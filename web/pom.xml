<!--
  ~ Copyright (C) 2001-2016 Food and Agriculture Organization of the
  ~ United Nations (FAO-UN), United Nations World Food Programme (WFP)
  ~ and United Nations Environment Programme (UNEP)
  ~
  ~ This program is free software; you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation; either version 2 of the License, or (at
  ~ your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but
  ~ WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  ~ General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program; if not, write to the Free Software
  ~ Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
  ~
  ~ Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
  ~ Rome - Italy. email: geonetwork@osgeo.org
  -->

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.geonetwork-opensource</groupId>
    <artifactId>geonetwork</artifactId>
    <version>3.3.0-SNAPSHOT</version>
  </parent>


  </dependencies>


  <build>
    <plugins>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>build-helper-maven-plugin</artifactId>
        <version>1.7</version>
        <executions>
          <execution>
            <id>add-source</id>
            <phase>generate-sources</phase>
            <goals>
              <goal>add-source</goal>
            </goals>
            <configuration>
              <sources>
                <source>${basedir}/src/main/java</source>
                <source>${basedir}/src/main/webapp/WEB-INF/classes/setup/sql/migrate</source>
              </sources>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-resources-plugin</artifactId>
        <version>2.5</version>
        <executions>
          <execution>
            <id>copy-filter-webResource</id>
            <phase>process-resources</phase>
            <goals>
              <goal>copy-resources</goal>
            </goals>
            <configuration>
              <escapeString>\</escapeString>
              <includeEmptyDirs>false</includeEmptyDirs>
              <outputDirectory>${build.webapp.resources}</outputDirectory>
              <resources>
                <resource>
                  <directory>${basedir}/src/main/webResources</directory>
                  <filtering>true</filtering>
                  <targetPath>${build.webapp.resources}</targetPath>
                </resource>
              </resources>
              <filters>
                <filter>${basedir}/src/main/filters/${env}.properties</filter>
                <filter>${basedir}/src/main/filters/deployment/config_${server}.properties</filter>
              </filters>
              <overwrite>true</overwrite>
            </configuration>
          </execution>
          <execution>
            <id>copy-schemas</id>
            <phase>process-resources</phase>
            <goals>
              <goal>copy-resources</goal>
            </goals>
            <configuration>
              <includeEmptyDirs>true</includeEmptyDirs>
              <overwrite>true</overwrite>
              <outputDirectory>${build.webapp.resources}</outputDirectory>
              <resources>
                <!-- Copy the schema folder to the webapp folder source directory
                in order to be loaded by the application when running mvn jetty:run.
                -->
                <resource>
                  <directory>${project.basedir}/../schemas/iso19139/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/iso19115-3/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/iso19139.myocean/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/iso19139.myocean.short/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/iso19139.emodnet.chemistry/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/iso19139.emodnet.hydrography/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/iso19139.sdn-product/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/iso19110/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/dublin-core/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <resource>
                  <directory>${project.basedir}/../schemas/csw-record/src/main/plugin</directory>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</targetPath>
                </resource>
                <!-- Copy the documentation in the webapp. -->
                <resource>
                  <directory>${project.basedir}/../docs/manuals/target/doc</directory>
                  <targetPath>${basedir}/src/main/webapp/doc</targetPath>
                </resource>
              </resources>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>buildnumber-maven-plugin</artifactId>
        <version>1.4</version>
        <executions>
          <execution>
            <phase>validate</phase>
            <goals>
              <goal>create</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <timestampFormat>{0,date,MM/dd/yyyy hh:mm:ss a}</timestampFormat>
          <doCheck>false</doCheck>
          <doUpdate>false</doUpdate>
          <revisionOnScmFailure>true</revisionOnScmFailure>
        </configuration>
      </plugin>

      <plugin>
        <artifactId>maven-war-plugin</artifactId>
        <configuration>
          <archive>
            <manifest>
              <addDefaultImplementationEntries>true</addDefaultImplementationEntries>
            </manifest>
            <manifestEntries>
              <Implementation-Build>${buildNumber}</Implementation-Build>
            </manifestEntries>
          </archive>
          <archiveClasses>true</archiveClasses>
          <!-- Filter resources according to current profile properties
              (see src/main/filters) and copy them to the webapp -->
          <webResources>
            <resource>
              <directory>${project.basedir}/../schemas</directory>
              <includes>
                <include>**/src/main/plugin/*</include>
              </includes>
              <targetPath>WEB-INF/data/config/schema_plugins</targetPath>
            </resource>
            <resource>
              <directory>${project.basedir}/../web-client/src/main/resources</directory>
            </resource>
            <resource>
              <directory>${project.basedir}/../web-ui/src/main/resources</directory>
            </resource>
            <resource>
              <directory>${build.webapp.resources}</directory>
            </resource>
          </webResources>
          <!-- <packagingExcludes>WEB-INF/data/**</packagingExcludes> -->
          <packagingExcludes>
            xml/schemas/**,
            catalog/lib/style/bootstrap/docs/**,
            catalog/lib/style/bootstrap/fonts/**,
            catalog/lib/style/bootstrap/grunt/**,
            catalog/lib/style/bootstrap/test-infra/**,
            catalog/lib/style/font-awesome/css/**,
            catalog/lib/style/font-awesome/src/**,
            catalog/lib/style/font-awesome/scss/**
          </packagingExcludes>
          <!--          <warSourceDirectory>src/main/geonetwork</warSourceDirectory> -->
          <webXml>${build.webapp.resources}/WEB-INF/web.xml</webXml>
          <attachClasses>true</attachClasses>
          <warName>${geonetwork.webapp.name}</warName>
          <webappDirectory>${project.build.directory}/geonetwork</webappDirectory>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.eclipse.jetty</groupId>
        <artifactId>jetty-maven-plugin</artifactId>
        <configuration>
          <contextXml>${basedir}/jetty-context.xml</contextXml>
          <webAppSourceDirectory>${project.build.directory}/geonetwork</webAppSourceDirectory>
          <webApp>
            <contextPath>/geonetwork</contextPath>
            <descriptor>${project.build.directory}/WEB-INF/web.xml</descriptor>
            <baseResource implementation="org.eclipse.jetty.util.resource.ResourceCollection">
              <resourcesAsCSV>
                ${project.basedir}/src/main/webapp,
                ${rootProjectDir}/web-ui/src/main/resources/,
                ${build.webapp.resources},
                ${rootProjectDir}/web-client/src/main/resources/</resourcesAsCSV>
            </baseResource>
          </webApp>
          <systemProperties>
            <systemProperty>
              <name>org.eclipse.jetty.server.Request.maxFormContentSize</name>
              <value>500000</value>
            </systemProperty>
          </systemProperties>
          <stopKey>JETTY_TOP</stopKey>
          <stopPort>8090</stopPort>
        </configuration>
      </plugin>
    </plugins>
  </build>

  <!-- Define profiles for running configuration using -Denv=profile.id parameter
    Profiles configuration is defined in src/main/filters.
    -->
  <profiles>
    <profile>
      <id>run-static-analysis</id>
      <activation>
        <property><name>!skipTests</name></property>
      </activation>
      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>findbugs-maven-plugin</artifactId>
          </plugin>
        </plugins>
      </build>
    </profile>
    <profile>
      <id>no-env-specified</id>
      <activation>
        <property>
          <name>!env</name>
        </property>
      </activation>
      <properties>
        <env>prod</env>
      </properties>
    </profile>
    <profile>
      <id>env-prod</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>default</server>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>env-dev</id>
      <activation>
        <property>
          <name>env</name>
          <value>dev</value>
        </property>
      </activation>
      <properties>
        <env>dev</env>
        <server>default</server>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>env-inspire</id>
      <activation>
        <property>
          <name>env</name>
          <value>inspire</value>
        </property>
      </activation>
      <properties>
        <env>inspire</env>
        <server>default</server>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>

    <!-- CLS myocean ro configuration profile -->
    <profile>
      <id>cls-myocean-ro</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>cls-myocean-ro</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork-myocean-ro</geonetwork.webapp.name>
      </properties>
    </profile>

    <!-- Sextant configuration profile -->
    <profile>
      <id>ifr-visi-sxt</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-visi-sxt</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-visi-sxt-6.5</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-visi-sxt-6.5</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-visi-sextant-nse</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-visi-sextant-nse</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-exp</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-exp</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-sextant-myocean</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-sextant-myocean</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-myocean-ro</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-myocean-ro</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork-myocean-ro</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-myocean-ro-exp</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-myocean-ro-exp</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork-myocean-ro</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-myocean-ro-visi1-sextant5</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-myocean-ro-visi1-sextant5</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork-myocean-ro-visi1-sextant5</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-myocean-integration</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-myocean-integration</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-myocean-test-tomcat1</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-myocean-test-tomcat1</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>ifr-myocean-int-tomcat1</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>ifr-myocean-int-tomcat1</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>pc55</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>pc55</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>karukera</id>
      <activation>
        <property>
          <name>env</name>
          <value>dev</value>
        </property>
      </activation>
      <properties>
        <env>dev</env>
        <server>karukera</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>fgravin_local</id>
      <activation>
        <property>
          <name>env</name>
          <value>dev</value>
        </property>
      </activation>
      <properties>
        <env>dev</env>
        <server>fgravin_local</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>jacroute_local</id>
      <activation>
        <property>
          <name>env</name>
          <value>dev</value>
        </property>
      </activation>
      <properties>
        <env>dev</env>
        <server>jacroute_local</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>aabt_local</id>
      <activation>
        <property>
          <name>env</name>
          <value>dev</value>
        </property>
      </activation>
      <properties>
        <env>dev</env>
        <server>aabt_local</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>

    <profile>
      <id>titellus</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>titellus</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>jeichar</id>
      <activation>
        <property>
          <name>env</name>
          <value>dev</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>jeichar</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <profile>
      <id>fgravin</id>
      <activation>
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
        <server>fgravin</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>
    <!-- Sextant configuration porfile / end -->
    <profile>
      <id>widgets</id>
      <properties>
        <web.xml.widget.config.overrides>/WEB-INF/config-overrides-widget.xml</web.xml.widget.config.overrides>
      </properties>
    </profile>
    <profile>
      <id>widgets-tab</id>
      <properties>
        <web.xml.widget.config.overrides>/WEB-INF/config-overrides-widgettab.xml</web.xml.widget.config.overrides>
      </properties>
    </profile>
    <profile>
      <id>html5ui</id>
      <properties>
        <web.xml.widget.config.overrides>/WEB-INF/config-overrides-html5ui.xml</web.xml.widget.config.overrides>
      </properties>
    </profile>
    <profile>
      <id>oguyot_local</id>
      <activation>
        <property>
          <name>env</name>
          <value>dev</value>
        </property>
      </activation>
      <properties>
        <env>dev</env>
        <server>oguyot_local</server>
        <widgets.webapp.resources>,../web-client/src/main/resources/</widgets.webapp.resources>
        <geonetwork.webapp.name>geonetwork</geonetwork.webapp.name>
      </properties>
    </profile>

    <profile>
      <id>es</id>
      <properties>
        <es.spring.profile>es</es.spring.profile>
      </properties>
    </profile>
  </profiles>

  <properties>
    <geonetwork.version>${project.version}</geonetwork.version>
    <geonetwork.subversion>SNAPSHOT</geonetwork.subversion>
    <geonetwork.webapp.dir>${basedir}/src/main/webapp</geonetwork.webapp.dir>
    <geonetwork.webapp.js.dir>${geonetwork.webapp.dir}/scripts</geonetwork.webapp.js.dir>
    <geonetwork.build.dir>${project.build.directory}/${project.build.finalName}</geonetwork.build.dir>
    <geonetwork.webapp.css.dir>${geonetwork.webapp.dir}</geonetwork.webapp.css.dir>
    <minify.verbose>false</minify.verbose>
    <build.webapp.resources>${project.build.directory}/webapp</build.webapp.resources>
    <web.xml.main.config.overrides>/WEB-INF/config-overrides-${env}.xml</web.xml.main.config.overrides>
    <web.xml.widget.config.overrides></web.xml.widget.config.overrides>
    <system.specific.overrides></system.specific.overrides>
    <rootProjectDir>${basedir}/..</rootProjectDir>
    <wro4jOutput>${project.build.directory}/wro4j-output/</wro4jOutput>
  </properties>
</project>
