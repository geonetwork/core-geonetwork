<!--
  ~ Copyright (C) 2001-2016 Food and Agriculture Organization of the
  ~ United Nations (FAO-UN), United Nations World Food Programme (WFP)
  ~ and United Nations Environment Programme (UNEP)
  ~
  ~ This program is free software; you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation; either version 2 of the License, or (at
  ~ your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but
  ~ WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  ~ General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program; if not, write to the Free Software
  ~ Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
  ~
  ~ Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
  ~ Rome - Italy. email: geonetwork@osgeo.org
  -->

<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://maven.apache.org/POM/4.0.0"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.geonetwork-opensource</groupId>
    <artifactId>geonetwork</artifactId>
    <version>4.4.5-SNAPSHOT</version>
  </parent>


  <!-- =========================================================== -->
  <!--     Module Description                                      -->
  <!-- =========================================================== -->
  <artifactId>gn-web-app</artifactId>
  <packaging>war</packaging>
  <name>GeoNetwork Web module</name>
  <description>GeoNetwork web module description (TODO).</description>

  <licenses>
    <license>
      <name>General Public License (GPL)</name>
      <url>http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt</url>
      <distribution>repo</distribution>
    </license>
  </licenses>


  <!-- FIXME set common dependencies to the root pom.xml  -->
  <dependencies>
    <dependency>
      <groupId>org.apache.logging.log4j</groupId>
      <artifactId>log4j-api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.apache.logging.log4j</groupId>
      <artifactId>log4j-core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.apache.logging.log4j</groupId>
      <artifactId>log4j-slf4j-impl</artifactId>
    </dependency>
    <dependency>
      <groupId>org.apache.logging.log4j</groupId>
      <artifactId>log4j-jul</artifactId>
    </dependency>
    <dependency>
      <groupId>org.tuckey</groupId>
      <artifactId>urlrewritefilter</artifactId>
    </dependency>

    <dependency>
      <groupId>org.antlr</groupId>
      <artifactId>antlr-runtime</artifactId>
      <version>3.5.2</version>
    </dependency>
    <dependency>
      <groupId>xalan</groupId>
      <artifactId>xalan</artifactId>
    </dependency>
    <dependency>
      <groupId>xalan</groupId>
      <artifactId>serializer</artifactId>
    </dependency>
    <dependency>
      <groupId>net.sf.saxon</groupId>
      <artifactId>saxon-dom</artifactId>
    </dependency>
    <dependency>
      <groupId>org.openrdf</groupId>
      <artifactId>openrdf-model</artifactId>
    </dependency>
    <dependency>
      <groupId>org.openrdf</groupId>
      <artifactId>openrdf-util</artifactId>
    </dependency>
    <dependency>
      <groupId>org.openrdf</groupId>
      <artifactId>sesame</artifactId>
    </dependency>
    <dependency>
      <groupId>org.openrdf</groupId>
      <artifactId>rio</artifactId>
    </dependency>
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-context</artifactId>
    </dependency>
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-orm</artifactId>
    </dependency>
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-tx</artifactId>
    </dependency>
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-webmvc</artifactId>
    </dependency>
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-web</artifactId>
    </dependency>
    <dependency>
      <groupId>org.jolokia</groupId>
      <artifactId>jolokia-core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-test</artifactId>
      <scope>compile</scope>
    </dependency>
    <dependency>
      <groupId>org.springdoc</groupId>
      <artifactId>springdoc-openapi-webmvc-core</artifactId>
    </dependency>
    <!-- Z39.50, SRU  stuff (ie: Spring, CQL, ...)  -->
    <dependency>
      <groupId>org.dspace</groupId>
      <artifactId>cql-java</artifactId>
    </dependency>
    <dependency>
      <groupId>org.jzkit</groupId>
      <artifactId>a2j</artifactId>
    </dependency>
    <dependency>
      <groupId>marc4j</groupId>
      <artifactId>marc4j</artifactId>
    </dependency>

    <dependency>
      <groupId>org.geotools</groupId>
      <artifactId>gt-xml</artifactId>
    </dependency>
    <dependency>
      <groupId>org.geotools.xsd</groupId>
      <artifactId>gt-xsd-gml3</artifactId>
    </dependency>
    <dependency>
      <groupId>org.geotools</groupId>
      <artifactId>gt-cql</artifactId>
    </dependency>
    <dependency>
      <groupId>org.geotools</groupId>
      <artifactId>gt-shapefile</artifactId>
    </dependency>
    <dependency>
      <groupId>org.geotools.xsd</groupId>
      <artifactId>gt-xsd-filter</artifactId>
    </dependency>
    <dependency>
      <groupId>org.geotools</groupId>
      <artifactId>gt-epsg-extension</artifactId>
    </dependency>
    <dependency>
      <groupId>org.geotools</groupId>
      <artifactId>gt-referencing</artifactId>
    </dependency>
    <dependency>
      <groupId>org.geotools</groupId>
      <artifactId>gt-epsg-hsql</artifactId>
    </dependency>
    <dependency>
      <groupId>org.geotools.jdbc</groupId>
      <artifactId>gt-jdbc-postgis</artifactId>
    </dependency>

    <dependency>
      <groupId>org.locationtech.jts</groupId>
      <artifactId>jts-core</artifactId>
    </dependency>
    <dependency>
      <groupId>pcj</groupId>
      <artifactId>pcj</artifactId>
    </dependency>
    <dependency>
      <groupId>org.apache.xmlgraphics</groupId>
      <artifactId>batik-ext</artifactId>
    </dependency>
    <dependency>
      <groupId>org.apache.httpcomponents</groupId>
      <artifactId>httpclient</artifactId>
    </dependency>
    <dependency>
      <groupId>commons-net</groupId>
      <artifactId>commons-net</artifactId>
    </dependency>
    <dependency>
      <groupId>org.apache.commons</groupId>
      <artifactId>commons-email</artifactId>
    </dependency>
    <dependency>
      <groupId>commons-digester</groupId>
      <artifactId>commons-digester</artifactId>
    </dependency>
    <dependency>
      <groupId>commons-io</groupId>
      <artifactId>commons-io</artifactId>
    </dependency>
    <dependency>
      <groupId>org.apache.xmlgraphics</groupId>
      <artifactId>xmlgraphics-commons</artifactId>
    </dependency>
    <dependency>
      <groupId>commons-collections</groupId>
      <artifactId>commons-collections</artifactId>
    </dependency>
    <dependency>
      <groupId>com.h2database</groupId>
      <artifactId>h2</artifactId>
    </dependency>
    <dependency>
      <groupId>org.postgresql</groupId>
      <artifactId>postgresql</artifactId>
    </dependency>
    <dependency>
      <groupId>org.postgis</groupId>
      <artifactId>postgis-jdbc</artifactId>
      <exclusions>
        <!-- excluded because it redefines some classes provided by the JDBC postgresql driver,
             polluting the classloader. -->
        <exclusion>
          <groupId>org.postgis</groupId>
          <artifactId>postgis-stubs</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
    </dependency>
    <!-- Not permitted under oracle licensing rules
    <dependency>
      <groupId>ojdbc</groupId>
      <artifactId>ojdbc</artifactId>
    </dependency>
        -->
    <dependency>
      <groupId>eu.medsea.mimeutil</groupId>
      <artifactId>mime-util</artifactId>
    </dependency>
    <dependency>
      <groupId>jaxen</groupId>
      <artifactId>jaxen</artifactId>
    </dependency>
    <dependency>
      <groupId>com.google.guava</groupId>
      <artifactId>guava</artifactId>
    </dependency>


    <dependency>
      <groupId>org.tmatesoft.svnkit</groupId>
      <artifactId>svnkit</artifactId>
    </dependency>

    <!-- Print service: MapFish -->
    <dependency>
      <groupId>com.github.librepdf</groupId>
      <artifactId>openpdf</artifactId>
    </dependency>
    <dependency>
      <groupId>org.mapfish.print</groupId>
      <artifactId>print-lib</artifactId>
      <exclusions>
        <exclusion>
          <groupId>com.lowagie</groupId>
          <artifactId>itext</artifactId>
        </exclusion>
        <exclusion>
          <groupId>commons-httpclient</groupId>
          <artifactId>commons-httpclient</artifactId>
        </exclusion>
        <!--
        <exclusion>
          <groupId>com.codahale.metrics</groupId>
          <artifactId>metrics-core</artifactId>
        </exclusion>
        <exclusion>
          <groupId>com.codahale.metrics</groupId>
          <artifactId>metrics-log4j</artifactId>
        </exclusion>
        <exclusion>
          <groupId>com.codahale.metrics</groupId>
          <artifactId>metrics-servlet</artifactId>
        </exclusion>
        <exclusion>
          <groupId>com.codahale.metrics</groupId>
          <artifactId>metrics-servlets</artifactId>
        </exclusion>
        <exclusion>
          <groupId>com.codahale.metrics</groupId>
          <artifactId>metrics-httpclient</artifactId>
        </exclusion>
        -->
        <exclusion>
          <groupId>com.google.guava</groupId>
          <artifactId>guava</artifactId>
        </exclusion>
        <exclusion>
          <groupId>org.springframework</groupId>
          <artifactId>spring-context</artifactId>
        </exclusion>
        <exclusion>
          <groupId>org.springframework</groupId>
          <artifactId>spring-web</artifactId>
        </exclusion>
        <exclusion>
          <groupId>xalan</groupId>
          <artifactId>xalan</artifactId>
        </exclusion>
        <exclusion>
          <groupId>xalan</groupId>
          <artifactId>serializer</artifactId>
        </exclusion>
        <exclusion>
          <groupId>org.apache.xmlgraphics</groupId>
          <artifactId>batik-transcoder</artifactId>
        </exclusion>
      </exclusions>
    </dependency>

    <!-- ====================== -->
    <!-- Generated dependencies -->
    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-cachingxslt</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-oaipmh</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency> <!-- dummy API for ARC SDE stuff -->
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-dummy-api</artifactId>
      <version>${project.version}</version>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-core</artifactId>
      <version>${project.version}</version>
      <exclusions>
        <exclusion>
          <groupId>javax.servlet</groupId>
          <artifactId>javax.servlet-api</artifactId>
        </exclusion>
      </exclusions>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-services</artifactId>
      <version>${project.version}</version>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-harvesters</artifactId>
      <version>${project.version}</version>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-health-monitor</artifactId>
      <version>${project.version}</version>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-inspire-atom</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-doi</artifactId>
      <version>${project.version}</version>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-listeners</artifactId>
      <version>${project.version}</version>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-translationproviders</artifactId>
      <version>${project.version}</version>
    </dependency>

    <!-- Handled locally by a temporarly repository -->
    <dependency>
      <groupId>dlib</groupId>
      <artifactId>dlib</artifactId>
    </dependency>
    <dependency>
      <groupId>lizard</groupId>
      <artifactId>lizard-tiff</artifactId>
    </dependency>
    <dependency>
      <groupId>jzkit</groupId>
      <artifactId>jzkit-core</artifactId>
      <version>3.r260.geonetwork.patch.1</version>
    </dependency>
    <dependency>
      <groupId>jzkit</groupId>
      <artifactId>jzkit-service</artifactId>
      <version>3.r260.geonetwork.patch.1</version>
    </dependency>
    <dependency>
      <groupId>jzkit</groupId>
      <artifactId>jzkit-z3950-server</artifactId>
      <version>3.r260.geonetwork.patch.1</version>
    </dependency>
    <dependency>
      <groupId>jzkit</groupId>
      <artifactId>jzkit-z3950-plugin</artifactId>
      <version>3.r260.geonetwork.patch.1</version>
    </dependency>
    <dependency>
      <groupId>jakarta</groupId>
      <artifactId>jakarta-slide-webdavlib</artifactId>
      <version>2.1</version>
    </dependency>
    <dependency>
      <groupId>edu.ucar</groupId>
      <artifactId>netcdf</artifactId>
    </dependency>

    <!-- Monitoring libraries -->
    <dependency>
      <groupId>com.yammer.metrics</groupId>
      <artifactId>metrics-core</artifactId>
    </dependency>
    <dependency>
      <groupId>com.yammer.metrics</groupId>
      <artifactId>metrics-servlet</artifactId>
    </dependency>
    <dependency>
      <groupId>com.yammer.metrics</groupId>
      <artifactId>metrics-web</artifactId>
    </dependency>
    <dependency>
      <groupId>com.yammer.metrics</groupId>
      <artifactId>metrics-log4j</artifactId>
    </dependency>
    <dependency>
      <groupId>opendap</groupId>
      <artifactId>opendap</artifactId>
      <version>2.1</version>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-web-ui</artifactId>
      <version>${project.version}</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-domain</artifactId>
      <version>${project.version}</version>
      <classifier>tests</classifier>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-core</artifactId>
      <version>${project.version}</version>
      <classifier>tests</classifier>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-services</artifactId>
      <version>${project.version}</version>
      <classifier>tests</classifier>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-wro4j</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>ro.isdc.wro4j</groupId>
      <artifactId>wro4j-maven-plugin</artifactId>
      <version>${wro.version}</version>
      <scope>test</scope>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-camelPeriodicProducer</artifactId>
      <version>${project.version}</version>
    </dependency>

    <dependency>
      <groupId>${project.groupId}</groupId>
      <artifactId>gn-wfsfeature-harvester</artifactId>
      <version>${project.version}</version>
      <exclusions>
        <exclusion>
          <groupId>org.mortbay.jetty</groupId>
          <artifactId>servlet-api</artifactId>
        </exclusion>
        <exclusion>
          <groupId>org.mortbay.jetty</groupId>
          <artifactId>servlet-api-2.5</artifactId>
        </exclusion>
        <exclusion>
          <groupId>org.apache.geronimo.specs</groupId>
          <artifactId>geronimo-servlet_3.0_spec</artifactId>
        </exclusion>
        <exclusion>
          <groupId>org.mortbay.jetty</groupId>
          <artifactId>jsp-api-2.1</artifactId>
        </exclusion>
      </exclusions>
    </dependency>

    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>javax.servlet-api</artifactId>
      <version>3.0.1</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>org.hibernate</groupId>
      <artifactId>hibernate-validator</artifactId>
    </dependency>
    <dependency>
      <groupId>org.mitre.dsmiley.httpproxy</groupId>
      <artifactId>smiley-http-proxy-servlet</artifactId>
      <version>1.12.1</version>
    </dependency>

    <!--Detect urls in String and transform to html format-->
    <dependency>
      <groupId>org.nibor.autolink</groupId>
      <artifactId>autolink</artifactId>
      <version>0.6.0</version>
    </dependency>
    <dependency>
      <groupId>org.powermock</groupId>
      <artifactId>powermock-module-junit4</artifactId>
      <scope>test</scope>
    </dependency>
    <!--
    Required for DB migration test
    like AdvancedSearchFormMigrationTest
    <dependency>
      <groupId>net.bytebuddy</groupId>
      <artifactId>byte-buddy</artifactId>
      <version>0.6.14</version>
      <scope>test</scope>
    </dependency>-->
    <!--
    Required by domain
    Invocation of init method failed; nested exception is
    java.lang.NoClassDefFoundError: net/bytebuddy/TypeCache
    org.springframework.beans.factory.BeanCreationException:
    Error creating bean with name 'entityManagerFactory' defined in URL
    -->
    <dependency>
      <groupId>net.bytebuddy</groupId>
      <artifactId>byte-buddy</artifactId>
      <version>1.10.10</version>
    </dependency>

    <!-- Add dependencies to built-in schema plugin having a custom bean to be loaded. -->
    <dependency>
      <groupId>org.geonetwork-opensource.schemas</groupId>
      <artifactId>gn-schema-iso19139</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.geonetwork-opensource.schemas</groupId>
      <artifactId>gn-schema-csw-record</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.geonetwork-opensource.schemas</groupId>
      <artifactId>gn-schema-iso19110</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.geonetwork-opensource.schemas</groupId>
      <artifactId>gn-schema-dublin-core</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.geonetwork-opensource.schemas</groupId>
      <artifactId>gn-schema-iso19115-3.2018</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.xmlunit</groupId>
      <artifactId>xmlunit-matchers</artifactId>
      <version>${xmlunit.version}</version>
      <scope>test</scope>
    </dependency>
  </dependencies>

  <build>
    <plugins>
      <!-- Generate a properties file with the commit hash to be displayed on the admin.console -->
	    <plugin>
        <groupId>io.github.git-commit-id</groupId>
        <artifactId>git-commit-id-maven-plugin</artifactId>
        <version>4.9.9</version>
        <executions>
          <execution>
            <phase>initialize</phase>
            <id>get-the-git-infos</id>
            <goals>
                <goal>revision</goal>
            </goals>
          </execution>
        </executions>

        <configuration>
          <dotGitDirectory>${project.basedir}/../.git</dotGitDirectory>
          <prefix>git</prefix>
          <dateFormat>yyyy-MM-dd'T'HH:mm:ssZ</dateFormat>
          <dateFormatTimeZone>${user.timezone}</dateFormatTimeZone>
          <verbose>false</verbose>
          <generateGitPropertiesFile>true</generateGitPropertiesFile>
          <generateGitPropertiesFilename>src/main/webResources/WEB-INF/classes/git.properties</generateGitPropertiesFilename>
          <!-- Denotes the format to save properties in. Valid options are "properties" (default) and "json". Properties will be saved to the generateGitPropertiesFilename if generateGitPropertiesFile is set to `true`. -->
          <format>properties</format>
          <skipPoms>true</skipPoms>
          <injectAllReactorProjects>true</injectAllReactorProjects>
          <failOnNoGitDirectory>false</failOnNoGitDirectory>
          <failOnUnableToExtractRepoInfo>false</failOnUnableToExtractRepoInfo>
          <skip>false</skip>
          <runOnlyOnce>false</runOnlyOnce>
          <excludeProperties>
          </excludeProperties>
          <includeOnlyProperties>
            <includeOnlyProperty>^git.tags$</includeOnlyProperty>
            <includeOnlyProperty>^git.branch$</includeOnlyProperty>
            <includeOnlyProperty>^git.commit.id$</includeOnlyProperty>
            <includeOnlyProperty>^git.build.time$</includeOnlyProperty>
          </includeOnlyProperties>
          <replacementProperties>
          </replacementProperties>
          <useNativeGit>false</useNativeGit>
          <abbrevLength>7</abbrevLength>
          <commitIdGenerationMode>flat</commitIdGenerationMode>
          <gitDescribe>
            <skip>false</skip>
            <always>false</always>
            <abbrev>7</abbrev>
            <dirty>-dirty</dirty>
            <match>*</match>
            <tags>true</tags>
            <forceLongFormat>false</forceLongFormat>
          </gitDescribe>
          <!-- @since 2.2.2 -->
          <!--
              Since version **2.2.2** the maven-git-commit-id-plugin comes equipped with an additional validation utility which can be used to verify if your project properties are set as you would like to have them set.
              *Note*: This configuration will only be taken into account when the additional goal `validateRevision` is configured inside an execution.
          -->
          <validationProperties>
            <validationProperty>
              <!--
                   A descriptive name that will be used to be able to identify the validation that does not match up (will be displayed in the error message).
              -->
              <name>validating project version</name>
              <!--
                   the value that needs the validation
                   *Note* : In order to be able to validate the generated git-properties inside the pom itself you may need to set the configuration `<injectAllReactorProjects>true</injectAllReactorProjects>`.
              -->
              <value>${project.version}</value>
              <!--
                  the expected value
              -->
              <shouldMatchTo><![CDATA[^.*(?<!-SNAPSHOT)$]]></shouldMatchTo>
            </validationProperty>
            <!-- the next validationProperty you would like to validate -->
          </validationProperties>
          <validationShouldFailIfNoMatch>false</validationShouldFailIfNoMatch>
        </configuration>
      </plugin>
      <plugin>
        <artifactId>maven-clean-plugin</artifactId>
        <configuration>
          <filesets>
            <fileset>
              <directory>${schema-plugins.dir}</directory>
              <includes>
                <include>**/*</include>
              </includes>
              <followSymlinks>false</followSymlinks>
            </fileset>
          </filesets>
        </configuration>
        <executions>
          <execution>
            <id>reset</id>
            <goals><goal>clean</goal></goals>
            <configuration>
              <filesets>
                <fileset>
                  <directory>${user.home}</directory>
                  <includes>
                    <include>gn.mv.db</include>
                    <include>gn.trace.db</include>
                  </includes>
                </fileset>
                <!-- reset working files covered by .gitignore -->
                <fileset>
                  <directory>.</directory>
                  <includes>
                    <include>*.db</include>
                    <include>*.db.old</include>
                    <include>images/**</include>
                    <include>jcs_caching/**</include>
                    <include>logs/**</include>
                  </includes>
                </fileset>
                <fileset>
                  <directory>src/main/webapp/</directory>
                  <includes>
                    <include>META-INF/MANIFEST.MF</include>
                    <include>data/**</include>
                    <include>doc/en/**</include>
                    <include>doc/fr/**</include>
                    <include>images/logos/*</include>
                    <include>images/logos/statTmp</include>
                    <include>scripts/lib/**</include>
                  </includes>
                </fileset>
                <fileset>
                  <directory>src/main/webapp/WEB-INF/</directory>
                  <includes>
                    <include>data/0*</include>
                    <include>data/config/schema_plugins/**</include>
                    <include>data/config/schemaplugin-uri-catalog.xml</include>
                    <include>data/data/backup/**</include>
                    <include>data/data/metadata_data/**</include>
                    <include>data/data/metadata_subversion/**</include>
                    <include>data/data/resources/htmlcache/**</include>
                    <!--include>data/data/resources/images/**</include-->
                    <include>data/data/schema_plugins/**</include>
                    <include>data/data/resources/xml/**</include>
                    <include>data/data/upload/**</include>
                    <include>data/harvester_*</include>
                    <include>data/index/**</include>
                    <include>data/node_less_files/**</include>
                    <include>data/removed/**</include>
                    <include>data/wro4j*.db</include>
                    <include>data/wro4j-cache*</include>
                    <include>data/data_*</include>
                    <include>data/lucene/**</include>
                    <include>metadata_subversion/</include>
                  </includes>
                </fileset>
              </filesets>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>build-helper-maven-plugin</artifactId>
        <executions>
          <execution>
            <id>add-source</id>
            <phase>generate-sources</phase>
            <goals>
              <goal>add-source</goal>
            </goals>
            <configuration>
              <sources>
                <source>${basedir}/src/main/java</source>
                <source>${basedir}/src/main/webapp/WEB-INF/classes/setup/sql/migrate</source>
              </sources>
            </configuration>
          </execution>
          <execution>
            <id>add-test-resource</id>
            <phase>generate-test-resources</phase>
            <goals>
              <goal>add-test-resource</goal>
            </goals>
            <configuration>
              <resources>
                <resource>
                  <directory>${basedir}/src/main/webapp/xslt</directory>
                  <targetPath>resources/xslt</targetPath>
                </resource>
              </resources>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-resources-plugin</artifactId>
        <executions>
          <execution>
            <id>copy-filter-webResource</id>
            <phase>process-resources</phase>
            <goals>
              <goal>copy-resources</goal>
            </goals>
            <configuration>
              <escapeString>\</escapeString>
              <includeEmptyDirs>false</includeEmptyDirs>
              <outputDirectory>${build.webapp.resources}</outputDirectory>
              <resources>
                <resource>
                  <directory>${basedir}/src/main/webResources</directory>
                  <filtering>true</filtering>
                  <targetPath>${build.webapp.resources}</targetPath>
                </resource>
              </resources>
              <filters>
                <filter>${basedir}/src/main/filters/${env}.properties</filter>
              </filters>
              <overwrite>true</overwrite>
            </configuration>
          </execution>
          <execution>
            <id>copy-index-schema-to-source</id>
            <phase>process-resources</phase>
            <goals>
              <goal>copy-resources</goal>
            </goals>
            <configuration>
              <escapeString>\</escapeString>
              <includeEmptyDirs>false</includeEmptyDirs>
              <outputDirectory>${basedir}/src/main/webapp/WEB-INF/data/config/index</outputDirectory>
              <resources>
                <resource>
                  <directory>${basedir}/src/main/webResources/WEB-INF/data/config/index</directory>
                  <filtering>true</filtering>
                  <targetPath>${basedir}/src/main/webapp/WEB-INF/data/config/index</targetPath>
                </resource>
              </resources>
              <overwrite>true</overwrite>
            </configuration>
          </execution>
          <execution>
            <id>copy-encryptor-config-to-source</id>
            <phase>process-resources</phase>
            <goals>
              <goal>copy-resources</goal>
            </goals>
            <configuration>
              <escapeString>\</escapeString>
              <includeEmptyDirs>false</includeEmptyDirs>
              <outputDirectory>${basedir}/src/main/webapp/WEB-INF/data/config</outputDirectory>
              <resources>
                <resource>
                  <directory>${basedir}/src/main/webResources/WEB-INF/data/config</directory>
                  <filtering>true</filtering>
                  <includes>
                    <include>encryptor.properties</include>
                  </includes>
                </resource>
              </resources>
              <overwrite>false</overwrite>
            </configuration>
          </execution>
          <execution>
            <id>copy-web-ui-wro-sources</id>
            <phase>process-resources</phase>
            <goals>
              <goal>copy-resources</goal>
            </goals>
            <configuration>
              <outputDirectory>${project.build.outputDirectory}</outputDirectory>
              <resources>
                <resource>
                  <directory>${project.basedir}/../web-ui/src/main/resources/WEB-INF/classes</directory>
                  <filtering>false</filtering>
                  <includes>
                    <include>web-ui-wro-sources.xml</include>
                  </includes>
                </resource>
              </resources>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <artifactId>maven-war-plugin</artifactId>
        <configuration>
          <archive>
            <manifest>
              <addDefaultImplementationEntries>true</addDefaultImplementationEntries>
            </manifest>
            <manifestEntries>
              <Implementation-Build>${git.commit.id}</Implementation-Build>
            </manifestEntries>
          </archive>
          <archiveClasses>true</archiveClasses>
          <!-- Filter resources according to current profile properties
              (see src/main/filters) and copy them to the webapp -->
          <webResources>
            <resource>
              <directory>${project.basedir}/../schemas</directory>
              <includes>
                <include>**/src/main/plugin/*</include>
              </includes>
              <targetPath>WEB-INF/data/config/schema_plugins</targetPath>
            </resource>
            <resource>
              <directory>${project.basedir}/../web-ui/src/main/resources</directory>
            </resource>
            <resource>
              <directory>${build.webapp.resources}</directory>
            </resource>
            <resource>
              <directory>${project.build.directory}</directory>
              <includes>
                <include>wro4j-cache.mv.db</include>
              </includes>
              <targetPath>WEB-INF/prebuilt</targetPath>
            </resource>
          </webResources>
          <!-- <packagingExcludes>WEB-INF/data/**</packagingExcludes> -->

          <packagingExcludes>
            xml/schemas/**,
            WEB-INF/data/*.db,
            WEB-INF/data/index/**,
            WEB-INF/data/data/backup/**,
            WEB-INF/data/data/resources/htmlcache/**,
            catalog/lib/style/font-awesome/.github/**,
            catalog/lib/style/font-awesome/js/**,
            catalog/lib/style/font-awesome/js-packages/**,
            catalog/lib/style/font-awesome/metadata/**,
            catalog/lib/style/font-awesome/sprites/**,
            catalog/lib/style/font-awesome/otfs/**,
            catalog/lib/style/font-awesome/scss/**,
            catalog/lib/style/font-awesome/svgs/**,
            catalog/lib/style/font-awesome/*.json,
            catalog/lib/style/font-awesome/*.txt,
            catalog/lib/style/font-awesome/*.md,
            catalog/lib/style/bootstrap/*.json,
            catalog/lib/style/bootstrap/Gemfile*,
            catalog/lib/style/bootstrap/.*,
            catalog/lib/style/bootstrap/*.txt,
            catalog/lib/style/bootstrap/*.yml,
            catalog/lib/style/bootstrap/*.js,
            catalog/lib/style/bootstrap/*.md,
            catalog/lib/style/bootstrap/CNAME,
            catalog/lib/style/bootstrap/docs/en/**,
            catalog/lib/style/bootstrap/docs/fr/**,
            catalog/lib/style/bootstrap/fonts/**,
            catalog/lib/style/bootstrap/nuget/**,
            catalog/lib/style/bootstrap/grunt/**,
            catalog/lib/style/bootstrap/test-infra/**,
            catalog/lib/bootstrap-table/*.json,
            catalog/lib/bootstrap-table/Gemfile*,
            catalog/lib/bootstrap-table/.*,
            catalog/lib/bootstrap-table/*.txt,
            catalog/lib/bootstrap-table/*.md,
            catalog/lib/bootstrap-table/docs/**
          </packagingExcludes>
          <!--          <warSourceDirectory>src/main/geonetwork</warSourceDirectory> -->
          <webXml>${build.webapp.resources}/WEB-INF/web.xml</webXml>
          <attachClasses>true</attachClasses>
          <warName>${application.name}</warName>
          <webappDirectory>${project.build.directory}/geonetwork</webappDirectory>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.eclipse.jetty</groupId>
        <artifactId>jetty-maven-plugin</artifactId>
        <configuration>
          <contextXml>${basedir}/jetty-context.xml</contextXml>
          <webAppSourceDirectory>${project.build.directory}/geonetwork</webAppSourceDirectory>
          <webApp>
            <contextPath>${geonetwork.webapp.contextpath}</contextPath>
            <descriptor>${project.build.directory}/WEB-INF/web.xml</descriptor>
            <baseResource implementation="org.eclipse.jetty.util.resource.ResourceCollection">
              <resourcesAsCSV>
                ${project.basedir}/src/main/webapp,
                ${rootProjectDir}/web-ui/src/main/resources/,
                ${build.webapp.resources}
              </resourcesAsCSV>
            </baseResource>
          </webApp>
          <systemProperties>
            <systemProperty>
              <name>org.eclipse.jetty.server.Request.maxFormContentSize</name>
              <value>5000000</value>
            </systemProperty>
            <systemProperty>
              <name>org.eclipse.jetty.server.Request.maxFormKeys</name>
              <value>8000</value>
            </systemProperty>
            <systemProperty>
              <name>org.eclipse.jetty.classInheritanceMap</name>
              <value>true</value>
            </systemProperty>
          </systemProperties>
          <httpConnector>
            <port>${jetty.port}</port>
          </httpConnector>
          <stopKey>JETTY_TOP</stopKey>
          <stopPort>${jetty.stop.port}</stopPort>
        </configuration>
      </plugin>


    </plugins>
  </build>

  <profiles>
    <profile>
      <id>wro4j-prebuild-cache</id>
      <activation>
        <property>
          <name>prebuild-cache</name>
          <value>true</value>
        </property>
      </activation>
      <build>
        <plugins>
          <!-- build WRO4J Cache during build time -->
          <plugin>
            <groupId>ro.isdc.wro4j</groupId>
            <artifactId>wro4j-maven-plugin</artifactId>
            <version>${wro.version}</version>
            <dependencies>
              <dependency>
                <groupId>org.webjars.npm</groupId>
                <artifactId>glob</artifactId>
                <version>7.1.1</version>
              </dependency>
            </dependencies>
            <executions>
              <execution>
                <id>wro4j-prebuild-cache</id>
                <phase>prepare-package</phase>
                <goals>
                  <goal>run</goal>
                </goals>
                <configuration>
                  <wroManagerFactory>org.fao.geonet.wro4j.GeonetworkMavenNoTestsWrojManagerFactory</wroManagerFactory>
                  <extraConfigFile>${build.webapp.resources}/WEB-INF/wro-maven.properties</extraConfigFile>
                  <wroFile>${project.build.directory}/geonetwork/WEB-INF/wro-sources-maven.xml</wroFile>
                  <destinationFolder>${wro4jOutput}</destinationFolder>
                  <targetGroups>lib,lib3d,gn_search,gn_search_default,gn_login,gn_login_default,gn_editor,gn_editor_default,gn_admin,gn_admin_default,nv.d3,gn_fonts,gn_inspire,gn_pickers,gn_print_default,ng-skos,bootstrap-table.min</targetGroups>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

    <!-- Unpack schema resources from maven artifacts -->
    <profile>
      <id>schemas-unpack</id>
      <activation>
        <property><name>schemasCopy</name><value>!true</value></property>
      </activation>
      <build>
        <plugins>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-dependency-plugin</artifactId>
            <executions>
              <execution>
                <id>unpack-schemas</id>
                <phase>process-resources</phase>
                <goals><goal>unpack</goal></goals>
                <configuration>
                  <encoding>UTF-8</encoding>
                  <artifactItems>
                    <!-- unpack built-in schema plugins into schema-plugins directory -->
                    <artifactItem>
                      <groupId>org.geonetwork-opensource.schemas</groupId>
                      <artifactId>gn-schema-iso19139</artifactId>
                      <type>zip</type>
                      <overWrite>false</overWrite>
                      <outputDirectory>${schema-plugins.dir}</outputDirectory>
                    </artifactItem>
                    <artifactItem>
                      <groupId>org.geonetwork-opensource.schemas</groupId>
                      <artifactId>gn-schema-csw-record</artifactId>
                      <type>zip</type>
                      <overWrite>false</overWrite>
                      <outputDirectory>${schema-plugins.dir}</outputDirectory>
                    </artifactItem>
                    <artifactItem>
                      <groupId>org.geonetwork-opensource.schemas</groupId>
                      <artifactId>gn-schema-iso19110</artifactId>
                      <type>zip</type>
                      <overWrite>false</overWrite>
                      <outputDirectory>${schema-plugins.dir}</outputDirectory>
                    </artifactItem>
                    <artifactItem>
                      <groupId>org.geonetwork-opensource.schemas</groupId>
                      <artifactId>gn-schema-dublin-core</artifactId>
                      <type>zip</type>
                      <overWrite>false</overWrite>
                      <outputDirectory>${schema-plugins.dir}</outputDirectory>
                    </artifactItem>
                    <artifactItem>
                      <groupId>org.geonetwork-opensource.schemas</groupId>
                      <artifactId>gn-schema-iso19115-3.2018</artifactId>
                      <type>zip</type>
                      <overWrite>false</overWrite>
                      <outputDirectory>${schema-plugins.dir}</outputDirectory>
                    </artifactItem>
                  </artifactItems>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

    <!-- Copy schema resources using relative paths -->
    <profile>
      <id>schemas-copy</id>
      <activation> <!-- use -DcopySchemas=true to activate       -->
        <property><name>schemasCopy</name><value>true</value></property>
      </activation>
      <!-- Add dependencies to schema plugin having a custom Bean to be loaded. -->
      <dependencies>
        <!-- add schema_plugins -->
      </dependencies>
      <build>
        <plugins>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-antrun-plugin</artifactId>
            <executions>
              <execution>
                <id>copy-schemas-ant</id>
                <phase>process-resources</phase>
                <goals>
                  <goal>run</goal>
                </goals>
                <configuration>
                    <!-- Copy all the src/main/plugin folders in schemas to the webapp folder
                    in order to be loaded by the application when running mvn jetty:run.
                    -->
                  <target description="copy from schemas to schema_plugins folder">
                    <copy todir="${schema-plugins.dir}" preservelastmodified="true">
                      <fileset dir="${basedir}/../schemas/">
                        <include name="**/src/main/plugin/**"/>
                      </fileset>
                      <regexpmapper handledirsep="yes"
                        from="^[-_\.a-zA-Z0-9]+/src/main/plugin/(.*)"
                          to="\1" />
                    </copy>
                  </target>
                </configuration>
              </execution>
            </executions>
          </plugin>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-resources-plugin</artifactId>
            <!-- copy schema resources using relative paths -->
            <executions>
              <execution>
                <id>copy-schemas</id>
                <phase>process-resources</phase>
                <goals>
                  <goal>copy-resources</goal>
                </goals>
                <configuration>
                  <includeEmptyDirs>true</includeEmptyDirs>
                  <overwrite>true</overwrite>
                  <outputDirectory>${build.webapp.resources}</outputDirectory>
                  <resources>
                    <!-- Copy src/main/plugin folder to webapp folder source directory
                    in order to be loaded by the application when running mvn jetty:run.
                    -->
                    <!--
                    <resource>
                      <directory>metadata101/iso19139.xyz/src/main/plugin</directory>
                      <targetPath>${schema-plugins.dir}</targetPath>
                    </resource>
                    -->
                  </resources>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

    <profile>
      <id>run-static-analysis</id>
      <activation>
        <property>
          <name>!skipTests</name>
        </property>
      </activation>
      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>findbugs-maven-plugin</artifactId>
          </plugin>
        </plugins>
      </build>
    </profile>

    <!--
    Define profiles for running configuration using -Denv=profile.id parameter
    Profiles configuration is defined in src/main/filters.
    -->
    <profile>
      <id>no-env-specified</id>
      <activation>
        <property> <!-- default -->
          <name>!env</name>
        </property>
      </activation>
      <properties>
        <env>prod</env>
      </properties>
    </profile>
    <profile>
      <id>env-prod</id>
      <activation> <!-- -Denv=prod -->
        <property>
          <name>env</name>
          <value>prod</value>
        </property>
      </activation>
      <properties>
        <env>prod</env>
      </properties>
    </profile>
    <profile>
      <id>env-dev</id>
      <activation>
        <property> <!-- -Denv=dev -->
          <name>env</name>
          <value>dev</value>
        </property>
      </activation>
      <properties>
        <env>dev</env>
        <wro.debug>true</wro.debug>
      </properties>
    </profile>
    <profile>
      <id>env-inspire</id>
      <activation> <!-- -Denv=inspire -->
        <property>
          <name>env</name>
          <value>inspire</value>
        </property>
      </activation>
      <properties>
        <env>inspire</env>
      </properties>
    </profile>

    <profile>
      <id>with-doc</id>
      <dependencies>
        <dependency>
          <groupId>${project.groupId}</groupId>
          <artifactId>gn-guide</artifactId>
          <version>${project.version}</version>
          <classifier>help</classifier>
          <type>zip</type>
        </dependency>
      </dependencies>

      <build>
        <plugins>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-resources-plugin</artifactId>
            <executions>
              <execution>
                <id>copy-documentation</id>
                <phase>process-resources</phase>
                <goals>
                  <goal>copy-resources</goal>
                </goals>
                <configuration>
                  <includeEmptyDirs>true</includeEmptyDirs>
                  <overwrite>true</overwrite>
                  <outputDirectory>${build.webapp.resources}</outputDirectory>
                  <resources>
                    <resource>
                      <directory>${project.basedir}/../docs/manual/target/help</directory>
                      <targetPath>${basedir}/src/main/webapp/doc/en</targetPath>
                    </resource>
                  </resources>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

    <profile>
      <id>slave</id>
      <dependencies>
        <dependency>
          <groupId>${project.groupId}</groupId>
          <artifactId>slave</artifactId>
          <version>${project.version}</version>
        </dependency>
      </dependencies>
    </profile>

    <profile>
      <id>datastorage-cmis</id>
      <dependencies>
        <dependency>
          <groupId>org.geonetwork-opensource.datastorage</groupId>
          <artifactId>gn-datastorage-cmis</artifactId>
          <version>${project.version}</version>
        </dependency>
      </dependencies>
    </profile>

    <profile>
      <id>datastorage-jcloud</id>
      <dependencies>
        <dependency>
          <groupId>org.geonetwork-opensource.datastorage</groupId>
          <artifactId>gn-datastorage-jcloud</artifactId>
          <version>${project.version}</version>
        </dependency>
      </dependencies>
    </profile>

    <profile>
      <id>datastorage-s3</id>
      <dependencies>
        <dependency>
          <groupId>org.geonetwork-opensource.datastorage</groupId>
          <artifactId>gn-datastorage-s3</artifactId>
          <version>${project.version}</version>
        </dependency>
      </dependencies>
    </profile>

    <profile>
      <id>war</id>
      <dependencies>
        <dependency>
          <groupId>org.slf4j</groupId>
          <artifactId>slf4j-api</artifactId>
          <version>1.7.36</version>
        </dependency>
      </dependencies>
    </profile>
  </profiles>

  <properties>
    <geonetwork.version>${project.version}</geonetwork.version>
    <geonetwork.subversion>SNAPSHOT</geonetwork.subversion>
    <geonetwork.webapp.dir>${basedir}/src/main/webapp</geonetwork.webapp.dir>
    <geonetwork.webapp.js.dir>${geonetwork.webapp.dir}/scripts</geonetwork.webapp.js.dir>
    <geonetwork.build.dir>${project.build.directory}/${project.build.finalName}</geonetwork.build.dir>
    <geonetwork.webapp.contextpath>/${application.name}</geonetwork.webapp.contextpath>
    <schema-plugins.dir>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins</schema-plugins.dir>
    <geonetwork.webapp.css.dir>${geonetwork.webapp.dir}</geonetwork.webapp.css.dir>
    <minify.verbose>false</minify.verbose>
    <build.webapp.resources>${project.build.directory}/webapp</build.webapp.resources>
    <rootProjectDir>${basedir}/..</rootProjectDir>
    <wro4jOutput>${project.build.directory}/wro4j-output/</wro4jOutput>
  </properties>
</project>
