<div class="wrapper" data-ng-controller="gnViewerController as ctrl"
  ng-class="{'leftBarExpanded': isContainerOpened()}">
  <div class="sxt-main-tabs">

    <sxt-tab-switcher />
  </div>
  <div id="map" ol-map="map" class="map"></div>
  <div gn-gfi="" dismiss=".popover" map="map"></div>
  <gn-features-tables gn-features-tables-map="map"
    gn-active="isContainerOpened()"></gn-features-tables>

  <!-- profile graph (data will come through the service) -->
  <gn-profile map="map"></gn-profile>

  <!-- Left buttons - Tools-->
  <div class="tools main-tools" ng-class="{'activeTool': isContainerOpened(), 'sxt-maximize-layer-tools': active.maximized }">

    <div gi-btn-group class="sxt-panel-button">
      <button class="btn btn-default" ng-model="activeTools.layers" type="submit" rel="#layers" gi-btn="active">
        <span class="fsxt">c</span>
        <span role="tooltip" data-translate="">Layers</span>
      </button>
      <button class="btn btn-default" ng-model="activeTools.import" type="submit" rel="#importLayer" gi-btn="active">
        <span class="fsxt">d</span>
        <span role="tooltip" data-translate="">add</span>
      </button>
      <button class="btn btn-default" ng-model="activeTools.contexts" type="submit" rel="#contexts" gi-btn="active">
        <span class="fa fa-bookmark"></span>
        <span role="tooltip" data-translate="">Contexts</span>
      </button>
      <button class="btn btn-default" ng-model="activeTools.print" type="submit" rel="#print" gi-btn="active">
        <span class="fa fa-print"></span>
        <span role="tooltip" data-translate="">Print</span>
      </button>
      <button gi-btn="active" class="btn btn-default" type="submit" ng-model="mInteraction.active" rel="#measures">
        <span class="fsxt">a</span>
        <span role="tooltip" data-translate="">Measure</span>
      </button>
      <button gi-btn="active" class="btn btn-default" type="submit" rel="#draw" ng-model="drawVector.active">
        <span class="fa fa-pencil"></span>
        <span role="tooltip" data-translate="">Annotations</span>
      </button>
      <button ng-if="benthique" gi-btn="active" class="btn btn-default" type="submit" rel="#benthique" ng-model="activeTools.benthique">
        <span class="fa fa-anchor"></span>
        <span role="tooltip" data-translate="">Esp√®ces benthiques</span>
      </button>

      <button ng-if="::processes && processes.length == 1" gi-btn="active"
        class="btn btn-default" ng-model="activeTools.processes" type="submit"
        rel="#process-panel">
        <span class="fa fa-cogs"></span>
        <span role="tooltip" data-translate>wpsProcess</span>
      </button>

      <!--Hidden btn to bind activeTools.processes in thg gi-btn-grp-->
      <button ng-if="::processes && processes.length > 1" gi-btn
              class="hidden" ng-model="activeTools.processes"></button>
      <div class="btn-group" role="group" sxt-popover-dropdown placement="bottom"
        className="sxt-popover-grid" container="{{container}}"
        ng-if="::processes && processes.length > 1">
        <button class="btn btn-default dropdown-toggle" data-toggle="dropdown"
          ng-class="{active: activeTools.processes}">
          <span class="fa fa-cogs"></span>
          <span role="tooltip" data-translate>wpsProcesses</span>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right text-left">
          <li data-ng-repeat="p in ::processes">
            <a ng-click="selectProcess(p, true)">
              <span class="fa fa-cog"></span>
              {{ ::getProcessLabel(p) }}
            </a>
          </li>
        </ul>
      </div>


    </div>
    <div class="panel-tools-container" ng-class="{'sxt-tab-open': isContainerOpened() }">

      <!--Layer tree & background layers-->
      <div class="panel panel-default panel-tools" id="layers" gnv-layermanager-btn ng-show="activeTools.layers">
        <div class="layers clearfix" ng-class="{'layers-tools-expanded': active.layersTools}">


          <div class="sxt-layertree">
            <div gn-baselayerswitcher="" gn-baselayerswitcher-map="map"></div>
            <div gn-terrain-switcher="ol3d"
                 ng-show="is3dEnabled"></div>
            <div sxt-layertree="map"></div>
          </div>

          <hr class="sxt-layer-separator">
          <div class="btn-group sxt-layer-tabs sxt-ncwms-tabs" ng-show="layerTabs.ncwms.active">
            <button class="btn btn-default btn-xs" ng-click="layerTabSelect('ncwms')" ng-class="{'active': layerTabs.ncwms.active}">
              <span class="tools-bar-close-btn pull-right">&times;</span>
              <span translate>ncwms</span>
            </button>
          </div>
          <div class="btn-group sxt-layer-tabs sxt-ncwms-tabs" ng-show="layerTabs.wps.active">
            <button class="btn btn-default btn-xs" ng-click="layerTabSelect('wps')" ng-class="{'active': layerTabs.wps.active}">
              <span class="tools-bar-close-btn pull-right">&times;</span>
              <span translate>process</span>
            </button>
          </div>
          <div class="btn-group sxt-layer-tabs sxt-ncwms-tabs" ng-show="layerTabs.wfsfilter.active">
            <button class="btn btn-default btn-xs" ng-click="layerTabSelect('wfsfilter')" ng-class="{'active': layerTabs.wfsfilter.active}">
              <span class="tools-bar-close-btn pull-right">&times</span>
              <span translate>filter</span>
            </button>
          </div>
          <div class="btn-group sxt-layer-tabs sxt-ncwms-tabs" ng-show="layerTabs.annotations.active">
            <button class="btn btn-default btn-xs" ng-click="layerTabSelect('annotations')" ng-class="{'active': layerTabs.annotations.active}">
              <span class="tools-bar-close-btn pull-right">&times</span>
              <span translate>annotations</span>
            </button>
          </div>
          <button class="btn btn-default btn-xs" sxt-layer-tools-toggle>
            <i class="fa" ng-class="{ 'fa-plus': !active.maximized, 'fa-minus': active.maximized }"></i>
          </button>
          <button class="tools-bar-close-btn tools-bar-close-btn-single pull-right" ng-class="{'sxt-hidden': isSeparatedTool()}"
                  ng-show="isLayerTabActive()" ng-click="closeLayerTab()"><span class="">&times;</span>
          </button>

          <div class="btn-group sxt-layer-tabs" ng-class="{'sxt-hidden': isSeparatedTool()}">
            <button class="btn btn-default btn-xs" ng-click="layerTabSelect('legend')" ng-class="{'active': layerTabs.legend.active}">
              <span translate>legend</span>
            </button>
            <button class="btn btn-default btn-xs" ng-click="layerTabSelect('sort')" ng-class="{'active': layerTabs.sort.active}">
              <span translate>sort</span>
            </button>
            <button class="btn btn-default btn-xs" ng-click="layerTabSelect('source')" ng-class="{'active': layerTabs.source.active}">
              <span translate>source</span>
            </button>
          </div>


          <tabset class="sxt-layers-tabset">

            <tab active="layerTabs.legend.active" select="handleTabParsing()">
              <tab-heading>
                <i class="fa fa-picture-o fa-fw"></i>
                <span translate>legends</span>
              </tab-heading>
              <div class="panel-carousel" gn-legend-panel="map"></div>
            </tab>

            <tab active="layerTabs.sort.active">
              <tab-heading>
                <i class="fa fa-sort fa-fw"></i>
                <span translate>sort</span>
              </tab-heading>
              <div class="panel-carousel" gn-layerorder-panel="map"></div>
            </tab>

            <tab active="layerTabs.source.active">
              <tab-heading>
                <i class="fa fa-info fa-fw"></i>
                <span translate>sources</span>
              </tab-heading>
              <div class="panel-carousel" gn-layersources-panel="map"></div>
            </tab>

            <tab active="layerTabs.ncwms.active">
              <tab-heading>
                <i class="fa fa-anchor fa-fw"></i>
                <span translate>ncwms</span>
              </tab-heading>
              <div class="panel panel-default panel-ncwms-container ncwms-root" ng-if="active.NCWMS">
                <div class="panel-heading">{{active.NCWMS.get('label')}}</div>
                <div gn-ncwms-transect map="map" layer="active.NCWMS"></div>
              </div>
            </tab>

            <tab active="layerTabs.wps.active">
              <tab-heading>
                <i class="fa fa-cog"></i>
                <span translate>process</span>
              </tab-heading>
              <div class="wps-container">
                <div class="sxt-wps-panel">
                  <gn-wps-process-form ng-if="layerTabs.wps.active" map="map"
                    wps-link="wpsLink" wfs-link="wfsLink"/>
                </div>
              </div>
            </tab>

            <tab active="layerTabs.wfsfilter.active">
              <tab-heading>
                <i class="fa fa-cog"></i>
                <span translate>filter</span>
              </tab-heading>
              <div class="wps-container"
                advanced="{ updateOnImageLoad: false, autoScrollOnFocus: false }">
                <div class="sxt-wfsfilter-panel"></div>
              </div>
            </tab>

            <tab active="layerTabs.annotations.active">
              <tab-heading>
                <i class="fa fa-pencil"></i>
                <span translate>annotations</span>
              </tab-heading>
              <div>
                <sxt-annotations-editor map="map"
                                        layer="active.ANNOTATIONS"
                                        ng-if="layerTabs.annotations.active">
                </sxt-annotations-editor>
              </div>
            </tab>

          </tabset>

        </div>
      </div>

      <!--Import layer WMS,WMTS,KML-->
      <div class="panel panel-default panel-tools" id="importLayer" gnv-layermanager-btn ng-show="activeTools.import">
        <div class="panel-body">

          <div class="btn-group flux">
            <button type="button" class="btn btn-default" data-translate="">LayerWMS</button>
            <button type="button" class="btn btn-default" data-translate="">LayerWMTS</button>
            <button type="button" class="btn btn-default" data-translate="">LayerKML</button>
          </div>

          <div class="panel-carousel-window">
            <div class="panel-carousel-container">
              <div class="panel-carousel" gn-wms-import="wms" gn-wms-import-map="map" gn-wms-import-url=""></div>
              <div class="panel-carousel" gn-wms-import="wmts" gn-wms-import-map="map" gn-wms-import-url=""></div>
              <div class="panel-carousel" gn-kml-import="" gn-kml-import-map="map"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel panel-default panel-tools" id="contexts" ng-show="activeTools.contexts">

      <div class="panel-body">
        <div gn-ows-context="" map="map"
          template="../../catalog/views/sextant/templates/owscontext/owscontext.html">
        </div>
      </div>
    </div>

      <!--Measure Info Panel-->
      <div class="panel panel-default panel-tools" id="measures" ng-show="mInteraction.active">
        <div class="panel-body panel-sm">
          <div class="gn-measure-text">
            <div class="alert alert-warning hidden-print" translate>measure_instruction</div>
            <dl class="dl-horizontal">
              <dt>{{'Distance' | translate}}</dt>
              <dd>{{measureObj.distance}}</dd>
              <dt>{{'Surface' | translate}}</dt>
              <dd ng-bind-html="measureObj.surface"></dd>
            </dl>
          </div>
        </div>
      </div>

      <!--Draw Panel-->
      <div class="panel panel-default panel-tools" id="draw" ng-show="drawVector.active">
        <div class="panel-body">
          <div class="gn-draw-styleform" gn-draw="" map="map" vector="drawVector">
          </div>
        </div>
      </div>

      <!--Espece benthique panel-->
      <div ng-if="benthique" class="panel panel-default panel-tools" id="benthique" ng-show="activeTools.benthique">
        <div class="panel-body">
          <h5 data-translate="">benthiqueSpicies</h5>
          <div class="sxt-benthique" sxtb-panel="map">
          </div>
        </div>
      </div>

      <!--process panel-->
      <div class="panel panel-default panel-tools" id="process-panel" ng-show="activeTools.processes">
        <div class="panel-body">
          <gn-wps-process-form ng-if="activeTools.processes" map="map"
            wps-link="selectedProcess"/>
        </div>
      </div>

    <div class="panel panel-default panel-tools" id="print" ng-show="activeTools.print">

      <div class="panel-body">
        <div gn-mapprint="" print-active="activeTools.print" map="map"></div>
      </div>
    </div>

      </div>

  </div>


  <!--Top right buttons - Navigation-->
  <div ng-if="hasGeoSearch" class="btn-group sx-toolbar tools" gn-localisation-input map="map"></div>

  <!--Top right buttons - Navigation-->
  <div class="tools control-tools">
    <button class="btn btn-default btn-zoomin" type="submit" data-ng-click="zoom(map,1)">
      <span class="fa fa-plus"></span>
      <span role="tooltip" data-translate="">Zoom</span>
    </button>
    <button class="btn btn-default btn-maxextent" type="submit" data-ng-click="zoomToMaxExtent(map)">
      <span class="fa fa-globe"></span>
      <span role="tooltip" data-translate="">maxExtentZoom</span>
    </button>
    <button class="btn btn-default btn-zoomout" type="submit" data-ng-click="zoom(map,-1)">
      <span class="fa fa-minus"></span>
      <span role="tooltip" data-translate="">ZoomOut</span>
    </button>

    <!-- graticule: hidden if no layer info given -->
    <button gn-graticule-btn="map" class="btn btn-default" type="submit"
      ng-if="graticuleOgcService" graticule-ogc-service="graticuleOgcService">
    </button>

    <button ng-if="profileTool" class="btn btn-default btn-profiletool" type="submit" sxt-profile-tool="map"
            wps-link="profileTool">
      <span class="fa fa-area-chart"></span>
      <span role="tooltip" translate>profileToolTooltip</span>
    </button>

    <button class="btn btn-default" type="submit" sxt-full-screen="map">
      <span class="fa fa-expand"></span>
      <span role="tooltip" data-translate="">fullScreen</span>
    </button>
    <button class="btn btn-default" type="submit"
            data-ng-if="is3DModeAllowed"
            data-ng-click="switch2D3D(map)">
      <span class="fa fa-cube"
            data-ng-class="is3dEnabled ? 'fa-cube' : 'fa-square-o'"/>
      <span role="tooltip" data-translate="">switchFrom2DTo3D</span>
    </button>
  </div>


  <footer ng-class="{'leftBarExpanded': isContainerOpened()}">
    <div sxt-mouse-position></div>
  </footer>

</div>
