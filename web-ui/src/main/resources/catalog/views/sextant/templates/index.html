<div class="gn-search-page container-fluid" data-ng-controller="GnSearchController">
  <div class="hfull" data-ng-controller="gnsSextant" id="sxt-controller">

    <!-- show alerts here only in API mode (otherwise they are in base-layout.xsl) -->
    <div data-gn-alert-manager="" ng-if="gnUrl"></div>

    <tabset class="hfull" id="main-tabset" type="pills">
      <tab ng-if="mainTabs.search" heading="{{mainTabs.search.title}}" active="mainTabs.search.active" class="sxt-scroll">

        <div class="sxt-main-tabs sxt-search-tab">

          <sxt-tab-switcher></sxt-tab-switcher>

          <!-- login button -->
          <div class="btn-group sxt-adminbtn pull-right"
               ng-if="allowLogin && !authenticated">
            <a type="button" class="btn btn-default"
               ng-if="allowLogin && !authenticated" href="{{getSignInUrl()}}"
               title="{{'signIn'|translate}}">
              <i class="fa fa-sign-in"></i>
              <span data-translate="">signIn</span>
            </a>
          </div>

          <!-- registered user info-->
          <div class="btn-group sxt-adminbtn pull-right"
               ng-if="authenticated && !user.isEditorOrMore()">
            <span class="btn btn-default btn-static dropdown-toggle">
              <span ng-if="user.name && user.surname">{{user.name}} {{user.surname}}</span>
              <span ng-if="!user.name || !user.surname">{{user.username}}</span>
            </span>
          </div>

          <!-- admin button-->
          <div class="btn-group sxt-adminbtn pull-right"
               ng-if="authenticated && user.isEditorOrMore()">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
              <span class="fa fa-cog"></span>&nbsp;
              <span translate class="hidden-sm hidden-xs">administration</span>&nbsp;
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
              <li class="btn-static"><a>
                <i class="fa fa-user"></i>&nbsp;
                <span ng-if="user.name && user.surname">{{user.name}} {{user.surname}}</span>
                <span ng-if="!user.name || !user.surname">{{user.username}}</span>
                </a></li>
              <li role="separator" class="divider"></li>
              <li data-ng-if="user.isAdministrator()"><a href="{{gnUrl}}admin.console">
                <i class="fa fa-th"></i>&nbsp;<span translate>adminConsole</span></a></li>
              <li><a title="{{'adminConsole' | translate}}" href="{{gnUrl}}catalog.edit#/create" target="_blank">
                <i class="fa fa-file-o"></i>&nbsp;<span translate>mdNew</span></a></li>
              <li><a href="{{gnUrl}}catalog.edit#/import" target="_blank">
                <i class="fa fa-arrow-circle-o-up"></i>&nbsp;<span translate>mdImport</span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="{{getSignOutUrl()}}" title="{{'signout' | translate}}">
                <i class="fa fa-sign-out"></i>&nbsp;{{'signout' | translate}}</a></li>
            </ul>
          </div>
        </div>

        <div class="hfull sxt-search-main-container" data-ng-controller="gnsSextantSearch" data-ng-class="{'sxt-scroll' : tabOverflow.search}"
             data-ng-hide="inMdView">


          <form data-ng-search-form="" class="hfull" role="form" runsearch="true">

            <div class="row hfull">

              <div class="maincol hfull sxt-left-panel col-md-4"
                   data-ng-include="'../../catalog/views/sextant/templates/searchForm.html'">
              </div>
              <div gn-grid-related-query="searchResults.records"></div>

              <div class="maincol hfull sxt-center-panel col-md-8">
                <div class="panel panel-default hfull">
                  <div class="panel-heading" data-ng-show="searchResults.count > 0">

                      <!--sort by combo-->
                      <div sortby-combo params="searchObj.params"
                           gn-sortby="searchObj.sortBy"
                           gn-sortby-values="searchObj.sortbyValues"
                           template="../../catalog/views/sextant/templates/formfields/sortByCombo.html"
                           class="pull-right"></div>

                      <div class="pull-left" data-gn-pagination="paginationInfo"
                           data-hits-values="searchObj.hitsperpageValues"
                           template="../../catalog/views/sextant/templates/formfields/pagination.html">
                      </div>
                  </div>
                  <span class="loading fa fa-spinner fa-spin" ng-show="searching"></span>
                  <div class="noresult alert alert-warning ng-scope" role="alert" ng-if="!searching && searchResults.count == 0">
                    <span data-translate="">noResult</span>
                  </div>
                  <div gn-results-container search-results="searchResults" template-url="resultTemplate" map="searchObj.searchMap" data-ng-show="searchResults.count > 0">
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </tab>
      <tab ng-if="mainTabs.map" select="displayMapTab()" active="mainTabs.map.active">
        <tab-heading>
          {{mainTabs.map.title}}
          <span class="badge" ng-if="mainTabs.map.titleInfo">{{mainTabs.map.titleInfo}}</span>
        </tab-heading>
        <div sxt-main-viewer="" map="searchObj.viewerMap" class="gn-main-viewer">
        </div>
      </tab>
      <tab ng-if="mainTabs.panier" select="displayPanierTab()" active="mainTabs.panier.active">
        <tab-heading>
          {{mainTabs.panier.title}}
          <span class="badge" ng-if="mainTabs.panier.titleInfo">{{mainTabs.panier.titleInfo}}</span>
        </tab-heading>

        <div sxt-panier="searchObj.panier" data-ng-hide="inMdView"
             data-ng-class="{'sxt-scroll' : tabOverflow.search}"></div>
      </tab>

    </tabset>
  </div>
</div>

<!-- this will hide the page while it is loading, and is removed on window.load
  everything is specified inline because the stylesheet is not available yet -->
<div class="sxt-loading"
  style="position: absolute;
  top: 0px;
  left: 0px;
  right: 0px;
  height: inherit;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: #F3F3F3;
  color: #818181;
  z-index: 1000;">
  <span style="margin-bottom: 8px">Loading...</span>
  <i class="fa fa-spinner fa-spin fa-lg"/>
</div>
