Ext.namespace("Ext.ux.form");
Ext.ux.form.TwinTriggerComboBox=function(config){Ext.ux.form.TwinTriggerComboBox.superclass.constructor.apply(this,arguments)
};
Ext.extend(Ext.ux.form.TwinTriggerComboBox,Ext.form.ComboBox,{trigger1Class:"x-form-clear-trigger",trigger2Class:"",trigger3Class:"x-form-trigger3-trigger",hideTrigger1:true,tooltipType:"qtip",initComponent:function(){Ext.ux.form.TwinTriggerComboBox.superclass.initComponent.call(this);
this.addEvents({clear:true,trigger3:true});
this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger3Class}]}
},getTrigger:function(index){return this.triggers[index]
},initTrigger:function(){var ts=this.trigger.select(".x-form-trigger",true);
var triggerField=this;
ts.each(function(t,all,index){t.hide=function(){var w=triggerField.wrap.getWidth();
this.dom.style.display="none";
triggerField.el.setWidth(w-triggerField.trigger.getWidth())
};
t.show=function(){var w=triggerField.wrap.getWidth();
this.dom.style.display="";
triggerField.el.setWidth(w-triggerField.trigger.getWidth())
};
var triggerIndex="Trigger"+(index+1);
if(this["hide"+triggerIndex]){t.dom.style.display="none"
}t.on("click",this["on"+triggerIndex+"Click"],this,{preventDefault:true});
t.addClassOnOver("x-form-trigger-over");
t.addClassOnClick("x-form-trigger-click")
},this);
this.triggers=ts.elements;
if(this.trigger3TipConfig){var config={target:this.getTrigger(2)};
for(var i in this.helpTipConfig){config[i]=this.helpTipConfig[i]
}var tip=new Ext.ToolTip(config)
}if(this.trigger3TipConfig){if(typeof this.trigger3TipConfig=="object"){Ext.QuickTips.register(Ext.apply({target:this.getTrigger(2)},this.trigger3TipConfig))
}else{this.getTrigger(2).dom[this.tooltipType]=this.trigger3TipConfig
}}},onTrigger1Click:function(){this.clearValue();
this.triggerBlur.defer(50,this)
},onTrigger2Click:function(){this.onTriggerClick()
},onTrigger3Click:function(){this.fireEvent("trigger3Click",this)
},onSelect:function(record,index){Ext.ux.form.TwinTriggerComboBox.superclass.onSelect.apply(this,[record,index]);
this.triggers[0].show()
},clearValue:function(){Ext.ux.form.TwinTriggerComboBox.superclass.clearValue.call(this);
this.triggers[0].hide();
this.fireEvent("clear",this)
},insert:function(index,data){this.reset();
var rec=new this.store.recordType(data);
rec.id=rec.data.id;
this.store.insert(index,rec);
this.setValue(rec.data.id);
this.fireEvent("select",this,rec,index)
}});
Ext.reg("twintriggercombo",Ext.ux.form.TwinTriggerComboBox);/*
 * Ext Core Library $version&#xD;&#xA;http://extjs.com/&#xD;&#xA;Copyright(c) 2006-2009, $author.&#xD;&#xA;&#xD;&#xA;The MIT License&#xD;&#xA;&#xD;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xD;&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xD;&#xA;in the Software without restriction, including without limitation the rights&#xD;&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xD;&#xA;copies of the Software, and to permit persons to whom the Software is&#xD;&#xA;furnished to do so, subject to the following conditions:&#xD;&#xA;&#xD;&#xA;The above copyright notice and this permission notice shall be included in&#xD;&#xA;all copies or substantial portions of the Software.&#xD;&#xA;&#xD;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xD;&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xD;&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xD;&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xD;&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xD;&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xD;&#xA;THE SOFTWARE.&#xD;&#xA;
 */
Ext.ns("Ext.ux");
Ext.ux.RatingItem=Ext.extend(Ext.Component,{starWidth:16,resetValue:"",defaultConfig:{defaultSelected:-1,nbStars:5,split:1,selected:-1,showTitles:true,cls:"",disabled:false},constructor:function(element,config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
Ext.ux.RatingItem.superclass.constructor.call(this);
this.addEvents("change","reset");
if(element==undefined){element=document.createElement("div");
element.className=this.itemCls;
this.text="";
for(var i=0;
i<(this.nbStars*this.split);
i++){this.text+='<input type="radio" name="rating'+this.id+'" value="'+(i+1)/this.split+'" '+((i+1)/this.split==this.defaultSelected?' checked="true"':"")+'"/>'
}element.innerHTML=this.text
}this.el=Ext.get(element);
this.init()
},onRender:function(){Ext.ux.RatingItem.superclass.onRender.apply(this,arguments)
},init:function(){var disabled=this.disabled;
this.values=[];
this.titles=[];
this.stars=[];
this.container=this.el.createChild({cls:"ux-rating-container ux-rating-clearfix"+this.cls});
if(this.canReset){this.resetEl=this.container.createChild({cls:"ux-rating-reset",cn:[{tag:"a",title:this.showTitles?(this.resetTitle||"Reset your vote"):"",html:"Reset"}]});
this.resetEl.visibilityMode=Ext.Element.DISPLAY;
this.resetEl.hover(function(){Ext.fly(this).addClass("ux-rating-reset-hover")
},function(){Ext.fly(this).removeClass("ux-rating-reset-hover")
});
this.resetEl.on("click",this.reset,this)
}this.radioBoxes=this.el.select("input[type=radio]");
this.radioBoxes.each(this.initStar,this);
this.input=this.container.createChild({tag:"input",type:"hidden",name:this.name,value:this.values[this.defaultSelected]||this.resetValue});
this.radioBoxes.remove();
this.select(this.defaultSelected===undefined?false:this.defaultSelected);
if(disabled){this.disable()
}else{this.enable()
}},initStar:function(item,all,i){var sw=Math.floor(this.starWidth/this.split);
if(i==0){this.name=item.dom.name;
this.disabled=item.dom.disabled
}this.values[i]=item.dom.value;
this.titles[i]=item.dom.title;
if(item.dom.checked){this.defaultSelected=i
}var star=this.container.createChild({cls:"ux-rating-star"});
var starLink=star.createChild({tag:"a",html:this.values[i],title:this.showTitles?this.titles[i]:""});
if(this.split){var odd=(i%this.split);
star.setWidth(sw);
starLink.setStyle("margin-left","-"+(odd*sw)+"px")
}this.stars.push(star.dom)
},onStarClick:function(ev,t){if(!this.disabled){this.select(this.stars.indexOf(t))
}},onStarOver:function(ev,t){if(!this.disabled){this.fillTo(this.stars.indexOf(t),true)
}},onStarOut:function(ev,t){if(!this.disabled){this.fillTo(this.selected,false)
}},reset:function(ev,t){this.select(-1)
},select:function(index){if(index===false||index===-1){this.value=this.resetValue;
this.title="";
this.input.dom.value="";
if(this.canReset){this.resetEl.setOpacity(0.5)
}this.fillNone();
if(this.selected!==-1){this.fireEvent("change",this,this.values[index],this.stars[index])
}this.selected=-1
}else{if(index!==this.selected){this.selected=index;
this.value=this.values[index];
this.title=this.titles[index];
this.input.dom.value=this.value;
if(this.canReset){this.resetEl.setOpacity(0.99)
}this.fillTo(index,false);
this.fireEvent("change",this,this.values[index],this.stars[index])
}}},fillTo:function(index,hover){if(index!=-1){var addClass=hover?"ux-rating-star-hover":"ux-rating-star-on";
var removeClass=hover?"ux-rating-star-on":"ux-rating-star-hover";
Ext.each(this.stars.slice(0,index+1),function(){Ext.fly(this).removeClass(removeClass).addClass(addClass)
});
Ext.each(this.stars.slice(index+1),function(){Ext.fly(this).removeClass([removeClass,addClass])
})
}else{this.fillNone()
}},fillNone:function(){this.container.select(".ux-rating-star").removeClass(["ux-rating-star-hover","ux-rating-star-on"])
},enable:function(){if(this.canReset){this.resetEl.show()
}this.input.dom.disabled=null;
this.disabled=false;
this.container.removeClass("ux-rating-disabled");
this.container.on({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"})
},disable:function(){if(this.canReset){this.resetEl.hide()
}this.input.dom.disabled=true;
this.disabled=true;
this.container.addClass("ux-rating-disabled");
this.container.un({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"})
},getValue:function(){return this.values[this.selected]||this.resetValue
},destroy:function(){this.disable();
this.container.remove();
this.radioBoxes.appendTo(this.el);
if(this.selected!==-1){this.radioBoxes.elements[this.selected].checked=true
}}});
Ext.reg("ratingitem",Ext.ux.RatingItem);Ext.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.form.FileUploadField.superclass.initComponent.call(this);
this.addEvents("fileselected")
},onRender:function(ct,position){Ext.form.FileUploadField.superclass.onRender.call(this,ct,position);
this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});
this.el.addClass("x-form-file-text");
this.el.dom.removeAttribute("name");
this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});
var btnCfg=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});
this.button=new Ext.Button(Ext.apply(btnCfg,{renderTo:this.wrap,cls:"x-form-file-btn"+(btnCfg.iconCls?" x-btn-icon":"")}));
if(this.buttonOnly){this.el.hide();
this.wrap.setWidth(this.button.getEl().getWidth())
}this.fileInput.on("change",function(){var v=this.fileInput.dom.value;
this.setValue(v);
this.fireEvent("fileselected",this,v)
},this)
},getFileInputId:function(){return this.id+"-file"
},onResize:function(w,h){Ext.form.FileUploadField.superclass.onResize.call(this,w,h);
this.wrap.setWidth(w);
if(!this.buttonOnly){var w=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;
this.el.setWidth(w)
}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap
},getPositionEl:function(){return this.wrap
},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])
}});
Ext.reg("fileuploadfield",Ext.form.FileUploadField);Ext.ns("Ext.ux.form");
Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"m/d/y",timeFormat:"g:i A",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);
var dateConfig=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);
this.df=new Ext.form.DateField(dateConfig);
this.df.ownerCt=this;
delete (this.dateFormat);
var timeConfig=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);
this.tf=new Ext.form.TimeField(timeConfig);
this.tf.ownerCt=this;
delete (this.timeFormat);
this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);
this.relayEvents(this.tf,["focus","specialkey","invalid","valid"])
},onRender:function(ct,position){if(this.isRendered){return
}Ext.ux.form.DateTime.superclass.onRender.call(this,ct,position);
var t;
if("below"===this.timePosition||"bellow"===this.timePosition){t=Ext.DomHelper.append(ct,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true)
}else{t=Ext.DomHelper.append(ct,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true)
}this.tableEl=t;
this.wrap=t.wrap({cls:"x-form-field-wrap"});
this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});
this.df.render(t.child("td.ux-datetime-date"));
this.tf.render(t.child("td.ux-datetime-time"));
if(Ext.isIE&&Ext.isStrict){t.select("input").applyStyles({top:0})
}this.on("specialkey",this.onSpecialKey,this);
this.df.el.swallowEvent(["keydown","keypress"]);
this.tf.el.swallowEvent(["keydown","keypress"]);
if("side"===this.msgTarget){var elp=this.el.findParent(".x-form-element",10,true);
this.errorIcon=elp.createChild({cls:"x-form-invalid-icon"});
this.df.errorIcon=this.errorIcon;
this.tf.errorIcon=this.errorIcon
}this.el.dom.name=this.hiddenName||this.name||this.id;
this.df.el.dom.removeAttribute("name");
this.tf.el.dom.removeAttribute("name");
this.isRendered=true;
this.updateHidden()
},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])
},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)
},clearInvalid:function(){this.df.clearInvalid();
this.tf.clearInvalid()
},markInvalid:function(msg){this.df.markInvalid(msg);
this.tf.markInvalid(msg)
},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();
this.wrap.remove();
this.tableEl.remove();
this.df.destroy();
this.tf.destroy()
}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;
this.df.onDisable();
this.tf.onDisable()
}this.disabled=true;
this.df.disabled=true;
this.tf.disabled=true;
this.fireEvent("disable",this);
return this
},enable:function(){if(this.rendered){this.df.onEnable();
this.tf.onEnable()
}this.disabled=false;
this.df.disabled=false;
this.tf.disabled=false;
this.fireEvent("enable",this);
return this
},focus:function(){this.df.focus()
},getPositionEl:function(){return this.wrap
},getResizeEl:function(){return this.wrap
},getValue:function(){return this.dateValue?new Date(this.dateValue):""
},isValid:function(){return this.df.isValid()&&this.tf.isValid()
},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()
},onBlur:function(f){if(this.wrapClick){f.focus();
this.wrapClick=false
}if(f===this.df){this.updateDate()
}else{this.updateTime()
}this.updateHidden();
(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var v=this.getValue();
if(String(v)!==String(this.startValue)){this.fireEvent("change",this,v,this.startValue)
}this.hasFocus=false;
this.fireEvent("blur",this)
}}).defer(100,this)
},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;
this.startValue=this.getValue();
this.fireEvent("focus",this)
}},onMouseDown:function(e){if(!this.disabled){this.wrapClick="td"===e.target.nodeName.toLowerCase()
}},onSpecialKey:function(t,e){var key=e.getKey();
if(key===e.TAB){if(t===this.df&&!e.shiftKey){e.stopEvent();
this.tf.focus()
}if(t===this.tf&&e.shiftKey){e.stopEvent();
this.df.focus()
}}if(key===e.ENTER){this.updateValue()
}},setDate:function(date){this.df.setValue(date)
},setTime:function(date){this.tf.setValue(date)
},setSize:function(w,h){if(!w){return
}if("below"===this.timePosition){this.df.setSize(w,h);
this.tf.setSize(w,h);
if(Ext.isIE){this.df.el.up("td").setWidth(w);
this.tf.el.up("td").setWidth(w)
}}else{this.df.setSize(w-this.timeWidth-4,h);
this.tf.setSize(this.timeWidth,h);
if(Ext.isIE){this.df.el.up("td").setWidth(w-this.timeWidth-4);
this.tf.el.up("td").setWidth(this.timeWidth)
}}},setValue:function(val){if(!val&&true===this.emptyToNow){this.setValue(new Date());
return
}else{if(!val){this.setDate("");
this.setTime("");
this.updateValue();
return
}}if("number"===typeof val){val=new Date(val)
}else{if("string"===typeof val&&this.hiddenFormat){val=Date.parseDate(val,this.hiddenFormat)
}}val=val?val:new Date(1970,0,1,0,0,0);
var da,time;
if(val instanceof Date){this.setDate(val);
this.setTime(val);
this.dateValue=new Date(val)
}else{da=val.split(this.dtSeparator);
this.setDate(da[0]);
if(da[1]){if(da[2]){da[1]+=da[2]
}this.setTime(da[1])
}}this.updateValue()
},setVisible:function(visible){if(visible){this.df.show();
this.tf.show()
}else{this.df.hide();
this.tf.hide()
}return this
},show:function(){return this.setVisible(true)
},hide:function(){return this.setVisible(false)
},updateDate:function(){var d=this.df.getValue();
if(d){if(!(this.dateValue instanceof Date)){this.initDateValue();
if(!this.tf.getValue()){this.setTime(this.dateValue)
}}this.dateValue.setMonth(0);
this.dateValue.setFullYear(d.getFullYear());
this.dateValue.setMonth(d.getMonth(),d.getDate())
}else{this.dateValue="";
this.setTime("")
}},updateTime:function(){var t=this.tf.getValue();
if(t&&!(t instanceof Date)){t=Date.parseDate(t,this.tf.format)
}if(t&&!this.df.getValue()){this.initDateValue();
this.setDate(this.dateValue)
}if(this.dateValue instanceof Date){if(t){this.dateValue.setHours(t.getHours());
this.dateValue.setMinutes(t.getMinutes());
this.dateValue.setSeconds(t.getSeconds())
}else{this.dateValue.setHours(0);
this.dateValue.setMinutes(0);
this.dateValue.setSeconds(0)
}}},updateHidden:function(){if(this.isRendered){var value=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";
this.el.dom.value=value
}},updateValue:function(){this.updateDate();
this.updateTime();
this.updateHidden();
return
},validate:function(){return this.df.validate()&&this.tf.validate()
},renderer:function(field){var format=field.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;
format+=" "+(field.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);
var renderer=function(val){var retval=Ext.util.Format.date(val,format);
return retval
};
return renderer
}});
Ext.reg("xdatetime",Ext.ux.form.DateTime);/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");
Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(config){Ext.apply(this,config);
this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});
Ext.ux.grid.RowExpander.superclass.constructor.call(this);
if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)
}this.tpl.compile()
}this.state={};
this.bodyContent={}
},getRowClass:function(record,rowIndex,p,ds){p.cols=p.cols-1;
var content=this.bodyContent[record.id];
if(!content&&!this.lazyRender){content=this.getBodyContent(record,rowIndex)
}if(content){p.body=content
}return this.state[record.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"
},init:function(grid){this.grid=grid;
var view=grid.getView();
view.getRowClass=this.getRowClass.createDelegate(this);
view.enableRowBody=true;
grid.on("render",this.onRender,this);
grid.on("destroy",this.onDestroy,this)
},onRender:function(){var grid=this.grid;
var mainBody=grid.getView().mainBody;
mainBody.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});
if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})
}if(this.expandOnDblClick){grid.on("rowdblclick",this.onRowDblClick,this)
}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();
delete this.keyNav
}var mainBody=this.grid.getView().mainBody;
if(mainBody){mainBody.un("mousedown",this.onMouseDown,this)
}},onRowDblClick:function(grid,rowIdx,e){this.toggleRow(rowIdx)
},onEnter:function(e){var g=this.grid;
var sm=g.getSelectionModel();
var sels=sm.getSelections();
for(var i=0,len=sels.length;
i<len;
i++){var rowIdx=g.getStore().indexOf(sels[i]);
this.toggleRow(rowIdx)
}},getBodyContent:function(record,index){if(!this.enableCaching){return this.tpl.apply(record.data)
}var content=this.bodyContent[record.id];
if(!content){content=this.tpl.apply(record.data);
this.bodyContent[record.id]=content
}return content
},onMouseDown:function(e,t){e.stopEvent();
var row=e.getTarget(".x-grid3-row");
this.toggleRow(row)
},renderer:function(v,p,record){p.cellAttr='rowspan="2"';
return'<div class="x-grid3-row-expander">&#160;</div>'
},beforeExpand:function(record,body,rowIndex){if(this.fireEvent("beforeexpand",this,record,body,rowIndex)!==false){if(this.tpl&&this.lazyRender){body.innerHTML=this.getBodyContent(record,rowIndex)
}return true
}else{return false
}},toggleRow:function(row){if(typeof row=="number"){row=this.grid.view.getRow(row)
}this[Ext.fly(row).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](row)
},expandRow:function(row){if(typeof row=="number"){row=this.grid.view.getRow(row)
}var record=this.grid.store.getAt(row.rowIndex);
var body=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",row);
if(this.beforeExpand(record,body,row.rowIndex)){this.state[record.id]=true;
Ext.fly(row).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");
this.fireEvent("expand",this,record,body,row.rowIndex)
}},collapseRow:function(row){if(typeof row=="number"){row=this.grid.view.getRow(row)
}var record=this.grid.store.getAt(row.rowIndex);
var body=Ext.fly(row).child("tr:nth(1) div.x-grid3-row-body",true);
if(this.fireEvent("beforecollapse",this,record,body,row.rowIndex)!==false){this.state[record.id]=false;
Ext.fly(row).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");
this.fireEvent("collapse",this,record,body,row.rowIndex)
}}});
Ext.preg("rowexpander",Ext.ux.grid.RowExpander);
Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Array.prototype.contains=function(element){return this.indexOf(element)!==-1
};
Ext.namespace("Ext.ux");
Ext.ux.DDView=function(config){if(!config.itemSelector){var tpl=config.tpl;
if(this.classRe.test(tpl)){config.tpl=tpl.replace(this.classRe,"class=$1x-combo-list-item $2$1")
}else{config.tpl=tpl.replace(this.tagRe,'$1 class="x-combo-list-item" $2')
}config.itemSelector=".x-combo-list-item"
}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(config,{border:false}))
};
Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);
if(this.dragGroup){this.setDraggable(this.dragGroup.split(","))
}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","))
}if(this.deletable){this.setDeletable()
}this.isDirtyFlag=false;
this.addEvents("drop")
},validate:function(){return true
},destroy:function(){this.purgeListeners();
this.getEl().removeAllListeners();
this.getEl().remove();
if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy()
}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy()
}}},getName:function(){return this.name
},setValue:function(v){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store"
}var data={};
data[this.store.reader.meta.root]=v?[].concat(v):[];
this.store.proxy=new Ext.data.MemoryProxy(data);
this.store.load()
},getValue:function(){var result="(";
this.store.each(function(rec){result+=rec.id+","
});
return result.substr(0,result.length-1)+")"
},getIds:function(){var i=0,result=new Array(this.store.getCount());
this.store.each(function(rec){result[i++]=rec.id
});
return result
},isDirty:function(){return this.isDirtyFlag
},getTargetFromEvent:function(e){var target=e.getTarget();
while((target!==null)&&(target.parentNode!=this.el.dom)){target=target.parentNode
}if(!target){target=this.el.dom.lastChild||this.el.dom
}return target
},getDragData:function(e){var target=this.findItemFromChild(e.getTarget());
if(target){if(!this.isSelected(target)){delete this.ignoreNextClick;
this.onItemClick(target,this.indexOf(target),e);
this.ignoreNextClick=true
}var dragData={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&e.ctrlKey)};
if(this.getSelectionCount()==1){var i=this.getSelectedIndexes()[0];
var n=this.getNode(i);
dragData.viewNodes.push(dragData.ddel=n);
dragData.records.push(this.store.getAt(i));
dragData.repairXY=Ext.fly(n).getXY()
}else{dragData.ddel=document.createElement("div");
dragData.ddel.className="multi-proxy";
this.collectSelection(dragData)
}return dragData
}return false
},getRepairXY:function(e){return this.dragData.repairXY
},collectSelection:function(data){data.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();
if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(i){var n=this.getNode(i);
var dragNode=n.cloneNode(true);
dragNode.id=Ext.id();
data.ddel.appendChild(dragNode);
data.records.push(this.store.getAt(i));
data.viewNodes.push(n)
},this)
}else{var i=0;
this.store.each(function(rec){if(this.isSelected(i)){var n=this.getNode(i);
var dragNode=n.cloneNode(true);
dragNode.id=Ext.id();
data.ddel.appendChild(dragNode);
data.records.push(this.store.getAt(i));
data.viewNodes.push(n)
}i++
},this)
}},setDraggable:function(ddGroup){if(ddGroup instanceof Array){Ext.each(ddGroup,this.setDraggable,this);
return
}if(this.dragZone){this.dragZone.addToGroup(ddGroup)
}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:ddGroup});
if(!this.multiSelect){this.singleSelect=true
}this.dragZone.getDragData=this.getDragData.createDelegate(this);
this.dragZone.getRepairXY=this.getRepairXY;
this.dragZone.onEndDrag=this.onEndDrag
}},setDroppable:function(ddGroup){if(ddGroup instanceof Array){Ext.each(ddGroup,this.setDroppable,this);
return
}if(this.dropZone){this.dropZone.addToGroup(ddGroup)
}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:ddGroup});
this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);
this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);
this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);
this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);
this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this)
}},getDropPoint:function(e,n,dd){if(n==this.el.dom){return"above"
}var t=Ext.lib.Dom.getY(n),b=t+n.offsetHeight;
var c=t+(b-t)/2;
var y=Ext.lib.Event.getPageY(e);
if(y<=c){return"above"
}else{return"below"
}},isValidDropPoint:function(pt,n,data){if(!data.viewNodes||(data.viewNodes.length!=1)){return true
}var d=data.viewNodes[0];
if(d==n){return false
}if((pt=="below")&&(n.nextSibling==d)){return false
}if((pt=="above")&&(n.previousSibling==d)){return false
}return true
},onNodeEnter:function(n,dd,e,data){if(this.highlightColor&&(data.sourceView!=this)){this.el.highlight(this.highlightColor)
}return false
},onNodeOver:function(n,dd,e,data){var dragElClass=this.dropNotAllowed;
var pt=this.getDropPoint(e,n,dd);
if(this.isValidDropPoint(pt,n,data)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below"
}if(pt){var targetElClass;
if(pt=="above"){dragElClass=n.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";
targetElClass="x-view-drag-insert-above"
}else{dragElClass=n.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";
targetElClass="x-view-drag-insert-below"
}if(this.lastInsertClass!=targetElClass){Ext.fly(n).replaceClass(this.lastInsertClass,targetElClass);
this.lastInsertClass=targetElClass
}}}return dragElClass
},onNodeOut:function(n,dd,e,data){this.removeDropIndicators(n)
},onNodeDrop:function(n,dd,e,data){if(this.fireEvent("drop",this,n,dd,e,data)===false){return false
}var pt=this.getDropPoint(e,n,dd);
var insertAt=(this.appendOnly||(n==this.el.dom))?this.store.getCount():n.viewIndex;
if(pt=="below"){insertAt++
}if(data.sourceView==this){if(pt=="below"){if(data.viewNodes[0]==n){data.viewNodes.shift()
}}else{if(data.viewNodes[data.viewNodes.length-1]==n){data.viewNodes.pop()
}}if(!data.viewNodes.length){return false
}if(insertAt>this.store.indexOf(data.records[0])){insertAt--
}}if(data.node instanceof Ext.tree.TreeNode){var r=data.node.getOwnerTree().recordFromNode(data.node);
if(r){data.records=[r]
}}if(!data.records){alert("Programming problem. Drag data contained no Records");
return false
}for(var i=0;
i<data.records.length;
i++){var r=data.records[i];
var dup=this.store.getById(r.id);
if(dup&&(dd!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(dup))).frame("red",1);
return true
}var x=new Ext.data.Record();
r.id=x.id;
delete x
}if(data.copy){this.store.insert(insertAt++,r.copy())
}else{if(data.sourceView){data.sourceView.isDirtyFlag=true;
data.sourceView.store.remove(r)
}if(!this.allowTrash){this.store.insert(insertAt++,r)
}}if(this.sortField){this.store.sort(this.sortField,this.sortDir)
}this.isDirtyFlag=true
}this.dragZone.cachedTarget=null;
return true
},onEndDrag:function(data,e){var d=Ext.get(this.dragData.ddel);
if(d&&d.hasClass("multi-proxy")){d.remove()
}},removeDropIndicators:function(n){if(n){Ext.fly(n).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);
this.lastInsertClass="_noclass"
}},setDeletable:function(imageUrl){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true
}var c=this.getContextMenu();
this.contextMenu.on("itemclick",function(item){switch(item.id){case"delete":this.remove(this.getSelectedIndexes());
break
}},this);
this.contextMenu.add({icon:imageUrl||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")})
},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});
this.el.on("contextmenu",this.showContextMenu,this)
}return this.contextMenu
},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this)
}},showContextMenu:function(e,item){item=this.findItemFromChild(e.getTarget());
if(item){e.stopEvent();
this.select(this.getNode(item),this.multiSelect&&e.ctrlKey,true);
this.contextMenu.showAt(e.getXY())
}},remove:function(selectedIndices){selectedIndices=[].concat(selectedIndices);
for(var i=0;
i<selectedIndices.length;
i++){var rec=this.store.getAt(selectedIndices[i]);
this.store.remove(rec)
}},onDblClick:function(e){var item=this.findItemFromChild(e.getTarget());
if(item){if(this.fireEvent("dblclick",this,this.indexOf(item),item,e)===false){return false
}if(this.dragGroup){var targets=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);
while(targets.contains(this.dropZone)){targets.remove(this.dropZone)
}if((targets.length==1)&&(targets[0].owningView)){this.dragZone.cachedTarget=null;
var el=Ext.get(targets[0].getEl());
var box=el.getBox(true);
targets[0].onNodeDrop(el.dom,{target:el.dom,xy:[box.x,box.y+box.height-1]},null,this.getDragData(e))
}}}},onItemClick:function(item,index,e){if(this.ignoreNextClick){delete this.ignoreNextClick;
return
}if(this.fireEvent("beforeclick",this,index,item,e)===false){return false
}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&e.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),index),false)
}else{if(this.isSelected(item)&&e.ctrlKey){this.deselect(item)
}else{this.deselect(item);
this.select(item,this.multiSelect&&e.ctrlKey);
this.lastSelection=item
}}e.preventDefault()
}return true
}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},tpl:null,initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);
this.addEvents({dblclick:true,click:true,change:true,drop:true})
},onRender:function(ct,position){var fs,cls,tpl;
Ext.ux.Multiselect.superclass.onRender.call(this,ct,position);
cls="ux-mselect";
fs=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});
if(!this.legend){fs.el.down("."+fs.headerCls).remove()
}fs.body.addClass(cls);
if(!this.tpl){tpl='<tpl for="."><div class="'+cls+"-item";
if(Ext.isIE||Ext.isIE7){tpl+='" unselectable=on'
}else{tpl+=' x-unselectable"'
}tpl+=">{"+this.displayField+"}</div></tpl>";
this.tpl=tpl
}if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})
}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:cls+"-selected",tpl:this.tpl,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+cls+"-item",isFormField:false,applyTo:fs.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});
fs.add(this.view);
this.view.on("click",this.onViewClick,this);
this.view.on("beforeClick",this.onViewBeforeClick,this);
this.view.on("dblclick",this.onViewDblClick,this);
this.view.on("drop",function(ddView,n,dd,e,data){return this.fireEvent("drop",ddView,n,dd,e,data)
},this);
this.hiddenName=this.name;
var hiddenTag={tag:"input",type:"hidden",value:"",name:this.name};
if(this.isFormField){this.hiddenField=this.el.createChild(hiddenTag)
}else{this.hiddenField=Ext.get(document.body).createChild(hiddenTag)
}fs.doLayout()
},initValue:Ext.emptyFn,onViewClick:function(vw,index,node,e){var arrayIndex=this.preClickSelections.indexOf(index);
if(arrayIndex!=-1){this.preClickSelections.splice(arrayIndex,1);
this.view.clearSelections(true);
this.view.select(this.preClickSelections)
}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);
this.hiddenField.dom.value=this.getValue();
this.fireEvent("click",this,e);
this.validate()
},onViewBeforeClick:function(vw,index,node,e){this.preClickSelections=this.view.getSelectedIndexes();
if(this.disabled){return false
}},onViewDblClick:function(vw,index,node,e){return this.fireEvent("dblclick",vw,index,node,e)
},getValue:function(valueField){var returnArray=[];
var selectionsArray=this.view.getSelectedIndexes();
if(selectionsArray.length==0){return""
}for(var i=0;
i<selectionsArray.length;
i++){returnArray.push(this.store.getAt(selectionsArray[i]).get(((valueField!=null)?valueField:this.valueField)))
}return returnArray.join(this.delimiter)
},setValue:function(values){var index;
var selections=[];
this.view.clearSelections();
this.hiddenField.dom.value="";
if(!values||(values=="")){return
}if(!(values instanceof Array)){values=values.split(this.delimiter)
}for(var i=0;
i<values.length;
i++){index=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+values[i]+"$","i")).itemAt(0));
selections.push(index)
}this.view.select(selections);
this.hiddenField.dom.value=this.getValue();
this.validate()
},selectAll:function(){var selections=[];
for(var i=0;
i<this.view.store.getCount();
i++){selections.push(i)
}this.view.select(selections);
this.hiddenField.dom.value=this.getValue();
this.validate()
},reset:function(){this.setValue("")
},getRawValue:function(valueField){var tmp=this.getValue(valueField);
if(tmp.length){tmp=tmp.split(this.delimiter)
}else{tmp=[]
}return tmp
},setRawValue:function(values){setValue(values)
},validateValue:function(value){if(value.length<1){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}if(value.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));
return false
}if(value.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));
return false
}return true
}});
Ext.reg("multiselect",Ext.ux.Multiselect);
Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,fromAllowDup:false,toAllowDup:false,fromAllowTrash:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},fromTpl:null,toTpl:null,initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);
this.addEvents({rowdblclick:true,change:true})
},onRender:function(ct,position){Ext.ux.ItemSelector.superclass.onRender.call(this,ct,position);
this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.fromAllowDup,copy:this.fromAllowDup,allowTrash:this.fromAllowTrash,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.fromTpl});
this.fromMultiselect.on("dblclick",this.onRowDblClick,this);
if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})
}this.toStore.on("add",this.valueChanged,this);
this.toStore.on("remove",this.valueChanged,this);
this.toStore.on("load",this.valueChanged,this);
this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.toAllowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.toTpl});
this.toMultiselect.on("dblclick",this.onRowDblClick,this);
var p=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});
p.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);
var icons=new Ext.Panel({header:false});
p.add(icons);
p.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);
p.render(this.el);
icons.el.down("."+icons.bwrapCls).remove();
if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"
}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");
this.iconDown=this.imagePath+(this.iconDown||"down2.gif");
this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");
this.iconRight=this.imagePath+(this.iconRight||"right2.gif");
this.iconTop=this.imagePath+(this.iconTop||"top2.gif");
this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");
var el=icons.getEl();
if(!this.toSortField){this.toTopIcon=el.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"});
this.upIcon=el.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"})
}this.addIcon=el.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"});
this.removeIcon=el.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"});
if(!this.toSortField){this.downIcon=el.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"});
this.toBottomIcon=el.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})
}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);
this.upIcon.on("click",this.up,this);
this.downIcon.on("click",this.down,this);
this.toBottomIcon.on("click",this.toBottom,this)
}this.addIcon.on("click",this.fromTo,this);
this.removeIcon.on("click",this.toFrom,this)
}if((!this.drawUpIcon||this.hideNavIcons)&&this.upIcon){this.upIcon.dom.style.display="none"
}if((!this.drawDownIcon||this.hideNavIcons)&&this.downIcon){this.downIcon.dom.style.display="none"
}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"
}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"
}if((!this.drawTopIcon||this.hideNavIcons)&&this.toTopIcon){this.toTopIcon.dom.style.display="none"
}if((!this.drawBotIcon||this.hideNavIcons)&&this.toBottomIcon){this.toBottomIcon.dom.style.display="none"
}var tb=p.body.first();
this.el.setWidth(p.body.first().getWidth());
p.body.removeClass();
this.hiddenName=this.name;
var hiddenTag={tag:"input",type:"hidden",value:"",name:this.name};
this.hiddenField=this.el.createChild(hiddenTag);
this.valueChanged(this.toStore)
},initValue:Ext.emptyFn,toTop:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
var records=[];
if(selectionsArray.length>0){selectionsArray.sort();
for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
records.push(record)
}selectionsArray=[];
for(var i=records.length-1;
i>-1;
i--){record=records[i];
this.toMultiselect.view.store.remove(record);
this.toMultiselect.view.store.insert(0,record);
selectionsArray.push(((records.length-1)-i))
}}this.toMultiselect.view.refresh();
this.toMultiselect.view.select(selectionsArray)
},toBottom:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
var records=[];
if(selectionsArray.length>0){selectionsArray.sort();
for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
records.push(record)
}selectionsArray=[];
for(var i=0;
i<records.length;
i++){record=records[i];
this.toMultiselect.view.store.remove(record);
this.toMultiselect.view.store.add(record);
selectionsArray.push((this.toMultiselect.view.store.getCount())-(records.length-i))
}}this.toMultiselect.view.refresh();
this.toMultiselect.view.select(selectionsArray)
},up:function(){var record=null;
var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
selectionsArray.sort();
var newSelectionsArray=[];
if(selectionsArray.length>0){for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
if((selectionsArray[i]-1)>=0){this.toMultiselect.view.store.remove(record);
this.toMultiselect.view.store.insert(selectionsArray[i]-1,record);
newSelectionsArray.push(selectionsArray[i]-1)
}}this.toMultiselect.view.refresh();
this.toMultiselect.view.select(newSelectionsArray)
}},down:function(){var record=null;
var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
selectionsArray.sort();
selectionsArray.reverse();
var newSelectionsArray=[];
if(selectionsArray.length>0){for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
if((selectionsArray[i]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(record);
this.toMultiselect.view.store.insert(selectionsArray[i]+1,record);
newSelectionsArray.push(selectionsArray[i]+1)
}}this.toMultiselect.view.refresh();
this.toMultiselect.view.select(newSelectionsArray)
}},fromTo:function(){var selectionsArray=this.fromMultiselect.view.getSelectedIndexes();
var records=[];
if(selectionsArray.length>0){for(var i=0;
i<selectionsArray.length;
i++){record=this.fromMultiselect.view.store.getAt(selectionsArray[i]);
records.push(record)
}if(!this.toAllowDup){selectionsArray=[]
}for(var i=0;
i<records.length;
i++){record=records[i];
if(this.toAllowDup){var x=new Ext.data.Record();
record.id=x.id;
delete x;
this.toMultiselect.view.store.add(record)
}else{if(this.fromAllowTrash){this.fromMultiselect.view.store.remove(record)
}this.toMultiselect.view.store.add(record);
selectionsArray.push((this.toMultiselect.view.store.getCount()-1))
}}}this.toMultiselect.view.refresh();
this.fromMultiselect.view.refresh();
if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)
}if(this.toAllowDup){this.fromMultiselect.view.select(selectionsArray)
}else{this.toMultiselect.view.select(selectionsArray)
}},toFrom:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
var records=[];
if(selectionsArray.length>0){for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
records.push(record)
}selectionsArray=[];
for(var i=0;
i<records.length;
i++){record=records[i];
this.toMultiselect.view.store.remove(record);
if(!this.fromAllowDup){this.fromMultiselect.view.store.add(record);
selectionsArray.push((this.fromMultiselect.view.store.getCount()-1))
}}}this.fromMultiselect.view.refresh();
this.toMultiselect.view.refresh();
if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)
}this.fromMultiselect.view.select(selectionsArray)
},valueChanged:function(store){var record=null;
var values=[];
for(var i=0;
i<store.getCount();
i++){record=store.getAt(i);
values.push(record.get(this.valueField))
}this.hiddenField.dom.value=values.join(this.delimiter);
this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)
},getValue:function(){return this.hiddenField.dom.value
},onRowDblClick:function(vw,index,node,e){return this.fireEvent("rowdblclick",vw,index,node,e)
},reset:function(){range=this.toMultiselect.store.getRange();
this.toMultiselect.store.removeAll();
if(!this.fromAllowDup){this.fromMultiselect.store.add(range);
this.fromMultiselect.store.sort(this.displayField,"ASC")
}this.valueChanged(this.toMultiselect.store)
}});
Ext.reg("itemselector",Ext.ux.ItemSelector);/*
 * Ext Core Library $version&#xD;&#xA;http://extjs.com/&#xD;&#xA;Copyright(c) 2006-2009, $author.&#xD;&#xA;&#xD;&#xA;The MIT License&#xD;&#xA;&#xD;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xD;&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xD;&#xA;in the Software without restriction, including without limitation the rights&#xD;&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xD;&#xA;copies of the Software, and to permit persons to whom the Software is&#xD;&#xA;furnished to do so, subject to the following conditions:&#xD;&#xA;&#xD;&#xA;The above copyright notice and this permission notice shall be included in&#xD;&#xA;all copies or substantial portions of the Software.&#xD;&#xA;&#xD;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xD;&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xD;&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xD;&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xD;&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xD;&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xD;&#xA;THE SOFTWARE.&#xD;&#xA;
 */
Ext.ns("Ext.ux");
Ext.ux.Lightbox=(function(){var els={},images=[],activeImage,initialized=false,selectors=[];
return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?((11-this.resizeSpeed)*0.15):0;
this.overlayDuration=this.animate?0.2:0;
if(!initialized){Ext.apply(this,Ext.util.Observable.prototype);
Ext.util.Observable.constructor.call(this);
this.addEvents("open","close");
this.initMarkup();
this.initEvents();
initialized=true
}},initMarkup:function(){els.shim=Ext.DomHelper.append(document.body,{tag:"iframe",id:"ux-lightbox-shim"},true);
els.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);
var lightboxTpl=new Ext.Template(this.getTemplate());
els.lightbox=lightboxTpl.append(document.body,{},true);
var ids=["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"];
Ext.each(ids,function(id){els[id]=Ext.get("ux-lightbox-"+id)
});
Ext.each([els.overlay,els.lightbox,els.shim],function(el){el.setVisibilityMode(Ext.Element.DISPLAY);
el.hide()
});
var size=(this.animate?250:1)+"px";
els.outerImageContainer.setStyle({width:size,height:size})
},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"]
},initEvents:function(){var close=function(ev){ev.preventDefault();
this.close()
};
els.overlay.on("click",close,this);
els.loadingLink.on("click",close,this);
els.navClose.on("click",close,this);
els.lightbox.on("click",function(ev){if(ev.getTarget().id=="ux-lightbox"){this.close()
}},this);
els.navPrev.on("click",function(ev){ev.preventDefault();
this.setImage(activeImage-1)
},this);
els.navNext.on("click",function(ev){ev.preventDefault();
this.setImage(activeImage+1)
},this)
},register:function(sel,group){if(selectors.indexOf(sel)===-1){selectors.push(sel);
Ext.fly(document).on("click",function(ev){var target=ev.getTarget(sel);
if(target){ev.preventDefault();
this.open(target,sel,group)
}},this)
}},open:function(image,sel,group){group=group||false;
this.setViewSize();
els.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){images=[];
var index=0;
if(!group){images.push([image.href,image.title])
}else{var setItems=Ext.query(sel);
Ext.each(setItems,function(item){if(item.href){images.push([item.href,item.title])
}});
while(images[index][0]!=image.href){index++
}}var pageScroll=Ext.fly(document).getScroll();
var lightboxTop=pageScroll.top+(Ext.lib.Dom.getViewportHeight()/10);
var lightboxLeft=pageScroll.left;
els.lightbox.setStyle({top:lightboxTop+"px",left:lightboxLeft+"px"}).show();
this.setImage(index);
this.fireEvent("open",images[index])
},scope:this})
},setViewSize:function(){var viewSize=this.getViewSize();
els.overlay.setStyle({width:viewSize[0]+"px",height:viewSize[1]+"px"});
els.shim.setStyle({width:viewSize[0]+"px",height:viewSize[1]+"px"}).show()
},setImage:function(index){activeImage=index;
this.disableKeyNav();
if(this.animate){els.loading.show()
}els.image.hide();
els.hoverNav.hide();
els.navPrev.hide();
els.navNext.hide();
els.dataContainer.setOpacity(0.0001);
els.imageNumber.hide();
var preload=new Image();
preload.onload=(function(){els.image.dom.src=images[activeImage][0];
this.resizeImage(preload.width,preload.height)
}).createDelegate(this);
preload.src=images[activeImage][0]
},resizeImage:function(w,h){var wCur=els.outerImageContainer.getWidth();
var hCur=els.outerImageContainer.getHeight();
var wNew=(w+this.borderSize*2);
var hNew=(h+this.borderSize*2);
var wDiff=wCur-wNew;
var hDiff=hCur-hNew;
var afterResize=function(){els.hoverNav.setWidth(els.imageContainer.getWidth()+"px");
els.navPrev.setHeight(h+"px");
els.navNext.setHeight(h+"px");
els.outerDataContainer.setWidth(wNew+"px");
this.showImage()
};
if(hDiff!=0||wDiff!=0){els.outerImageContainer.shift({height:hNew,width:wNew,duration:this.resizeDuration,scope:this,callback:afterResize,delay:50})
}else{afterResize.call(this)
}},showImage:function(){els.loading.hide();
els.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails()
}});
this.preloadImages()
},updateDetails:function(){var detailsWidth=els.data.getWidth(true)-els.navClose.getWidth()-10;
els.details.setWidth((detailsWidth>0?detailsWidth:0)+"px");
els.caption.update(images[activeImage][1]);
els.caption.show();
if(images.length>1){els.imageNumber.update(this.labelImage+" "+(activeImage+1)+" "+this.labelOf+"  "+images.length);
els.imageNumber.show()
}els.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var viewSize=this.getViewSize();
els.overlay.setHeight(viewSize[1]+"px");
this.updateNav()
}})
},updateNav:function(){this.enableKeyNav();
els.hoverNav.show();
if(activeImage>0){els.navPrev.show()
}if(activeImage<(images.length-1)){els.navNext.show()
}},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this)
},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this)
},keyNavAction:function(ev){var keyCode=ev.getKey();
if(keyCode==88||keyCode==67||keyCode==27){this.close()
}else{if(keyCode==80||keyCode==37){if(activeImage!=0){this.setImage(activeImage-1)
}}else{if(keyCode==78||keyCode==39){if(activeImage!=(images.length-1)){this.setImage(activeImage+1)
}}}}},preloadImages:function(){var next,prev;
if(images.length>activeImage+1){next=new Image();
next.src=images[activeImage+1][0]
}if(activeImage>0){prev=new Image();
prev.src=images[activeImage-1][0]
}},close:function(){this.disableKeyNav();
els.lightbox.hide();
els.overlay.fadeOut({duration:this.overlayDuration});
els.shim.hide();
this.fireEvent("close",activeImage)
},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()]
}}
})();
Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);Proj4js={defaultDatum:"WGS84",transform:function(source,dest,point){if(!source.readyToUse||!dest.readyToUse){this.reportError("Proj4js initialization for "+source.srsCode+" not yet complete");
return point
}if((source.srsProjNumber=="900913"&&dest.datumCode!="WGS84")||(dest.srsProjNumber=="900913"&&source.datumCode!="WGS84")){var wgs84=Proj4js.WGS84;
this.transform(source,wgs84,point);
source=wgs84
}if(source.projName=="longlat"){point.x*=Proj4js.common.D2R;
point.y*=Proj4js.common.D2R
}else{if(source.to_meter){point.x*=source.to_meter;
point.y*=source.to_meter
}source.inverse(point)
}if(source.from_greenwich){point.x+=source.from_greenwich
}point=this.datum_transform(source.datum,dest.datum,point);
if(dest.from_greenwich){point.x-=dest.from_greenwich
}if(dest.projName=="longlat"){point.x*=Proj4js.common.R2D;
point.y*=Proj4js.common.R2D
}else{dest.forward(point);
if(dest.to_meter){point.x/=dest.to_meter;
point.y/=dest.to_meter
}}return point
},datum_transform:function(source,dest,point){if(source.compare_datums(dest)){return point
}if(source.datum_type==Proj4js.common.PJD_NODATUM||dest.datum_type==Proj4js.common.PJD_NODATUM){return point
}if(source.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")
}if(dest.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")
}if(source.es!=dest.es||source.a!=dest.a||source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM||dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM){source.geodetic_to_geocentric(point);
if(source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM){source.geocentric_to_wgs84(point)
}if(dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM){dest.geocentric_from_wgs84(point)
}dest.geocentric_to_geodetic(point)
}if(dest.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")
}return point
},reportError:function(msg){},extend:function(destination,source){destination=destination||{};
if(source){for(var property in source){var value=source[property];
if(value!==undefined){destination[property]=value
}}}return destination
},Class:function(){var Class=function(){this.initialize.apply(this,arguments)
};
var extended={};
var parent;
for(var i=0;
i<arguments.length;
++i){if(typeof arguments[i]=="function"){parent=arguments[i].prototype
}else{parent=arguments[i]
}Proj4js.extend(extended,parent)
}Class.prototype=extended;
return Class
},bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);
return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));
return func.apply(object,newArgs)
}
},scriptName:"proj4js.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath){return this.libPath
}var scriptName=this.scriptName;
var scriptNameLen=scriptName.length;
var scripts=document.getElementsByTagName("script");
for(var i=0;
i<scripts.length;
i++){var src=scripts[i].getAttribute("src");
if(src){var index=src.lastIndexOf(scriptName);
if((index>-1)&&(index+scriptNameLen==src.length)){this.libPath=src.slice(0,-scriptNameLen);
break
}}}return this.libPath||""
},loadScript:function(url,onload,onfail,loadCheck){var script=document.createElement("script");
script.defer=false;
script.type="text/javascript";
script.id=url;
script.src=url;
script.onload=onload;
script.onerror=onfail;
script.loadCheck=loadCheck;
if(/MSIE/.test(navigator.userAgent)){script.onreadystatechange=this.checkReadyState
}document.getElementsByTagName("head")[0].appendChild(script)
},checkReadyState:function(){if(this.readyState=="loaded"){if(!this.loadCheck()){this.onerror()
}else{this.onload()
}}}};
Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,initialize:function(srsCode){this.srsCodeInput=srsCode;
if(srsCode.indexOf("urn:")==0){var urn=srsCode.split(":");
if((urn[1]=="ogc"||urn[1]=="x-ogc")&&(urn[2]=="def")&&(urn[3]=="crs")&&urn.length==7){srsCode=urn[4]+":"+urn[6]
}}else{if(srsCode.indexOf("http://")==0){var url=srsCode.split("#");
if(url[0].match(/epsg.org/)){srsCode="EPSG:"+url[1]
}else{if(url[0].match(/RIG.xml/)){srsCode="IGNF:"+url[1]
}}}}this.srsCode=srsCode.toUpperCase();
if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;
this.srsAuth="epsg";
this.srsProjNumber=this.srsCode.substring(5)
}else{if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;
this.srsAuth="IGNF";
this.srsProjNumber=this.srsCode.substring(5)
}else{if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;
this.srsAuth="CRS";
this.srsProjNumber=this.srsCode.substring(4)
}else{this.srsAuth="";
this.srsProjNumber=this.srsCode
}}}this.loadProjDefinition()
},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();
return
}var url=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";
Proj4js.loadScript(url,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))
},loadFromService:function(){var url=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js";
Proj4js.loadScript(url,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))
},defsLoaded:function(){this.parseDefs();
this.loadProjCode(this.projName)
},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true
}else{return false
}},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);
Proj4js.extend(Proj4js.defs[this.srsCode],Proj4js.defs.WGS84);
this.defsLoaded()
},loadProjCode:function(projName){if(Proj4js.Proj[projName]){this.initTransforms();
return
}var url=Proj4js.getScriptLocation()+"projCode/"+projName+".js";
Proj4js.loadScript(url,Proj4js.bind(this.loadProjCodeSuccess,this,projName),Proj4js.bind(this.loadProjCodeFailure,this,projName),Proj4js.bind(this.checkCodeLoaded,this,projName))
},loadProjCodeSuccess:function(projName){if(Proj4js.Proj[projName].dependsOn){this.loadProjCode(Proj4js.Proj[projName].dependsOn)
}else{this.initTransforms()
}},loadProjCodeFailure:function(projName){Proj4js.reportError("failed to find projection file for: "+projName)
},checkCodeLoaded:function(projName){if(Proj4js.Proj[projName]){return true
}else{return false
}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);
this.init();
this.readyToUse=true
},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];
var paramName,paramVal;
var paramArray=this.defData.split("+");
for(var prop=0;
prop<paramArray.length;
prop++){var property=paramArray[prop].split("=");
paramName=property[0].toLowerCase();
paramVal=property[1];
switch(paramName.replace(/\s/gi,"")){case"":break;
case"title":this.title=paramVal;
break;
case"proj":this.projName=paramVal.replace(/\s/gi,"");
break;
case"units":this.units=paramVal.replace(/\s/gi,"");
break;
case"datum":this.datumCode=paramVal.replace(/\s/gi,"");
break;
case"nadgrids":this.nagrids=paramVal.replace(/\s/gi,"");
break;
case"ellps":this.ellps=paramVal.replace(/\s/gi,"");
break;
case"a":this.a=parseFloat(paramVal);
break;
case"b":this.b=parseFloat(paramVal);
break;
case"rf":this.rf=parseFloat(paramVal);
break;
case"lat_0":this.lat0=paramVal*Proj4js.common.D2R;
break;
case"lat_1":this.lat1=paramVal*Proj4js.common.D2R;
break;
case"lat_2":this.lat2=paramVal*Proj4js.common.D2R;
break;
case"lat_ts":this.lat_ts=paramVal*Proj4js.common.D2R;
break;
case"lon_0":this.long0=paramVal*Proj4js.common.D2R;
break;
case"alpha":this.alpha=parseFloat(paramVal)*Proj4js.common.D2R;
break;
case"lonc":this.longc=paramVal*Proj4js.common.D2R;
break;
case"x_0":this.x0=parseFloat(paramVal);
break;
case"y_0":this.y0=parseFloat(paramVal);
break;
case"k_0":this.k0=parseFloat(paramVal);
break;
case"k":this.k0=parseFloat(paramVal);
break;
case"R_A":this.R=true;
break;
case"zone":this.zone=parseInt(paramVal);
break;
case"south":this.utmSouth=true;
break;
case"towgs84":this.datum_params=paramVal.split(",");
break;
case"to_meter":this.to_meter=parseFloat(paramVal);
break;
case"from_greenwich":this.from_greenwich=paramVal*Proj4js.common.D2R;
break;
case"pm":paramVal=paramVal.replace(/\s/gi,"");
this.from_greenwich=Proj4js.PrimeMeridian[paramVal]?Proj4js.PrimeMeridian[paramVal]:parseFloat(paramVal);
this.from_greenwich*=Proj4js.common.D2R;
break;
case"no_defs":break;
default:}}this.deriveConstants()
},deriveConstants:function(){if(this.nagrids=="@null"){this.datumCode="none"
}if(this.datumCode&&this.datumCode!="none"){var datumDef=Proj4js.Datum[this.datumCode];
if(datumDef){this.datum_params=datumDef.towgs84.split(",");
this.ellps=datumDef.ellipse;
this.datumName=datumDef.datumName?datumDef.datumName:this.datumCode
}}if(!this.a){var ellipse=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;
Proj4js.extend(this,ellipse)
}if(this.rf&&!this.b){this.b=(1-1/this.rf)*this.a
}if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;
this.b=this.a
}this.a2=this.a*this.a;
this.b2=this.b*this.b;
this.es=(this.a2-this.b2)/this.a2;
this.e=Math.sqrt(this.es);
if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.RA4+this.es*Proj4js.RA6));
this.a2=this.a*this.a;
this.b2=this.b*this.b;
this.es=0
}this.ep2=(this.a2-this.b2)/this.b2;
if(!this.k0){this.k0=1
}this.datum=new Proj4js.datum(this)
}});
Proj4js.Proj.longlat={init:function(){},forward:function(pt){return pt
},inverse:function(pt){return pt
}};
Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:900913":"+title= Google Mercator EPSG:900913 +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};
Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:900913"];
Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:0.7853981633974483,R2D:57.29577951308232,D2R:0.017453292519943295,SEC_TO_RAD:0.00000484813681109536,EPSLN:1e-10,MAX_ITER:20,COS_67P5:0.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:0.16666666666666666,RA4:0.04722222222222222,RA6:0.022156084656084655,RV4:0.06944444444444445,RV6:0.04243827160493827,msfnz:function(eccent,sinphi,cosphi){var con=eccent*sinphi;
return cosphi/(Math.sqrt(1-con*con))
},tsfnz:function(eccent,phi,sinphi){var con=eccent*sinphi;
var com=0.5*eccent;
con=Math.pow(((1-con)/(1+con)),com);
return(Math.tan(0.5*(this.HALF_PI-phi))/con)
},phi2z:function(eccent,ts){var eccnth=0.5*eccent;
var con,dphi;
var phi=this.HALF_PI-2*Math.atan(ts);
for(i=0;
i<=15;
i++){con=eccent*Math.sin(phi);
dphi=this.HALF_PI-2*Math.atan(ts*(Math.pow(((1-con)/(1+con)),eccnth)))-phi;
phi+=dphi;
if(Math.abs(dphi)<=1e-10){return phi
}}alert("phi2z has NoConvergence");
return(-9999)
},qsfnz:function(eccent,sinphi,cosphi){var con;
if(eccent>1e-7){con=eccent*sinphi;
return((1-eccent*eccent)*(sinphi/(1-con*con)-(0.5/eccent)*Math.log((1-con)/(1+con))))
}else{return(2*sinphi)
}},asinz:function(x){if(Math.abs(x)>1){x=(x>1)?1:-1
}return Math.asin(x)
},e0fn:function(x){return(1-0.25*x*(1+x/16*(3+1.25*x)))
},e1fn:function(x){return(0.375*x*(1+0.25*x*(1+0.46875*x)))
},e2fn:function(x){return(0.05859375*x*x*(1+0.75*x))
},e3fn:function(x){return(x*x*x*(35/3072))
},mlfn:function(e0,e1,e2,e3,phi){return(e0*phi-e1*Math.sin(2*phi)+e2*Math.sin(4*phi)-e3*Math.sin(6*phi))
},srat:function(esinp,exp){return(Math.pow((1-esinp)/(1+esinp),exp))
},sign:function(x){if(x<0){return(-1)
}else{return(1)
}},adjust_lon:function(x){x=(Math.abs(x)<this.PI)?x:(x-(this.sign(x)*this.TWO_PI));
return x
},adjust_lat:function(x){x=(Math.abs(x)<this.HALF_PI)?x:(x-(this.sign(x)*this.PI));
return x
},latiso:function(eccent,phi,sinphi){if(Math.abs(phi)>this.HALF_PI){return +Number.NaN
}if(phi==this.HALF_PI){return Number.POSITIVE_INFINITY
}if(phi==-1*this.HALF_PI){return -1*Number.POSITIVE_INFINITY
}var con=eccent*sinphi;
return Math.log(Math.tan((this.HALF_PI+phi)/2))+eccent*Math.log((1-con)/(1+con))/2
},fL:function(x,L){return 2*Math.atan(x*Math.exp(L))-this.HALF_PI
},invlatiso:function(eccent,ts){var phi=this.fL(1,ts);
var Iphi=0;
var con=0;
do{Iphi=phi;
con=eccent*Math.sin(Iphi);
phi=this.fL(Math.exp(eccent*Math.log((1+con)/(1-con))/2),ts)
}while(Math.abs(phi-Iphi)>1e-12);
return phi
},sinh:function(x){var r=Math.exp(x);
r=(r-1/r)/2;
return r
},cosh:function(x){var r=Math.exp(x);
r=(r+1/r)/2;
return r
},tanh:function(x){var r=Math.exp(x);
r=(r-1/r)/(r+1/r);
return r
},asinh:function(x){var s=(x>=0?1:-1);
return s*(Math.log(Math.abs(x)+Math.sqrt(x*x+1)))
},acosh:function(x){return 2*Math.log(Math.sqrt((x+1)/2)+Math.sqrt((x-1)/2))
},atanh:function(x){return Math.log((x-1)/(x+1))/2
},gN:function(a,e,sinphi){var temp=e*sinphi;
return a/Math.sqrt(1-temp*temp)
}};
Proj4js.datum=Proj4js.Class({initialize:function(proj){this.datum_type=Proj4js.common.PJD_WGS84;
if(proj.datumCode&&proj.datumCode=="none"){this.datum_type=Proj4js.common.PJD_NODATUM
}if(proj&&proj.datum_params){for(var i=0;
i<proj.datum_params.length;
i++){proj.datum_params[i]=parseFloat(proj.datum_params[i])
}if(proj.datum_params[0]!=0||proj.datum_params[1]!=0||proj.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM
}if(proj.datum_params.length>3){if(proj.datum_params[3]!=0||proj.datum_params[4]!=0||proj.datum_params[5]!=0||proj.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;
proj.datum_params[3]*=Proj4js.common.SEC_TO_RAD;
proj.datum_params[4]*=Proj4js.common.SEC_TO_RAD;
proj.datum_params[5]*=Proj4js.common.SEC_TO_RAD;
proj.datum_params[6]=(proj.datum_params[6]/1000000)+1
}}}if(proj){this.a=proj.a;
this.b=proj.b;
this.es=proj.es;
this.ep2=proj.ep2;
this.datum_params=proj.datum_params
}},compare_datums:function(dest){if(this.datum_type!=dest.datum_type){return false
}else{if(this.a!=dest.a||Math.abs(this.es-dest.es)>5e-11){return false
}else{if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2])
}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2]&&this.datum_params[3]==dest.datum_params[3]&&this.datum_params[4]==dest.datum_params[4]&&this.datum_params[5]==dest.datum_params[5]&&this.datum_params[6]==dest.datum_params[6])
}else{if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,"snadgrids").s,pj_param(dest.params,"snadgrids").s)==0
}else{return true
}}}}}},geodetic_to_geocentric:function(p){var Longitude=p.x;
var Latitude=p.y;
var Height=p.z?p.z:0;
var X;
var Y;
var Z;
var Error_Code=0;
var Rn;
var Sin_Lat;
var Sin2_Lat;
var Cos_Lat;
if(Latitude<-Proj4js.common.HALF_PI&&Latitude>-1.001*Proj4js.common.HALF_PI){Latitude=-Proj4js.common.HALF_PI
}else{if(Latitude>Proj4js.common.HALF_PI&&Latitude<1.001*Proj4js.common.HALF_PI){Latitude=Proj4js.common.HALF_PI
}else{if((Latitude<-Proj4js.common.HALF_PI)||(Latitude>Proj4js.common.HALF_PI)){Proj4js.reportError("geocent:lat out of range:"+Latitude);
return null
}}}if(Longitude>Proj4js.common.PI){Longitude-=(2*Proj4js.common.PI)
}Sin_Lat=Math.sin(Latitude);
Cos_Lat=Math.cos(Latitude);
Sin2_Lat=Sin_Lat*Sin_Lat;
Rn=this.a/(Math.sqrt(1-this.es*Sin2_Lat));
X=(Rn+Height)*Cos_Lat*Math.cos(Longitude);
Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude);
Z=((Rn*(1-this.es))+Height)*Sin_Lat;
p.x=X;
p.y=Y;
p.z=Z;
return Error_Code
},geocentric_to_geodetic:function(p){var genau=1e-12;
var genau2=(genau*genau);
var maxiter=30;
var P;
var RR;
var CT;
var ST;
var RX;
var RK;
var RN;
var CPHI0;
var SPHI0;
var CPHI;
var SPHI;
var SDPHI;
var At_Pole;
var iter;
var X=p.x;
var Y=p.y;
var Z=p.z?p.z:0;
var Longitude;
var Latitude;
var Height;
At_Pole=false;
P=Math.sqrt(X*X+Y*Y);
RR=Math.sqrt(X*X+Y*Y+Z*Z);
if(P/this.a<genau){At_Pole=true;
Longitude=0;
if(RR/this.a<genau){Latitude=Proj4js.common.HALF_PI;
Height=-this.b;
return
}}else{Longitude=Math.atan2(Y,X)
}CT=Z/RR;
ST=P/RR;
RX=1/Math.sqrt(1-this.es*(2-this.es)*ST*ST);
CPHI0=ST*(1-this.es)*RX;
SPHI0=CT*RX;
iter=0;
do{iter++;
RN=this.a/Math.sqrt(1-this.es*SPHI0*SPHI0);
Height=P*CPHI0+Z*SPHI0-RN*(1-this.es*SPHI0*SPHI0);
RK=this.es*RN/(RN+Height);
RX=1/Math.sqrt(1-RK*(2-RK)*ST*ST);
CPHI=ST*(1-RK)*RX;
SPHI=CT*RX;
SDPHI=SPHI*CPHI0-CPHI*SPHI0;
CPHI0=CPHI;
SPHI0=SPHI
}while(SDPHI*SDPHI>genau2&&iter<maxiter);
Latitude=Math.atan(SPHI/Math.abs(CPHI));
p.x=Longitude;
p.y=Latitude;
p.z=Height;
return p
},geocentric_to_geodetic_noniter:function(p){var X=p.x;
var Y=p.y;
var Z=p.z?p.z:0;
var Longitude;
var Latitude;
var Height;
var W;
var W2;
var T0;
var T1;
var S0;
var S1;
var Sin_B0;
var Sin3_B0;
var Cos_B0;
var Sin_p1;
var Cos_p1;
var Rn;
var Sum;
var At_Pole;
X=parseFloat(X);
Y=parseFloat(Y);
Z=parseFloat(Z);
At_Pole=false;
if(X!=0){Longitude=Math.atan2(Y,X)
}else{if(Y>0){Longitude=Proj4js.common.HALF_PI
}else{if(Y<0){Longitude=-Proj4js.common.HALF_PI
}else{At_Pole=true;
Longitude=0;
if(Z>0){Latitude=Proj4js.common.HALF_PI
}else{if(Z<0){Latitude=-Proj4js.common.HALF_PI
}else{Latitude=Proj4js.common.HALF_PI;
Height=-this.b;
return
}}}}}W2=X*X+Y*Y;
W=Math.sqrt(W2);
T0=Z*Proj4js.common.AD_C;
S0=Math.sqrt(T0*T0+W2);
Sin_B0=T0/S0;
Cos_B0=W/S0;
Sin3_B0=Sin_B0*Sin_B0*Sin_B0;
T1=Z+this.b*this.ep2*Sin3_B0;
Sum=W-this.a*this.es*Cos_B0*Cos_B0*Cos_B0;
S1=Math.sqrt(T1*T1+Sum*Sum);
Sin_p1=T1/S1;
Cos_p1=Sum/S1;
Rn=this.a/Math.sqrt(1-this.es*Sin_p1*Sin_p1);
if(Cos_p1>=Proj4js.common.COS_67P5){Height=W/Cos_p1-Rn
}else{if(Cos_p1<=-Proj4js.common.COS_67P5){Height=W/-Cos_p1-Rn
}else{Height=Z/Sin_p1+Rn*(this.es-1)
}}if(At_Pole==false){Latitude=Math.atan(Sin_p1/Cos_p1)
}p.x=Longitude;
p.y=Latitude;
p.z=Height;
return p
},geocentric_to_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM){p.x+=this.datum_params[0];
p.y+=this.datum_params[1];
p.z+=this.datum_params[2]
}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var Dx_BF=this.datum_params[0];
var Dy_BF=this.datum_params[1];
var Dz_BF=this.datum_params[2];
var Rx_BF=this.datum_params[3];
var Ry_BF=this.datum_params[4];
var Rz_BF=this.datum_params[5];
var M_BF=this.datum_params[6];
var x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF;
var y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF;
var z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;
p.x=x_out;
p.y=y_out;
p.z=z_out
}}},geocentric_from_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM){p.x-=this.datum_params[0];
p.y-=this.datum_params[1];
p.z-=this.datum_params[2]
}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var Dx_BF=this.datum_params[0];
var Dy_BF=this.datum_params[1];
var Dz_BF=this.datum_params[2];
var Rx_BF=this.datum_params[3];
var Ry_BF=this.datum_params[4];
var Rz_BF=this.datum_params[5];
var M_BF=this.datum_params[6];
var x_tmp=(p.x-Dx_BF)/M_BF;
var y_tmp=(p.y-Dy_BF)/M_BF;
var z_tmp=(p.z-Dz_BF)/M_BF;
p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp;
p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp;
p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp
}}}});
Proj4js.Point=Proj4js.Class({initialize:function(x,y,z){if(typeof x=="object"){this.x=x[0];
this.y=x[1];
this.z=x[2]||0
}else{if(typeof x=="string"){var coords=x.split(",");
this.x=parseFloat(coords[0]);
this.y=parseFloat(coords[1]);
this.z=parseFloat(coords[2])||0
}else{this.x=x;
this.y=y;
this.z=z||0
}}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)
},toString:function(){return("x="+this.x+",y="+this.y)
},toShortString:function(){return(this.x+", "+this.y)
}});
Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};
Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};
Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};
Proj4js.WGS84=new Proj4js.Proj("WGS84");
Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;
Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");
return
}this.temp=this.b/this.a;
this.es=1-Math.pow(this.temp,2);
this.e3=Math.sqrt(this.es);
this.sin_po=Math.sin(this.lat1);
this.cos_po=Math.cos(this.lat1);
this.t1=this.sin_po;
this.con=this.sin_po;
this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);
this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);
this.sin_po=Math.sin(this.lat2);
this.cos_po=Math.cos(this.lat2);
this.t2=this.sin_po;
this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);
this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);
this.sin_po=Math.sin(this.lat0);
this.cos_po=Math.cos(this.lat0);
this.t3=this.sin_po;
this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);
if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1)
}else{this.ns0=this.con
}this.c=this.ms1*this.ms1+this.ns0*this.qs1;
this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0
},forward:function(p){var lon=p.x;
var lat=p.y;
this.sin_phi=Math.sin(lat);
this.cos_phi=Math.cos(lat);
var qs=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi);
var rh1=this.a*Math.sqrt(this.c-this.ns0*qs)/this.ns0;
var theta=this.ns0*Proj4js.common.adjust_lon(lon-this.long0);
var x=rh1*Math.sin(theta)+this.x0;
var y=this.rh-rh1*Math.cos(theta)+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){var rh1,qs,con,theta,lon,lat;
p.x-=this.x0;
p.y=this.rh-p.y+this.y0;
if(this.ns0>=0){rh1=Math.sqrt(p.x*p.x+p.y*p.y);
con=1
}else{rh1=-Math.sqrt(p.x*p.x+p.y*p.y);
con=-1
}theta=0;
if(rh1!=0){theta=Math.atan2(con*p.x,con*p.y)
}con=rh1*this.ns0/this.a;
qs=(this.c-con*con)/this.ns0;
if(this.e3>=1e-10){con=1-0.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;
if(Math.abs(Math.abs(con)-Math.abs(qs))>1e-10){lat=this.phi1z(this.e3,qs)
}else{if(qs>=0){lat=0.5*PI
}else{lat=-0.5*PI
}}}else{lat=this.phi1z(e3,qs)
}lon=Proj4js.common.adjust_lon(theta/this.ns0+this.long0);
p.x=lon;
p.y=lat;
return p
},phi1z:function(eccent,qs){var con,com,dphi;
var phi=Proj4js.common.asinz(0.5*qs);
if(eccent<Proj4js.common.EPSLN){return phi
}var eccnts=eccent*eccent;
for(var i=1;
i<=25;
i++){sinphi=Math.sin(phi);
cosphi=Math.cos(phi);
con=eccent*sinphi;
com=1-con*con;
dphi=0.5*com*com/cosphi*(qs/(1-eccnts)-sinphi/com+0.5/eccent*Math.log((1-con)/(1+con)));
phi=phi+dphi;
if(Math.abs(dphi)<=1e-7){return phi
}}Proj4js.reportError("aea:phi1z:Convergence error");
return null
}};
Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);
if(!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");
return
}this.sinc0=Math.sin(this.phic0);
this.cosc0=Math.cos(this.phic0);
this.R2=2*this.rc;
if(!this.title){this.title="Oblique Stereographic Alternative"
}},forward:function(p){p.x=Proj4js.common.adjust_lon(p.x-this.long0);
Proj4js.Proj.gauss.forward.apply(this,[p]);
sinc=Math.sin(p.y);
cosc=Math.cos(p.y);
cosl=Math.cos(p.x);
k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl);
p.x=k*cosc*Math.sin(p.x);
p.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);
p.x=this.a*p.x+this.x0;
p.y=this.a*p.y+this.y0;
return p
},inverse:function(p){var lon,lat;
p.x=(p.x-this.x0)/this.a;
p.y=(p.y-this.y0)/this.a;
p.x/=this.k0;
p.y/=this.k0;
if((rho=Math.sqrt(p.x*p.x+p.y*p.y))){c=2*Math.atan2(rho,this.R2);
sinc=Math.sin(c);
cosc=Math.cos(c);
lat=Math.asin(cosc*this.sinc0+p.y*sinc*this.cosc0/rho);
lon=Math.atan2(p.x*sinc,rho*this.cosc0*cosc-p.y*this.sinc0*sinc)
}else{lat=this.phic0;
lon=0
}p.x=lon;
p.y=lat;
Proj4js.Proj.gauss.inverse.apply(this,[p]);
p.x=Proj4js.common.adjust_lon(p.x+this.long0);
return p
}};
Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);
this.e1=Proj4js.common.e1fn(this.es);
this.e2=Proj4js.common.e2fn(this.es);
this.e3=Proj4js.common.e3fn(this.es);
this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)
},forward:function(p){var lon=p.x;
var lat=p.y;
var delta_lon=Proj4js.common.adjust_lon(lon-this.long0);
var con;
var x,y;
var sin_phi=Math.sin(lat);
var cos_phi=Math.cos(lat);
if(this.sphere){var b=cos_phi*Math.sin(delta_lon);
if((Math.abs(Math.abs(b)-1))<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");
return(93)
}else{x=0.5*this.a*this.k0*Math.log((1+b)/(1-b));
con=Math.acos(cos_phi*Math.cos(delta_lon)/Math.sqrt(1-b*b));
if(lat<0){con=-con
}y=this.a*this.k0*(con-this.lat0)
}}else{var al=cos_phi*delta_lon;
var als=Math.pow(al,2);
var c=this.ep2*Math.pow(cos_phi,2);
var tq=Math.tan(lat);
var t=Math.pow(tq,2);
con=1-this.es*Math.pow(sin_phi,2);
var n=this.a/Math.sqrt(con);
var ml=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);
x=this.k0*n*al*(1+als/6*(1-t+c+als/20*(5-18*t+Math.pow(t,2)+72*c-58*this.ep2)))+this.x0;
y=this.k0*(ml-this.ml0+n*tq*(als*(0.5+als/24*(5-t+9*c+4*Math.pow(c,2)+als/30*(61-58*t+Math.pow(t,2)+600*c-330*this.ep2)))))+this.y0
}p.x=x;
p.y=y;
return p
},inverse:function(p){var con,phi;
var delta_phi;
var i;
var max_iter=6;
var lat,lon;
if(this.sphere){var f=Math.exp(p.x/(this.a*this.k0));
var g=0.5*(f-1/f);
var temp=this.lat0+p.y/(this.a*this.k0);
var h=Math.cos(temp);
con=Math.sqrt((1-h*h)/(1+g*g));
lat=Math.asinz(con);
if(temp<0){lat=-lat
}if((g==0)&&(h==0)){lon=this.long0
}else{lon=Proj4js.common.adjust_lon(Math.atan2(g,h)+this.long0)
}}else{var x=p.x-this.x0;
var y=p.y-this.y0;
con=(this.ml0+y/this.k0)/this.a;
phi=con;
for(i=0;
;
i++){delta_phi=((con+this.e1*Math.sin(2*phi)-this.e2*Math.sin(4*phi)+this.e3*Math.sin(6*phi))/this.e0)-phi;
phi+=delta_phi;
if(Math.abs(delta_phi)<=Proj4js.common.EPSLN){break
}if(i>=max_iter){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");
return(95)
}}if(Math.abs(phi)<Proj4js.common.HALF_PI){var sin_phi=Math.sin(phi);
var cos_phi=Math.cos(phi);
var tan_phi=Math.tan(phi);
var c=this.ep2*Math.pow(cos_phi,2);
var cs=Math.pow(c,2);
var t=Math.pow(tan_phi,2);
var ts=Math.pow(t,2);
con=1-this.es*Math.pow(sin_phi,2);
var n=this.a/Math.sqrt(con);
var r=n*(1-this.es)/con;
var d=x/(n*this.k0);
var ds=Math.pow(d,2);
lat=phi-(n*tan_phi*ds/r)*(0.5-ds/24*(5+3*t+10*c-4*cs-9*this.ep2-ds/30*(61+90*t+298*c+45*ts-252*this.ep2-3*cs)));
lon=Proj4js.common.adjust_lon(this.long0+(d*(1-ds/6*(1+2*t+c-ds/20*(5-2*c+28*t-3*cs+8*this.ep2+24*ts)))/cos_phi))
}else{lat=Proj4js.common.HALF_PI*Proj4js.common.sign(y);
lon=this.long0
}}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.equi={init:function(){if(!this.x0){this.x0=0
}if(!this.y0){this.y0=0
}if(!this.lat0){this.lat0=0
}if(!this.long0){this.long0=0
}},forward:function(p){var lon=p.x;
var lat=p.y;
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var x=this.x0+this.a*dlon*Math.cos(this.lat0);
var y=this.y0+this.a*lat;
this.t1=x;
this.t2=Math.cos(this.lat0);
p.x=x;
p.y=y;
return p
},inverse:function(p){p.x-=this.x0;
p.y-=this.y0;
var lat=p.y/this.a;
if(Math.abs(lat)>Proj4js.common.HALF_PI){Proj4js.reportError("equi:Inv:DataError")
}var lon=Proj4js.common.adjust_lon(this.long0+p.x/(this.a*Math.cos(this.lat0)));
p.x=lon;
p.y=lat
}};
Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts)
}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts))
}}},forward:function(p){var lon=p.x;
var lat=p.y;
if(lat*Proj4js.common.R2D>90&&lat*Proj4js.common.R2D<-90&&lon*Proj4js.common.R2D>180&&lon*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+lon+" : "+lat);
return null
}var x,y;
if(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");
return null
}else{if(this.sphere){x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0);
y=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*lat))
}else{var sinphi=Math.sin(lat);
var ts=Proj4js.common.tsfnz(this.e,lat,sinphi);
x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0);
y=this.y0-this.a*this.k0*Math.log(ts)
}p.x=x;
p.y=y;
return p
}},inverse:function(p){var x=p.x-this.x0;
var y=p.y-this.y0;
var lon,lat;
if(this.sphere){lat=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-y/this.a*this.k0))
}else{var ts=Math.exp(-y/(this.a*this.k0));
lat=Proj4js.common.phi2z(this.e,ts);
if(lat==-9999){Proj4js.reportError("merc:inverse: lat = -9999");
return null
}}lon=Proj4js.common.adjust_lon(this.long0+x/(this.a*this.k0));
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.sinu={init:function(){this.R=6370997
},forward:function(p){var x,y,delta_lon;
var lon=p.x;
var lat=p.y;
delta_lon=Proj4js.common.adjust_lon(lon-this.long0);
x=this.R*delta_lon*Math.cos(lat)+this.x0;
y=this.R*lat+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){var lat,temp,lon;
p.x-=this.x0;
p.y-=this.y0;
lat=p.y/this.R;
if(Math.abs(lat)>Proj4js.common.HALF_PI){Proj4js.reportError("sinu:Inv:DataError")
}temp=Math.abs(lat)-Proj4js.common.HALF_PI;
if(Math.abs(temp)>Proj4js.common.EPSLN){temp=this.long0+p.x/(this.R*Math.cos(lat));
lon=Proj4js.common.adjust_lon(temp)
}else{lon=this.long0
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.eqdc={init:function(){if(!this.mode){this.mode=0
}this.temp=this.b/this.a;
this.es=1-Math.pow(this.temp,2);
this.e=Math.sqrt(this.es);
this.e0=Proj4js.common.e0fn(this.es);
this.e1=Proj4js.common.e1fn(this.es);
this.e2=Proj4js.common.e2fn(this.es);
this.e3=Proj4js.common.e3fn(this.es);
this.sinphi=Math.sin(this.lat1);
this.cosphi=Math.cos(this.lat1);
this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);
this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);
if(this.mode!=0){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("eqdc:Init:EqualLatitudes")
}this.sinphi=Math.sin(this.lat2);
this.cosphi=Math.cos(this.lat2);
this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);
this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);
if(Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN){this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)
}else{this.ns=this.sinphi
}}else{this.ns=this.sinphi
}this.g=this.ml1+this.ms1/this.ns;
this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);
this.rh=this.a*(this.g-this.ml0)
},forward:function(p){var lon=p.x;
var lat=p.y;
var ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);
var rh1=this.a*(this.g-ml);
var theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0);
var x=this.x0+rh1*Math.sin(theta);
var y=this.y0+this.rh-rh1*Math.cos(theta);
p.x=x;
p.y=y;
return p
},inverse:function(p){p.x-=this.x0;
p.y=this.rh-p.y+this.y0;
var con,rh1;
if(this.ns>=0){var rh1=Math.sqrt(p.x*p.x+p.y*p.y);
var con=1
}else{rh1=-Math.sqrt(p.x*p.x+p.y*p.y);
con=-1
}var theta=0;
if(rh1!=0){theta=Math.atan2(con*p.x,con*p.y)
}var ml=this.g-rh1/this.a;
var lat=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3);
var lon=Proj4js.common.adjust_lon(this.long0+theta/this.ns);
p.x=lon;
p.y=lat;
return p
},phi3z:function(ml,e0,e1,e2,e3){var phi;
var dphi;
phi=ml;
for(var i=0;
i<15;
i++){dphi=(ml+e1*Math.sin(2*phi)-e2*Math.sin(4*phi)+e3*Math.sin(6*phi))/e0-phi;
phi+=dphi;
if(Math.abs(dphi)<=1e-10){return phi
}}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");
return null
}};
function phi4z(eccent,e0,e1,e2,e3,a,b,c,phi){var sinphi,sin2ph,tanph,ml,mlp,con1,con2,con3,dphi,i;
phi=a;
for(i=1;
i<=15;
i++){sinphi=Math.sin(phi);
tanphi=Math.tan(phi);
c=tanphi*Math.sqrt(1-eccent*sinphi*sinphi);
sin2ph=Math.sin(2*phi);
ml=e0*phi-e1*sin2ph+e2*Math.sin(4*phi)-e3*Math.sin(6*phi);
mlp=e0-2*e1*Math.cos(2*phi)+4*e2*Math.cos(4*phi)-6*e3*Math.cos(6*phi);
con1=2*ml+c*(ml*ml+b)-2*a*(c*ml+1);
con2=eccent*sin2ph*(ml*ml+b-2*a*ml)/(2*c);
con3=2*(a-ml)*(c*mlp-2/sin2ph)-2*mlp;
dphi=con1/(con2+con3);
phi+=dphi;
if(Math.abs(dphi)<=1e-10){return(phi)
}}Proj4js.reportError("phi4z: No convergence");
return null
}function e4fn(x){var con,com;
con=1+x;
com=1-x;
return(Math.sqrt((Math.pow(con,con))*(Math.pow(com,com))))
}Proj4js.Proj.poly={init:function(){var temp;
if(this.lat0=0){this.lat0=90
}this.temp=this.b/this.a;
this.es=1-Math.pow(this.temp,2);
this.e=Math.sqrt(this.es);
this.e0=Proj4js.common.e0fn(this.es);
this.e1=Proj4js.common.e1fn(this.es);
this.e2=Proj4js.common.e2fn(this.es);
this.e3=Proj4js.common.e3fn(this.es);
this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)
},forward:function(p){var sinphi,cosphi;
var al;
var c;
var con,ml;
var ms;
var x,y;
var lon=p.x;
var lat=p.y;
con=Proj4js.common.adjust_lon(lon-this.long0);
if(Math.abs(lat)<=1e-7){x=this.x0+this.a*con;
y=this.y0-this.a*this.ml0
}else{sinphi=Math.sin(lat);
cosphi=Math.cos(lat);
ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);
ms=Proj4js.common.msfnz(this.e,sinphi,cosphi);
con=sinphi;
x=this.x0+this.a*ms*Math.sin(con)/sinphi;
y=this.y0+this.a*(ml-this.ml0+ms*(1-Math.cos(con))/sinphi)
}p.x=x;
p.y=y;
return p
},inverse:function(p){var sin_phi,cos_phi;
var al;
var b;
var c;
var con,ml;
var iflg;
var lon,lat;
p.x-=this.x0;
p.y-=this.y0;
al=this.ml0+p.y/this.a;
iflg=0;
if(Math.abs(al)<=1e-7){lon=p.x/this.a+this.long0;
lat=0
}else{b=al*al+(p.x/this.a)*(p.x/this.a);
iflg=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,b,c,lat);
if(iflg!=1){return(iflg)
}lon=Proj4js.common.adjust_lon((asinz(p.x*c/this.a)/Math.sin(lat))+this.long0)
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";
Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;
Proj4js.Proj.gstmerc={init:function(){var temp=this.b/this.a;
this.e=Math.sqrt(1-temp*temp);
this.lc=this.long0;
this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));
var sinz=Math.sin(this.lat0);
var pc=Math.asin(sinz/this.rs);
var sinzpc=Math.sin(pc);
this.cp=Proj4js.common.latiso(0,pc,sinzpc)-this.rs*Proj4js.common.latiso(this.e,this.lat0,sinz);
this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*sinz*sinz);
this.xs=this.x0;
this.ys=this.y0-this.n2*pc;
if(!this.title){this.title="Gauss Schreiber transverse mercator"
}},forward:function(p){var lon=p.x;
var lat=p.y;
var L=this.rs*(lon-this.lc);
var Ls=this.cp+(this.rs*Proj4js.common.latiso(this.e,lat,Math.sin(lat)));
var lat1=Math.asin(Math.sin(L)/Proj4js.common.cosh(Ls));
var Ls1=Proj4js.common.latiso(0,lat1,Math.sin(lat1));
p.x=this.xs+(this.n2*Ls1);
p.y=this.ys+(this.n2*Math.atan(Proj4js.common.sinh(Ls)/Math.cos(L)));
return p
},inverse:function(p){var x=p.x;
var y=p.y;
var L=Math.atan(Proj4js.common.sinh((x-this.xs)/this.n2)/Math.cos((y-this.ys)/this.n2));
var lat1=Math.asin(Math.sin((y-this.ys)/this.n2)/Proj4js.common.cosh((x-this.xs)/this.n2));
var LC=Proj4js.common.latiso(0,lat1,Math.sin(lat1));
p.x=this.lc+L/this.rs;
p.y=Proj4js.common.invlatiso(this.e,(LC-this.cp)/this.rs);
return p
}};
Proj4js.Proj.ortho={init:function(def){this.sin_p14=Math.sin(this.lat0);
this.cos_p14=Math.cos(this.lat0)
},forward:function(p){var sinphi,cosphi;
var dlon;
var coslon;
var ksp;
var g;
var lon=p.x;
var lat=p.y;
dlon=Proj4js.common.adjust_lon(lon-this.long0);
sinphi=Math.sin(lat);
cosphi=Math.cos(lat);
coslon=Math.cos(dlon);
g=this.sin_p14*sinphi+this.cos_p14*cosphi*coslon;
ksp=1;
if((g>0)||(Math.abs(g)<=Proj4js.common.EPSLN)){var x=this.a*ksp*cosphi*Math.sin(dlon);
var y=this.y0+this.a*ksp*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon)
}else{Proj4js.reportError("orthoFwdPointError")
}p.x=x;
p.y=y;
return p
},inverse:function(p){var rh;
var z;
var sinz,cosz;
var temp;
var con;
var lon,lat;
p.x-=this.x0;
p.y-=this.y0;
rh=Math.sqrt(p.x*p.x+p.y*p.y);
if(rh>this.a+1e-7){Proj4js.reportError("orthoInvDataError")
}z=Proj4js.common.asinz(rh/this.a);
sinz=Math.sin(z);
cosi=Math.cos(z);
lon=this.long0;
if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.lat0
}lat=Proj4js.common.asinz(cosz*this.sin_p14+(y*sinz*this.cos_p14)/rh);
con=Math.abs(lat0)-Proj4js.common.HALF_PI;
if(Math.abs(con)<=Proj4js.common.EPSLN){if(this.lat0>=0){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y))
}else{lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y))
}}con=cosz-this.sin_p14*Math.sin(lat);
if((Math.abs(con)>=Proj4js.common.EPSLN)||(Math.abs(x)>=Proj4js.common.EPSLN)){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2((p.x*sinz*this.cos_p14),(con*rh)))
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.somerc={init:function(){var phy0=this.lat0;
this.lambda0=this.long0;
var sinPhy0=Math.sin(phy0);
var semiMajorAxis=this.a;
var invF=this.rf;
var flattening=1/invF;
var e2=2*flattening-Math.pow(flattening,2);
var e=this.e=Math.sqrt(e2);
this.R=semiMajorAxis*Math.sqrt(1-e2)/(1-e2*Math.pow(sinPhy0,2));
this.alpha=Math.sqrt(1+e2/(1-e2)*Math.pow(Math.cos(phy0),4));
this.b0=Math.asin(sinPhy0/this.alpha);
this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+phy0/2))+this.alpha*e/2*Math.log((1+e*sinPhy0)/(1-e*sinPhy0))
},forward:function(p){var Sa1=Math.log(Math.tan(Math.PI/4-p.y/2));
var Sa2=this.e/2*Math.log((1+this.e*Math.sin(p.y))/(1-this.e*Math.sin(p.y)));
var S=-this.alpha*(Sa1+Sa2)+this.K;
var b=2*(Math.atan(Math.exp(S))-Math.PI/4);
var I=this.alpha*(p.x-this.lambda0);
var rotI=Math.atan(Math.sin(I)/(Math.sin(this.b0)*Math.tan(b)+Math.cos(this.b0)*Math.cos(I)));
var rotB=Math.asin(Math.cos(this.b0)*Math.sin(b)-Math.sin(this.b0)*Math.cos(b)*Math.cos(I));
p.y=this.R/2*Math.log((1+Math.sin(rotB))/(1-Math.sin(rotB)))+this.y0;
p.x=this.R*rotI+this.x0;
return p
},inverse:function(p){var Y=p.x-this.x0;
var X=p.y-this.y0;
var rotI=Y/this.R;
var rotB=2*(Math.atan(Math.exp(X/this.R))-Math.PI/4);
var b=Math.asin(Math.cos(this.b0)*Math.sin(rotB)+Math.sin(this.b0)*Math.cos(rotB)*Math.cos(rotI));
var I=Math.atan(Math.sin(rotI)/(Math.cos(this.b0)*Math.cos(rotI)-Math.sin(this.b0)*Math.tan(rotB)));
var lambda=this.lambda0+I/this.alpha;
var S=0;
var phy=b;
var prevPhy=-1000;
var iteration=0;
while(Math.abs(phy-prevPhy)>1e-7){if(++iteration>20){Proj4js.reportError("omercFwdInfinity");
return
}S=1/this.alpha*(Math.log(Math.tan(Math.PI/4+b/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(phy))/2));
prevPhy=phy;
phy=2*Math.atan(Math.exp(S))-Math.PI/2
}p.x=lambda;
p.y=phy;
return p
}};
Proj4js.Proj.stere={ssfn_:function(phit,sinphi,eccen){sinphi*=eccen;
return(Math.tan(0.5*(Proj4js.common.HALF_PI+phit))*Math.pow((1-sinphi)/(1+sinphi),0.5*eccen))
},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;
var t=Math.abs(this.lat0);
if((Math.abs(t)-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE
}else{this.mode=t>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT
}this.phits=Math.abs(this.phits);
if(this.es){var X;
switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e))
}else{t=Math.sin(this.phits);
this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,t);
t*=this.e;
this.akm1/=Math.sqrt(1-t*t)
}break;
case this.EQUIT:this.akm1=2*this.k0;
break;
case this.OBLIQ:t=Math.sin(this.lat0);
X=2*Math.atan(this.ssfn_(this.lat0,t,this.e))-Proj4js.common.HALF_PI;
t*=this.e;
this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-t*t);
this.sinX1=Math.sin(X);
this.cosX1=Math.cos(X);
break
}}else{switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);
this.cosph0=Math.cos(this.lat0);
case this.EQUIT:this.akm1=2*this.k0;
break;
case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-0.5*this.phits):2*this.k0;
break
}}},forward:function(p){var lon=p.x;
var lat=p.y;
var x,y;
if(this.sphere){var sinphi,cosphi,coslam,sinlam;
sinphi=Math.sin(lat);
cosphi=Math.cos(lat);
coslam=Math.cos(lon);
sinlam=Math.sin(lon);
switch(this.mode){case this.EQUIT:y=1+cosphi*coslam;
if(y<=Proj4js.common.EPSLN){F_ERROR
}y=this.akm1/y;
x=y*cosphi*sinlam;
y*=sinphi;
break;
case this.OBLIQ:y=1+this.sinph0*sinphi+this.cosph0*cosphi*coslam;
if(y<=Proj4js.common.EPSLN){F_ERROR
}y=this.akm1/y;
x=y*cosphi*sinlam;
y*=this.cosph0*sinphi-this.sinph0*cosphi*coslam;
break;
case this.N_POLE:coslam=-coslam;
lat=-lat;
case this.S_POLE:if(Math.abs(lat-Proj4js.common.HALF_PI)<this.TOL){F_ERROR
}y=this.akm1*Math.tan(Proj4js.common.FORTPI+0.5*lat);
x=sinlam*y;
y*=coslam;
break
}}else{coslam=Math.cos(lon);
sinlam=Math.sin(lon);
sinphi=Math.sin(lat);
if(this.mode==this.OBLIQ||this.mode==this.EQUIT){X=2*Math.atan(this.ssfn_(lat,sinphi,this.e));
sinX=Math.sin(X-Proj4js.common.HALF_PI);
cosX=Math.cos(X)
}switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*coslam));
y=A*(this.cosX1*sinX-this.sinX1*cosX*coslam);
x=A*cosX;
break;
case this.EQUIT:A=2*this.akm1/(1+cosX*coslam);
y=A*sinX;
x=A*cosX;
break;
case this.S_POLE:lat=-lat;
coslam=-coslam;
sinphi=-sinphi;
case this.N_POLE:x=this.akm1*Proj4js.common.tsfnz(this.e,lat,sinphi);
y=-x*coslam;
break
}x=x*sinlam
}p.x=x*this.a+this.x0;
p.y=y*this.a+this.y0;
return p
},inverse:function(p){var x=(p.x-this.x0)/this.a;
var y=(p.y-this.y0)/this.a;
var lon,lat;
var cosphi,sinphi,tp=0,phi_l=0,rho,halfe=0,pi2=0;
var i;
if(this.sphere){var c,rh,sinc,cosc;
rh=Math.sqrt(x*x+y*y);
c=2*Math.atan(rh/this.akm1);
sinc=Math.sin(c);
cosc=Math.cos(c);
lon=0;
switch(this.mode){case this.EQUIT:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=0
}else{lat=Math.asin(y*sinc/rh)
}if(cosc!=0||x!=0){lon=Math.atan2(x*sinc,cosc*rh)
}break;
case this.OBLIQ:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.phi0
}else{lat=Math.asin(cosc*sinph0+y*sinc*cosph0/rh)
}c=cosc-sinph0*Math.sin(lat);
if(c!=0||x!=0){lon=Math.atan2(x*sinc*cosph0,c*rh)
}break;
case this.N_POLE:y=-y;
case this.S_POLE:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.phi0
}else{lat=Math.asin(this.mode==this.S_POLE?-cosc:cosc)
}lon=(x==0&&y==0)?0:Math.atan2(x,y);
break
}}else{rho=Math.sqrt(x*x+y*y);
switch(this.mode){case this.OBLIQ:case this.EQUIT:tp=2*Math.atan2(rho*this.cosX1,this.akm1);
cosphi=Math.cos(tp);
sinphi=Math.sin(tp);
if(rho==0){phi_l=Math.asin(cosphi*this.sinX1)
}else{phi_l=Math.asin(cosphi*this.sinX1+(y*sinphi*this.cosX1/rho))
}tp=Math.tan(0.5*(Proj4js.common.HALF_PI+phi_l));
x*=sinphi;
y=rho*this.cosX1*cosphi-y*this.sinX1*sinphi;
pi2=Proj4js.common.HALF_PI;
halfe=0.5*this.e;
break;
case this.N_POLE:y=-y;
case this.S_POLE:tp=-rho/this.akm1;
phi_l=Proj4js.common.HALF_PI-2*Math.atan(tp);
pi2=-Proj4js.common.HALF_PI;
halfe=-0.5*this.e;
break
}for(i=this.NITER;
i--;
phi_l=lat){sinphi=this.e*Math.sin(phi_l);
lat=2*Math.atan(tp*Math.pow((1+sinphi)/(1-sinphi),halfe))-pi2;
if(Math.abs(phi_l-lat)<this.CONV){if(this.mode==this.S_POLE){lat=-lat
}lon=(x==0&&y==0)?0:Math.atan2(x,y);
p.x=lon;
p.y=lat;
return p
}}}}};
Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array();
this.A[1]=+0.6399175073;
this.A[2]=-0.1358797613;
this.A[3]=+0.063294409;
this.A[4]=-0.02526853;
this.A[5]=+0.0117879;
this.A[6]=-0.0055161;
this.A[7]=+0.0026906;
this.A[8]=-0.001333;
this.A[9]=+0.00067;
this.A[10]=-0.00034;
this.B_re=new Array();
this.B_im=new Array();
this.B_re[1]=+0.7557853228;
this.B_im[1]=0;
this.B_re[2]=+0.249204646;
this.B_im[2]=+0.003371507;
this.B_re[3]=-0.001541739;
this.B_im[3]=+0.04105856;
this.B_re[4]=-0.10162907;
this.B_im[4]=+0.01727609;
this.B_re[5]=-0.26623489;
this.B_im[5]=-0.36249218;
this.B_re[6]=-0.6870983;
this.B_im[6]=-1.1651967;
this.C_re=new Array();
this.C_im=new Array();
this.C_re[1]=+1.3231270439;
this.C_im[1]=0;
this.C_re[2]=-0.577245789;
this.C_im[2]=-0.007809598;
this.C_re[3]=+0.508307513;
this.C_im[3]=-0.112208952;
this.C_re[4]=-0.15094762;
this.C_im[4]=+0.18200602;
this.C_re[5]=+1.01418179;
this.C_im[5]=+1.64497696;
this.C_re[6]=+1.9660549;
this.C_im[6]=+2.5127645;
this.D=new Array();
this.D[1]=+1.5627014243;
this.D[2]=+0.5185406398;
this.D[3]=-0.03333098;
this.D[4]=-0.1052906;
this.D[5]=-0.0368594;
this.D[6]=+0.007317;
this.D[7]=+0.0122;
this.D[8]=+0.00394;
this.D[9]=-0.0013
},forward:function(p){var lon=p.x;
var lat=p.y;
var delta_lat=lat-this.lat0;
var delta_lon=lon-this.long0;
var d_phi=delta_lat/Proj4js.common.SEC_TO_RAD*0.00001;
var d_lambda=delta_lon;
var d_phi_n=1;
var d_psi=0;
for(n=1;
n<=10;
n++){d_phi_n=d_phi_n*d_phi;
d_psi=d_psi+this.A[n]*d_phi_n
}var th_re=d_psi;
var th_im=d_lambda;
var th_n_re=1;
var th_n_im=0;
var th_n_re1;
var th_n_im1;
var z_re=0;
var z_im=0;
for(n=1;
n<=6;
n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;
th_n_im1=th_n_im*th_re+th_n_re*th_im;
th_n_re=th_n_re1;
th_n_im=th_n_im1;
z_re=z_re+this.B_re[n]*th_n_re-this.B_im[n]*th_n_im;
z_im=z_im+this.B_im[n]*th_n_re+this.B_re[n]*th_n_im
}x=(z_im*this.a)+this.x0;
y=(z_re*this.a)+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){var x=p.x;
var y=p.y;
var delta_x=x-this.x0;
var delta_y=y-this.y0;
var z_re=delta_y/this.a;
var z_im=delta_x/this.a;
var z_n_re=1;
var z_n_im=0;
var z_n_re1;
var z_n_im1;
var th_re=0;
var th_im=0;
for(n=1;
n<=6;
n++){z_n_re1=z_n_re*z_re-z_n_im*z_im;
z_n_im1=z_n_im*z_re+z_n_re*z_im;
z_n_re=z_n_re1;
z_n_im=z_n_im1;
th_re=th_re+this.C_re[n]*z_n_re-this.C_im[n]*z_n_im;
th_im=th_im+this.C_im[n]*z_n_re+this.C_re[n]*z_n_im
}for(i=0;
i<this.iterations;
i++){var th_n_re=th_re;
var th_n_im=th_im;
var th_n_re1;
var th_n_im1;
var num_re=z_re;
var num_im=z_im;
for(n=2;
n<=6;
n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;
th_n_im1=th_n_im*th_re+th_n_re*th_im;
th_n_re=th_n_re1;
th_n_im=th_n_im1;
num_re=num_re+(n-1)*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im);
num_im=num_im+(n-1)*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im)
}th_n_re=1;
th_n_im=0;
var den_re=this.B_re[1];
var den_im=this.B_im[1];
for(n=2;
n<=6;
n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;
th_n_im1=th_n_im*th_re+th_n_re*th_im;
th_n_re=th_n_re1;
th_n_im=th_n_im1;
den_re=den_re+n*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im);
den_im=den_im+n*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im)
}var den2=den_re*den_re+den_im*den_im;
th_re=(num_re*den_re+num_im*den_im)/den2;
th_im=(num_im*den_re-num_re*den_im)/den2
}var d_psi=th_re;
var d_lambda=th_im;
var d_psi_n=1;
var d_phi=0;
for(n=1;
n<=9;
n++){d_psi_n=d_psi_n*d_psi;
d_phi=d_phi+this.D[n]*d_psi_n
}var lat=this.lat0+(d_phi*Proj4js.common.SEC_TO_RAD*100000);
var lon=this.long0+d_lambda;
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.mill={init:function(){},forward:function(p){var lon=p.x;
var lat=p.y;
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var x=this.x0+this.a*dlon;
var y=this.y0+this.a*Math.log(Math.tan((Proj4js.common.PI/4)+(lat/2.5)))*1.25;
p.x=x;
p.y=y;
return p
},inverse:function(p){p.x-=this.x0;
p.y-=this.y0;
var lon=Proj4js.common.adjust_lon(this.long0+p.x/this.a);
var lat=2.5*(Math.atan(Math.exp(0.8*p.y/this.a))-Proj4js.common.PI/4);
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");
return
}this.lat0=0;
this.long0=((6*Math.abs(this.zone))-183)*Proj4js.common.D2R;
this.x0=500000;
this.y0=this.utmSouth?10000000:0;
this.k0=0.9996;
Proj4js.Proj.tmerc.init.apply(this);
this.forward=Proj4js.Proj.tmerc.forward;
this.inverse=Proj4js.Proj.tmerc.inverse
}};
var GEOCENT_LAT_ERROR=1;
var COS_67P5=0.3826834323650898;
var AD_C=1.0026;
function cs_geodetic_to_geocentric(cs,p){var Longitude=p.x;
var Latitude=p.y;
var Height=p.z;
var X;
var Y;
var Z;
var Error_Code=0;
var Rn;
var Sin_Lat;
var Sin2_Lat;
var Cos_Lat;
if(Latitude<-HALF_PI&&Latitude>-1.001*HALF_PI){Latitude=-HALF_PI
}else{if(Latitude>HALF_PI&&Latitude<1.001*HALF_PI){Latitude=HALF_PI
}else{if((Latitude<-HALF_PI)||(Latitude>HALF_PI)){Error_Code|=GEOCENT_LAT_ERROR
}}}if(!Error_Code){if(Longitude>PI){Longitude-=(2*PI)
}Sin_Lat=Math.sin(Latitude);
Cos_Lat=Math.cos(Latitude);
Sin2_Lat=Sin_Lat*Sin_Lat;
Rn=cs.a/(Math.sqrt(1-cs.es*Sin2_Lat));
X=(Rn+Height)*Cos_Lat*Math.cos(Longitude);
Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude);
Z=((Rn*(1-cs.es))+Height)*Sin_Lat
}p.x=X;
p.y=Y;
p.z=Z;
return Error_Code
}function cs_geocentric_to_geodetic(cs,p){var X=p.x;
var Y=p.y;
var Z=p.z;
var Longitude;
var Latitude;
var Height;
var W;
var W2;
var T0;
var T1;
var S0;
var S1;
var Sin_B0;
var Sin3_B0;
var Cos_B0;
var Sin_p1;
var Cos_p1;
var Rn;
var Sum;
var At_Pole;
X=parseFloat(X);
Y=parseFloat(Y);
Z=parseFloat(Z);
At_Pole=false;
if(X!=0){Longitude=Math.atan2(Y,X)
}else{if(Y>0){Longitude=HALF_PI
}else{if(Y<0){Longitude=-HALF_PI
}else{At_Pole=true;
Longitude=0;
if(Z>0){Latitude=HALF_PI
}else{if(Z<0){Latitude=-HALF_PI
}else{Latitude=HALF_PI;
Height=-cs.b;
return
}}}}}W2=X*X+Y*Y;
W=Math.sqrt(W2);
T0=Z*AD_C;
S0=Math.sqrt(T0*T0+W2);
Sin_B0=T0/S0;
Cos_B0=W/S0;
Sin3_B0=Sin_B0*Sin_B0*Sin_B0;
T1=Z+cs.b*cs.ep2*Sin3_B0;
Sum=W-cs.a*cs.es*Cos_B0*Cos_B0*Cos_B0;
S1=Math.sqrt(T1*T1+Sum*Sum);
Sin_p1=T1/S1;
Cos_p1=Sum/S1;
Rn=cs.a/Math.sqrt(1-cs.es*Sin_p1*Sin_p1);
if(Cos_p1>=COS_67P5){Height=W/Cos_p1-Rn
}else{if(Cos_p1<=-COS_67P5){Height=W/-Cos_p1-Rn
}else{Height=Z/Sin_p1+Rn*(cs.es-1)
}}if(At_Pole==false){Latitude=Math.atan(Sin_p1/Cos_p1)
}p.x=Longitude;
p.y=Latitude;
p.z=Height;
return 0
}function cs_geocentric_to_wgs84(defn,p){if(defn.datum_type==PJD_3PARAM){p.x+=defn.datum_params[0];
p.y+=defn.datum_params[1];
p.z+=defn.datum_params[2]
}else{var Dx_BF=defn.datum_params[0];
var Dy_BF=defn.datum_params[1];
var Dz_BF=defn.datum_params[2];
var Rx_BF=defn.datum_params[3];
var Ry_BF=defn.datum_params[4];
var Rz_BF=defn.datum_params[5];
var M_BF=defn.datum_params[6];
var x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF;
var y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF;
var z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;
p.x=x_out;
p.y=y_out;
p.z=z_out
}}function cs_geocentric_from_wgs84(defn,p){if(defn.datum_type==PJD_3PARAM){p.x-=defn.datum_params[0];
p.y-=defn.datum_params[1];
p.z-=defn.datum_params[2]
}else{var Dx_BF=defn.datum_params[0];
var Dy_BF=defn.datum_params[1];
var Dz_BF=defn.datum_params[2];
var Rx_BF=defn.datum_params[3];
var Ry_BF=defn.datum_params[4];
var Rz_BF=defn.datum_params[5];
var M_BF=defn.datum_params[6];
var x_tmp=(p.x-Dx_BF)/M_BF;
var y_tmp=(p.y-Dy_BF)/M_BF;
var z_tmp=(p.z-Dz_BF)/M_BF;
p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp;
p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp;
p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp
}}Proj4js.Proj.vandg={init:function(){this.R=6370997
},forward:function(p){var lon=p.x;
var lat=p.y;
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var x,y;
if(Math.abs(lat)<=Proj4js.common.EPSLN){x=this.x0+this.R*dlon;
y=this.y0
}var theta=Proj4js.common.asinz(2*Math.abs(lat/Proj4js.common.PI));
if((Math.abs(dlon)<=Proj4js.common.EPSLN)||(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)){x=this.x0;
if(lat>=0){y=this.y0+Proj4js.common.PI*this.R*Math.tan(0.5*theta)
}else{y=this.y0+Proj4js.common.PI*this.R*-Math.tan(0.5*theta)
}}var al=0.5*Math.abs((Proj4js.common.PI/dlon)-(dlon/Proj4js.common.PI));
var asq=al*al;
var sinth=Math.sin(theta);
var costh=Math.cos(theta);
var g=costh/(sinth+costh-1);
var gsq=g*g;
var m=g*(2/sinth-1);
var msq=m*m;
var con=Proj4js.common.PI*this.R*(al*(g-msq)+Math.sqrt(asq*(g-msq)*(g-msq)-(msq+asq)*(gsq-msq)))/(msq+asq);
if(dlon<0){con=-con
}x=this.x0+con;
con=Math.abs(con/(Proj4js.common.PI*this.R));
if(lat>=0){y=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-con*con-2*al*con)
}else{y=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-con*con-2*al*con)
}p.x=x;
p.y=y;
return p
},inverse:function(p){var dlon;
var xx,yy,xys,c1,c2,c3;
var al,asq;
var a1;
var m1;
var con;
var th1;
var d;
p.x-=this.x0;
p.y-=this.y0;
con=Proj4js.common.PI*this.R;
xx=p.x/con;
yy=p.y/con;
xys=xx*xx+yy*yy;
c1=-Math.abs(yy)*(1+xys);
c2=c1-2*yy*yy+xx*xx;
c3=-2*c1+1+2*yy*yy+xys*xys;
d=yy*yy/c3+(2*c2*c2*c2/c3/c3/c3-9*c1*c2/c3/c3)/27;
a1=(c1-c2*c2/3/c3)/c3;
m1=2*Math.sqrt(-a1/3);
con=((3*d)/a1)/m1;
if(Math.abs(con)>1){if(con>=0){con=1
}else{con=-1
}}th1=Math.acos(con)/3;
if(p.y>=0){lat=(-m1*Math.cos(th1+Proj4js.common.PI/3)-c2/3/c3)*Proj4js.common.PI
}else{lat=-(-m1*Math.cos(th1+PI/3)-c2/3/c3)*Proj4js.common.PI
}if(Math.abs(xx)<Proj4js.common.EPSLN){lon=this.long0
}lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(xys-1+Math.sqrt(1+2*(xx*xx-yy*yy)+xys*xys))/2/xx);
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.eqc={init:function(){if(!this.x0){this.x0=0
}if(!this.y0){this.y0=0
}if(!this.lat0){this.lat0=0
}if(!this.long0){this.long0=0
}if(!this.lat_ts){this.lat_ts=0
}if(!this.title){this.title="Equidistant Cylindrical (Plate Carre)"
}this.rc=Math.cos(this.lat_ts)
},forward:function(p){var lon=p.x;
var lat=p.y;
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var dlat=Proj4js.common.adjust_lat(lat-this.lat0);
p.x=this.x0+(this.a*dlon*this.rc);
p.y=this.y0+(this.a*dlat);
return p
},inverse:function(p){var x=p.x;
var y=p.y;
p.x=Proj4js.common.adjust_lon(this.long0+((x-this.x0)/(this.a*this.rc)));
p.y=Proj4js.common.adjust_lat(this.lat0+((y-this.y0)/(this.a)));
return p
}};
Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);
cphi=Math.cos(this.lat0);
cphi*=cphi;
this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);
this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));
this.phic0=Math.asin(sphi/this.C);
this.ratexp=0.5*this.C*this.e;
this.K=Math.tan(0.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))
},forward:function(p){var lon=p.x;
var lat=p.y;
p.y=2*Math.atan(this.K*Math.pow(Math.tan(0.5*lat+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(lat),this.ratexp))-Proj4js.common.HALF_PI;
p.x=this.C*lon;
return p
},inverse:function(p){var DEL_TOL=1e-14;
var lon=p.x/this.C;
var lat=p.y;
num=Math.pow(Math.tan(0.5*lat+Proj4js.common.FORTPI)/this.K,1/this.C);
for(var i=Proj4js.common.MAX_ITER;
i>0;
--i){lat=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(p.y),-0.5*this.e))-Proj4js.common.HALF_PI;
if(Math.abs(lat-p.y)<DEL_TOL){break
}p.y=lat
}if(!i){Proj4js.reportError("gauss:inverse:convergence failed");
return null
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.omerc={init:function(){if(!this.mode){this.mode=0
}if(!this.lon1){this.lon1=0;
this.mode=1
}if(!this.lon2){this.lon2=0
}if(!this.lat2){this.lat2=0
}var temp=this.b/this.a;
var es=1-Math.pow(temp,2);
var e=Math.sqrt(es);
this.sin_p20=Math.sin(this.lat0);
this.cos_p20=Math.cos(this.lat0);
this.con=1-this.es*this.sin_p20*this.sin_p20;
this.com=Math.sqrt(1-es);
this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-es));
this.al=this.a*this.bl*this.k0*this.com/this.con;
if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;
this.d=1;
this.el=1
}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);
this.con=Math.sqrt(this.con);
this.d=this.bl*this.com/(this.cos_p20*this.con);
if((this.d*this.d-1)>0){if(this.lat0>=0){this.f=this.d+Math.sqrt(this.d*this.d-1)
}else{this.f=this.d-Math.sqrt(this.d*this.d-1)
}}else{this.f=this.d
}this.el=this.f*Math.pow(this.ts,this.bl)
}if(this.mode!=0){this.g=0.5*(this.f-1/this.f);
this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);
this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;
this.con=Math.abs(this.lat0);
if((this.con>Proj4js.common.EPSLN)&&(Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN)){this.singam=Math.sin(this.gama);
this.cosgam=Math.cos(this.gama);
this.sinaz=Math.sin(this.alpha);
this.cosaz=Math.cos(this.alpha);
if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)
}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)
}}else{Proj4js.reportError("omerc:Init:DataError")
}}else{this.sinphi=Math.sin(this.at1);
this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);
this.sinphi=Math.sin(this.lat2);
this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);
this.h=Math.pow(this.ts1,this.bl);
this.l=Math.pow(this.ts2,this.bl);
this.f=this.el/this.h;
this.g=0.5*(this.f-1/this.f);
this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);
this.p=(this.l-this.h)/(this.l+this.h);
this.dlon=this.lon1-this.lon2;
if(this.dlon<-Proj4js.common.PI){this.lon2=this.lon2-2*Proj4js.common.PI
}if(this.dlon>Proj4js.common.PI){this.lon2=this.lon2+2*Proj4js.common.PI
}this.dlon=this.lon1-this.lon2;
this.longc=0.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(0.5*this.bl*this.dlon)/this.p)/this.bl;
this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);
this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);
this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));
if(Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError")
}else{this.con=Math.abs(this.lat1)
}if((this.con<=Proj4js.common.EPSLN)||(Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN)){Proj4js.reportError("omercInitDataError")
}else{if(Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError")
}}this.singam=Math.sin(this.gam);
this.cosgam=Math.cos(this.gam);
this.sinaz=Math.sin(this.alpha);
this.cosaz=Math.cos(this.alpha);
if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)
}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)
}}},forward:function(p){var theta;
var sin_phi,cos_phi;
var b;
var c,t,tq;
var con,n,ml;
var q,us,vl;
var ul,vs;
var s;
var dlon;
var ts1;
var lon=p.x;
var lat=p.y;
sin_phi=Math.sin(lat);
dlon=Proj4js.common.adjust_lon(lon-this.longc);
vl=Math.sin(this.bl*dlon);
if(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){ts1=Proj4js.common.tsfnz(this.e,lat,sin_phi);
q=this.el/(Math.pow(ts1,this.bl));
s=0.5*(q-1/q);
t=0.5*(q+1/q);
ul=(s*this.singam-vl*this.cosgam)/t;
con=Math.cos(this.bl*dlon);
if(Math.abs(con)<1e-7){us=this.al*this.bl*dlon
}else{us=this.al*Math.atan((s*this.cosgam+vl*this.singam)/con)/this.bl;
if(con<0){us=us+Proj4js.common.PI*this.al/this.bl
}}}else{if(lat>=0){ul=this.singam
}else{ul=-this.singam
}us=this.al*lat/this.bl
}if(Math.abs(Math.abs(ul)-1)<=Proj4js.common.EPSLN){Proj4js.reportError("omercFwdInfinity")
}vs=0.5*this.al*Math.log((1-ul)/(1+ul))/this.bl;
us=us-this.u;
var x=this.x0+vs*this.cosaz+us*this.sinaz;
var y=this.y0+us*this.cosaz-vs*this.sinaz;
p.x=x;
p.y=y;
return p
},inverse:function(p){var delta_lon;
var theta;
var delta_theta;
var sin_phi,cos_phi;
var b;
var c,t,tq;
var con,n,ml;
var vs,us,q,s,ts1;
var vl,ul,bs;
var dlon;
var flag;
p.x-=this.x0;
p.y-=this.y0;
flag=0;
vs=p.x*this.cosaz-p.y*this.sinaz;
us=p.y*this.cosaz+p.x*this.sinaz;
us=us+this.u;
q=Math.exp(-this.bl*vs/this.al);
s=0.5*(q-1/q);
t=0.5*(q+1/q);
vl=Math.sin(this.bl*us/this.al);
ul=(vl*this.cosgam+s*this.singam)/t;
if(Math.abs(Math.abs(ul)-1)<=Proj4js.common.EPSLN){lon=this.longc;
if(ul>=0){lat=Proj4js.common.HALF_PI
}else{lat=-Proj4js.common.HALF_PI
}}else{con=1/this.bl;
ts1=Math.pow((this.el/Math.sqrt((1+ul)/(1-ul))),con);
lat=Proj4js.common.phi2z(this.e,ts1);
theta=this.longc-Math.atan2((s*this.cosgam-vl*this.singam),con)/this.bl;
lon=Proj4js.common.adjust_lon(theta)
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0
}if(!this.k0){this.k0=1
}if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");
return
}var temp=this.b/this.a;
this.e=Math.sqrt(1-temp*temp);
var sin1=Math.sin(this.lat1);
var cos1=Math.cos(this.lat1);
var ms1=Proj4js.common.msfnz(this.e,sin1,cos1);
var ts1=Proj4js.common.tsfnz(this.e,this.lat1,sin1);
var sin2=Math.sin(this.lat2);
var cos2=Math.cos(this.lat2);
var ms2=Proj4js.common.msfnz(this.e,sin2,cos2);
var ts2=Proj4js.common.tsfnz(this.e,this.lat2,sin2);
var ts0=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));
if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(ms1/ms2)/Math.log(ts1/ts2)
}else{this.ns=sin1
}this.f0=ms1/(this.ns*Math.pow(ts1,this.ns));
this.rh=this.a*this.f0*Math.pow(ts0,this.ns);
if(!this.title){this.title="Lambert Conformal Conic"
}},forward:function(p){var lon=p.x;
var lat=p.y;
if(lat<=90&&lat>=-90&&lon<=180&&lon>=-180){}else{Proj4js.reportError("lcc:forward: llInputOutOfRange: "+lon+" : "+lat);
return null
}var con=Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI);
var ts;
if(con>Proj4js.common.EPSLN){ts=Proj4js.common.tsfnz(this.e,lat,Math.sin(lat));
rh1=this.a*this.f0*Math.pow(ts,this.ns)
}else{con=lat*this.ns;
if(con<=0){Proj4js.reportError("lcc:forward: No Projection");
return null
}rh1=0
}var theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0);
p.x=this.k0*(rh1*Math.sin(theta))+this.x0;
p.y=this.k0*(this.rh-rh1*Math.cos(theta))+this.y0;
return p
},inverse:function(p){var rh1,con,ts;
var lat,lon;
x=(p.x-this.x0)/this.k0;
y=(this.rh-(p.y-this.y0)/this.k0);
if(this.ns>0){rh1=Math.sqrt(x*x+y*y);
con=1
}else{rh1=-Math.sqrt(x*x+y*y);
con=-1
}var theta=0;
if(rh1!=0){theta=Math.atan2((con*x),(con*y))
}if((rh1!=0)||(this.ns>0)){con=1/this.ns;
ts=Math.pow((rh1/(this.a*this.f0)),con);
lat=Proj4js.common.phi2z(this.e,ts);
if(lat==-9999){return null
}}else{lat=-Proj4js.common.HALF_PI
}lon=Proj4js.common.adjust_lon(theta/this.ns+this.long0);
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.laea={init:function(){this.sin_lat_o=Math.sin(this.lat0);
this.cos_lat_o=Math.cos(this.lat0)
},forward:function(p){var lon=p.x;
var lat=p.y;
var delta_lon=Proj4js.common.adjust_lon(lon-this.long0);
var sin_lat=Math.sin(lat);
var cos_lat=Math.cos(lat);
var sin_delta_lon=Math.sin(delta_lon);
var cos_delta_lon=Math.cos(delta_lon);
var g=this.sin_lat_o*sin_lat+this.cos_lat_o*cos_lat*cos_delta_lon;
if(g==-1){Proj4js.reportError("laea:fwd:Point projects to a circle of radius "+2*R);
return null
}var ksp=this.a*Math.sqrt(2/(1+g));
var x=ksp*cos_lat*sin_delta_lon+this.x0;
var y=ksp*(this.cos_lat_o*sin_lat-this.sin_lat_o*cos_lat*cos_delta_lon)+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){p.x-=this.x0;
p.y-=this.y0;
var Rh=Math.sqrt(p.x*p.x+p.y*p.y);
var temp=Rh/(2*this.a);
if(temp>1){Proj4js.reportError("laea:Inv:DataError");
return null
}var z=2*Proj4js.common.asinz(temp);
var sin_z=Math.sin(z);
var cos_z=Math.cos(z);
var lon=this.long0;
if(Math.abs(Rh)>Proj4js.common.EPSLN){var lat=Proj4js.common.asinz(this.sin_lat_o*cos_z+this.cos_lat_o*sin_z*p.y/Rh);
var temp=Math.abs(this.lat0)-Proj4js.common.HALF_PI;
if(Math.abs(temp)>Proj4js.common.EPSLN){temp=cos_z-this.sin_lat_o*Math.sin(lat);
if(temp!=0){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x*sin_z*this.cos_lat_o,temp*Rh))
}}else{if(this.lat0<0){lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y))
}else{lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y))
}}}else{lat=this.lat0
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);
this.cos_p12=Math.cos(this.lat0)
},forward:function(p){var lon=p.x;
var lat=p.y;
var ksp;
var sinphi=Math.sin(p.y);
var cosphi=Math.cos(p.y);
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var coslon=Math.cos(dlon);
var g=this.sin_p12*sinphi+this.cos_p12*cosphi*coslon;
if(Math.abs(Math.abs(g)-1)<Proj4js.common.EPSLN){ksp=1;
if(g<0){Proj4js.reportError("aeqd:Fwd:PointError");
return
}}else{var z=Math.acos(g);
ksp=z/Math.sin(z)
}p.x=this.x0+this.a*ksp*cosphi*Math.sin(dlon);
p.y=this.y0+this.a*ksp*(this.cos_p12*sinphi-this.sin_p12*cosphi*coslon);
return p
},inverse:function(p){p.x-=this.x0;
p.y-=this.y0;
var rh=Math.sqrt(p.x*p.x+p.y*p.y);
if(rh>(2*Proj4js.common.HALF_PI*this.a)){Proj4js.reportError("aeqdInvDataError");
return
}var z=rh/this.a;
var sinz=Math.sin(z);
var cosz=Math.cos(z);
var lon=this.long0;
var lat;
if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.lat0
}else{lat=Proj4js.common.asinz(cosz*this.sin_p12+(p.y*sinz*this.cos_p12)/rh);
var con=Math.abs(this.lat0)-Proj4js.common.HALF_PI;
if(Math.abs(con)<=Proj4js.common.EPSLN){if(lat0>=0){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y))
}else{lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y))
}}else{con=cosz-this.sin_p12*Math.sin(lat);
if((Math.abs(con)<Proj4js.common.EPSLN)&&(Math.abs(p.x)<Proj4js.common.EPSLN)){}else{var temp=Math.atan2((p.x*sinz*this.cos_p12),(con*rh));
lon=Proj4js.common.adjust_lon(this.long0+Math.atan2((p.x*sinz*this.cos_p12),(con*rh)))
}}}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.moll={init:function(){},forward:function(p){var lon=p.x;
var lat=p.y;
var delta_lon=Proj4js.common.adjust_lon(lon-this.long0);
var theta=lat;
var con=Proj4js.common.PI*Math.sin(lat);
for(var i=0;
;
i++){var delta_theta=-(theta+Math.sin(theta)-con)/(1+Math.cos(theta));
theta+=delta_theta;
if(Math.abs(delta_theta)<Proj4js.common.EPSLN){break
}if(i>=50){Proj4js.reportError("moll:Fwd:IterationError")
}}theta/=2;
if(Proj4js.common.PI/2-Math.abs(lat)<Proj4js.common.EPSLN){delta_lon=0
}var x=0.900316316158*this.a*delta_lon*Math.cos(theta)+this.x0;
var y=1.4142135623731*this.a*Math.sin(theta)+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){var theta;
var arg;
p.x-=this.x0;
var arg=p.y/(1.4142135623731*this.a);
if(Math.abs(arg)>0.999999999999){arg=0.999999999999
}var theta=Math.asin(arg);
var lon=Proj4js.common.adjust_lon(this.long0+(p.x/(0.900316316158*this.a*Math.cos(theta))));
if(lon<(-Proj4js.common.PI)){lon=-Proj4js.common.PI
}if(lon>Proj4js.common.PI){lon=Proj4js.common.PI
}arg=(2*theta+Math.sin(2*theta))/Proj4js.common.PI;
if(Math.abs(arg)>1){arg=1
}var lat=Math.asin(arg);
p.x=lon;
p.y=lat;
return p
}};var OpenLayers={singleFile:true};(function(){var singleFile=(typeof OpenLayers=="object"&&OpenLayers.singleFile);
var scriptLocation;
window.OpenLayers={_scriptName:(!singleFile)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){if(scriptLocation!=undefined){return scriptLocation
}scriptLocation="";
var isOL=new RegExp("(^|(.*?\\/))("+OpenLayers._scriptName+")(\\?|$)");
var scripts=document.getElementsByTagName("script");
for(var i=0,len=scripts.length;
i<len;
i++){var src=scripts[i].getAttribute("src");
if(src){var match=src.match(isOL);
if(match){scriptLocation=match[1];
break
}}}return scriptLocation
}};
if(!singleFile){var jsfiles=new Array("OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Class.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Events.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/Image/IFrame.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/Google/v3.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/WMS/Post.js","OpenLayers/Layer/WMTS.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Layer/Zoomify.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Control/WMTSGetFeatureInfo.js","OpenLayers/Control/Graticule.js","OpenLayers/Control/TransformFeature.js","OpenLayers/Control/SLDSelect.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Filter.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Strategy/Refresh.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Protocol/SOS.js","OpenLayers/Protocol/SOS/v1_0_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/Style2.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Format.js","OpenLayers/Format/XML.js","OpenLayers/Format/Context.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/Atom.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/CSWGetDomain.js","OpenLayers/Format/CSWGetDomain/v2_0_2.js","OpenLayers/Format/CSWGetRecords.js","OpenLayers/Format/CSWGetRecords/v2_0_2.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSCapabilities/v1_3.js","OpenLayers/Format/WMSCapabilities/v1_3_0.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Format/SOSCapabilities.js","OpenLayers/Format/SOSCapabilities/v1_0_0.js","OpenLayers/Format/SOSGetObservation.js","OpenLayers/Format/SOSGetFeatureOfInterest.js","OpenLayers/Format/OWSContext.js","OpenLayers/Format/OWSContext/v0_3_1.js","OpenLayers/Format/WMTSCapabilities.js","OpenLayers/Format/WMTSCapabilities/v1_0_0.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Symbolizer.js","OpenLayers/Symbolizer/Point.js","OpenLayers/Symbolizer/Line.js","OpenLayers/Symbolizer/Polygon.js","OpenLayers/Symbolizer/Text.js","OpenLayers/Symbolizer/Raster.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js","OpenLayers/Lang/fr.js");
var agent=navigator.userAgent;
var docWrite=(agent.match("MSIE")||agent.match("Safari"));
if(docWrite){var allScriptTags=new Array(jsfiles.length)
}var host=OpenLayers._getScriptLocation()+"lib/";
for(var i=0,len=jsfiles.length;
i<len;
i++){if(docWrite){allScriptTags[i]="<script src='"+host+jsfiles[i]+"'><\/script>"
}else{var s=document.createElement("script");
s.src=host+jsfiles[i];
var h=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;
h.appendChild(s)
}}if(docWrite){document.write(allScriptTags.join(""))
}}})();
OpenLayers.VERSION_NUMBER="OpenLayers 2.10 -- $Revision: 10721 $";OpenLayers.Util={};
OpenLayers.Util.getElement=function(){var elements=[];
for(var i=0,len=arguments.length;
i<len;
i++){var element=arguments[i];
if(typeof element=="string"){element=document.getElementById(element)
}if(arguments.length==1){return element
}elements.push(element)
}return elements
};
OpenLayers.Util.isElement=function(o){return !!(o&&o.nodeType===1)
};
if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement
}OpenLayers.Util.extend=function(destination,source){destination=destination||{};
if(source){for(var property in source){var value=source[property];
if(value!==undefined){destination[property]=value
}}var sourceIsEvt=typeof window.Event=="function"&&source instanceof window.Event;
if(!sourceIsEvt&&source.hasOwnProperty&&source.hasOwnProperty("toString")){destination.toString=source.toString
}}return destination
};
OpenLayers.Util.removeItem=function(array,item){for(var i=array.length-1;
i>=0;
i--){if(array[i]==item){array.splice(i,1)
}}return array
};
OpenLayers.Util.clearArray=function(array){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));
array.length=0
};
OpenLayers.Util.indexOf=function(array,obj){if(typeof array.indexOf=="function"){return array.indexOf(obj)
}else{for(var i=0,len=array.length;
i<len;
i++){if(array[i]==obj){return i
}}return -1
}};
OpenLayers.Util.modifyDOMElement=function(element,id,px,sz,position,border,overflow,opacity){if(id){element.id=id
}if(px){element.style.left=px.x+"px";
element.style.top=px.y+"px"
}if(sz){element.style.width=sz.w+"px";
element.style.height=sz.h+"px"
}if(position){element.style.position=position
}if(border){element.style.border=border
}if(overflow){element.style.overflow=overflow
}if(parseFloat(opacity)>=0&&parseFloat(opacity)<1){element.style.filter="alpha(opacity="+(opacity*100)+")";
element.style.opacity=opacity
}else{if(parseFloat(opacity)==1){element.style.filter="";
element.style.opacity=""
}}};
OpenLayers.Util.createDiv=function(id,px,sz,imgURL,position,border,overflow,opacity){var dom=document.createElement("div");
if(imgURL){dom.style.backgroundImage="url("+imgURL+")"
}if(!id){id=OpenLayers.Util.createUniqueID("OpenLayersDiv")
}if(!position){position="absolute"
}OpenLayers.Util.modifyDOMElement(dom,id,px,sz,position,border,overflow,opacity);
return dom
};
OpenLayers.Util.createImage=function(id,px,sz,imgURL,position,border,opacity,delayDisplay){var image=document.createElement("img");
if(!id){id=OpenLayers.Util.createUniqueID("OpenLayersDiv")
}if(!position){position="relative"
}OpenLayers.Util.modifyDOMElement(image,id,px,sz,position,border,null,opacity);
if(delayDisplay){image.style.display="none";
OpenLayers.Event.observe(image,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,image));
OpenLayers.Event.observe(image,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,image))
}image.style.alt=id;
image.galleryImg="no";
if(imgURL){image.src=imgURL
}return image
};
OpenLayers.Util.setOpacity=function(element,opacity){OpenLayers.Util.modifyDOMElement(element,null,null,null,null,null,null,opacity)
};
OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.display=""
}OpenLayers.Element.removeClass(this,"olImageLoadError")
};
OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;
OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;
if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var urls=this.urls;
if(urls&&urls instanceof Array&&urls.length>1){var src=this.src.toString();
var current_url,k;
for(k=0;
current_url=urls[k];
k++){if(src.indexOf(current_url)!=-1){break
}}var guess=Math.floor(urls.length*Math.random());
var new_url=urls[guess];
k=0;
while(new_url==current_url&&k++<4){guess=Math.floor(urls.length*Math.random());
new_url=urls[guess]
}this.src=src.replace(current_url,new_url)
}else{this.src=this.src
}}else{OpenLayers.Element.addClass(this,"olImageLoadError")
}this.style.display=""
};
OpenLayers.Util.alphaHackNeeded=null;
OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var arVersion=navigator.appVersion.split("MSIE");
var version=parseFloat(arVersion[1]);
var filter=false;
try{filter=!!(document.body.filters)
}catch(e){}OpenLayers.Util.alphaHackNeeded=(filter&&(version>=5.5)&&(version<7))
}return OpenLayers.Util.alphaHackNeeded
};
OpenLayers.Util.modifyAlphaImageDiv=function(div,id,px,sz,imgURL,position,border,sizing,opacity){OpenLayers.Util.modifyDOMElement(div,id,px,sz,position,null,null,opacity);
var img=div.childNodes[0];
if(imgURL){img.src=imgURL
}OpenLayers.Util.modifyDOMElement(img,div.id+"_innerImage",null,sz,"relative",border);
if(OpenLayers.Util.alphaHack()){if(div.style.display!="none"){div.style.display="inline-block"
}if(sizing==null){sizing="scale"
}div.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='"+sizing+"')";
if(parseFloat(div.style.opacity)>=0&&parseFloat(div.style.opacity)<1){div.style.filter+=" alpha(opacity="+div.style.opacity*100+")"
}img.style.filter="alpha(opacity=0)"
}};
OpenLayers.Util.createAlphaImageDiv=function(id,px,sz,imgURL,position,border,sizing,opacity,delayDisplay){var div=OpenLayers.Util.createDiv();
var img=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);
div.appendChild(img);
if(delayDisplay){img.style.display="none";
OpenLayers.Event.observe(img,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,div));
OpenLayers.Event.observe(img,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,div))
}OpenLayers.Util.modifyAlphaImageDiv(div,id,px,sz,imgURL,position,border,sizing,opacity);
return div
};
OpenLayers.Util.upperCaseObject=function(object){var uObject={};
for(var key in object){uObject[key.toUpperCase()]=object[key]
}return uObject
};
OpenLayers.Util.applyDefaults=function(to,from){to=to||{};
var fromIsEvt=typeof window.Event=="function"&&from instanceof window.Event;
for(var key in from){if(to[key]===undefined||(!fromIsEvt&&from.hasOwnProperty&&from.hasOwnProperty(key)&&!to.hasOwnProperty(key))){to[key]=from[key]
}}if(!fromIsEvt&&from&&from.hasOwnProperty&&from.hasOwnProperty("toString")&&!to.hasOwnProperty("toString")){to.toString=from.toString
}return to
};
OpenLayers.Util.getParameterString=function(params){var paramsArray=[];
for(var key in params){var value=params[key];
if((value!=null)&&(typeof value!="function")){var encodedValue;
if(typeof value=="object"&&value.constructor==Array){var encodedItemArray=[];
var item;
for(var itemIndex=0,len=value.length;
itemIndex<len;
itemIndex++){item=value[itemIndex];
encodedItemArray.push(encodeURIComponent((item===null||item===undefined)?"":item))
}encodedValue=encodedItemArray.join(",")
}else{encodedValue=encodeURIComponent(value)
}paramsArray.push(encodeURIComponent(key)+"="+encodedValue)
}}return paramsArray.join("&")
};
OpenLayers.Util.urlAppend=function(url,paramStr){var newUrl=url;
if(paramStr){var parts=(url+" ").split(/[?&]/);
newUrl+=(parts.pop()===" "?paramStr:parts.length?"&"+paramStr:"?"+paramStr)
}return newUrl
};
OpenLayers.ImgPath="";
OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/")
};
OpenLayers.Util.Try=function(){var returnValue=null;
for(var i=0,len=arguments.length;
i<len;
i++){var lambda=arguments[i];
try{returnValue=lambda();
break
}catch(e){}}return returnValue
};
OpenLayers.Util.getNodes=function(p,tagName){var nodes=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(p.documentElement.childNodes,tagName)
},function(){return OpenLayers.Util._getNodes(p.childNodes,tagName)
});
return nodes
};
OpenLayers.Util._getNodes=function(nodes,tagName){var retArray=[];
for(var i=0,len=nodes.length;
i<len;
i++){if(nodes[i].nodeName==tagName){retArray.push(nodes[i])
}}return retArray
};
OpenLayers.Util.getTagText=function(parent,item,index){var result=OpenLayers.Util.getNodes(parent,item);
if(result&&(result.length>0)){if(!index){index=0
}if(result[index].childNodes.length>1){return result.childNodes[1].nodeValue
}else{if(result[index].childNodes.length==1){return result[index].firstChild.nodeValue
}}}else{return""
}};
OpenLayers.Util.getXmlNodeValue=function(node){var val=null;
OpenLayers.Util.Try(function(){val=node.text;
if(!val){val=node.textContent
}if(!val){val=node.firstChild.nodeValue
}},function(){val=node.textContent
});
return val
};
OpenLayers.Util.mouseLeft=function(evt,div){var target=(evt.relatedTarget)?evt.relatedTarget:evt.toElement;
while(target!=div&&target!=null){target=target.parentNode
}return(target!=div)
};
OpenLayers.Util.DEFAULT_PRECISION=14;
OpenLayers.Util.toFloat=function(number,precision){if(precision==null){precision=OpenLayers.Util.DEFAULT_PRECISION
}var number;
if(precision==0){number=parseFloat(number)
}else{number=parseFloat(parseFloat(number).toPrecision(precision))
}return number
};
OpenLayers.Util.rad=function(x){return x*Math.PI/180
};
OpenLayers.Util.deg=function(x){return x*180/Math.PI
};
OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};
OpenLayers.Util.distVincenty=function(p1,p2){var ct=OpenLayers.Util.VincentyConstants;
var a=ct.a,b=ct.b,f=ct.f;
var L=OpenLayers.Util.rad(p2.lon-p1.lon);
var U1=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p1.lat)));
var U2=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p2.lat)));
var sinU1=Math.sin(U1),cosU1=Math.cos(U1);
var sinU2=Math.sin(U2),cosU2=Math.cos(U2);
var lambda=L,lambdaP=2*Math.PI;
var iterLimit=20;
while(Math.abs(lambda-lambdaP)>1e-12&&--iterLimit>0){var sinLambda=Math.sin(lambda),cosLambda=Math.cos(lambda);
var sinSigma=Math.sqrt((cosU2*sinLambda)*(cosU2*sinLambda)+(cosU1*sinU2-sinU1*cosU2*cosLambda)*(cosU1*sinU2-sinU1*cosU2*cosLambda));
if(sinSigma==0){return 0
}var cosSigma=sinU1*sinU2+cosU1*cosU2*cosLambda;
var sigma=Math.atan2(sinSigma,cosSigma);
var alpha=Math.asin(cosU1*cosU2*sinLambda/sinSigma);
var cosSqAlpha=Math.cos(alpha)*Math.cos(alpha);
var cos2SigmaM=cosSigma-2*sinU1*sinU2/cosSqAlpha;
var C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha));
lambdaP=lambda;
lambda=L+(1-C)*f*Math.sin(alpha)*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)))
}if(iterLimit==0){return NaN
}var uSq=cosSqAlpha*(a*a-b*b)/(b*b);
var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));
var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));
var deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM)));
var s=b*A*(sigma-deltaSigma);
var d=s.toFixed(3)/1000;
return d
};
OpenLayers.Util.destinationVincenty=function(lonlat,brng,dist){var u=OpenLayers.Util;
var ct=u.VincentyConstants;
var a=ct.a,b=ct.b,f=ct.f;
var lon1=lonlat.lon;
var lat1=lonlat.lat;
var s=dist;
var alpha1=u.rad(brng);
var sinAlpha1=Math.sin(alpha1);
var cosAlpha1=Math.cos(alpha1);
var tanU1=(1-f)*Math.tan(u.rad(lat1));
var cosU1=1/Math.sqrt((1+tanU1*tanU1)),sinU1=tanU1*cosU1;
var sigma1=Math.atan2(tanU1,cosAlpha1);
var sinAlpha=cosU1*sinAlpha1;
var cosSqAlpha=1-sinAlpha*sinAlpha;
var uSq=cosSqAlpha*(a*a-b*b)/(b*b);
var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));
var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));
var sigma=s/(b*A),sigmaP=2*Math.PI;
while(Math.abs(sigma-sigmaP)>1e-12){var cos2SigmaM=Math.cos(2*sigma1+sigma);
var sinSigma=Math.sin(sigma);
var cosSigma=Math.cos(sigma);
var deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM)));
sigmaP=sigma;
sigma=s/(b*A)+deltaSigma
}var tmp=sinU1*sinSigma-cosU1*cosSigma*cosAlpha1;
var lat2=Math.atan2(sinU1*cosSigma+cosU1*sinSigma*cosAlpha1,(1-f)*Math.sqrt(sinAlpha*sinAlpha+tmp*tmp));
var lambda=Math.atan2(sinSigma*sinAlpha1,cosU1*cosSigma-sinU1*sinSigma*cosAlpha1);
var C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha));
var L=lambda-(1-C)*f*sinAlpha*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)));
var revAz=Math.atan2(sinAlpha,-tmp);
return new OpenLayers.LonLat(lon1+u.deg(L),u.deg(lat2))
};
OpenLayers.Util.getParameters=function(url){url=url||window.location.href;
var paramsString="";
if(OpenLayers.String.contains(url,"?")){var start=url.indexOf("?")+1;
var end=OpenLayers.String.contains(url,"#")?url.indexOf("#"):url.length;
paramsString=url.substring(start,end)
}var parameters={};
var pairs=paramsString.split(/[&;]/);
for(var i=0,len=pairs.length;
i<len;
++i){var keyValue=pairs[i].split("=");
if(keyValue[0]){var key=decodeURIComponent(keyValue[0]);
var value=keyValue[1]||"";
value=decodeURIComponent(value.replace(/\+/g," ")).split(",");
if(value.length==1){value=value[0]
}parameters[key]=value
}}return parameters
};
OpenLayers.Util.getArgs=function(url){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));
return OpenLayers.Util.getParameters(url)
};
OpenLayers.Util.lastSeqID=0;
OpenLayers.Util.createUniqueID=function(prefix){if(prefix==null){prefix="id_"
}OpenLayers.Util.lastSeqID+=1;
return prefix+OpenLayers.Util.lastSeqID
};
OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};
OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;
OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;
OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;
OpenLayers.METERS_PER_INCH=0.0254000508001016;
OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});
OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});
OpenLayers.DOTS_PER_INCH=72;
OpenLayers.Util.normalizeScale=function(scale){var normScale=(scale>1)?(1/scale):scale;
return normScale
};
OpenLayers.Util.getResolutionFromScale=function(scale,units){var resolution;
if(scale){if(units==null){units="degrees"
}var normScale=OpenLayers.Util.normalizeScale(scale);
resolution=1/(normScale*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH)
}return resolution
};
OpenLayers.Util.getScaleFromResolution=function(resolution,units){if(units==null){units="degrees"
}var scale=resolution*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH;
return scale
};
OpenLayers.Util.safeStopPropagation=function(evt){OpenLayers.Event.stop(evt,true)
};
OpenLayers.Util.pagePosition=function(forElement){var valueT=0,valueL=0;
var element=forElement;
var child=forElement;
while(element){if(element==document.body){if(OpenLayers.Element.getStyle(child,"position")=="absolute"){break
}}valueT+=element.offsetTop||0;
valueL+=element.offsetLeft||0;
child=element;
try{element=element.offsetParent
}catch(e){OpenLayers.Console.error(OpenLayers.i18n("pagePositionFailed",{elemId:element.id}));
break
}}element=forElement;
while(element){valueT-=element.scrollTop||0;
valueL-=element.scrollLeft||0;
element=element.parentNode
}return[valueL,valueT]
};
OpenLayers.Util.isEquivalentUrl=function(url1,url2,options){options=options||{};
OpenLayers.Util.applyDefaults(options,{ignoreCase:true,ignorePort80:true,ignoreHash:true});
var urlObj1=OpenLayers.Util.createUrlObject(url1,options);
var urlObj2=OpenLayers.Util.createUrlObject(url2,options);
for(var key in urlObj1){if(key!=="args"){if(urlObj1[key]!=urlObj2[key]){return false
}}}for(var key in urlObj1.args){if(urlObj1.args[key]!=urlObj2.args[key]){return false
}delete urlObj2.args[key]
}for(var key in urlObj2.args){return false
}return true
};
OpenLayers.Util.createUrlObject=function(url,options){options=options||{};
if(!(/^\w+:\/\//).test(url)){var loc=window.location;
var port=loc.port?":"+loc.port:"";
var fullUrl=loc.protocol+"//"+loc.host.split(":").shift()+port;
if(url.indexOf("/")===0){url=fullUrl+url
}else{var parts=loc.pathname.split("/");
parts.pop();
url=fullUrl+parts.join("/")+"/"+url
}}if(options.ignoreCase){url=url.toLowerCase()
}var a=document.createElement("a");
a.href=url;
var urlObject={};
urlObject.host=a.host.split(":").shift();
urlObject.protocol=a.protocol;
if(options.ignorePort80){urlObject.port=(a.port=="80"||a.port=="0")?"":a.port
}else{urlObject.port=(a.port==""||a.port=="0")?"80":a.port
}urlObject.hash=(options.ignoreHash||a.hash==="#")?"":a.hash;
var queryString=a.search;
if(!queryString){var qMark=url.indexOf("?");
queryString=(qMark!=-1)?url.substr(qMark):""
}urlObject.args=OpenLayers.Util.getParameters(queryString);
urlObject.pathname=(a.pathname.charAt(0)=="/")?a.pathname:"/"+a.pathname;
return urlObject
};
OpenLayers.Util.removeTail=function(url){var head=null;
var qMark=url.indexOf("?");
var hashMark=url.indexOf("#");
if(qMark==-1){head=(hashMark!=-1)?url.substr(0,hashMark):url
}else{head=(hashMark!=-1)?url.substr(0,Math.min(qMark,hashMark)):url.substr(0,qMark)
}return head
};
OpenLayers.Util.getBrowserName=function(){var browserName="";
var ua=navigator.userAgent.toLowerCase();
if(ua.indexOf("opera")!=-1){browserName="opera"
}else{if(ua.indexOf("msie")!=-1){browserName="msie"
}else{if(ua.indexOf("safari")!=-1){browserName="safari"
}else{if(ua.indexOf("mozilla")!=-1){if(ua.indexOf("firefox")!=-1){browserName="firefox"
}else{browserName="mozilla"
}}}}}return browserName
};
OpenLayers.Util.getRenderedDimensions=function(contentHTML,size,options){var w,h;
var container=document.createElement("div");
container.style.visibility="hidden";
var containerElement=(options&&options.containerElement)?options.containerElement:document.body;
if(size){if(size.w){w=size.w;
container.style.width=w+"px"
}else{if(size.h){h=size.h;
container.style.height=h+"px"
}}}if(options&&options.displayClass){container.className=options.displayClass
}var content=document.createElement("div");
content.innerHTML=contentHTML;
content.style.overflow="visible";
if(content.childNodes){for(var i=0,l=content.childNodes.length;
i<l;
i++){if(!content.childNodes[i].style){continue
}content.childNodes[i].style.overflow="visible"
}}container.appendChild(content);
containerElement.appendChild(container);
var parentHasPositionAbsolute=false;
var parent=container.parentNode;
while(parent&&parent.tagName.toLowerCase()!="body"){var parentPosition=OpenLayers.Element.getStyle(parent,"position");
if(parentPosition=="absolute"){parentHasPositionAbsolute=true;
break
}else{if(parentPosition&&parentPosition!="static"){break
}}parent=parent.parentNode
}if(!parentHasPositionAbsolute){container.style.position="absolute"
}if(!w){w=parseInt(content.scrollWidth);
container.style.width=w+"px"
}if(!h){h=parseInt(content.scrollHeight)
}container.removeChild(content);
containerElement.removeChild(container);
return new OpenLayers.Size(w,h)
};
OpenLayers.Util.getScrollbarWidth=function(){var scrollbarWidth=OpenLayers.Util._scrollbarWidth;
if(scrollbarWidth==null){var scr=null;
var inn=null;
var wNoScroll=0;
var wScroll=0;
scr=document.createElement("div");
scr.style.position="absolute";
scr.style.top="-1000px";
scr.style.left="-1000px";
scr.style.width="100px";
scr.style.height="50px";
scr.style.overflow="hidden";
inn=document.createElement("div");
inn.style.width="100%";
inn.style.height="200px";
scr.appendChild(inn);
document.body.appendChild(scr);
wNoScroll=inn.offsetWidth;
scr.style.overflow="scroll";
wScroll=inn.offsetWidth;
document.body.removeChild(document.body.lastChild);
OpenLayers.Util._scrollbarWidth=(wNoScroll-wScroll);
scrollbarWidth=OpenLayers.Util._scrollbarWidth
}return scrollbarWidth
};
OpenLayers.Util.getFormattedLonLat=function(coordinate,axis,dmsOption){if(!dmsOption){dmsOption="dms"
}var abscoordinate=Math.abs(coordinate);
var coordinatedegrees=Math.floor(abscoordinate);
var coordinateminutes=(abscoordinate-coordinatedegrees)/(1/60);
var tempcoordinateminutes=coordinateminutes;
coordinateminutes=Math.floor(coordinateminutes);
var coordinateseconds=(tempcoordinateminutes-coordinateminutes)/(1/60);
coordinateseconds=Math.round(coordinateseconds*10);
coordinateseconds/=10;
if(coordinatedegrees<10){coordinatedegrees="0"+coordinatedegrees
}var str=coordinatedegrees+"\u00B0";
if(dmsOption.indexOf("dm")>=0){if(coordinateminutes<10){coordinateminutes="0"+coordinateminutes
}str+=coordinateminutes+"'";
if(dmsOption.indexOf("dms")>=0){if(coordinateseconds<10){coordinateseconds="0"+coordinateseconds
}str+=coordinateseconds+'"'
}}if(axis=="lon"){str+=coordinate<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")
}else{str+=coordinate<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")
}return str
};OpenLayers.String={startsWith:function(str,sub){return(str.indexOf(sub)==0)
},contains:function(str,sub){return(str.indexOf(sub)!=-1)
},trim:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")
},camelize:function(str){var oStringList=str.split("-");
var camelizedString=oStringList[0];
for(var i=1,len=oStringList.length;
i<len;
i++){var s=oStringList[i];
camelizedString+=s.charAt(0).toUpperCase()+s.substring(1)
}return camelizedString
},format:function(template,context,args){if(!context){context=window
}var replacer=function(str,match){var replacement;
var subs=match.split(/\.+/);
for(var i=0;
i<subs.length;
i++){if(i==0){replacement=context
}replacement=replacement[subs[i]]
}if(typeof replacement=="function"){replacement=args?replacement.apply(null,args):replacement()
}if(typeof replacement=="undefined"){return"undefined"
}else{return replacement
}};
return template.replace(OpenLayers.String.tokenRegEx,replacer)
},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(value){return OpenLayers.String.numberRegEx.test(value)
},numericIf:function(value){return OpenLayers.String.isNumeric(value)?parseFloat(value):value
}};
if(!String.prototype.startsWith){String.prototype.startsWith=function(sStart){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));
return OpenLayers.String.startsWith(this,sStart)
}
}if(!String.prototype.contains){String.prototype.contains=function(str){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));
return OpenLayers.String.contains(this,str)
}
}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));
return OpenLayers.String.trim(this)
}
}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));
return OpenLayers.String.camelize(this)
}
}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(num,sig){var fig=0;
if(sig>0){fig=parseFloat(num.toPrecision(sig))
}return fig
},format:function(num,dec,tsep,dsep){dec=(typeof dec!="undefined")?dec:0;
tsep=(typeof tsep!="undefined")?tsep:OpenLayers.Number.thousandsSeparator;
dsep=(typeof dsep!="undefined")?dsep:OpenLayers.Number.decimalSeparator;
if(dec!=null){num=parseFloat(num.toFixed(dec))
}var parts=num.toString().split(".");
if(parts.length==1&&dec==null){dec=0
}var integer=parts[0];
if(tsep){var thousands=/(-?[0-9]+)([0-9]{3})/;
while(thousands.test(integer)){integer=integer.replace(thousands,"$1"+tsep+"$2")
}}var str;
if(dec==0){str=integer
}else{var rem=parts.length>1?parts[1]:"0";
if(dec!=null){rem=rem+new Array(dec-rem.length+1).join("0")
}str=integer+dsep+rem
}return str
}};
if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(sig){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));
return OpenLayers.Number.limitSigDigs(this,sig)
}
}OpenLayers.Function={bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);
return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));
return func.apply(object,newArgs)
}
},bindAsEventListener:function(func,object){return function(event){return func.call(object,event||window.event)
}
},False:function(){return false
},True:function(){return true
}};
if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));
Array.prototype.unshift.apply(arguments,[this]);
return OpenLayers.Function.bind.apply(null,arguments)
}
}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(object){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));
return OpenLayers.Function.bindAsEventListener(this,object)
}
}OpenLayers.Array={filter:function(array,callback,caller){var selected=[];
if(Array.prototype.filter){selected=array.filter(callback,caller)
}else{var len=array.length;
if(typeof callback!="function"){throw new TypeError()
}for(var i=0;
i<len;
i++){if(i in array){var val=array[i];
if(callback.call(caller,val,i,array)){selected.push(val)
}}}}return selected
}};
OpenLayers.Date={toISOString:(function(){if("toISOString" in Date.prototype){return function(date){return date.toISOString()
}
}else{function pad(num,len){var str=num+"";
while(str.length<len){str="0"+str
}return str
}return function(date){var str;
if(isNaN(date.getTime())){str="Invalid Date"
}else{str=date.getUTCFullYear()+"-"+pad(date.getUTCMonth()+1,2)+"-"+pad(date.getUTCDate(),2)+"T"+pad(date.getUTCHours(),2)+":"+pad(date.getUTCMinutes(),2)+":"+pad(date.getUTCSeconds(),2)+"."+pad(date.getUTCMilliseconds(),3)+"Z"
}return str
}
}})(),parse:function(str){var date;
var elapsed=Date.parse(str);
if(!isNaN(elapsed)){date=new Date(elapsed)
}else{var match=str.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))?$/);
var date;
if(match&&(match[1]||match[7])){var year=parseInt(match[1],10)||0;
var month=(parseInt(match[2],10)-1)||0;
var day=parseInt(match[3],10)||1;
date=new Date(Date.UTC(year,month,day));
var type=match[7];
if(type){var hours=parseInt(match[4],10);
var minutes=parseInt(match[5],10);
var secFrac=parseFloat(match[6]);
var seconds=secFrac|0;
var milliseconds=Math.round(1000*(secFrac-seconds));
date.setUTCHours(hours,minutes,seconds,milliseconds);
if(type!=="Z"){var hoursOffset=parseInt(type,10);
var minutesOffset=parseInt(match[8])||0;
var offset=-1000*(60*(hoursOffset*60)+minutesOffset*60);
date=new Date(date.getTime()+offset)
}}}else{date=new Date("invalid")
}}return date
}};OpenLayers.Class=function(){var Class=function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)
}};
var extended={};
var parent,initialize,Type;
for(var i=0,len=arguments.length;
i<len;
++i){Type=arguments[i];
if(typeof Type=="function"){if(i==0&&len>1){initialize=Type.prototype.initialize;
Type.prototype.initialize=function(){};
extended=new Type();
if(initialize===undefined){delete Type.prototype.initialize
}else{Type.prototype.initialize=initialize
}}parent=Type.prototype
}else{parent=Type
}OpenLayers.Util.extend(extended,parent)
}Class.prototype=extended;
return Class
};
OpenLayers.Class.isPrototype=function(){};
OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)
}}
};
OpenLayers.Class.inherit=function(){var superClass=arguments[0];
var proto=new superClass(OpenLayers.Class.isPrototype);
for(var i=1,len=arguments.length;
i<len;
i++){if(typeof arguments[i]=="function"){var mixin=arguments[i];
arguments[i]=new mixin(OpenLayers.Class.isPrototype)
}OpenLayers.Util.extend(proto,arguments[i])
}return proto
};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(left,bottom,right,top){if(left!=null){this.left=OpenLayers.Util.toFloat(left)
}if(bottom!=null){this.bottom=OpenLayers.Util.toFloat(bottom)
}if(right!=null){this.right=OpenLayers.Util.toFloat(right)
}if(top!=null){this.top=OpenLayers.Util.toFloat(top)
}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)
},equals:function(bounds){var equals=false;
if(bounds!=null){equals=((this.left==bounds.left)&&(this.right==bounds.right)&&(this.top==bounds.top)&&(this.bottom==bounds.bottom))
}return equals
},toString:function(){return("left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+")")
},toArray:function(reverseAxisOrder){if(reverseAxisOrder===true){return[this.bottom,this.left,this.top,this.right]
}else{return[this.left,this.bottom,this.right,this.top]
}},toBBOX:function(decimal,reverseAxisOrder){if(decimal==null){decimal=6
}var mult=Math.pow(10,decimal);
var xmin=Math.round(this.left*mult)/mult;
var ymin=Math.round(this.bottom*mult)/mult;
var xmax=Math.round(this.right*mult)/mult;
var ymax=Math.round(this.top*mult)/mult;
if(reverseAxisOrder===true){return ymin+","+xmin+","+ymax+","+xmax
}else{return xmin+","+ymin+","+xmax+","+ymax
}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])
},getWidth:function(){return(this.right-this.left)
},getHeight:function(){return(this.top-this.bottom)
},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())
},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)
},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)
}return this.centerLonLat
},scale:function(ratio,origin){if(origin==null){origin=this.getCenterLonLat()
}var origx,origy;
if(origin.CLASS_NAME=="OpenLayers.LonLat"){origx=origin.lon;
origy=origin.lat
}else{origx=origin.x;
origy=origin.y
}var left=(this.left-origx)*ratio+origx;
var bottom=(this.bottom-origy)*ratio+origy;
var right=(this.right-origx)*ratio+origx;
var top=(this.top-origy)*ratio+origy;
return new OpenLayers.Bounds(left,bottom,right,top)
},add:function(x,y){if((x==null)||(y==null)){var msg=OpenLayers.i18n("boundsAddError");
OpenLayers.Console.error(msg);
return null
}return new OpenLayers.Bounds(this.left+x,this.bottom+y,this.right+x,this.top+y)
},extend:function(object){var bounds=null;
if(object){switch(object.CLASS_NAME){case"OpenLayers.LonLat":bounds=new OpenLayers.Bounds(object.lon,object.lat,object.lon,object.lat);
break;
case"OpenLayers.Geometry.Point":bounds=new OpenLayers.Bounds(object.x,object.y,object.x,object.y);
break;
case"OpenLayers.Bounds":bounds=object;
break
}if(bounds){this.centerLonLat=null;
if((this.left==null)||(bounds.left<this.left)){this.left=bounds.left
}if((this.bottom==null)||(bounds.bottom<this.bottom)){this.bottom=bounds.bottom
}if((this.right==null)||(bounds.right>this.right)){this.right=bounds.right
}if((this.top==null)||(bounds.top>this.top)){this.top=bounds.top
}}}},containsLonLat:function(ll,inclusive){return this.contains(ll.lon,ll.lat,inclusive)
},containsPixel:function(px,inclusive){return this.contains(px.x,px.y,inclusive)
},contains:function(x,y,inclusive){if(inclusive==null){inclusive=true
}if(x==null||y==null){return false
}x=OpenLayers.Util.toFloat(x);
y=OpenLayers.Util.toFloat(y);
var contains=false;
if(inclusive){contains=((x>=this.left)&&(x<=this.right)&&(y>=this.bottom)&&(y<=this.top))
}else{contains=((x>this.left)&&(x<this.right)&&(y>this.bottom)&&(y<this.top))
}return contains
},intersectsBounds:function(bounds,inclusive){if(inclusive==null){inclusive=true
}var intersects=false;
var mightTouch=(this.left==bounds.right||this.right==bounds.left||this.top==bounds.bottom||this.bottom==bounds.top);
if(inclusive||!mightTouch){var inBottom=(((bounds.bottom>=this.bottom)&&(bounds.bottom<=this.top))||((this.bottom>=bounds.bottom)&&(this.bottom<=bounds.top)));
var inTop=(((bounds.top>=this.bottom)&&(bounds.top<=this.top))||((this.top>bounds.bottom)&&(this.top<bounds.top)));
var inLeft=(((bounds.left>=this.left)&&(bounds.left<=this.right))||((this.left>=bounds.left)&&(this.left<=bounds.right)));
var inRight=(((bounds.right>=this.left)&&(bounds.right<=this.right))||((this.right>=bounds.left)&&(this.right<=bounds.right)));
intersects=((inBottom||inTop)&&(inLeft||inRight))
}return intersects
},containsBounds:function(bounds,partial,inclusive){if(partial==null){partial=false
}if(inclusive==null){inclusive=true
}var bottomLeft=this.contains(bounds.left,bounds.bottom,inclusive);
var bottomRight=this.contains(bounds.right,bounds.bottom,inclusive);
var topLeft=this.contains(bounds.left,bounds.top,inclusive);
var topRight=this.contains(bounds.right,bounds.top,inclusive);
return(partial)?(bottomLeft||bottomRight||topLeft||topRight):(bottomLeft&&bottomRight&&topLeft&&topRight)
},determineQuadrant:function(lonlat){var quadrant="";
var center=this.getCenterLonLat();
quadrant+=(lonlat.lat<center.lat)?"b":"t";
quadrant+=(lonlat.lon<center.lon)?"l":"r";
return quadrant
},transform:function(source,dest){this.centerLonLat=null;
var ll=OpenLayers.Projection.transform({x:this.left,y:this.bottom},source,dest);
var lr=OpenLayers.Projection.transform({x:this.right,y:this.bottom},source,dest);
var ul=OpenLayers.Projection.transform({x:this.left,y:this.top},source,dest);
var ur=OpenLayers.Projection.transform({x:this.right,y:this.top},source,dest);
this.left=Math.min(ll.x,ul.x);
this.bottom=Math.min(ll.y,lr.y);
this.right=Math.max(lr.x,ur.x);
this.top=Math.max(ul.y,ur.y);
return this
},wrapDateLine:function(maxExtent,options){options=options||{};
var leftTolerance=options.leftTolerance||0;
var rightTolerance=options.rightTolerance||0;
var newBounds=this.clone();
if(maxExtent){while(newBounds.left<maxExtent.left&&(newBounds.right-rightTolerance)<=maxExtent.left){newBounds=newBounds.add(maxExtent.getWidth(),0)
}while((newBounds.left+leftTolerance)>=maxExtent.right&&newBounds.right>maxExtent.right){newBounds=newBounds.add(-maxExtent.getWidth(),0)
}}return newBounds
},CLASS_NAME:"OpenLayers.Bounds"});
OpenLayers.Bounds.fromString=function(str){var bounds=str.split(",");
return OpenLayers.Bounds.fromArray(bounds)
};
OpenLayers.Bounds.fromArray=function(bbox){return new OpenLayers.Bounds(parseFloat(bbox[0]),parseFloat(bbox[1]),parseFloat(bbox[2]),parseFloat(bbox[3]))
};
OpenLayers.Bounds.fromSize=function(size){return new OpenLayers.Bounds(0,size.h,size.w,0)
};
OpenLayers.Bounds.oppositeQuadrant=function(quadrant){var opp="";
opp+=(quadrant.charAt(0)=="t")?"b":"t";
opp+=(quadrant.charAt(1)=="l")?"r":"l";
return opp
};OpenLayers.Rico=new Object();
OpenLayers.Rico.Corner={round:function(e,options){e=OpenLayers.Util.getElement(e);
this._setOptions(options);
var color=this.options.color;
if(this.options.color=="fromElement"){color=this._background(e)
}var bgColor=this.options.bgColor;
if(this.options.bgColor=="fromParent"){bgColor=this._background(e.offsetParent)
}this._roundCornersImpl(e,color,bgColor)
},changeColor:function(theDiv,newColor){theDiv.style.backgroundColor=newColor;
var spanElements=theDiv.parentNode.getElementsByTagName("span");
for(var currIdx=0;
currIdx<spanElements.length;
currIdx++){spanElements[currIdx].style.backgroundColor=newColor
}},changeOpacity:function(theDiv,newOpacity){var mozillaOpacity=newOpacity;
var ieOpacity="alpha(opacity="+newOpacity*100+")";
theDiv.style.opacity=mozillaOpacity;
theDiv.style.filter=ieOpacity;
var spanElements=theDiv.parentNode.getElementsByTagName("span");
for(var currIdx=0;
currIdx<spanElements.length;
currIdx++){spanElements[currIdx].style.opacity=mozillaOpacity;
spanElements[currIdx].style.filter=ieOpacity
}},reRound:function(theDiv,options){var topRico=theDiv.parentNode.childNodes[0];
var bottomRico=theDiv.parentNode.childNodes[2];
theDiv.parentNode.removeChild(topRico);
theDiv.parentNode.removeChild(bottomRico);
this.round(theDiv.parentNode,options)
},_roundCornersImpl:function(e,color,bgColor){if(this.options.border){this._renderBorder(e,bgColor)
}if(this._isTopRounded()){this._roundTopCorners(e,color,bgColor)
}if(this._isBottomRounded()){this._roundBottomCorners(e,color,bgColor)
}},_renderBorder:function(el,bgColor){var borderValue="1px solid "+this._borderColor(bgColor);
var borderL="border-left: "+borderValue;
var borderR="border-right: "+borderValue;
var style="style='"+borderL+";"+borderR+"'";
el.innerHTML="<div "+style+">"+el.innerHTML+"</div>"
},_roundTopCorners:function(el,color,bgColor){var corner=this._createCorner(bgColor);
for(var i=0;
i<this.options.numSlices;
i++){corner.appendChild(this._createCornerSlice(color,bgColor,i,"top"))
}el.style.paddingTop=0;
el.insertBefore(corner,el.firstChild)
},_roundBottomCorners:function(el,color,bgColor){var corner=this._createCorner(bgColor);
for(var i=(this.options.numSlices-1);
i>=0;
i--){corner.appendChild(this._createCornerSlice(color,bgColor,i,"bottom"))
}el.style.paddingBottom=0;
el.appendChild(corner)
},_createCorner:function(bgColor){var corner=document.createElement("div");
corner.style.backgroundColor=(this._isTransparent()?"transparent":bgColor);
return corner
},_createCornerSlice:function(color,bgColor,n,position){var slice=document.createElement("span");
var inStyle=slice.style;
inStyle.backgroundColor=color;
inStyle.display="block";
inStyle.height="1px";
inStyle.overflow="hidden";
inStyle.fontSize="1px";
var borderColor=this._borderColor(color,bgColor);
if(this.options.border&&n==0){inStyle.borderTopStyle="solid";
inStyle.borderTopWidth="1px";
inStyle.borderLeftWidth="0px";
inStyle.borderRightWidth="0px";
inStyle.borderBottomWidth="0px";
inStyle.height="0px";
inStyle.borderColor=borderColor
}else{if(borderColor){inStyle.borderColor=borderColor;
inStyle.borderStyle="solid";
inStyle.borderWidth="0px 1px"
}}if(!this.options.compact&&(n==(this.options.numSlices-1))){inStyle.height="2px"
}this._setMargin(slice,n,position);
this._setBorder(slice,n,position);
return slice
},_setOptions:function(options){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};
OpenLayers.Util.extend(this.options,options||{});
this.options.numSlices=this.options.compact?2:4;
if(this._isTransparent()){this.options.blend=false
}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""
}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""
}if(this.options.corners.indexOf("tl")>=0){return"left"
}else{if(this.options.corners.indexOf("tr")>=0){return"right"
}}return""
},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""
}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""
}if(this.options.corners.indexOf("bl")>=0){return"left"
}else{if(this.options.corners.indexOf("br")>=0){return"right"
}}return""
},_borderColor:function(color,bgColor){if(color=="transparent"){return bgColor
}else{if(this.options.border){return this.options.border
}else{if(this.options.blend){return this._blend(bgColor,color)
}else{return""
}}}},_setMargin:function(el,n,corners){var marginSize=this._marginSize(n);
var whichSide=corners=="top"?this._whichSideTop():this._whichSideBottom();
if(whichSide=="left"){el.style.marginLeft=marginSize+"px";
el.style.marginRight="0px"
}else{if(whichSide=="right"){el.style.marginRight=marginSize+"px";
el.style.marginLeft="0px"
}else{el.style.marginLeft=marginSize+"px";
el.style.marginRight=marginSize+"px"
}}},_setBorder:function(el,n,corners){var borderSize=this._borderSize(n);
var whichSide=corners=="top"?this._whichSideTop():this._whichSideBottom();
if(whichSide=="left"){el.style.borderLeftWidth=borderSize+"px";
el.style.borderRightWidth="0px"
}else{if(whichSide=="right"){el.style.borderRightWidth=borderSize+"px";
el.style.borderLeftWidth="0px"
}else{el.style.borderLeftWidth=borderSize+"px";
el.style.borderRightWidth=borderSize+"px"
}}if(this.options.border!=false){el.style.borderLeftWidth=borderSize+"px";
el.style.borderRightWidth=borderSize+"px"
}},_marginSize:function(n){if(this._isTransparent()){return 0
}var marginSizes=[5,3,2,1];
var blendedMarginSizes=[3,2,1,0];
var compactMarginSizes=[2,1];
var smBlendedMarginSizes=[1,0];
if(this.options.compact&&this.options.blend){return smBlendedMarginSizes[n]
}else{if(this.options.compact){return compactMarginSizes[n]
}else{if(this.options.blend){return blendedMarginSizes[n]
}else{return marginSizes[n]
}}}},_borderSize:function(n){var transparentBorderSizes=[5,3,2,1];
var blendedBorderSizes=[2,1,1,1];
var compactBorderSizes=[1,0];
var actualBorderSizes=[0,2,0,0];
if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1
}else{if(this.options.compact){return compactBorderSizes[n]
}else{if(this.options.blend){return blendedBorderSizes[n]
}else{if(this.options.border){return actualBorderSizes[n]
}else{if(this._isTransparent()){return transparentBorderSizes[n]
}}}}}return 0
},_hasString:function(str){for(var i=1;
i<arguments.length;
i++){if(str.indexOf(arguments[i])>=0){return true
}}return false
},_blend:function(c1,c2){var cc1=OpenLayers.Rico.Color.createFromHex(c1);
cc1.blend(OpenLayers.Rico.Color.createFromHex(c2));
return cc1
},_background:function(el){try{return OpenLayers.Rico.Color.createColorFromBackground(el).asHex()
}catch(err){return"#ffffff"
}},_isTransparent:function(){return this.options.color=="transparent"
},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")
},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")
},_hasSingleTextChild:function(el){return el.childNodes.length==1&&el.childNodes[0].nodeType==3
}};OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(error){alert(error)
},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};
(function(){var scripts=document.getElementsByTagName("script");
for(var i=0,len=scripts.length;
i<len;
++i){if(scripts[i].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);
break
}}}})();OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(options){OpenLayers.Util.extend(this,options);
this.options=options
},destroy:function(){},read:function(data){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))
},write:function(object){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))
},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.CSWGetRecords=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.CSWGetRecords.DEFAULTS);
var cls=OpenLayers.Format.CSWGetRecords["v"+options.version.replace(/\./g,"_")];
if(!cls){throw"Unsupported CSWGetRecords version: "+options.version
}return new cls(options)
};
OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(event){return event.target||event.srcElement
},isLeftClick:function(event){return(((event.which)&&(event.which==1))||((event.button)&&(event.button==1)))
},isRightClick:function(event){return(((event.which)&&(event.which==3))||((event.button)&&(event.button==2)))
},stop:function(event,allowDefault){if(!allowDefault){if(event.preventDefault){event.preventDefault()
}else{event.returnValue=false
}}if(event.stopPropagation){event.stopPropagation()
}else{event.cancelBubble=true
}},findElement:function(event,tagName){var element=OpenLayers.Event.element(event);
while(element.parentNode&&(!element.tagName||(element.tagName.toUpperCase()!=tagName.toUpperCase()))){element=element.parentNode
}return element
},observe:function(elementParam,name,observer,useCapture){var element=OpenLayers.Util.getElement(elementParam);
useCapture=useCapture||false;
if(name=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.attachEvent)){name="keydown"
}if(!this.observers){this.observers={}
}if(!element._eventCacheID){var idPrefix="eventCacheID_";
if(element.id){idPrefix=element.id+"_"+idPrefix
}element._eventCacheID=OpenLayers.Util.createUniqueID(idPrefix)
}var cacheID=element._eventCacheID;
if(!this.observers[cacheID]){this.observers[cacheID]=[]
}this.observers[cacheID].push({element:element,name:name,observer:observer,useCapture:useCapture});
if(element.addEventListener){element.addEventListener(name,observer,useCapture)
}else{if(element.attachEvent){element.attachEvent("on"+name,observer)
}}},stopObservingElement:function(elementParam){var element=OpenLayers.Util.getElement(elementParam);
var cacheID=element._eventCacheID;
this._removeElementObservers(OpenLayers.Event.observers[cacheID])
},_removeElementObservers:function(elementObservers){if(elementObservers){for(var i=elementObservers.length-1;
i>=0;
i--){var entry=elementObservers[i];
var args=new Array(entry.element,entry.name,entry.observer,entry.useCapture);
var removed=OpenLayers.Event.stopObserving.apply(this,args)
}}},stopObserving:function(elementParam,name,observer,useCapture){useCapture=useCapture||false;
var element=OpenLayers.Util.getElement(elementParam);
var cacheID=element._eventCacheID;
if(name=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.detachEvent){name="keydown"
}}var foundEntry=false;
var elementObservers=OpenLayers.Event.observers[cacheID];
if(elementObservers){var i=0;
while(!foundEntry&&i<elementObservers.length){var cacheEntry=elementObservers[i];
if((cacheEntry.name==name)&&(cacheEntry.observer==observer)&&(cacheEntry.useCapture==useCapture)){elementObservers.splice(i,1);
if(elementObservers.length==0){delete OpenLayers.Event.observers[cacheID]
}foundEntry=true;
break
}i++
}}if(foundEntry){if(element.removeEventListener){element.removeEventListener(name,observer,useCapture)
}else{if(element&&element.detachEvent){element.detachEvent("on"+name,observer)
}}}return foundEntry
},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var cacheID in OpenLayers.Event.observers){var elementObservers=OpenLayers.Event.observers[cacheID];
OpenLayers.Event._removeElementObservers.apply(this,[elementObservers])
}OpenLayers.Event.observers=false
}},CLASS_NAME:"OpenLayers.Event"};
OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);
if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event)
}else{var Event=OpenLayers.Event
}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(object,element,eventTypes,fallThrough,options){OpenLayers.Util.extend(this,options);
this.object=object;
this.fallThrough=fallThrough;
this.listeners={};
this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);
this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);
this.eventTypes=[];
if(eventTypes!=null){for(var i=0,len=eventTypes.length;
i<len;
i++){this.addEventType(eventTypes[i])
}}if(element!=null){this.attachToElement(element)
}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);
if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)
}}this.element=null;
this.listeners=null;
this.object=null;
this.eventTypes=null;
this.fallThrough=null;
this.eventHandler=null
},addEventType:function(eventName){if(!this.listeners[eventName]){this.eventTypes.push(eventName);
this.listeners[eventName]=[]
}},attachToElement:function(element){if(this.element){OpenLayers.Event.stopObservingElement(this.element)
}this.element=element;
for(var i=0,len=this.BROWSER_EVENTS.length;
i<len;
i++){var eventType=this.BROWSER_EVENTS[i];
this.addEventType(eventType);
OpenLayers.Event.observe(element,eventType,this.eventHandler)
}OpenLayers.Event.observe(element,"dragstart",OpenLayers.Event.stop)
},on:function(object){for(var type in object){if(type!="scope"){this.register(type,object.scope,object[type])
}}},register:function(type,obj,func){if((func!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,type)!=-1)){if(obj==null){obj=this.object
}var listeners=this.listeners[type];
listeners.push({obj:obj,func:func})
}},registerPriority:function(type,obj,func){if(func!=null){if(obj==null){obj=this.object
}var listeners=this.listeners[type];
if(listeners!=null){listeners.unshift({obj:obj,func:func})
}}},un:function(object){for(var type in object){if(type!="scope"){this.unregister(type,object.scope,object[type])
}}},unregister:function(type,obj,func){if(obj==null){obj=this.object
}var listeners=this.listeners[type];
if(listeners!=null){for(var i=0,len=listeners.length;
i<len;
i++){if(listeners[i].obj==obj&&listeners[i].func==func){listeners.splice(i,1);
break
}}}},remove:function(type){if(this.listeners[type]!=null){this.listeners[type]=[]
}},triggerEvent:function(type,evt){var listeners=this.listeners[type];
if(!listeners||listeners.length==0){return
}if(evt==null){evt={}
}evt.object=this.object;
evt.element=this.element;
if(!evt.type){evt.type=type
}var listeners=listeners.slice(),continueChain;
for(var i=0,len=listeners.length;
i<len;
i++){var callback=listeners[i];
continueChain=callback.func.apply(callback.obj,[evt]);
if((continueChain!=undefined)&&(continueChain==false)){break
}}if(!this.fallThrough){OpenLayers.Event.stop(evt,true)
}return continueChain
},handleBrowserEvent:function(evt){if(this.includeXY){evt.xy=this.getMousePosition(evt)
}this.triggerEvent(evt.type,evt)
},clearMouseCache:function(){this.element.scrolls=null;
this.element.lefttop=null;
this.element.offsets=null
},getMousePosition:function(evt){if(!this.includeXY){this.clearMouseCache()
}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);
this.element.hasScrollEvent=true
}}if(!this.element.scrolls){this.element.scrolls=[(document.documentElement.scrollLeft||document.body.scrollLeft),(document.documentElement.scrollTop||document.body.scrollTop)]
}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]
}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element);
this.element.offsets[0]+=this.element.scrolls[0];
this.element.offsets[1]+=this.element.scrolls[1]
}return new OpenLayers.Pixel((evt.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(evt.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])
},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(url,size,offset,calculateOffset){this.url=url;
this.size=(size)?size:new OpenLayers.Size(20,20);
this.offset=offset?offset:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));
this.calculateOffset=calculateOffset;
var id=OpenLayers.Util.createUniqueID("OL_Icon_");
this.imageDiv=OpenLayers.Util.createAlphaImageDiv(id)
},destroy:function(){this.erase();
OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);
this.imageDiv.innerHTML="";
this.imageDiv=null
},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)
},setSize:function(size){if(size!=null){this.size=size
}this.draw()
},setUrl:function(url){if(url!=null){this.url=url
}this.draw()
},draw:function(px){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");
this.moveTo(px);
return this.imageDiv
},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv)
}},setOpacity:function(opacity){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,opacity)
},moveTo:function(px){if(px!=null){this.px=px
}if(this.imageDiv!=null){if(this.px==null){this.display(false)
}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)
}var offsetPx=this.px.offset(this.offset);
OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,offsetPx)
}}},display:function(display){this.imageDiv.style.display=(display)?"":"none"
},isDrawn:function(){var isDrawn=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));
return isDrawn
},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(lonlat,icon){this.lonlat=lonlat;
var newIcon=(icon)?icon:OpenLayers.Marker.defaultIcon();
if(this.icon==null){this.icon=newIcon
}else{this.icon.url=newIcon.url;
this.icon.size=newIcon.size;
this.icon.offset=newIcon.offset;
this.icon.calculateOffset=newIcon.calculateOffset
}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null)
},destroy:function(){this.erase();
this.map=null;
this.events.destroy();
this.events=null;
if(this.icon!=null){this.icon.destroy();
this.icon=null
}},draw:function(px){return this.icon.draw(px)
},erase:function(){if(this.icon!=null){this.icon.erase()
}},moveTo:function(px){if((px!=null)&&(this.icon!=null)){this.icon.moveTo(px)
}this.lonlat=this.map.getLonLatFromLayerPx(px)
},isDrawn:function(){var isDrawn=(this.icon&&this.icon.isDrawn());
return isDrawn
},onScreen:function(){var onScreen=false;
if(this.map){var screenBounds=this.map.getExtent();
onScreen=screenBounds.containsLonLat(this.lonlat)
}return onScreen
},inflate:function(inflate){if(this.icon){var newSize=new OpenLayers.Size(this.icon.size.w*inflate,this.icon.size.h*inflate);
this.icon.setSize(newSize)
}},setOpacity:function(opacity){this.icon.setOpacity(opacity)
},setUrl:function(url){this.icon.setUrl(url)
},display:function(display){this.icon.display(display)
},CLASS_NAME:"OpenLayers.Marker"});
OpenLayers.Marker.defaultIcon=function(){var url=OpenLayers.Util.getImagesLocation()+"marker.png";
var size=new OpenLayers.Size(21,25);
var calculateOffset=function(size){return new OpenLayers.Pixel(-(size.w/2),-size.h)
};
return new OpenLayers.Icon(url,size,null,calculateOffset)
};OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding)
}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(id,lonlat,contentSize,contentHTML,closeBox,closeBoxCallback){if(id==null){id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
}this.id=id;
this.lonlat=lonlat;
this.contentSize=(contentSize!=null)?contentSize:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);
if(contentHTML!=null){this.contentHTML=contentHTML
}this.backgroundColor=OpenLayers.Popup.COLOR;
this.opacity=OpenLayers.Popup.OPACITY;
this.border=OpenLayers.Popup.BORDER;
this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");
this.div.className=this.displayClass;
var groupDivId=this.id+"_GroupDiv";
this.groupDiv=OpenLayers.Util.createDiv(groupDivId,null,null,null,"relative",null,"hidden");
var id=this.div.id+"_contentDiv";
this.contentDiv=OpenLayers.Util.createDiv(id,null,this.contentSize.clone(),null,"relative");
this.contentDiv.className=this.contentDisplayClass;
this.groupDiv.appendChild(this.contentDiv);
this.div.appendChild(this.groupDiv);
if(closeBox){this.addCloseBox(closeBoxCallback)
}this.registerEvents()
},destroy:function(){this.id=null;
this.lonlat=null;
this.size=null;
this.contentHTML=null;
this.backgroundColor=null;
this.opacity=null;
this.border=null;
if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)
}this.events.destroy();
this.events=null;
if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);
this.groupDiv.removeChild(this.closeDiv)
}this.closeDiv=null;
this.div.removeChild(this.groupDiv);
this.groupDiv=null;
if(this.map!=null){this.map.removePopup(this)
}this.map=null;
this.div=null;
this.autoSize=null;
this.minSize=null;
this.maxSize=null;
this.padding=null;
this.panMapIfOutOfView=null
},draw:function(px){if(px==null){if((this.lonlat!=null)&&(this.map!=null)){px=this.map.getLayerPxFromLonLat(this.lonlat)
}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)
}if(!this.disableFirefoxOverflowHack&&OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var style=document.defaultView.getComputedStyle(this.contentDiv,null);
var currentOverflow=style.getPropertyValue("overflow");
if(currentOverflow!="hidden"){this.contentDiv._oldOverflow=currentOverflow;
this.contentDiv.style.overflow="hidden"
}});
this.map.events.register("moveend",this,function(){var oldOverflow=this.contentDiv._oldOverflow;
if(oldOverflow){this.contentDiv.style.overflow=oldOverflow;
this.contentDiv._oldOverflow=null
}})
}this.moveTo(px);
if(!this.autoSize&&!this.size){this.setSize(this.contentSize)
}this.setBackgroundColor();
this.setOpacity();
this.setBorder();
this.setContentHTML();
if(this.panMapIfOutOfView){this.panIntoView()
}return this.div
},updatePosition:function(){if((this.lonlat)&&(this.map)){var px=this.map.getLayerPxFromLonLat(this.lonlat);
if(px){this.moveTo(px)
}}},moveTo:function(px){if((px!=null)&&(this.div!=null)){this.div.style.left=px.x+"px";
this.div.style.top=px.y+"px"
}},visible:function(){return OpenLayers.Element.visible(this.div)
},toggle:function(){if(this.visible()){this.hide()
}else{this.show()
}},show:function(){OpenLayers.Element.show(this.div);
if(this.panMapIfOutOfView){this.panIntoView()
}},hide:function(){OpenLayers.Element.hide(this.div)
},setSize:function(contentSize){this.size=contentSize.clone();
var contentDivPadding=this.getContentDivPadding();
var wPadding=contentDivPadding.left+contentDivPadding.right;
var hPadding=contentDivPadding.top+contentDivPadding.bottom;
this.fixPadding();
wPadding+=this.padding.left+this.padding.right;
hPadding+=this.padding.top+this.padding.bottom;
if(this.closeDiv){var closeDivWidth=parseInt(this.closeDiv.style.width);
wPadding+=closeDivWidth+contentDivPadding.right
}this.size.w+=wPadding;
this.size.h+=hPadding;
if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=contentDivPadding.left+contentDivPadding.right;
this.contentSize.h+=contentDivPadding.bottom+contentDivPadding.top
}if(this.div!=null){this.div.style.width=this.size.w+"px";
this.div.style.height=this.size.h+"px"
}if(this.contentDiv!=null){this.contentDiv.style.width=contentSize.w+"px";
this.contentDiv.style.height=contentSize.h+"px"
}},updateSize:function(){var preparedHTML="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";
var containerElement=(this.map)?this.map.layerContainerDiv:document.body;
var realSize=OpenLayers.Util.getRenderedDimensions(preparedHTML,null,{displayClass:this.displayClass,containerElement:containerElement});
var safeSize=this.getSafeContentSize(realSize);
var newSize=null;
if(safeSize.equals(realSize)){newSize=realSize
}else{var fixedSize=new OpenLayers.Size();
fixedSize.w=(safeSize.w<realSize.w)?safeSize.w:null;
fixedSize.h=(safeSize.h<realSize.h)?safeSize.h:null;
if(fixedSize.w&&fixedSize.h){newSize=safeSize
}else{var clippedSize=OpenLayers.Util.getRenderedDimensions(preparedHTML,fixedSize,{displayClass:this.contentDisplayClass,containerElement:containerElement});
var currentOverflow=OpenLayers.Element.getStyle(this.contentDiv,"overflow");
if((currentOverflow!="hidden")&&(clippedSize.equals(safeSize))){var scrollBar=OpenLayers.Util.getScrollbarWidth();
if(fixedSize.w){clippedSize.h+=scrollBar
}else{clippedSize.w+=scrollBar
}}newSize=this.getSafeContentSize(clippedSize)
}}this.setSize(newSize)
},setBackgroundColor:function(color){if(color!=undefined){this.backgroundColor=color
}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor
}},setOpacity:function(opacity){if(opacity!=undefined){this.opacity=opacity
}if(this.div!=null){this.div.style.opacity=this.opacity;
this.div.style.filter="alpha(opacity="+this.opacity*100+")"
}},setBorder:function(border){if(border!=undefined){this.border=border
}if(this.div!=null){this.div.style.border=this.border
}},setContentHTML:function(contentHTML){if(contentHTML!=null){this.contentHTML=contentHTML
}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;
if(this.autoSize){this.registerImageListeners();
this.updateSize()
}}},registerImageListeners:function(){var onImgLoad=function(){this.popup.updateSize();
if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()
}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)
};
var images=this.contentDiv.getElementsByTagName("img");
for(var i=0,len=images.length;
i<len;
i++){var img=images[i];
if(img.width==0||img.height==0){var context={popup:this,img:img};
img._onImgLoad=OpenLayers.Function.bind(onImgLoad,context);
OpenLayers.Event.observe(img,"load",img._onImgLoad)
}}},getSafeContentSize:function(size){var safeContentSize=size.clone();
var contentDivPadding=this.getContentDivPadding();
var wPadding=contentDivPadding.left+contentDivPadding.right;
var hPadding=contentDivPadding.top+contentDivPadding.bottom;
this.fixPadding();
wPadding+=this.padding.left+this.padding.right;
hPadding+=this.padding.top+this.padding.bottom;
if(this.closeDiv){var closeDivWidth=parseInt(this.closeDiv.style.width);
wPadding+=closeDivWidth+contentDivPadding.right
}if(this.minSize){safeContentSize.w=Math.max(safeContentSize.w,(this.minSize.w-wPadding));
safeContentSize.h=Math.max(safeContentSize.h,(this.minSize.h-hPadding))
}if(this.maxSize){safeContentSize.w=Math.min(safeContentSize.w,(this.maxSize.w-wPadding));
safeContentSize.h=Math.min(safeContentSize.h,(this.maxSize.h-hPadding))
}if(this.map&&this.map.size){var extraX=0,extraY=0;
if(this.keepInMap&&!this.panMapIfOutOfView){var px=this.map.getPixelFromLonLat(this.lonlat);
switch(this.relativePosition){case"tr":extraX=px.x;
extraY=this.map.size.h-px.y;
break;
case"tl":extraX=this.map.size.w-px.x;
extraY=this.map.size.h-px.y;
break;
case"bl":extraX=this.map.size.w-px.x;
extraY=px.y;
break;
case"br":extraX=px.x;
extraY=px.y;
break;
default:extraX=px.x;
extraY=this.map.size.h-px.y;
break
}}var maxY=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-hPadding-extraY;
var maxX=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-wPadding-extraX;
safeContentSize.w=Math.min(safeContentSize.w,maxX);
safeContentSize.h=Math.min(safeContentSize.h,maxY)
}return safeContentSize
},getContentDivPadding:function(){var contentDivPadding=this._contentDivPadding;
if(!contentDivPadding){if(this.div.parentNode==null){this.div.style.display="none";
document.body.appendChild(this.div)
}contentDivPadding=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));
this._contentDivPadding=contentDivPadding;
if(this.div.parentNode==document.body){document.body.removeChild(this.div);
this.div.style.display=""
}}return contentDivPadding
},addCloseBox:function(callback){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));
this.closeDiv.className="olPopupCloseBox";
var contentDivPadding=this.getContentDivPadding();
this.closeDiv.style.right=contentDivPadding.right+"px";
this.closeDiv.style.top=contentDivPadding.top+"px";
this.groupDiv.appendChild(this.closeDiv);
var closePopup=callback||function(e){this.hide();
OpenLayers.Event.stop(e)
};
OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(closePopup,this))
},panIntoView:function(){var mapSize=this.map.getSize();
var origTL=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));
var newTL=origTL.clone();
if(origTL.x<this.map.paddingForPopups.left){newTL.x=this.map.paddingForPopups.left
}else{if((origTL.x+this.size.w)>(mapSize.w-this.map.paddingForPopups.right)){newTL.x=mapSize.w-this.map.paddingForPopups.right-this.size.w
}}if(origTL.y<this.map.paddingForPopups.top){newTL.y=this.map.paddingForPopups.top
}else{if((origTL.y+this.size.h)>(mapSize.h-this.map.paddingForPopups.bottom)){newTL.y=mapSize.h-this.map.paddingForPopups.bottom-this.size.h
}}var dx=origTL.x-newTL.x;
var dy=origTL.y-newTL.y;
this.map.pan(dx,dy)
},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);
this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this})
},onmousedown:function(evt){this.mousedown=true;
OpenLayers.Event.stop(evt,true)
},onmousemove:function(evt){if(this.mousedown){OpenLayers.Event.stop(evt,true)
}},onmouseup:function(evt){if(this.mousedown){this.mousedown=false;
OpenLayers.Event.stop(evt,true)
}},onclick:function(evt){OpenLayers.Event.stop(evt,true)
},onmouseout:function(evt){this.mousedown=false
},ondblclick:function(evt){OpenLayers.Event.stop(evt,true)
},CLASS_NAME:"OpenLayers.Popup"});
OpenLayers.Popup.WIDTH=200;
OpenLayers.Popup.HEIGHT=200;
OpenLayers.Popup.COLOR="white";
OpenLayers.Popup.OPACITY=1;
OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){var newArguments=[id,lonlat,contentSize,contentHTML,closeBox,closeBoxCallback];
OpenLayers.Popup.prototype.initialize.apply(this,newArguments);
this.anchor=(anchor!=null)?anchor:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}
},destroy:function(){this.anchor=null;
this.relativePosition=null;
OpenLayers.Popup.prototype.destroy.apply(this,arguments)
},show:function(){this.updatePosition();
OpenLayers.Popup.prototype.show.apply(this,arguments)
},moveTo:function(px){var oldRelativePosition=this.relativePosition;
this.relativePosition=this.calculateRelativePosition(px);
var newPx=this.calculateNewPx(px);
var newArguments=new Array(newPx);
OpenLayers.Popup.prototype.moveTo.apply(this,newArguments);
if(this.relativePosition!=oldRelativePosition){this.updateRelativePosition()
}},setSize:function(contentSize){OpenLayers.Popup.prototype.setSize.apply(this,arguments);
if((this.lonlat)&&(this.map)){var px=this.map.getLayerPxFromLonLat(this.lonlat);
this.moveTo(px)
}},calculateRelativePosition:function(px){var lonlat=this.map.getLonLatFromLayerPx(px);
var extent=this.map.getExtent();
var quadrant=extent.determineQuadrant(lonlat);
return OpenLayers.Bounds.oppositeQuadrant(quadrant)
},updateRelativePosition:function(){},calculateNewPx:function(px){var newPx=px.offset(this.anchor.offset);
var size=this.size||this.contentSize;
var top=(this.relativePosition.charAt(0)=="t");
newPx.y+=(top)?-(size.h+this.anchor.size.h):this.anchor.size.h;
var left=(this.relativePosition.charAt(1)=="l");
newPx.x+=(left)?-(size.w+this.anchor.size.w):this.anchor.size.w;
return newPx
},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);
OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)
},draw:function(px){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);
this.setContentHTML();
this.setBackgroundColor();
this.setOpacity();
return this.div
},updateRelativePosition:function(){this.setRicoCorners()
},setSize:function(contentSize){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);
this.setRicoCorners()
},setBackgroundColor:function(color){if(color!=undefined){this.backgroundColor=color
}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";
OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor)
}}},setOpacity:function(opacity){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,opacity);
if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)
}}},setBorder:function(border){this.border=0
},setRicoCorners:function(){var corners=this.getCornersToRound(this.relativePosition);
var options={corners:corners,color:this.backgroundColor,bgColor:"transparent",blend:false};
if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,options);
this.rounded=true
}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,options);
this.setBackgroundColor();
this.setOpacity()
}},getCornersToRound:function(){var corners=["tl","tr","bl","br"];
var corner=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);
OpenLayers.Util.removeItem(corners,corner);
return corners.join(" ")
},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});
OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:OpenLayers.Popup.AnchoredBubble,popup:null,initialize:function(layer,lonlat,data){this.layer=layer;
this.lonlat=lonlat;
this.data=(data!=null)?data:{};
this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)
}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker)
}this.layer=null;
this.id=null;
this.lonlat=null;
this.data=null;
if(this.marker!=null){this.destroyMarker(this.marker);
this.marker=null
}if(this.popup!=null){this.destroyPopup(this.popup);
this.popup=null
}},onScreen:function(){var onScreen=false;
if((this.layer!=null)&&(this.layer.map!=null)){var screenBounds=this.layer.map.getExtent();
onScreen=screenBounds.containsLonLat(this.lonlat)
}return onScreen
},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)
}return this.marker
},destroyMarker:function(){this.marker.destroy()
},createPopup:function(closeBox){if(this.lonlat!=null){var id=this.id+"_popup";
var anchor=(this.marker)?this.marker.icon:null;
if(!this.popup){this.popup=new this.popupClass(id,this.lonlat,this.data.popupSize,this.data.popupContentHTML,anchor,closeBox)
}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow
}this.popup.feature=this
}return this.popup
},destroyPopup:function(){if(this.popup){this.popup.feature=null;
this.popup.destroy();
this.popup=null
}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};
OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",initialize:function(geometry,attributes,style){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,attributes]);
this.lonlat=null;
this.geometry=geometry?geometry:null;
this.state=null;
this.attributes={};
if(attributes){this.attributes=OpenLayers.Util.extend(this.attributes,attributes)
}this.style=style?style:null
},destroy:function(){if(this.layer){this.layer.removeFeatures(this);
this.layer=null
}this.geometry=null;
OpenLayers.Feature.prototype.destroy.apply(this,arguments)
},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)
},onScreen:function(boundsOnly){var onScreen=false;
if(this.layer&&this.layer.map){var screenBounds=this.layer.map.getExtent();
if(boundsOnly){var featureBounds=this.geometry.getBounds();
onScreen=screenBounds.intersectsBounds(featureBounds)
}else{var screenPoly=screenBounds.toGeometry();
onScreen=screenPoly.intersects(this.geometry)
}}return onScreen
},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())
},createMarker:function(){return null
},destroyMarker:function(){},createPopup:function(){return null
},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=false;
if(this.geometry){atPoint=this.geometry.atPoint(lonlat,toleranceLon,toleranceLat)
}return atPoint
},destroyPopup:function(){},move:function(location){if(!this.layer||!this.geometry.move){return
}var pixel;
if(location.CLASS_NAME=="OpenLayers.LonLat"){pixel=this.layer.getViewPortPxFromLonLat(location)
}else{pixel=location
}var lastPixel=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());
var res=this.layer.map.getResolution();
this.geometry.move(res*(pixel.x-lastPixel.x),res*(lastPixel.y-pixel.y));
this.layer.drawFeature(this);
return lastPixel
},toState:function(state){if(state==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=state;
break;
case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break
}}else{if(state==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;
default:this.state=state;
break
}}else{if(state==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;
case OpenLayers.State.DELETE:break;
case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=state;
break
}}else{if(state==OpenLayers.State.UNKNOWN){this.state=state
}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});
OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(options){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")
}OpenLayers.Format.prototype.initialize.apply(this,[options]);
this.namespaces=OpenLayers.Util.extend({},this.namespaces);
this.namespaceAlias={};
for(var alias in this.namespaces){this.namespaceAlias[this.namespaces[alias]]=alias
}},destroy:function(){this.xmldom=null;
OpenLayers.Format.prototype.destroy.apply(this,arguments)
},setNamespace:function(alias,uri){this.namespaces[alias]=uri;
this.namespaceAlias[uri]=alias
},read:function(text){var index=text.indexOf("<");
if(index>0){text=text.substring(index)
}var node=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var xmldom;
if(window.ActiveXObject&&!this.xmldom){xmldom=new ActiveXObject("Microsoft.XMLDOM")
}else{xmldom=this.xmldom
}xmldom.loadXML(text);
return xmldom
}),this),function(){return new DOMParser().parseFromString(text,"text/xml")
},function(){var req=new XMLHttpRequest();
req.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(text),false);
if(req.overrideMimeType){req.overrideMimeType("text/xml")
}req.send(null);
return req.responseXML
});
if(this.keepData){this.data=node
}return node
},write:function(node){var data;
if(this.xmldom){data=node.xml
}else{var serializer=new XMLSerializer();
if(node.nodeType==1){var doc=document.implementation.createDocument("","",null);
if(doc.importNode){node=doc.importNode(node,true)
}doc.appendChild(node);
data=serializer.serializeToString(doc)
}else{data=serializer.serializeToString(node)
}}return data
},createElementNS:function(uri,name){var element;
if(this.xmldom){if(typeof uri=="string"){element=this.xmldom.createNode(1,name,uri)
}else{element=this.xmldom.createNode(1,name,"")
}}else{element=document.createElementNS(uri,name)
}return element
},createTextNode:function(text){var node;
if(typeof text!=="string"){text=String(text)
}if(this.xmldom){node=this.xmldom.createTextNode(text)
}else{node=document.createTextNode(text)
}return node
},getElementsByTagNameNS:function(node,uri,name){var elements=[];
if(node.getElementsByTagNameNS){elements=node.getElementsByTagNameNS(uri,name)
}else{var allNodes=node.getElementsByTagName("*");
var potentialNode,fullName;
for(var i=0,len=allNodes.length;
i<len;
++i){potentialNode=allNodes[i];
fullName=(potentialNode.prefix)?(potentialNode.prefix+":"+name):name;
if((name=="*")||(fullName==potentialNode.nodeName)){if((uri=="*")||(uri==potentialNode.namespaceURI)){elements.push(potentialNode)
}}}}return elements
},getAttributeNodeNS:function(node,uri,name){var attributeNode=null;
if(node.getAttributeNodeNS){attributeNode=node.getAttributeNodeNS(uri,name)
}else{var attributes=node.attributes;
var potentialNode,fullName;
for(var i=0,len=attributes.length;
i<len;
++i){potentialNode=attributes[i];
if(potentialNode.namespaceURI==uri){fullName=(potentialNode.prefix)?(potentialNode.prefix+":"+name):name;
if(fullName==potentialNode.nodeName){attributeNode=potentialNode;
break
}}}}return attributeNode
},getAttributeNS:function(node,uri,name){var attributeValue="";
if(node.getAttributeNS){attributeValue=node.getAttributeNS(uri,name)||""
}else{var attributeNode=this.getAttributeNodeNS(node,uri,name);
if(attributeNode){attributeValue=attributeNode.nodeValue
}}return attributeValue
},getChildValue:function(node,def){var value=def||"";
if(node){for(var child=node.firstChild;
child;
child=child.nextSibling){switch(child.nodeType){case 3:case 4:value+=child.nodeValue
}}}return value
},concatChildValues:function(node,def){var value="";
var child=node.firstChild;
var childValue;
while(child){childValue=child.nodeValue;
if(childValue){value+=childValue
}child=child.nextSibling
}if(value==""&&def!=undefined){value=def
}return value
},isSimpleContent:function(node){var simple=true;
for(var child=node.firstChild;
child;
child=child.nextSibling){if(child.nodeType===1){simple=false;
break
}}return simple
},contentType:function(node){var simple=false,complex=false;
var type=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;
for(var child=node.firstChild;
child;
child=child.nextSibling){switch(child.nodeType){case 1:complex=true;
break;
case 8:break;
default:simple=true
}if(complex&&simple){break
}}if(complex&&simple){type=OpenLayers.Format.XML.CONTENT_TYPE.MIXED
}else{if(complex){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX
}else{if(simple){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE
}}}return type
},hasAttributeNS:function(node,uri,name){var found=false;
if(node.hasAttributeNS){found=node.hasAttributeNS(uri,name)
}else{found=!!this.getAttributeNodeNS(node,uri,name)
}return found
},setAttributeNS:function(node,uri,name,value){if(node.setAttributeNS){node.setAttributeNS(uri,name,value)
}else{if(this.xmldom){if(uri){var attribute=node.ownerDocument.createNode(2,name,uri);
attribute.nodeValue=value;
node.setAttributeNode(attribute)
}else{node.setAttribute(name,value)
}}else{throw"setAttributeNS not implemented"
}}},createElementNSPlus:function(name,options){options=options||{};
var uri=options.uri||this.namespaces[options.prefix];
if(!uri){var loc=name.indexOf(":");
uri=this.namespaces[name.substring(0,loc)]
}if(!uri){uri=this.namespaces[this.defaultPrefix]
}var node=this.createElementNS(uri,name);
if(options.attributes){this.setAttributes(node,options.attributes)
}var value=options.value;
if(value!=null){node.appendChild(this.createTextNode(value))
}return node
},setAttributes:function(node,obj){var value,uri;
for(var name in obj){if(obj[name]!=null&&obj[name].toString){value=obj[name].toString();
uri=this.namespaces[name.substring(0,name.indexOf(":"))]||null;
this.setAttributeNS(node,uri,name,value)
}}},readNode:function(node,obj){if(!obj){obj={}
}var group=this.readers[node.namespaceURI?this.namespaceAlias[node.namespaceURI]:this.defaultPrefix];
if(group){var local=node.localName||node.nodeName.split(":").pop();
var reader=group[local]||group["*"];
if(reader){reader.apply(this,[node,obj])
}}return obj
},readChildNodes:function(node,obj){if(!obj){obj={}
}var children=node.childNodes;
var child;
for(var i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType==1){this.readNode(child,obj)
}}return obj
},writeNode:function(name,obj,parent){var prefix,local;
var split=name.indexOf(":");
if(split>0){prefix=name.substring(0,split);
local=name.substring(split+1)
}else{if(parent){prefix=this.namespaceAlias[parent.namespaceURI]
}else{prefix=this.defaultPrefix
}local=name
}var child=this.writers[prefix][local].apply(this,[obj]);
if(parent){parent.appendChild(child)
}return child
},getChildEl:function(node,name,uri){return node&&this.getThisOrNextEl(node.firstChild,name,uri)
},getNextEl:function(node,name,uri){return node&&this.getThisOrNextEl(node.nextSibling,name,uri)
},getThisOrNextEl:function(node,name,uri){outer:for(var sibling=node;
sibling;
sibling=sibling.nextSibling){switch(sibling.nodeType){case 1:if((!name||name===(sibling.localName||sibling.nodeName.split(":").pop()))&&(!uri||uri===sibling.namespaceURI)){break outer
}sibling=null;
break outer;
case 3:if(/^\s*$/.test(sibling.nodeValue)){break
}case 4:case 6:case 12:case 10:case 11:sibling=null;
break outer
}}return sibling||null
},lookupNamespaceURI:function(node,prefix){var uri=null;
if(node){if(node.lookupNamespaceURI){uri=node.lookupNamespaceURI(prefix)
}else{outer:switch(node.nodeType){case 1:if(node.namespaceURI!==null&&node.prefix===prefix){uri=node.namespaceURI;
break outer
}var len=node.attributes.length;
if(len){var attr;
for(var i=0;
i<len;
++i){attr=node.attributes[i];
if(attr.prefix==="xmlns"&&attr.name==="xmlns:"+prefix){uri=attr.value||null;
break outer
}else{if(attr.name==="xmlns"&&prefix===null){uri=attr.value||null;
break outer
}}}}uri=this.lookupNamespaceURI(node.parentNode,prefix);
break outer;
case 2:uri=this.lookupNamespaceURI(node.ownerElement,prefix);
break outer;
case 9:uri=this.lookupNamespaceURI(node.documentElement,prefix);
break outer;
case 6:case 12:case 10:case 11:break outer;
default:uri=this.lookupNamespaceURI(node.parentNode,prefix);
break outer
}}}return uri
},CLASS_NAME:"OpenLayers.Format.XML"});
OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};
OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);if(!OpenLayers.Format.OWSCommon){OpenLayers.Format.OWSCommon={}
}OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},readers:{ows:{ServiceIdentification:function(node,obj){obj.serviceIdentification={};
this.readChildNodes(node,obj.serviceIdentification)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,serviceIdentification){serviceIdentification["abstract"]=this.getChildValue(node)
},Keywords:function(node,serviceIdentification){serviceIdentification.keywords={};
this.readChildNodes(node,serviceIdentification.keywords)
},Keyword:function(node,keywords){keywords[this.getChildValue(node)]=true
},ServiceType:function(node,serviceIdentification){serviceIdentification.serviceType={codeSpace:node.getAttribute("codeSpace"),value:this.getChildValue(node)}
},ServiceTypeVersion:function(node,serviceIdentification){serviceIdentification.serviceTypeVersion=this.getChildValue(node)
},Fees:function(node,serviceIdentification){serviceIdentification.fees=this.getChildValue(node)
},AccessConstraints:function(node,serviceIdentification){serviceIdentification.accessConstraints=this.getChildValue(node)
},ServiceProvider:function(node,obj){obj.serviceProvider={};
this.readChildNodes(node,obj.serviceProvider)
},ProviderName:function(node,serviceProvider){serviceProvider.providerName=this.getChildValue(node)
},ProviderSite:function(node,serviceProvider){serviceProvider.providerSite=this.getAttributeNS(node,this.namespaces.xlink,"href")
},ServiceContact:function(node,serviceProvider){serviceProvider.serviceContact={};
this.readChildNodes(node,serviceProvider.serviceContact)
},IndividualName:function(node,serviceContact){serviceContact.individualName=this.getChildValue(node)
},PositionName:function(node,serviceContact){serviceContact.positionName=this.getChildValue(node)
},ContactInfo:function(node,serviceContact){serviceContact.contactInfo={};
this.readChildNodes(node,serviceContact.contactInfo)
},Phone:function(node,contactInfo){contactInfo.phone={};
this.readChildNodes(node,contactInfo.phone)
},Voice:function(node,phone){phone.voice=this.getChildValue(node)
},Address:function(node,contactInfo){contactInfo.address={};
this.readChildNodes(node,contactInfo.address)
},DeliveryPoint:function(node,address){address.deliveryPoint=this.getChildValue(node)
},City:function(node,address){address.city=this.getChildValue(node)
},AdministrativeArea:function(node,address){address.administrativeArea=this.getChildValue(node)
},PostalCode:function(node,address){address.postalCode=this.getChildValue(node)
},Country:function(node,address){address.country=this.getChildValue(node)
},ElectronicMailAddress:function(node,address){address.electronicMailAddress=this.getChildValue(node)
},Role:function(node,serviceContact){serviceContact.role=this.getChildValue(node)
},OperationsMetadata:function(node,obj){obj.operationsMetadata={};
this.readChildNodes(node,obj.operationsMetadata)
},Operation:function(node,operationsMetadata){var name=node.getAttribute("name");
operationsMetadata[name]={};
this.readChildNodes(node,operationsMetadata[name])
},DCP:function(node,operation){operation.dcp={};
this.readChildNodes(node,operation.dcp)
},HTTP:function(node,dcp){dcp.http={};
this.readChildNodes(node,dcp.http)
},Get:function(node,http){http.get=this.getAttributeNS(node,this.namespaces.xlink,"href")
},Post:function(node,http){http.post=this.getAttributeNS(node,this.namespaces.xlink,"href")
},Parameter:function(node,operation){if(!operation.parameters){operation.parameters={}
}var name=node.getAttribute("name");
operation.parameters[name]={};
this.readChildNodes(node,operation.parameters[name])
},Value:function(node,allowedValues){allowedValues[this.getChildValue(node)]=true
},OutputFormat:function(node,obj){obj.formats.push({value:this.getChildValue(node)});
this.readChildNodes(node,obj)
},WGS84BoundingBox:function(node,obj){var boundingBox={};
boundingBox.crs=node.getAttribute("crs");
if(obj.BoundingBox){obj.BoundingBox.push(boundingBox)
}else{obj.projection=boundingBox.crs;
boundingBox=obj
}this.readChildNodes(node,boundingBox)
},BoundingBox:function(node,obj){this.readers.ows["WGS84BoundingBox"].apply(this,[node,obj])
},LowerCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
str=str.replace(this.regExes.trimComma,",");
var pointList=str.split(this.regExes.splitSpace);
obj.left=pointList[0];
obj.bottom=pointList[1]
},UpperCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
str=str.replace(this.regExes.trimComma,",");
var pointList=str.split(this.regExes.splitSpace);
obj.right=pointList[0];
obj.top=pointList[1];
obj.bounds=new OpenLayers.Bounds(obj.left,obj.bottom,obj.right,obj.top);
delete obj.left;
delete obj.bottom;
delete obj.right;
delete obj.top
}}},writers:{ows:{BoundingBox:function(options){var node=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:options.projection}});
this.writeNode("ows:LowerCorner",options,node);
this.writeNode("ows:UpperCorner",options,node);
return node
},LowerCorner:function(options){var node=this.createElementNSPlus("ows:LowerCorner",{value:options.bounds.left+" "+options.bounds.bottom});
return node
},UpperCorner:function(options){var node=this.createElementNSPlus("ows:UpperCorner",{value:options.bounds.right+" "+options.bounds.top});
return node
},Title:function(title){var node=this.createElementNSPlus("ows:Title",{value:title});
return node
},OutputFormat:function(format){var node=this.createElementNSPlus("ows:OutputFormat",{value:format});
return node
}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.0",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",getParser:function(version){var v=version||this.version||this.defaultVersion;
if(!this.parser||this.parser.VERSION!=v){var format=OpenLayers.Format.WMC["v"+v.replace(/\./g,"_")];
if(!format){throw"Can't find a WMC parser for version "+v
}this.parser=new format(this.options)
}return this.parser
},layerToContext:function(layer){var parser=this.getParser();
var layerContext={queryable:layer.queryable,visibility:layer.visibility,name:layer.params.LAYERS,title:layer.name,metadataURL:layer.metadataURL,version:layer.params.VERSION,url:layer.url,maxExtent:layer.maxExtent,transparent:layer.params.TRANSPARENT,numZoomLevels:layer.numZoomLevels,units:layer.units,isBaseLayer:layer.isBaseLayer,opacity:layer.opacity,displayInLayerSwitcher:layer.displayInLayerSwitcher,singleTile:layer.singleTile,tileSize:(layer.singleTile||!layer.tileSize)?undefined:{width:layer.tileSize.w,height:layer.tileSize.h},minScale:(layer.options.resolutions||layer.options.scales||layer.options.maxResolution||layer.options.minScale)?layer.minScale:undefined,maxScale:(layer.options.resolutions||layer.options.scales||layer.options.minResolution||layer.options.maxScale)?layer.maxScale:undefined,formats:[{value:layer.params.FORMAT,current:true}],styles:[{href:layer.params.SLD,body:layer.params.SLD_BODY,name:layer.params.STYLES||parser.defaultStyleName,title:parser.defaultStyleTitle,current:true}]};
return layerContext
},toContext:function(obj){var context={};
var layers=obj.layers;
if(obj.CLASS_NAME=="OpenLayers.Map"){context.bounds=obj.getExtent();
context.maxExtent=obj.maxExtent;
context.projection=obj.projection;
context.size=obj.getSize()
}else{OpenLayers.Util.applyDefaults(context,obj);
if(context.layers!=undefined){delete (context.layers)
}}if(context.layersContext==undefined){context.layersContext=[]
}if(layers!=undefined&&layers instanceof Array){for(var i=0,len=layers.length;
i<len;
i++){var layer=layers[i];
if(layer instanceof OpenLayers.Layer.WMS){context.layersContext.push(this.layerToContext(layer))
}}}return context
},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(uri){var prefix=null;
if(uri==null){prefix=this.namespaces[this.defaultPrefix]
}else{for(prefix in this.namespaces){if(this.namespaces[prefix]==uri){break
}}}return prefix
},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
this.rootPrefix=root.prefix;
var context={version:root.getAttribute("version")};
this.runChildNodes(context,root);
return context
},runChildNodes:function(obj,node){var children=node.childNodes;
var childNode,processor,prefix,local;
for(var i=0,len=children.length;
i<len;
++i){childNode=children[i];
if(childNode.nodeType==1){prefix=this.getNamespacePrefix(childNode.namespaceURI);
local=childNode.nodeName.split(":").pop();
processor=this["read_"+prefix+"_"+local];
if(processor){processor.apply(this,[obj,childNode])
}}}},read_wmc_General:function(context,node){this.runChildNodes(context,node)
},read_wmc_BoundingBox:function(context,node){context.projection=node.getAttribute("SRS");
context.bounds=new OpenLayers.Bounds(parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy")))
},read_wmc_LayerList:function(context,node){context.layersContext=[];
this.runChildNodes(context,node)
},read_wmc_Layer:function(context,node){var layerContext={visibility:(node.getAttribute("hidden")!="1"),queryable:(node.getAttribute("queryable")=="1"),formats:[],styles:[]};
this.runChildNodes(layerContext,node);
context.layersContext.push(layerContext)
},read_wmc_Extension:function(obj,node){this.runChildNodes(obj,node)
},read_ol_units:function(layerContext,node){layerContext.units=this.getChildValue(node)
},read_ol_maxExtent:function(obj,node){var bounds=new OpenLayers.Bounds(node.getAttribute("minx"),node.getAttribute("miny"),node.getAttribute("maxx"),node.getAttribute("maxy"));
obj.maxExtent=bounds
},read_ol_transparent:function(layerContext,node){layerContext.transparent=this.getChildValue(node)
},read_ol_numZoomLevels:function(layerContext,node){layerContext.numZoomLevels=parseInt(this.getChildValue(node))
},read_ol_opacity:function(layerContext,node){layerContext.opacity=parseFloat(this.getChildValue(node))
},read_ol_singleTile:function(layerContext,node){layerContext.singleTile=(this.getChildValue(node)=="true")
},read_ol_tileSize:function(layerContext,node){var obj={width:node.getAttribute("width"),height:node.getAttribute("height")};
layerContext.tileSize=obj
},read_ol_isBaseLayer:function(layerContext,node){layerContext.isBaseLayer=(this.getChildValue(node)=="true")
},read_ol_displayInLayerSwitcher:function(layerContext,node){layerContext.displayInLayerSwitcher=(this.getChildValue(node)=="true")
},read_wmc_Server:function(layerContext,node){layerContext.version=node.getAttribute("version");
var server={};
var links=node.getElementsByTagName("OnlineResource");
if(links.length>0){this.read_wmc_OnlineResource(server,links[0])
}layerContext.url=server.href
},read_wmc_FormatList:function(layerContext,node){this.runChildNodes(layerContext,node)
},read_wmc_Format:function(layerContext,node){var format={value:this.getChildValue(node)};
if(node.getAttribute("current")=="1"){format.current=true
}layerContext.formats.push(format)
},read_wmc_StyleList:function(layerContext,node){this.runChildNodes(layerContext,node)
},read_wmc_Style:function(layerContext,node){var style={};
this.runChildNodes(style,node);
if(node.getAttribute("current")=="1"){style.current=true
}layerContext.styles.push(style)
},read_wmc_SLD:function(style,node){this.runChildNodes(style,node)
},read_sld_StyledLayerDescriptor:function(sld,node){var xml=OpenLayers.Format.XML.prototype.write.apply(this,[node]);
sld.body=xml
},read_wmc_OnlineResource:function(obj,node){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")
},read_wmc_Name:function(obj,node){var name=this.getChildValue(node);
if(name){obj.name=name
}},read_wmc_Title:function(obj,node){var title=this.getChildValue(node);
if(title){obj.title=title
}},read_wmc_MetadataURL:function(layerContext,node){var metadataURL={};
var links=node.getElementsByTagName("OnlineResource");
if(links.length>0){this.read_wmc_OnlineResource(metadataURL,links[0])
}layerContext.metadataURL=metadataURL.href
},read_wmc_Abstract:function(obj,node){var abst=this.getChildValue(node);
if(abst){obj["abstract"]=abst
}},read_wmc_LegendURL:function(style,node){var legend={width:node.getAttribute("width"),height:node.getAttribute("height")};
var links=node.getElementsByTagName("OnlineResource");
if(links.length>0){this.read_wmc_OnlineResource(legend,links[0])
}style.legend=legend
},write:function(context,options){var root=this.createElementDefaultNS("ViewContext");
this.setAttributes(root,{version:this.VERSION,id:(options&&typeof options.id=="string")?options.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
root.appendChild(this.write_wmc_General(context));
root.appendChild(this.write_wmc_LayerList(context));
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},createElementDefaultNS:function(name,childValue,attributes){var node=this.createElementNS(this.namespaces[this.defaultPrefix],name);
if(childValue){node.appendChild(this.createTextNode(childValue))
}if(attributes){this.setAttributes(node,attributes)
}return node
},setAttributes:function(node,obj){var value;
for(var name in obj){value=obj[name].toString();
if(value.match(/[A-Z]/)){this.setAttributeNS(node,null,name,value)
}else{node.setAttribute(name,value)
}}},write_wmc_General:function(context){var node=this.createElementDefaultNS("General");
if(context.size){node.appendChild(this.createElementDefaultNS("Window",null,{width:context.size.w,height:context.size.h}))
}var bounds=context.bounds;
node.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18),SRS:context.projection}));
node.appendChild(this.createElementDefaultNS("Title",context.title));
node.appendChild(this.write_ol_MapExtension(context));
return node
},write_ol_MapExtension:function(context){var node=this.createElementDefaultNS("Extension");
var bounds=context.maxExtent;
if(bounds){var maxExtent=this.createElementNS(this.namespaces.ol,"ol:maxExtent");
this.setAttributes(maxExtent,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18)});
node.appendChild(maxExtent)
}return node
},write_wmc_LayerList:function(context){var list=this.createElementDefaultNS("LayerList");
for(var i=0,len=context.layersContext.length;
i<len;
++i){list.appendChild(this.write_wmc_Layer(context.layersContext[i]))
}return list
},write_wmc_Layer:function(context){var node=this.createElementDefaultNS("Layer",null,{queryable:context.queryable?"1":"0",hidden:context.visibility?"0":"1"});
node.appendChild(this.write_wmc_Server(context));
node.appendChild(this.createElementDefaultNS("Name",context.name));
node.appendChild(this.createElementDefaultNS("Title",context.title));
if(context.metadataURL){node.appendChild(this.write_wmc_MetadataURL(context.metadataURL))
}return node
},write_wmc_LayerExtension:function(context){var node=this.createElementDefaultNS("Extension");
var bounds=context.maxExtent;
var maxExtent=this.createElementNS(this.namespaces.ol,"ol:maxExtent");
this.setAttributes(maxExtent,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18)});
node.appendChild(maxExtent);
if(context.tileSize&&!context.singleTile){var size=this.createElementNS(this.namespaces.ol,"ol:tileSize");
this.setAttributes(size,context.tileSize);
node.appendChild(size)
}var properties=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];
var child;
for(var i=0,len=properties.length;
i<len;
++i){child=this.createOLPropertyNode(context,properties[i]);
if(child){node.appendChild(child)
}}return node
},createOLPropertyNode:function(obj,prop){var node=null;
if(obj[prop]!=null){node=this.createElementNS(this.namespaces.ol,"ol:"+prop);
node.appendChild(this.createTextNode(obj[prop].toString()))
}return node
},write_wmc_Server:function(context){var node=this.createElementDefaultNS("Server");
this.setAttributes(node,{service:"OGC:WMS",version:context.version});
node.appendChild(this.write_wmc_OnlineResource(context.url));
return node
},write_wmc_MetadataURL:function(metadataURL){var node=this.createElementDefaultNS("MetadataURL");
node.appendChild(this.write_wmc_OnlineResource(metadataURL));
return node
},write_wmc_FormatList:function(context){var node=this.createElementDefaultNS("FormatList");
for(var i=0,len=context.formats.length;
i<len;
i++){var format=context.formats[i];
node.appendChild(this.createElementDefaultNS("Format",format.value,(format.current&&format.current==true)?{current:"1"}:null))
}return node
},write_wmc_StyleList:function(layer){var node=this.createElementDefaultNS("StyleList");
var styles=layer.styles;
if(styles&&styles instanceof Array){var sld;
for(var i=0,len=styles.length;
i<len;
i++){var s=styles[i];
var style=this.createElementDefaultNS("Style",null,(s.current&&s.current==true)?{current:"1"}:null);
if(s.href){sld=this.createElementDefaultNS("SLD");
var link=this.write_wmc_OnlineResource(s.href);
sld.appendChild(link);
sld.appendChild(this.createElementDefaultNS("Name",s.name));
if(s.title){sld.appendChild(this.createElementDefaultNS("Title",s.title))
}style.appendChild(sld)
}else{if(s.body){sld=this.createElementDefaultNS("SLD");
var doc=OpenLayers.Format.XML.prototype.read.apply(this,[s.body]);
var imported=doc.documentElement;
if(sld.ownerDocument&&sld.ownerDocument.importNode){imported=sld.ownerDocument.importNode(imported,true)
}sld.appendChild(imported);
sld.appendChild(this.createElementDefaultNS("Name",s.name));
if(s.title){sld.appendChild(this.createElementDefaultNS("Title",s.title))
}style.appendChild(sld)
}else{style.appendChild(this.createElementDefaultNS("Name",s.name));
style.appendChild(this.createElementDefaultNS("Title",s.title));
if(s["abstract"]){style.appendChild(this.createElementDefaultNS("Abstract",s["abstract"]))
}}}node.appendChild(style)
}}return node
},write_wmc_OnlineResource:function(href){var node=this.createElementDefaultNS("OnlineResource");
this.setAttributeNS(node,this.namespaces.xlink,"xlink:type","simple");
this.setAttributeNS(node,this.namespaces.xlink,"xlink:href",href);
return node
},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(options){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[options])
},write_wmc_Layer:function(context){var node=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[context]);
node.appendChild(this.write_wmc_FormatList(context));
node.appendChild(this.write_wmc_StyleList(context));
node.appendChild(this.write_wmc_LayerExtension(context))
},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(options){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[options])
},read_sld_MinScaleDenominator:function(layerContext,node){var minScaleDenominator=parseFloat(this.getChildValue(node));
if(minScaleDenominator>0){layerContext.maxScale=minScaleDenominator
}},read_sld_MaxScaleDenominator:function(layerContext,node){layerContext.minScale=parseFloat(this.getChildValue(node))
},write_wmc_Layer:function(context){var node=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[context]);
if(context.maxScale){var minSD=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");
minSD.appendChild(this.createTextNode(context.maxScale.toPrecision(16)));
node.appendChild(minSD)
}if(context.minScale){var maxSD=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");
maxSD.appendChild(this.createTextNode(context.minScale.toPrecision(16)));
node.appendChild(maxSD)
}node.appendChild(this.write_wmc_FormatList(context));
node.appendChild(this.write_wmc_StyleList(context));
node.appendChild(this.write_wmc_LayerExtension(context));
return node
},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(options){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};
OpenLayers.Format.prototype.initialize.apply(this,[options])
},read:function(wkt){var features,type,str;
var matches=this.regExes.typeStr.exec(wkt);
if(matches){type=matches[1].toLowerCase();
str=matches[2];
if(this.parse[type]){features=this.parse[type].apply(this,[str])
}if(this.internalProjection&&this.externalProjection){if(features&&features.CLASS_NAME=="OpenLayers.Feature.Vector"){features.geometry.transform(this.externalProjection,this.internalProjection)
}else{if(features&&type!="geometrycollection"&&typeof features=="object"){for(var i=0,len=features.length;
i<len;
i++){var component=features[i];
component.geometry.transform(this.externalProjection,this.internalProjection)
}}}}}return features
},write:function(features){var collection,geometry,type,data,isCollection;
if(features.constructor==Array){collection=features;
isCollection=true
}else{collection=[features];
isCollection=false
}var pieces=[];
if(isCollection){pieces.push("GEOMETRYCOLLECTION(")
}for(var i=0,len=collection.length;
i<len;
++i){if(isCollection&&i>0){pieces.push(",")
}geometry=collection[i].geometry;
type=geometry.CLASS_NAME.split(".")[2].toLowerCase();
if(!this.extract[type]){return null
}if(this.internalProjection&&this.externalProjection){geometry=geometry.clone();
geometry.transform(this.internalProjection,this.externalProjection)
}data=this.extract[type].apply(this,[geometry]);
pieces.push(type.toUpperCase()+"("+data+")")
}if(isCollection){pieces.push(")")
}return pieces.join("")
},extract:{point:function(point){return point.x+" "+point.y
},multipoint:function(multipoint){var array=[];
for(var i=0,len=multipoint.components.length;
i<len;
++i){array.push("("+this.extract.point.apply(this,[multipoint.components[i]])+")")
}return array.join(",")
},linestring:function(linestring){var array=[];
for(var i=0,len=linestring.components.length;
i<len;
++i){array.push(this.extract.point.apply(this,[linestring.components[i]]))
}return array.join(",")
},multilinestring:function(multilinestring){var array=[];
for(var i=0,len=multilinestring.components.length;
i<len;
++i){array.push("("+this.extract.linestring.apply(this,[multilinestring.components[i]])+")")
}return array.join(",")
},polygon:function(polygon){var array=[];
for(var i=0,len=polygon.components.length;
i<len;
++i){array.push("("+this.extract.linestring.apply(this,[polygon.components[i]])+")")
}return array.join(",")
},multipolygon:function(multipolygon){var array=[];
for(var i=0,len=multipolygon.components.length;
i<len;
++i){array.push("("+this.extract.polygon.apply(this,[multipolygon.components[i]])+")")
}return array.join(",")
}},parse:{point:function(str){var coords=OpenLayers.String.trim(str).split(this.regExes.spaces);
return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(coords[0],coords[1]))
},multipoint:function(str){var point;
var points=OpenLayers.String.trim(str).split(this.regExes.parenComma);
var components=[];
for(var i=0,len=points.length;
i<len;
++i){point=points[i].replace(this.regExes.trimParens,"$1");
components.push(this.parse.point.apply(this,[point]).geometry)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(components))
},linestring:function(str){var points=OpenLayers.String.trim(str).split(",");
var components=[];
for(var i=0,len=points.length;
i<len;
++i){components.push(this.parse.point.apply(this,[points[i]]).geometry)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(components))
},multilinestring:function(str){var line;
var lines=OpenLayers.String.trim(str).split(this.regExes.parenComma);
var components=[];
for(var i=0,len=lines.length;
i<len;
++i){line=lines[i].replace(this.regExes.trimParens,"$1");
components.push(this.parse.linestring.apply(this,[line]).geometry)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(components))
},polygon:function(str){var ring,linestring,linearring;
var rings=OpenLayers.String.trim(str).split(this.regExes.parenComma);
var components=[];
for(var i=0,len=rings.length;
i<len;
++i){ring=rings[i].replace(this.regExes.trimParens,"$1");
linestring=this.parse.linestring.apply(this,[ring]).geometry;
linearring=new OpenLayers.Geometry.LinearRing(linestring.components);
components.push(linearring)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(components))
},multipolygon:function(str){var polygon;
var polygons=OpenLayers.String.trim(str).split(this.regExes.doubleParenComma);
var components=[];
for(var i=0,len=polygons.length;
i<len;
++i){polygon=polygons[i].replace(this.regExes.trimParens,"$1");
components.push(this.parse.polygon.apply(this,[polygon]).geometry)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(components))
},geometrycollection:function(str){str=str.replace(/,\s*([A-Za-z])/g,"|$1");
var wktArray=OpenLayers.String.trim(str).split("|");
var components=[];
for(var i=0,len=wktArray.length;
i<len;
++i){components.push(OpenLayers.Format.WKT.prototype.read.apply(this,[wktArray[i]]))
}return components
}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,arguments);
OpenLayers.Util.extend(this,options);
this.options=options
},read:function(data){var result;
if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
if(root){var scope=this;
var read=this["read_"+root.nodeName];
if(read){result=read.call(this,root)
}else{result=new OpenLayers.Format.GML((this.options?this.options:{})).read(data)
}}else{result=data
}return result
},read_msGMLOutput:function(data){var response=[];
var layerNodes=this.getSiblingNodesByTagCriteria(data,this.layerIdentifier);
if(layerNodes){for(var i=0,len=layerNodes.length;
i<len;
++i){var node=layerNodes[i];
var layerName=node.nodeName;
if(node.prefix){layerName=layerName.split(":")[1]
}var layerName=layerName.replace(this.layerIdentifier,"");
var featureNodes=this.getSiblingNodesByTagCriteria(node,this.featureIdentifier);
if(featureNodes){for(var j=0;
j<featureNodes.length;
j++){var featureNode=featureNodes[j];
var geomInfo=this.parseGeometry(featureNode);
var attributes=this.parseAttributes(featureNode);
var feature=new OpenLayers.Feature.Vector(geomInfo.geometry,attributes,null);
feature.bounds=geomInfo.bounds;
feature.type=layerName;
response.push(feature)
}}}}return response
},read_FeatureInfoResponse:function(data){var response=[];
var featureNodes=this.getElementsByTagNameNS(data,"*","FIELDS");
for(var i=0,len=featureNodes.length;
i<len;
i++){var featureNode=featureNodes[i];
var geom=null;
var attributes={};
for(var j=0,jlen=featureNode.attributes.length;
j<jlen;
j++){var attribute=featureNode.attributes[j];
attributes[attribute.nodeName]=attribute.nodeValue
}response.push(new OpenLayers.Feature.Vector(geom,attributes,null))
}return response
},getSiblingNodesByTagCriteria:function(node,criteria){var nodes=[];
var children,tagName,n,matchNodes,child;
if(node&&node.hasChildNodes()){children=node.childNodes;
n=children.length;
for(var k=0;
k<n;
k++){child=children[k];
while(child&&child.nodeType!=1){child=child.nextSibling;
k++
}tagName=(child?child.nodeName:"");
if(tagName.length>0&&tagName.indexOf(criteria)>-1){nodes.push(child)
}else{matchNodes=this.getSiblingNodesByTagCriteria(child,criteria);
if(matchNodes.length>0){(nodes.length==0)?nodes=matchNodes:nodes.push(matchNodes)
}}}}return nodes
},parseAttributes:function(node){var attributes={};
if(node.nodeType==1){var children=node.childNodes;
var n=children.length;
for(var i=0;
i<n;
++i){var child=children[i];
if(child.nodeType==1){var grandchildren=child.childNodes;
if(grandchildren.length==1){var grandchild=grandchildren[0];
if(grandchild.nodeType==3||grandchild.nodeType==4){var name=(child.prefix)?child.nodeName.split(":")[1]:child.nodeName;
var value=grandchild.nodeValue.replace(this.regExes.trimSpace,"");
attributes[name]=value
}}}}}return attributes
},parseGeometry:function(node){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML()
}var feature=this.gmlFormat.parseFeature(node);
var geometry,bounds=null;
if(feature){geometry=feature.geometry&&feature.geometry.clone();
bounds=feature.bounds&&feature.bounds.clone();
feature.destroy()
}return{geometry:geometry,bounds:bounds}
},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){this.id=null;
this.bounds=null
},clone:function(){return new OpenLayers.Geometry()
},setBounds:function(bounds){if(bounds){this.bounds=bounds.clone()
}},clearBounds:function(){this.bounds=null;
if(this.parent){this.parent.clearBounds()
}},extendBounds:function(newBounds){var bounds=this.getBounds();
if(!bounds){this.setBounds(newBounds)
}else{this.bounds.extend(newBounds)
}},getBounds:function(){if(this.bounds==null){this.calculateBounds()
}return this.bounds
},calculateBounds:function(){},distanceTo:function(geometry,options){},getVertices:function(nodes){},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=false;
var bounds=this.getBounds();
if((bounds!=null)&&(lonlat!=null)){var dX=(toleranceLon!=null)?toleranceLon:0;
var dY=(toleranceLat!=null)?toleranceLat:0;
var toleranceBounds=new OpenLayers.Bounds(this.bounds.left-dX,this.bounds.bottom-dY,this.bounds.right+dX,this.bounds.top+dY);
atPoint=toleranceBounds.containsLonLat(lonlat)
}return atPoint
},getLength:function(){return 0
},getArea:function(){return 0
},getCentroid:function(){return null
},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))
},CLASS_NAME:"OpenLayers.Geometry"});
OpenLayers.Geometry.fromWKT=function(wkt){var format=arguments.callee.format;
if(!format){format=new OpenLayers.Format.WKT();
arguments.callee.format=format
}var geom;
var result=format.read(wkt);
if(result instanceof OpenLayers.Feature.Vector){geom=result.geometry
}else{if(result instanceof Array){var len=result.length;
var components=new Array(len);
for(var i=0;
i<len;
++i){components[i]=result[i].geometry
}geom=new OpenLayers.Geometry.Collection(components)
}}return geom
};
OpenLayers.Geometry.segmentsIntersect=function(seg1,seg2,options){var point=options&&options.point;
var tolerance=options&&options.tolerance;
var intersection=false;
var x11_21=seg1.x1-seg2.x1;
var y11_21=seg1.y1-seg2.y1;
var x12_11=seg1.x2-seg1.x1;
var y12_11=seg1.y2-seg1.y1;
var y22_21=seg2.y2-seg2.y1;
var x22_21=seg2.x2-seg2.x1;
var d=(y22_21*x12_11)-(x22_21*y12_11);
var n1=(x22_21*y11_21)-(y22_21*x11_21);
var n2=(x12_11*y11_21)-(y12_11*x11_21);
if(d==0){if(n1==0&&n2==0){intersection=true
}}else{var along1=n1/d;
var along2=n2/d;
if(along1>=0&&along1<=1&&along2>=0&&along2<=1){if(!point){intersection=true
}else{var x=seg1.x1+(along1*x12_11);
var y=seg1.y1+(along1*y12_11);
intersection=new OpenLayers.Geometry.Point(x,y)
}}}if(tolerance){var dist;
if(intersection){if(point){var segs=[seg1,seg2];
var seg,x,y;
outer:for(var i=0;
i<2;
++i){seg=segs[i];
for(var j=1;
j<3;
++j){x=seg["x"+j];
y=seg["y"+j];
dist=Math.sqrt(Math.pow(x-intersection.x,2)+Math.pow(y-intersection.y,2));
if(dist<tolerance){intersection.x=x;
intersection.y=y;
break outer
}}}}}else{var segs=[seg1,seg2];
var source,target,x,y,p,result;
outer:for(var i=0;
i<2;
++i){source=segs[i];
target=segs[(i+1)%2];
for(var j=1;
j<3;
++j){p={x:source["x"+j],y:source["y"+j]};
result=OpenLayers.Geometry.distanceToSegment(p,target);
if(result.distance<tolerance){if(point){intersection=new OpenLayers.Geometry.Point(p.x,p.y)
}else{intersection=true
}break outer
}}}}}return intersection
};
OpenLayers.Geometry.distanceToSegment=function(point,segment){var x0=point.x;
var y0=point.y;
var x1=segment.x1;
var y1=segment.y1;
var x2=segment.x2;
var y2=segment.y2;
var dx=x2-x1;
var dy=y2-y1;
var along=((dx*(x0-x1))+(dy*(y0-y1)))/(Math.pow(dx,2)+Math.pow(dy,2));
var x,y;
if(along<=0){x=x1;
y=y1
}else{if(along>=1){x=x2;
y=y2
}else{x=x1+along*dx;
y=y1+along*dy
}}return{distance:Math.sqrt(Math.pow(x-x0,2)+Math.pow(y-y0,2)),x:x,y:y}
};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(options){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");
OpenLayers.Util.extend(this,options);
this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);
if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)
}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)
}this.events.destroy();
this.events=null
}this.eventListeners=null;
if(this.handler){this.handler.destroy();
this.handler=null
}if(this.handlers){for(var key in this.handlers){if(this.handlers.hasOwnProperty(key)&&typeof this.handlers[key].destroy=="function"){this.handlers[key].destroy()
}}this.handlers=null
}if(this.map){this.map.removeControl(this);
this.map=null
}},setMap:function(map){this.map=map;
if(this.handler){this.handler.setMap(map)
}},draw:function(px){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);
this.div.className=this.displayClass;
if(!this.allowSelection){this.div.className+=" olControlNoSelect";
this.div.setAttribute("unselectable","on",0);
this.div.onselectstart=OpenLayers.Function.False
}if(this.title!=""){this.div.title=this.title
}}if(px!=null){this.position=px.clone()
}this.moveTo(this.position);
return this.div
},moveTo:function(px){if((px!=null)&&(this.div!=null)){this.div.style.left=px.x+"px";
this.div.style.top=px.y+"px"
}},activate:function(){if(this.active){return false
}if(this.handler){this.handler.activate()
}this.active=true;
if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")
}this.events.triggerEvent("activate");
return true
},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()
}this.active=false;
if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")
}this.events.triggerEvent("deactivate");
return true
}return false
},CLASS_NAME:"OpenLayers.Control"});
OpenLayers.Control.TYPE_BUTTON=1;
OpenLayers.Control.TYPE_TOGGLE=2;
OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(options){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);
OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);
this.removeButtons();
this.buttons=null;
this.position=null
},draw:function(px){OpenLayers.Control.prototype.draw.apply(this,arguments);
px=this.position;
this.buttons=[];
var sz=new OpenLayers.Size(18,18);
var centered=new OpenLayers.Pixel(px.x+sz.w/2,px.y);
this._addButton("panup","north-mini.png",centered,sz);
px.y=centered.y+sz.h;
this._addButton("panleft","west-mini.png",px,sz);
this._addButton("panright","east-mini.png",px.add(sz.w,0),sz);
this._addButton("pandown","south-mini.png",centered.add(0,sz.h*2),sz);
this._addButton("zoomin","zoom-plus-mini.png",centered.add(0,sz.h*3+5),sz);
this._addButton("zoomworld","zoom-world-mini.png",centered.add(0,sz.h*4+5),sz);
this._addButton("zoomout","zoom-minus-mini.png",centered.add(0,sz.h*5+5),sz);
return this.div
},_addButton:function(id,img,xy,sz){var imgLocation=OpenLayers.Util.getImagesLocation()+img;
var btn=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+id,xy,sz,imgLocation,"absolute");
this.div.appendChild(btn);
OpenLayers.Event.observe(btn,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,btn));
OpenLayers.Event.observe(btn,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,btn));
OpenLayers.Event.observe(btn,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,btn));
btn.action=id;
btn.map=this.map;
if(!this.slideRatio){var slideFactorPixels=this.slideFactor;
var getSlideFactor=function(){return slideFactorPixels
}
}else{var slideRatio=this.slideRatio;
var getSlideFactor=function(dim){return this.map.getSize()[dim]*slideRatio
}
}btn.getSlideFactor=getSlideFactor;
this.buttons.push(btn);
return btn
},_removeButton:function(btn){OpenLayers.Event.stopObservingElement(btn);
btn.map=null;
btn.getSlideFactor=null;
this.div.removeChild(btn);
OpenLayers.Util.removeItem(this.buttons,btn)
},removeButtons:function(){for(var i=this.buttons.length-1;
i>=0;
--i){this._removeButton(this.buttons[i])
}},doubleClick:function(evt){OpenLayers.Event.stop(evt);
return false
},buttonDown:function(evt){if(!OpenLayers.Event.isLeftClick(evt)){return
}switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));
break;
case"pandown":this.map.pan(0,this.getSlideFactor("h"));
break;
case"panleft":this.map.pan(-this.getSlideFactor("w"),0);
break;
case"panright":this.map.pan(this.getSlideFactor("w"),0);
break;
case"zoomin":this.map.zoomIn();
break;
case"zoomout":this.map.zoomOut();
break;
case"zoomworld":this.map.zoomToMaxExtent();
break
}OpenLayers.Event.stop(evt)
},CLASS_NAME:"OpenLayers.Control.PanZoom"});
OpenLayers.Control.PanZoom.X=4;
OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:false,forceFixedZoomLevel:false,mouseDragStart:null,zoomStart:null,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments)
},destroy:function(){this._removeZoomBar();
this.map.events.un({changebaselayer:this.redraw,scope:this});
OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);
delete this.mouseDragStart;
delete this.zoomStart
},setMap:function(map){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);
this.map.events.register("changebaselayer",this,this.redraw)
},redraw:function(){if(this.div!=null){this.removeButtons();
this._removeZoomBar()
}this.draw()
},draw:function(px){OpenLayers.Control.prototype.draw.apply(this,arguments);
px=this.position.clone();
this.buttons=[];
var sz=new OpenLayers.Size(18,18);
var centered=new OpenLayers.Pixel(px.x+sz.w/2,px.y);
var wposition=sz.w;
if(this.zoomWorldIcon){centered=new OpenLayers.Pixel(px.x+sz.w,px.y)
}this._addButton("panup","north-mini.png",centered,sz);
px.y=centered.y+sz.h;
this._addButton("panleft","west-mini.png",px,sz);
if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",px.add(sz.w,0),sz);
wposition*=2
}this._addButton("panright","east-mini.png",px.add(wposition,0),sz);
this._addButton("pandown","south-mini.png",centered.add(0,sz.h*2),sz);
this._addButton("zoomin","zoom-plus-mini.png",centered.add(0,sz.h*3+5),sz);
centered=this._addZoomBar(centered.add(0,sz.h*4+5));
this._addButton("zoomout","zoom-minus-mini.png",centered,sz);
return this.div
},_addZoomBar:function(centered){var imgLocation=OpenLayers.Util.getImagesLocation();
var id=this.id+"_"+this.map.id;
var zoomsToEnd=this.map.getNumZoomLevels()-1-this.map.getZoom();
var slider=OpenLayers.Util.createAlphaImageDiv(id,centered.add(-1,zoomsToEnd*this.zoomStopHeight),new OpenLayers.Size(20,9),imgLocation+"slider.png","absolute");
this.slider=slider;
this.sliderEvents=new OpenLayers.Events(this,slider,null,true,{includeXY:true});
this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});
var sz=new OpenLayers.Size();
sz.h=this.zoomStopHeight*this.map.getNumZoomLevels();
sz.w=this.zoomStopWidth;
var div=null;
if(OpenLayers.Util.alphaHack()){var id=this.id+"_"+this.map.id;
div=OpenLayers.Util.createAlphaImageDiv(id,centered,new OpenLayers.Size(sz.w,this.zoomStopHeight),imgLocation+"zoombar.png","absolute",null,"crop");
div.style.height=sz.h+"px"
}else{div=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,centered,sz,imgLocation+"zoombar.png")
}this.zoombarDiv=div;
this.divEvents=new OpenLayers.Events(this,div,null,true,{includeXY:true});
this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});
this.div.appendChild(div);
this.startTop=parseInt(div.style.top);
this.div.appendChild(slider);
this.map.events.register("zoomend",this,this.moveZoomBar);
centered=centered.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());
return centered
},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});
this.sliderEvents.destroy();
this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});
this.divEvents.destroy();
this.div.removeChild(this.zoombarDiv);
this.zoombarDiv=null;
this.div.removeChild(this.slider);
this.slider=null;
this.map.events.unregister("zoomend",this,this.moveZoomBar)
},passEventToSlider:function(evt){this.sliderEvents.handleBrowserEvent(evt)
},divClick:function(evt){if(!OpenLayers.Event.isLeftClick(evt)){return
}var y=evt.xy.y;
var top=OpenLayers.Util.pagePosition(evt.object)[1];
var levels=(y-top)/this.zoomStopHeight;
if(this.forceFixedZoomLevel||!this.map.fractionalZoom){levels=Math.floor(levels)
}var zoom=(this.map.getNumZoomLevels()-1)-levels;
zoom=Math.min(Math.max(zoom,0),this.map.getNumZoomLevels()-1);
this.map.zoomTo(zoom);
OpenLayers.Event.stop(evt)
},zoomBarDown:function(evt){if(!OpenLayers.Event.isLeftClick(evt)){return
}this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});
this.mouseDragStart=evt.xy.clone();
this.zoomStart=evt.xy.clone();
this.div.style.cursor="move";
this.zoombarDiv.offsets=null;
OpenLayers.Event.stop(evt)
},zoomBarDrag:function(evt){if(this.mouseDragStart!=null){var deltaY=this.mouseDragStart.y-evt.xy.y;
var offsets=OpenLayers.Util.pagePosition(this.zoombarDiv);
if((evt.clientY-offsets[1])>0&&(evt.clientY-offsets[1])<parseInt(this.zoombarDiv.style.height)-2){var newTop=parseInt(this.slider.style.top)-deltaY;
this.slider.style.top=newTop+"px";
this.mouseDragStart=evt.xy.clone()
}OpenLayers.Event.stop(evt)
}},zoomBarUp:function(evt){if(!OpenLayers.Event.isLeftClick(evt)){return
}if(this.mouseDragStart){this.div.style.cursor="";
this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});
var deltaY=this.zoomStart.y-evt.xy.y;
var zoomLevel=this.map.zoom;
if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){zoomLevel+=deltaY/this.zoomStopHeight;
zoomLevel=Math.min(Math.max(zoomLevel,0),this.map.getNumZoomLevels()-1)
}else{zoomLevel+=Math.round(deltaY/this.zoomStopHeight)
}this.map.zoomTo(zoomLevel);
this.mouseDragStart=null;
this.zoomStart=null;
OpenLayers.Event.stop(evt)
}},moveZoomBar:function(){var newTop=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;
this.slider.style.top=newTop+"px"
},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(easing){this.easing=(easing)?easing:OpenLayers.Easing.Expo.easeOut
},start:function(begin,finish,duration,options){this.playing=true;
this.begin=begin;
this.finish=finish;
this.duration=duration;
this.callbacks=options.callbacks;
this.time=0;
if(this.interval){window.clearInterval(this.interval);
this.interval=null
}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)
}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)
},stop:function(){if(!this.playing){return
}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)
}window.clearInterval(this.interval);
this.interval=null;
this.playing=false
},play:function(){var value={};
for(var i in this.begin){var b=this.begin[i];
var f=this.finish[i];
if(b==null||f==null||isNaN(b)||isNaN(f)){OpenLayers.Console.error("invalid value for Tween")
}var c=f-b;
value[i]=this.easing.apply(this,[this.time,b,c,this.duration])
}this.time++;
if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,value)
}if(this.time>this.duration){this.stop()
}},CLASS_NAME:"OpenLayers.Tween"});
OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};
OpenLayers.Easing.Linear={easeIn:function(t,b,c,d){return c*t/d+b
},easeOut:function(t,b,c,d){return c*t/d+b
},easeInOut:function(t,b,c,d){return c*t/d+b
},CLASS_NAME:"OpenLayers.Easing.Linear"};
OpenLayers.Easing.Expo={easeIn:function(t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b
},easeOut:function(t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b
},easeInOut:function(t,b,c,d){if(t==0){return b
}if(t==d){return b+c
}if((t/=d/2)<1){return c/2*Math.pow(2,10*(t-1))+b
}return c/2*(-Math.pow(2,-10*--t)+2)+b
},CLASS_NAME:"OpenLayers.Easing.Expo"};
OpenLayers.Easing.Quad={easeIn:function(t,b,c,d){return c*(t/=d)*t+b
},easeOut:function(t,b,c,d){return -c*(t/=d)*(t-2)+b
},easeInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b
}return -c/2*((--t)*(t-2)-1)+b
},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,initialize:function(div,options){if(arguments.length===1&&typeof div==="object"){options=div;
div=options&&options.div
}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);
this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);
this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);
this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";
OpenLayers.Util.extend(this,options);
this.layers=[];
this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");
this.div=OpenLayers.Util.getElement(div);
if(!this.div){this.div=document.createElement("div");
this.div.style.height="1px";
this.div.style.width="1px"
}OpenLayers.Element.addClass(this.div,"olMap");
var id=this.id+"_OpenLayers_ViewPort";
this.viewPortDiv=OpenLayers.Util.createDiv(id,null,null,null,"relative",null,"hidden");
this.viewPortDiv.style.width="100%";
this.viewPortDiv.style.height="100%";
this.viewPortDiv.className="olMapViewport";
this.div.appendChild(this.viewPortDiv);
id=this.id+"_OpenLayers_Container";
this.layerContainerDiv=OpenLayers.Util.createDiv(id);
this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;
this.viewPortDiv.appendChild(this.layerContainerDiv);
this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});
this.updateSize();
if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)
}this.events.register("movestart",this,this.updateSize);
if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)
}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);
OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)
}if(this.theme){var addNode=true;
var nodes=document.getElementsByTagName("link");
for(var i=0,len=nodes.length;
i<len;
++i){if(OpenLayers.Util.isEquivalentUrl(nodes.item(i).href,this.theme)){addNode=false;
break
}}if(addNode){var cssNode=document.createElement("link");
cssNode.setAttribute("rel","stylesheet");
cssNode.setAttribute("type","text/css");
cssNode.setAttribute("href",this.theme);
document.getElementsByTagName("head")[0].appendChild(cssNode)
}}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]
}else{this.controls=[]
}}for(var i=0,len=this.controls.length;
i<len;
i++){this.addControlToMap(this.controls[i])
}this.popups=[];
this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);
OpenLayers.Event.observe(window,"unload",this.unloadDestroy);
if(options&&options.layers){this.addLayers(options.layers);
if(options.center){this.setCenter(options.center,options.zoom)
}}},render:function(div){this.div=OpenLayers.Util.getElement(div);
OpenLayers.Element.addClass(this.div,"olMap");
this.events.attachToElement(this.div);
this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);
this.div.appendChild(this.viewPortDiv);
this.updateSize()
},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false
}if(this.panTween){this.panTween.stop();
this.panTween=null
}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);
this.unloadDestroy=null;
if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)
}else{this.events.unregister("resize",this,this.updateSize)
}this.paddingForPopups=null;
if(this.controls!=null){for(var i=this.controls.length-1;
i>=0;
--i){this.controls[i].destroy()
}this.controls=null
}if(this.layers!=null){for(var i=this.layers.length-1;
i>=0;
--i){this.layers[i].destroy(false)
}this.layers=null
}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)
}this.viewPortDiv=null;
if(this.eventListeners){this.events.un(this.eventListeners);
this.eventListeners=null
}this.events.destroy();
this.events=null
},setOptions:function(options){OpenLayers.Util.extend(this,options)
},getTileSize:function(){return this.tileSize
},getBy:function(array,property,match){var test=(typeof match.test=="function");
var found=OpenLayers.Array.filter(this[array],function(item){return item[property]==match||(test&&match.test(item[property]))
});
return found
},getLayersBy:function(property,match){return this.getBy("layers",property,match)
},getLayersByName:function(match){return this.getLayersBy("name",match)
},getLayersByClass:function(match){return this.getLayersBy("CLASS_NAME",match)
},getControlsBy:function(property,match){return this.getBy("controls",property,match)
},getControlsByClass:function(match){return this.getControlsBy("CLASS_NAME",match)
},getLayer:function(id){var foundLayer=null;
for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.layers[i];
if(layer.id==id){foundLayer=layer;
break
}}return foundLayer
},setLayerZIndex:function(layer,zIdx){layer.setZIndex(this.Z_INDEX_BASE[layer.isBaseLayer?"BaseLayer":"Overlay"]+zIdx*5)
},resetLayersZIndex:function(){for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.layers[i];
this.setLayerZIndex(layer,i)
}},addLayer:function(layer){for(var i=0,len=this.layers.length;
i<len;
i++){if(this.layers[i]==layer){var msg=OpenLayers.i18n("layerAlreadyAdded",{layerName:layer.name});
OpenLayers.Console.warn(msg);
return false
}}if(this.allOverlays){layer.isBaseLayer=false
}if(this.events.triggerEvent("preaddlayer",{layer:layer})===false){return
}layer.div.className="olLayerDiv";
layer.div.style.overflow="";
this.setLayerZIndex(layer,this.layers.length);
if(layer.isFixed){this.viewPortDiv.appendChild(layer.div)
}else{this.layerContainerDiv.appendChild(layer.div)
}this.layers.push(layer);
layer.setMap(this);
if(layer.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(layer)
}else{layer.setVisibility(false)
}}else{layer.redraw()
}this.events.triggerEvent("addlayer",{layer:layer});
layer.afterAdd()
},addLayers:function(layers){for(var i=0,len=layers.length;
i<len;
i++){this.addLayer(layers[i])
}},removeLayer:function(layer,setNewBaseLayer){if(setNewBaseLayer==null){setNewBaseLayer=true
}if(layer.isFixed){this.viewPortDiv.removeChild(layer.div)
}else{this.layerContainerDiv.removeChild(layer.div)
}OpenLayers.Util.removeItem(this.layers,layer);
layer.removeMap(this);
layer.map=null;
if(this.baseLayer==layer){this.baseLayer=null;
if(setNewBaseLayer){for(var i=0,len=this.layers.length;
i<len;
i++){var iLayer=this.layers[i];
if(iLayer.isBaseLayer||this.allOverlays){this.setBaseLayer(iLayer);
break
}}}}this.resetLayersZIndex();
this.events.triggerEvent("removelayer",{layer:layer})
},getNumLayers:function(){return this.layers.length
},getLayerIndex:function(layer){return OpenLayers.Util.indexOf(this.layers,layer)
},setLayerIndex:function(layer,idx){var base=this.getLayerIndex(layer);
if(idx<0){idx=0
}else{if(idx>this.layers.length){idx=this.layers.length
}}if(base!=idx){this.layers.splice(base,1);
this.layers.splice(idx,0,layer);
for(var i=0,len=this.layers.length;
i<len;
i++){this.setLayerZIndex(this.layers[i],i)
}this.events.triggerEvent("changelayer",{layer:layer,property:"order"});
if(this.allOverlays){if(idx===0){this.setBaseLayer(layer)
}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])
}}}}},raiseLayer:function(layer,delta){var idx=this.getLayerIndex(layer)+delta;
this.setLayerIndex(layer,idx)
},setBaseLayer:function(newBaseLayer){if(newBaseLayer!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,newBaseLayer)!=-1){var center=this.getCenter();
var newResolution=OpenLayers.Util.getResolutionFromScale(this.getScale(),newBaseLayer.units);
if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)
}this.baseLayer=newBaseLayer;
this.viewRequestID++;
if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true)
}if(center!=null){var newZoom=this.getZoomForResolution(newResolution||this.resolution,true);
this.setCenter(center,newZoom,false,true)
}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})
}}},addControl:function(control,px){this.controls.push(control);
this.addControlToMap(control,px)
},addControls:function(controls,pixels){var pxs=(arguments.length===1)?[]:pixels;
for(var i=0,len=controls.length;
i<len;
i++){var ctrl=controls[i];
var px=(pxs[i])?pxs[i]:null;
this.addControl(ctrl,px)
}},addControlToMap:function(control,px){control.outsideViewport=(control.div!=null);
if(this.displayProjection&&!control.displayProjection){control.displayProjection=this.displayProjection
}control.setMap(this);
var div=control.draw(px);
if(div){if(!control.outsideViewport){div.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;
this.viewPortDiv.appendChild(div)
}}if(control.autoActivate){control.activate()
}},getControl:function(id){var returnControl=null;
for(var i=0,len=this.controls.length;
i<len;
i++){var control=this.controls[i];
if(control.id==id){returnControl=control;
break
}}return returnControl
},removeControl:function(control){if((control)&&(control==this.getControl(control.id))){if(control.div&&(control.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(control.div)
}OpenLayers.Util.removeItem(this.controls,control)
}},addPopup:function(popup,exclusive){if(exclusive){for(var i=this.popups.length-1;
i>=0;
--i){this.removePopup(this.popups[i])
}}popup.map=this;
this.popups.push(popup);
var popupDiv=popup.draw();
if(popupDiv){popupDiv.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;
this.layerContainerDiv.appendChild(popupDiv)
}},removePopup:function(popup){OpenLayers.Util.removeItem(this.popups,popup);
if(popup.div){try{this.layerContainerDiv.removeChild(popup.div)
}catch(e){}}popup.map=null
},getSize:function(){var size=null;
if(this.size!=null){size=this.size.clone()
}return size
},updateSize:function(){var newSize=this.getCurrentSize();
if(newSize&&!isNaN(newSize.h)&&!isNaN(newSize.w)){this.events.clearMouseCache();
var oldSize=this.getSize();
if(oldSize==null){this.size=oldSize=newSize
}if(!newSize.equals(oldSize)){this.size=newSize;
for(var i=0,len=this.layers.length;
i<len;
i++){this.layers[i].onMapResize()
}var center=this.getCenter();
if(this.baseLayer!=null&&center!=null){var zoom=this.getZoom();
this.zoom=null;
this.setCenter(center,zoom)
}}}},getCurrentSize:function(){var size=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);
if(size.w==0&&size.h==0||isNaN(size.w)&&isNaN(size.h)){size.w=this.div.offsetWidth;
size.h=this.div.offsetHeight
}if(size.w==0&&size.h==0||isNaN(size.w)&&isNaN(size.h)){size.w=parseInt(this.div.style.width);
size.h=parseInt(this.div.style.height)
}return size
},calculateBounds:function(center,resolution){var extent=null;
if(center==null){center=this.getCenter()
}if(resolution==null){resolution=this.getResolution()
}if((center!=null)&&(resolution!=null)){var size=this.getSize();
var w_deg=size.w*resolution;
var h_deg=size.h*resolution;
extent=new OpenLayers.Bounds(center.lon-w_deg/2,center.lat-h_deg/2,center.lon+w_deg/2,center.lat+h_deg/2)
}return extent
},getCenter:function(){var center=null;
if(this.center){center=this.center.clone()
}return center
},getZoom:function(){return this.zoom
},pan:function(dx,dy,options){options=OpenLayers.Util.applyDefaults(options,{animate:true,dragging:false});
var centerPx=this.getViewPortPxFromLonLat(this.getCenter());
var newCenterPx=centerPx.add(dx,dy);
if(!options.dragging||!newCenterPx.equals(centerPx)){var newCenterLonLat=this.getLonLatFromViewPortPx(newCenterPx);
if(options.animate){this.panTo(newCenterLonLat)
}else{this.setCenter(newCenterLonLat,null,options.dragging)
}}},panTo:function(lonlat){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(lonlat)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod)
}var center=this.getCenter();
if(lonlat.lon==center.lon&&lonlat.lat==center.lat){return
}var from={lon:center.lon,lat:center.lat};
var to={lon:lonlat.lon,lat:lonlat.lat};
this.panTween.start(from,to,this.panDuration,{callbacks:{start:OpenLayers.Function.bind(function(lonlat){this.events.triggerEvent("movestart")
},this),eachStep:OpenLayers.Function.bind(function(lonlat){lonlat=new OpenLayers.LonLat(lonlat.lon,lonlat.lat);
this.moveTo(lonlat,this.zoom,{dragging:true,noEvent:true})
},this),done:OpenLayers.Function.bind(function(lonlat){lonlat=new OpenLayers.LonLat(lonlat.lon,lonlat.lat);
this.moveTo(lonlat,this.zoom,{noEvent:true});
this.events.triggerEvent("moveend")
},this)}})
}else{this.setCenter(lonlat)
}},setCenter:function(lonlat,zoom,dragging,forceZoomChange){this.moveTo(lonlat,zoom,{dragging:dragging,forceZoomChange:forceZoomChange,caller:"setCenter"})
},moveTo:function(lonlat,zoom,options){if(!options){options={}
}if(zoom!=null){zoom=parseFloat(zoom);
if(!this.fractionalZoom){zoom=Math.round(zoom)
}}var dragging=options.dragging;
var forceZoomChange=options.forceZoomChange;
var noEvent=options.noEvent;
if(this.panTween&&options.caller=="setCenter"){this.panTween.stop()
}if(!this.center&&!this.isValidLonLat(lonlat)){lonlat=this.maxExtent.getCenterLonLat()
}if(this.restrictedExtent!=null){if(lonlat==null){lonlat=this.getCenter()
}if(zoom==null){zoom=this.getZoom()
}var resolution=this.getResolutionForZoom(zoom);
var extent=this.calculateBounds(lonlat,resolution);
if(!this.restrictedExtent.containsBounds(extent)){var maxCenter=this.restrictedExtent.getCenterLonLat();
if(extent.getWidth()>this.restrictedExtent.getWidth()){lonlat=new OpenLayers.LonLat(maxCenter.lon,lonlat.lat)
}else{if(extent.left<this.restrictedExtent.left){lonlat=lonlat.add(this.restrictedExtent.left-extent.left,0)
}else{if(extent.right>this.restrictedExtent.right){lonlat=lonlat.add(this.restrictedExtent.right-extent.right,0)
}}}if(extent.getHeight()>this.restrictedExtent.getHeight()){lonlat=new OpenLayers.LonLat(lonlat.lon,maxCenter.lat)
}else{if(extent.bottom<this.restrictedExtent.bottom){lonlat=lonlat.add(0,this.restrictedExtent.bottom-extent.bottom)
}else{if(extent.top>this.restrictedExtent.top){lonlat=lonlat.add(0,this.restrictedExtent.top-extent.top)
}}}}}var zoomChanged=forceZoomChange||((this.isValidZoomLevel(zoom))&&(zoom!=this.getZoom()));
var centerChanged=(this.isValidLonLat(lonlat))&&(!lonlat.equals(this.center));
if(zoomChanged||centerChanged||!dragging){if(!this.dragging&&!noEvent){this.events.triggerEvent("movestart")
}if(centerChanged){if((!zoomChanged)&&(this.center)){this.centerLayerContainer(lonlat)
}this.center=lonlat.clone()
}if((zoomChanged)||(this.layerContainerOrigin==null)){this.layerContainerOrigin=this.center.clone();
this.layerContainerDiv.style.left="0px";
this.layerContainerDiv.style.top="0px"
}if(zoomChanged){this.zoom=zoom;
this.resolution=this.getResolutionForZoom(zoom);
this.viewRequestID++
}var bounds=this.getExtent();
if(this.baseLayer.visibility){this.baseLayer.moveTo(bounds,zoomChanged,dragging);
if(dragging){this.baseLayer.events.triggerEvent("move")
}else{this.baseLayer.events.triggerEvent("moveend",{zoomChanged:zoomChanged})
}}bounds=this.baseLayer.getExtent();
for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.layers[i];
if(layer!==this.baseLayer&&!layer.isBaseLayer){var inRange=layer.calculateInRange();
if(layer.inRange!=inRange){layer.inRange=inRange;
if(!inRange){layer.display(false)
}this.events.triggerEvent("changelayer",{layer:layer,property:"visibility"})
}if(inRange&&layer.visibility){layer.moveTo(bounds,zoomChanged,dragging);
if(dragging){layer.events.triggerEvent("move")
}else{layer.events.triggerEvent("moveend",{zoomChanged:zoomChanged})
}}}}if(zoomChanged){for(var i=0,len=this.popups.length;
i<len;
i++){this.popups[i].updatePosition()
}}this.events.triggerEvent("move");
if(zoomChanged){this.events.triggerEvent("zoomend")
}}if(!dragging&&!noEvent){this.events.triggerEvent("moveend")
}this.dragging=!!dragging
},centerLayerContainer:function(lonlat){var originPx=this.getViewPortPxFromLonLat(this.layerContainerOrigin);
var newPx=this.getViewPortPxFromLonLat(lonlat);
if((originPx!=null)&&(newPx!=null)){this.layerContainerDiv.style.left=Math.round(originPx.x-newPx.x)+"px";
this.layerContainerDiv.style.top=Math.round(originPx.y-newPx.y)+"px"
}},isValidZoomLevel:function(zoomLevel){return((zoomLevel!=null)&&(zoomLevel>=0)&&(zoomLevel<this.getNumZoomLevels()))
},isValidLonLat:function(lonlat){var valid=false;
if(lonlat!=null){var maxExtent=this.getMaxExtent();
valid=maxExtent.containsLonLat(lonlat)
}return valid
},getProjection:function(){var projection=this.getProjectionObject();
return projection?projection.getCode():null
},getProjectionObject:function(){var projection=null;
if(this.baseLayer!=null){projection=this.baseLayer.projection
}return projection
},getMaxResolution:function(){var maxResolution=null;
if(this.baseLayer!=null){maxResolution=this.baseLayer.maxResolution
}return maxResolution
},getMaxExtent:function(options){var maxExtent=null;
if(options&&options.restricted&&this.restrictedExtent){maxExtent=this.restrictedExtent
}else{if(this.baseLayer!=null){maxExtent=this.baseLayer.maxExtent
}}return maxExtent
},getNumZoomLevels:function(){var numZoomLevels=null;
if(this.baseLayer!=null){numZoomLevels=this.baseLayer.numZoomLevels
}return numZoomLevels
},getExtent:function(){var extent=null;
if(this.baseLayer!=null){extent=this.baseLayer.getExtent()
}return extent
},getResolution:function(){var resolution=null;
if(this.baseLayer!=null){resolution=this.baseLayer.getResolution()
}else{if(this.allOverlays===true&&this.layers.length>0){resolution=this.layers[0].getResolution()
}}return resolution
},getUnits:function(){var units=null;
if(this.baseLayer!=null){units=this.baseLayer.units
}return units
},getScale:function(){var scale=null;
if(this.baseLayer!=null){var res=this.getResolution();
var units=this.baseLayer.units;
scale=OpenLayers.Util.getScaleFromResolution(res,units)
}return scale
},getZoomForExtent:function(bounds,closest){var zoom=null;
if(this.baseLayer!=null){zoom=this.baseLayer.getZoomForExtent(bounds,closest)
}return zoom
},getResolutionForZoom:function(zoom){var resolution=null;
if(this.baseLayer){resolution=this.baseLayer.getResolutionForZoom(zoom)
}return resolution
},getZoomForResolution:function(resolution,closest){var zoom=null;
if(this.baseLayer!=null){zoom=this.baseLayer.getZoomForResolution(resolution,closest)
}return zoom
},zoomTo:function(zoom){if(this.isValidZoomLevel(zoom)){this.setCenter(null,zoom)
}},zoomIn:function(){this.zoomTo(this.getZoom()+1)
},zoomOut:function(){this.zoomTo(this.getZoom()-1)
},zoomToExtent:function(bounds,closest){var center=bounds.getCenterLonLat();
if(this.baseLayer.wrapDateLine){var maxExtent=this.getMaxExtent();
bounds=bounds.clone();
while(bounds.right<bounds.left){bounds.right+=maxExtent.getWidth()
}center=bounds.getCenterLonLat().wrapDateLine(maxExtent)
}this.setCenter(center,this.getZoomForExtent(bounds,closest))
},zoomToMaxExtent:function(options){var restricted=(options)?options.restricted:true;
var maxExtent=this.getMaxExtent({restricted:restricted});
this.zoomToExtent(maxExtent)
},zoomToScale:function(scale,closest){var res=OpenLayers.Util.getResolutionFromScale(scale,this.baseLayer.units);
var size=this.getSize();
var w_deg=size.w*res;
var h_deg=size.h*res;
var center=this.getCenter();
var extent=new OpenLayers.Bounds(center.lon-w_deg/2,center.lat-h_deg/2,center.lon+w_deg/2,center.lat+h_deg/2);
this.zoomToExtent(extent,closest)
},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;
if(this.baseLayer!=null){lonlat=this.baseLayer.getLonLatFromViewPortPx(viewPortPx)
}return lonlat
},getViewPortPxFromLonLat:function(lonlat){var px=null;
if(this.baseLayer!=null){px=this.baseLayer.getViewPortPxFromLonLat(lonlat)
}return px
},getLonLatFromPixel:function(px){return this.getLonLatFromViewPortPx(px)
},getPixelFromLonLat:function(lonlat){var px=this.getViewPortPxFromLonLat(lonlat);
px.x=Math.round(px.x);
px.y=Math.round(px.y);
return px
},getGeodesicPixelSize:function(px){var lonlat=px?this.getLonLatFromPixel(px):(this.getCenter()||new OpenLayers.LonLat(0,0));
var res=this.getResolution();
var left=lonlat.add(-res/2,0);
var right=lonlat.add(res/2,0);
var bottom=lonlat.add(0,-res/2);
var top=lonlat.add(0,res/2);
var dest=new OpenLayers.Projection("EPSG:4326");
var source=this.getProjectionObject()||dest;
if(!source.equals(dest)){left.transform(source,dest);
right.transform(source,dest);
bottom.transform(source,dest);
top.transform(source,dest)
}return new OpenLayers.Size(OpenLayers.Util.distVincenty(left,right),OpenLayers.Util.distVincenty(bottom,top))
},getViewPortPxFromLayerPx:function(layerPx){var viewPortPx=null;
if(layerPx!=null){var dX=parseInt(this.layerContainerDiv.style.left);
var dY=parseInt(this.layerContainerDiv.style.top);
viewPortPx=layerPx.add(dX,dY)
}return viewPortPx
},getLayerPxFromViewPortPx:function(viewPortPx){var layerPx=null;
if(viewPortPx!=null){var dX=-parseInt(this.layerContainerDiv.style.left);
var dY=-parseInt(this.layerContainerDiv.style.top);
layerPx=viewPortPx.add(dX,dY);
if(isNaN(layerPx.x)||isNaN(layerPx.y)){layerPx=null
}}return layerPx
},getLonLatFromLayerPx:function(px){px=this.getViewPortPxFromLayerPx(px);
return this.getLonLatFromViewPortPx(px)
},getLayerPxFromLonLat:function(lonlat){var px=this.getPixelFromLonLat(lonlat);
return this.getLayerPxFromViewPortPx(px)
},CLASS_NAME:"OpenLayers.Map"});
OpenLayers.Map.TILE_WIDTH=256;
OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,initialize:function(projCode,options){OpenLayers.Util.extend(this,options);
this.projCode=projCode;
if(window.Proj4js){this.proj=new Proj4js.Proj(projCode)
}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode
},getUnits:function(){return this.proj?this.proj.units:null
},toString:function(){return this.getCode()
},equals:function(projection){if(projection&&projection.getCode){return this.getCode()==projection.getCode()
}else{return false
}},destroy:function(){delete this.proj;
delete this.projCode
},CLASS_NAME:"OpenLayers.Projection"});
OpenLayers.Projection.transforms={};
OpenLayers.Projection.addTransform=function(from,to,method){if(!OpenLayers.Projection.transforms[from]){OpenLayers.Projection.transforms[from]={}
}OpenLayers.Projection.transforms[from][to]=method
};
OpenLayers.Projection.transform=function(point,source,dest){if(source.proj&&dest.proj){point=Proj4js.transform(source.proj,dest.proj,point)
}else{if(source&&dest&&OpenLayers.Projection.transforms[source.getCode()]&&OpenLayers.Projection.transforms[source.getCode()][dest.getCode()]){OpenLayers.Projection.transforms[source.getCode()][dest.getCode()](point)
}}return point
};OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(name,options){this.addOptions(options);
this.name=name;
if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");
this.div=OpenLayers.Util.createDiv(this.id);
this.div.style.width="100%";
this.div.style.height="100%";
this.div.dir="ltr";
this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);
if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)
}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true
}},destroy:function(setNewBaseLayer){if(setNewBaseLayer==null){setNewBaseLayer=true
}if(this.map!=null){this.map.removeLayer(this,setNewBaseLayer)
}this.projection=null;
this.map=null;
this.name=null;
this.div=null;
this.options=null;
if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)
}this.events.destroy()
}this.eventListeners=null;
this.events=null
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer(this.name,this.getOptions())
}OpenLayers.Util.applyDefaults(obj,this);
obj.map=null;
return obj
},getOptions:function(){var options={};
for(var o in this.options){options[o]=this[o]
}return options
},setName:function(newName){if(newName!=this.name){this.name=newName;
if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})
}}},addOptions:function(newOptions){if(this.options==null){this.options={}
}OpenLayers.Util.extend(this.options,newOptions);
OpenLayers.Util.extend(this,newOptions);
if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)
}if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits()
}if(this.map){var properties=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);
for(var o in newOptions){if(newOptions.hasOwnProperty(o)&&OpenLayers.Util.indexOf(properties,o)>=0){this.initResolutions();
break
}}}},onMapResize:function(){},redraw:function(){var redrawn=false;
if(this.map){this.inRange=this.calculateInRange();
var extent=this.getExtent();
if(extent&&this.inRange&&this.visibility){var zoomChanged=true;
this.moveTo(extent,zoomChanged,false);
this.events.triggerEvent("moveend",{zoomChanged:zoomChanged});
redrawn=true
}}return redrawn
},moveTo:function(bounds,zoomChanged,dragging){var display=this.visibility;
if(!this.isBaseLayer){display=display&&this.inRange
}this.display(display)
},setMap:function(map){if(this.map==null){this.map=map;
this.maxExtent=this.maxExtent||this.map.maxExtent;
this.minExtent=this.minExtent||this.map.minExtent;
this.projection=this.projection||this.map.projection;
if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)
}this.units=this.projection.getUnits()||this.units||this.map.units;
this.initResolutions();
if(!this.isBaseLayer){this.inRange=this.calculateInRange();
var show=((this.visibility)&&(this.inRange));
this.div.style.display=show?"":"none"
}this.setTileSize()
}},afterAdd:function(){},removeMap:function(map){},getImageSize:function(bounds){return(this.imageSize||this.tileSize)
},setTileSize:function(size){var tileSize=(size)?size:((this.tileSize)?this.tileSize:this.map.getTileSize());
this.tileSize=tileSize;
if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);
this.imageSize=new OpenLayers.Size(tileSize.w+(2*this.gutter),tileSize.h+(2*this.gutter))
}},getVisibility:function(){return this.visibility
},setVisibility:function(visibility){if(visibility!=this.visibility){this.visibility=visibility;
this.display(visibility);
this.redraw();
if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})
}this.events.triggerEvent("visibilitychanged")
}},display:function(display){if(display!=(this.div.style.display!="none")){this.div.style.display=(display&&this.calculateInRange())?"block":"none"
}},calculateInRange:function(){var inRange=false;
if(this.alwaysInRange){inRange=true
}else{if(this.map){var resolution=this.map.getResolution();
inRange=((resolution>=this.minResolution)&&(resolution<=this.maxResolution))
}}return inRange
},setIsBaseLayer:function(isBaseLayer){if(isBaseLayer!=this.isBaseLayer){this.isBaseLayer=isBaseLayer;
if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})
}}},initResolutions:function(){var i,len;
var props={},alwaysInRange=true;
for(i=0,len=this.RESOLUTION_PROPERTIES.length;
i<len;
i++){var p=this.RESOLUTION_PROPERTIES[i];
props[p]=this.options[p];
if(alwaysInRange&&this.options[p]){alwaysInRange=false
}}if(this.alwaysInRange==null){this.alwaysInRange=alwaysInRange
}if(props.resolutions==null){props.resolutions=this.resolutionsFromScales(props.scales)
}if(props.resolutions==null){props.resolutions=this.calculateResolutions(props)
}if(props.resolutions==null){for(i=0,len=this.RESOLUTION_PROPERTIES.length;
i<len;
i++){var p=this.RESOLUTION_PROPERTIES[i];
props[p]=this.options[p]!=null?this.options[p]:this.map[p]
}if(props.resolutions==null){props.resolutions=this.resolutionsFromScales(props.scales)
}if(props.resolutions==null){props.resolutions=this.calculateResolutions(props)
}}var maxResolution;
if(this.options.maxResolution&&this.options.maxResolution!=="auto"){maxResolution=this.options.maxResolution
}if(this.options.minScale){maxResolution=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units)
}var minResolution;
if(this.options.minResolution&&this.options.minResolution!=="auto"){minResolution=this.options.minResolution
}if(this.options.maxScale){minResolution=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)
}if(props.resolutions){props.resolutions.sort(function(a,b){return(b-a)
});
if(!maxResolution){maxResolution=props.resolutions[0]
}if(!minResolution){var lastIdx=props.resolutions.length-1;
minResolution=props.resolutions[lastIdx]
}}this.resolutions=props.resolutions;
if(this.resolutions){len=this.resolutions.length;
this.scales=new Array(len);
for(i=0;
i<len;
i++){this.scales[i]=OpenLayers.Util.getScaleFromResolution(this.resolutions[i],this.units)
}this.numZoomLevels=len
}this.minResolution=minResolution;
if(minResolution){this.maxScale=OpenLayers.Util.getScaleFromResolution(minResolution,this.units)
}this.maxResolution=maxResolution;
if(maxResolution){this.minScale=OpenLayers.Util.getScaleFromResolution(maxResolution,this.units)
}},resolutionsFromScales:function(scales){if(scales==null){return
}var resolutions,i,len;
len=scales.length;
resolutions=new Array(len);
for(i=0;
i<len;
i++){resolutions[i]=OpenLayers.Util.getResolutionFromScale(scales[i],this.units)
}return resolutions
},calculateResolutions:function(props){var maxResolution=props.maxResolution;
if(props.minScale!=null){maxResolution=OpenLayers.Util.getResolutionFromScale(props.minScale,this.units)
}else{if(maxResolution=="auto"&&this.maxExtent!=null){var viewSize=this.map.getSize();
var wRes=this.maxExtent.getWidth()/viewSize.w;
var hRes=this.maxExtent.getHeight()/viewSize.h;
maxResolution=Math.max(wRes,hRes)
}}var minResolution=props.minResolution;
if(props.maxScale!=null){minResolution=OpenLayers.Util.getResolutionFromScale(props.maxScale,this.units)
}else{if(props.minResolution=="auto"&&this.minExtent!=null){var viewSize=this.map.getSize();
var wRes=this.minExtent.getWidth()/viewSize.w;
var hRes=this.minExtent.getHeight()/viewSize.h;
minResolution=Math.max(wRes,hRes)
}}var maxZoomLevel=props.maxZoomLevel;
var numZoomLevels=props.numZoomLevels;
if(typeof minResolution==="number"&&typeof maxResolution==="number"&&numZoomLevels===undefined){var ratio=maxResolution/minResolution;
numZoomLevels=Math.floor(Math.log(ratio)/Math.log(2))+1
}else{if(numZoomLevels===undefined&&maxZoomLevel!=null){numZoomLevels=maxZoomLevel+1
}}if(typeof numZoomLevels!=="number"||numZoomLevels<=0||(typeof maxResolution!=="number"&&typeof minResolution!=="number")){return
}var resolutions=new Array(numZoomLevels);
var base=2;
if(typeof minResolution=="number"&&typeof maxResolution=="number"){base=Math.pow((maxResolution/minResolution),(1/(numZoomLevels-1)))
}var i;
if(typeof maxResolution==="number"){for(i=0;
i<numZoomLevels;
i++){resolutions[i]=maxResolution/Math.pow(base,i)
}}else{for(i=0;
i<numZoomLevels;
i++){resolutions[numZoomLevels-1-i]=minResolution*Math.pow(base,i)
}}return resolutions
},getResolution:function(){var zoom=this.map.getZoom();
return this.getResolutionForZoom(zoom)
},getExtent:function(){return this.map.calculateBounds()
},getZoomForExtent:function(extent,closest){var viewSize=this.map.getSize();
var idealResolution=Math.max(extent.getWidth()/viewSize.w,extent.getHeight()/viewSize.h);
return this.getZoomForResolution(idealResolution,closest)
},getDataExtent:function(){},getResolutionForZoom:function(zoom){zoom=Math.max(0,Math.min(zoom,this.resolutions.length-1));
var resolution;
if(this.map.fractionalZoom){var low=Math.floor(zoom);
var high=Math.ceil(zoom);
resolution=this.resolutions[low]-((zoom-low)*(this.resolutions[low]-this.resolutions[high]))
}else{resolution=this.resolutions[Math.round(zoom)]
}return resolution
},getZoomForResolution:function(resolution,closest){var zoom;
if(this.map.fractionalZoom){var lowZoom=0;
var highZoom=this.resolutions.length-1;
var highRes=this.resolutions[lowZoom];
var lowRes=this.resolutions[highZoom];
var res;
for(var i=0,len=this.resolutions.length;
i<len;
++i){res=this.resolutions[i];
if(res>=resolution){highRes=res;
lowZoom=i
}if(res<=resolution){lowRes=res;
highZoom=i;
break
}}var dRes=highRes-lowRes;
if(dRes>0){zoom=lowZoom+((highRes-resolution)/dRes)
}else{zoom=lowZoom
}}else{var diff;
var minDiff=Number.POSITIVE_INFINITY;
for(var i=0,len=this.resolutions.length;
i<len;
i++){if(closest){diff=Math.abs(this.resolutions[i]-resolution);
if(diff>minDiff){break
}minDiff=diff
}else{if(this.resolutions[i]<resolution){break
}}}zoom=Math.max(0,i-1)
}return zoom
},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;
if(viewPortPx!=null){var size=this.map.getSize();
var center=this.map.getCenter();
if(center){var res=this.map.getResolution();
var delta_x=viewPortPx.x-(size.w/2);
var delta_y=viewPortPx.y-(size.h/2);
lonlat=new OpenLayers.LonLat(center.lon+delta_x*res,center.lat-delta_y*res);
if(this.wrapDateLine){lonlat=lonlat.wrapDateLine(this.maxExtent)
}}}return lonlat
},getViewPortPxFromLonLat:function(lonlat){var px=null;
if(lonlat!=null){var resolution=this.map.getResolution();
var extent=this.map.getExtent();
px=new OpenLayers.Pixel((1/resolution*(lonlat.lon-extent.left)),(1/resolution*(extent.top-lonlat.lat)))
}return px
},setOpacity:function(opacity){if(opacity!=this.opacity){this.opacity=opacity;
for(var i=0,len=this.div.childNodes.length;
i<len;
++i){var element=this.div.childNodes[i].firstChild;
OpenLayers.Util.modifyDOMElement(element,null,null,null,null,null,null,opacity)
}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})
}}},getZIndex:function(){return this.div.style.zIndex
},setZIndex:function(zIndex){this.div.style.zIndex=zIndex
},adjustBounds:function(bounds){if(this.gutter){var mapGutter=this.gutter*this.map.getResolution();
bounds=new OpenLayers.Bounds(bounds.left-mapGutter,bounds.bottom-mapGutter,bounds.right+mapGutter,bounds.top+mapGutter)
}if(this.wrapDateLine){var wrappingOptions={rightTolerance:this.getResolution()};
bounds=bounds.wrapDateLine(this.maxExtent,wrappingOptions)
}return bounds
},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(layer,position,bounds,url,size){this.layer=layer;
this.position=position.clone();
this.bounds=bounds.clone();
this.url=url;
this.size=size.clone();
this.id=OpenLayers.Util.createUniqueID("Tile_");
this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES)
},unload:function(){if(this.isLoading){this.isLoading=false;
this.events.triggerEvent("unload")
}},destroy:function(){this.layer=null;
this.bounds=null;
this.size=null;
this.position=null;
this.events.destroy();
this.events=null
},clone:function(obj){if(obj==null){obj=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)
}OpenLayers.Util.applyDefaults(obj,this);
return obj
},draw:function(){var maxExtent=this.layer.maxExtent;
var withinMaxExtent=(maxExtent&&this.bounds.intersectsBounds(maxExtent,false));
this.shouldDraw=(withinMaxExtent||this.layer.displayOutsideMaxExtent);
this.clear();
return this.shouldDraw
},moveTo:function(bounds,position,redraw){if(redraw==null){redraw=true
}this.bounds=bounds.clone();
this.position=position.clone();
if(redraw){this.draw()
}},clear:function(){},getBoundsFromBaseLayer:function(position){var msg=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});
OpenLayers.Console.warn(msg);
var topLeft=this.layer.map.getLonLatFromLayerPx(position);
var bottomRightPx=position.clone();
bottomRightPx.x+=this.size.w;
bottomRightPx.y+=this.size.h;
var bottomRight=this.layer.map.getLonLatFromLayerPx(bottomRightPx);
if(topLeft.lon>bottomRight.lon){if(topLeft.lon<0){topLeft.lon=-180-(topLeft.lon+180)
}else{bottomRight.lon=180+bottomRight.lon+180
}}var bounds=new OpenLayers.Bounds(topLeft.lon,bottomRight.lat,bottomRight.lon,topLeft.lat);
return bounds
},showTile:function(){if(this.shouldDraw){this.show()
}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(layer,position,bounds,url,size){OpenLayers.Tile.prototype.initialize.apply(this,arguments);
this.url=url;
this.frame=document.createElement("div");
this.frame.style.overflow="hidden";
this.frame.style.position="absolute";
this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()
},destroy:function(){if(this.imgDiv!=null){if(this.layerAlphaHack){OpenLayers.Event.stopObservingElement(this.imgDiv.childNodes[0])
}OpenLayers.Event.stopObservingElement(this.imgDiv);
if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);
this.imgDiv.map=null
}this.imgDiv.urls=null;
this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"
}this.imgDiv=null;
if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame)
}this.frame=null;
if(this.backBufferTile){this.backBufferTile.destroy();
this.backBufferTile=null
}this.layer.events.unregister("loadend",this,this.resetBackBuffer);
OpenLayers.Tile.prototype.destroy.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)
}obj=OpenLayers.Tile.prototype.clone.apply(this,[obj]);
obj.imgDiv=null;
return obj
},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)
}var drawTile=OpenLayers.Tile.prototype.draw.apply(this,arguments);
if((OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1)||this.layer.singleTile){if(drawTile){if(!this.backBufferTile){this.backBufferTile=this.clone();
this.backBufferTile.hide();
this.backBufferTile.isBackBuffer=true;
this.events.register("loadend",this,this.resetBackBuffer);
this.layer.events.register("loadend",this,this.resetBackBuffer)
}this.startTransition()
}else{if(this.backBufferTile){this.backBufferTile.clear()
}}}else{if(drawTile&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);
this.isFirstDraw=false
}}if(!drawTile){return false
}if(this.isLoading){this.events.triggerEvent("reload")
}else{this.isLoading=true;
this.events.triggerEvent("loadstart")
}return this.renderTile()
},resetBackBuffer:function(){this.showTile();
if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;
var maxExtent=this.layer.maxExtent;
var withinMaxExtent=(maxExtent&&this.bounds.intersectsBounds(maxExtent,false));
if(withinMaxExtent){this.backBufferTile.position=this.position;
this.backBufferTile.bounds=this.bounds;
this.backBufferTile.size=this.size;
this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size;
this.backBufferTile.imageOffset=this.layer.imageOffset;
this.backBufferTile.resolution=this.layer.getResolution();
this.backBufferTile.renderTile()
}this.backBufferTile.hide()
}},renderTile:function(){if(this.imgDiv==null){this.initImgDiv()
}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;
if(this.layer.async){this.layer.getURLasync(this.bounds,this,"url",this.positionImage)
}else{if(this.layer.url instanceof Array){this.imgDiv.urls=this.layer.url.slice()
}this.url=this.layer.getURL(this.bounds);
this.positionImage()
}return true
},positionImage:function(){if(this.layer===null){return
}OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);
var imageSize=this.layer.getImageSize(this.bounds);
if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,imageSize,this.url)
}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,imageSize);
this.imgDiv.src=this.url
}},clear:function(){if(this.imgDiv){this.hide();
if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"
}}},initImgDiv:function(){var offset=this.layer.imageOffset;
var size=this.layer.getImageSize(this.bounds);
if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,offset,size,null,"relative",null,null,null,true)
}else{this.imgDiv=OpenLayers.Util.createImage(null,offset,size,null,"relative",null,null,true)
}this.imgDiv.className="olTileImage";
this.frame.style.zIndex=this.isBackBuffer?0:1;
this.frame.appendChild(this.imgDiv);
this.layer.div.appendChild(this.frame);
if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)
}this.imgDiv.map=this.layer.map;
var onload=function(){if(this.isLoading){this.isLoading=false;
this.events.triggerEvent("loadend")
}};
if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(onload,this))
}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(onload,this))
}var onerror=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){onload.call(this)
}};
OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(onerror,this))
},checkImgURL:function(){if(this.layer){var loaded=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;
if(!OpenLayers.Util.isEquivalentUrl(loaded,this.url)){this.hide()
}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return
}var ratio=1;
if(this.backBufferTile.resolution){ratio=this.backBufferTile.resolution/this.layer.getResolution()
}if(ratio!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var upperLeft=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);
var size=new OpenLayers.Size(this.backBufferTile.size.w*ratio,this.backBufferTile.size.h*ratio);
var px=this.layer.map.getLayerPxFromLonLat(upperLeft);
OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,px,size);
var imageSize=this.backBufferTile.imageSize;
imageSize=new OpenLayers.Size(imageSize.w*ratio,imageSize.h*ratio);
var imageOffset=this.backBufferTile.imageOffset;
if(imageOffset){imageOffset=new OpenLayers.Pixel(imageOffset.x*ratio,imageOffset.y*ratio)
}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,imageOffset,imageSize);
this.backBufferTile.show()
}}else{if(this.layer.singleTile){this.backBufferTile.show()
}else{this.backBufferTile.hide()
}}this.lastRatio=ratio
},show:function(){this.frame.style.display="";
if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.frame.scrollLeft=this.frame.scrollLeft
}}},hide:function(){this.frame.style.display="none"
},CLASS_NAME:"OpenLayers.Tile.Image"});
OpenLayers.Tile.Image.useBlankTile=(OpenLayers.Util.getBrowserName()=="safari"||OpenLayers.Util.getBrowserName()=="opera");OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(name,url,extent,size,options){this.url=url;
this.extent=extent;
this.maxExtent=extent;
this.size=size;
OpenLayers.Layer.prototype.initialize.apply(this,[name,options]);
this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w)
},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);
this.tile.destroy();
this.tile=null
}OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())
}obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);
return obj
},setMap:function(map){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w
}OpenLayers.Layer.prototype.setMap.apply(this,arguments)
},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);
var firstRendering=(this.tile==null);
if(zoomChanged||firstRendering){this.setTileSize();
var ul=new OpenLayers.LonLat(this.extent.left,this.extent.top);
var ulPx=this.map.getLayerPxFromLonLat(ul);
if(firstRendering){this.tile=new OpenLayers.Tile.Image(this,ulPx,this.extent,null,this.tileSize);
this.addTileMonitoringHooks(this.tile)
}else{this.tile.size=this.tileSize.clone();
this.tile.position=ulPx.clone()
}this.tile.draw()
}},setTileSize:function(){var tileWidth=this.extent.getWidth()/this.map.getResolution();
var tileHeight=this.extent.getHeight()/this.map.getResolution();
this.tileSize=new OpenLayers.Size(tileWidth,tileHeight)
},addTileMonitoringHooks:function(tile){tile.onLoadStart=function(){this.events.triggerEvent("loadstart")
};
tile.events.register("loadstart",this,tile.onLoadStart);
tile.onLoadEnd=function(){this.events.triggerEvent("loadend")
};
tile.events.register("loadend",this,tile.onLoadEnd);
tile.events.register("unload",this,tile.onLoadEnd)
},removeTileMonitoringHooks:function(tile){tile.unload();
tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,scope:this})
},setUrl:function(newUrl){this.url=newUrl;
this.tile.draw()
},getURL:function(bounds){return this.url
},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(components){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);
this.components=[];
if(components!=null){this.addComponents(components)
}},destroy:function(){this.components.length=0;
this.components=null;
OpenLayers.Geometry.prototype.destroy.apply(this,arguments)
},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");
for(var i=0,len=this.components.length;
i<len;
i++){geometry.addComponent(this.components[i].clone())
}OpenLayers.Util.applyDefaults(geometry,this);
return geometry
},getComponentsString:function(){var strings=[];
for(var i=0,len=this.components.length;
i<len;
i++){strings.push(this.components[i].toShortString())
}return strings.join(",")
},calculateBounds:function(){this.bounds=null;
if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());
for(var i=1,len=this.components.length;
i<len;
i++){this.extendBounds(this.components[i].getBounds())
}}},addComponents:function(components){if(!(components instanceof Array)){components=[components]
}for(var i=0,len=components.length;
i<len;
i++){this.addComponent(components[i])
}},addComponent:function(component,index){var added=false;
if(component){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,component.CLASS_NAME)>-1)){if(index!=null&&(index<this.components.length)){var components1=this.components.slice(0,index);
var components2=this.components.slice(index,this.components.length);
components1.push(component);
this.components=components1.concat(components2)
}else{this.components.push(component)
}component.parent=this;
this.clearBounds();
added=true
}}return added
},removeComponents:function(components){if(!(components instanceof Array)){components=[components]
}for(var i=components.length-1;
i>=0;
--i){this.removeComponent(components[i])
}},removeComponent:function(component){OpenLayers.Util.removeItem(this.components,component);
this.clearBounds()
},getLength:function(){var length=0;
for(var i=0,len=this.components.length;
i<len;
i++){length+=this.components[i].getLength()
}return length
},getArea:function(){var area=0;
for(var i=0,len=this.components.length;
i<len;
i++){area+=this.components[i].getArea()
}return area
},getGeodesicArea:function(projection){var area=0;
for(var i=0,len=this.components.length;
i<len;
i++){area+=this.components[i].getGeodesicArea(projection)
}return area
},getCentroid:function(weighted){if(!weighted){return this.components.length&&this.components[0].getCentroid()
}var len=this.components.length;
if(!len){return false
}var areas=[];
var centroids=[];
var areaSum=0;
var minArea=Number.MAX_VALUE;
var component;
for(var i=0;
i<len;
++i){component=this.components[i];
var area=component.getArea();
var centroid=component.getCentroid(true);
if(isNaN(area)||isNaN(centroid.x)||isNaN(centroid.y)){continue
}areas.push(area);
areaSum+=area;
minArea=(area<minArea&&area>0)?area:minArea;
centroids.push(centroid)
}len=areas.length;
if(areaSum===0){for(var i=0;
i<len;
++i){areas[i]=1
}areaSum=areas.length
}else{for(var i=0;
i<len;
++i){areas[i]/=minArea
}areaSum/=minArea
}var xSum=0,ySum=0,centroid,area;
for(var i=0;
i<len;
++i){centroid=centroids[i];
area=areas[i];
xSum+=centroid.x*area;
ySum+=centroid.y*area
}return new OpenLayers.Geometry.Point(xSum/areaSum,ySum/areaSum)
},getGeodesicLength:function(projection){var length=0;
for(var i=0,len=this.components.length;
i<len;
i++){length+=this.components[i].getGeodesicLength(projection)
}return length
},move:function(x,y){for(var i=0,len=this.components.length;
i<len;
i++){this.components[i].move(x,y)
}},rotate:function(angle,origin){for(var i=0,len=this.components.length;
i<len;
++i){this.components[i].rotate(angle,origin)
}},resize:function(scale,origin,ratio){for(var i=0;
i<this.components.length;
++i){this.components[i].resize(scale,origin,ratio)
}return this
},distanceTo:function(geometry,options){var edge=!(options&&options.edge===false);
var details=edge&&options&&options.details;
var result,best,distance;
var min=Number.POSITIVE_INFINITY;
for(var i=0,len=this.components.length;
i<len;
++i){result=this.components[i].distanceTo(geometry,options);
distance=details?result.distance:result;
if(distance<min){min=distance;
best=result;
if(min==0){break
}}}return best
},equals:function(geometry){var equivalent=true;
if(!geometry||!geometry.CLASS_NAME||(this.CLASS_NAME!=geometry.CLASS_NAME)){equivalent=false
}else{if(!(geometry.components instanceof Array)||(geometry.components.length!=this.components.length)){equivalent=false
}else{for(var i=0,len=this.components.length;
i<len;
++i){if(!this.components[i].equals(geometry.components[i])){equivalent=false;
break
}}}}return equivalent
},transform:function(source,dest){if(source&&dest){for(var i=0,len=this.components.length;
i<len;
i++){var component=this.components[i];
component.transform(source,dest)
}this.bounds=null
}return this
},intersects:function(geometry){var intersect=false;
for(var i=0,len=this.components.length;
i<len;
++i){intersect=geometry.intersects(this.components[i]);
if(intersect){break
}}return intersect
},getVertices:function(nodes){var vertices=[];
for(var i=0,len=this.components.length;
i<len;
++i){Array.prototype.push.apply(vertices,this.components[i].getVertices(nodes))
}return vertices
},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(x,y){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);
this.x=parseFloat(x);
this.y=parseFloat(y)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Geometry.Point(this.x,this.y)
}OpenLayers.Util.applyDefaults(obj,this);
return obj
},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)
},distanceTo:function(geometry,options){var edge=!(options&&options.edge===false);
var details=edge&&options&&options.details;
var distance,x0,y0,x1,y1,result;
if(geometry instanceof OpenLayers.Geometry.Point){x0=this.x;
y0=this.y;
x1=geometry.x;
y1=geometry.y;
distance=Math.sqrt(Math.pow(x0-x1,2)+Math.pow(y0-y1,2));
result=!details?distance:{x0:x0,y0:y0,x1:x1,y1:y1,distance:distance}
}else{result=geometry.distanceTo(this,options);
if(details){result={x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0,distance:result.distance}
}}return result
},equals:function(geom){var equals=false;
if(geom!=null){equals=((this.x==geom.x&&this.y==geom.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(geom.x)&&isNaN(geom.y)))
}return equals
},toShortString:function(){return(this.x+", "+this.y)
},move:function(x,y){this.x=this.x+x;
this.y=this.y+y;
this.clearBounds()
},rotate:function(angle,origin){angle*=Math.PI/180;
var radius=this.distanceTo(origin);
var theta=angle+Math.atan2(this.y-origin.y,this.x-origin.x);
this.x=origin.x+(radius*Math.cos(theta));
this.y=origin.y+(radius*Math.sin(theta));
this.clearBounds()
},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)
},resize:function(scale,origin,ratio){ratio=(ratio==undefined)?1:ratio;
this.x=origin.x+(scale*ratio*(this.x-origin.x));
this.y=origin.y+(scale*(this.y-origin.y));
this.clearBounds();
return this
},intersects:function(geometry){var intersect=false;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){intersect=this.equals(geometry)
}else{intersect=geometry.intersects(this)
}return intersect
},transform:function(source,dest){if((source&&dest)){OpenLayers.Projection.transform(this,source,dest);
this.bounds=null
}return this
},getVertices:function(nodes){return[this]
},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(components){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)
},addPoint:function(point,index){this.addComponent(point,index)
},removePoint:function(point){this.removeComponent(point)
},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(points){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)
},getLength:function(){var length=0;
if(this.components&&(this.components.length>1)){for(var i=1,len=this.components.length;
i<len;
i++){length+=this.components[i-1].distanceTo(this.components[i])
}}return length
},getGeodesicLength:function(projection){var geom=this;
if(projection){var gg=new OpenLayers.Projection("EPSG:4326");
if(!gg.equals(projection)){geom=this.clone().transform(projection,gg)
}}var length=0;
if(geom.components&&(geom.components.length>1)){var p1,p2;
for(var i=1,len=geom.components.length;
i<len;
i++){p1=geom.components[i-1];
p2=geom.components[i];
length+=OpenLayers.Util.distVincenty({lon:p1.x,lat:p1.y},{lon:p2.x,lat:p2.y})
}}return length*1000
},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(points){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)
},removeComponent:function(point){if(this.components&&(this.components.length>2)){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)
}},intersects:function(geometry){var intersect=false;
var type=geometry.CLASS_NAME;
if(type=="OpenLayers.Geometry.LineString"||type=="OpenLayers.Geometry.LinearRing"||type=="OpenLayers.Geometry.Point"){var segs1=this.getSortedSegments();
var segs2;
if(type=="OpenLayers.Geometry.Point"){segs2=[{x1:geometry.x,y1:geometry.y,x2:geometry.x,y2:geometry.y}]
}else{segs2=geometry.getSortedSegments()
}var seg1,seg1x1,seg1x2,seg1y1,seg1y2,seg2,seg2y1,seg2y2;
outer:for(var i=0,len=segs1.length;
i<len;
++i){seg1=segs1[i];
seg1x1=seg1.x1;
seg1x2=seg1.x2;
seg1y1=seg1.y1;
seg1y2=seg1.y2;
inner:for(var j=0,jlen=segs2.length;
j<jlen;
++j){seg2=segs2[j];
if(seg2.x1>seg1x2){break
}if(seg2.x2<seg1x1){continue
}seg2y1=seg2.y1;
seg2y2=seg2.y2;
if(Math.min(seg2y1,seg2y2)>Math.max(seg1y1,seg1y2)){continue
}if(Math.max(seg2y1,seg2y2)<Math.min(seg1y1,seg1y2)){continue
}if(OpenLayers.Geometry.segmentsIntersect(seg1,seg2)){intersect=true;
break outer
}}}}else{intersect=geometry.intersects(this)
}return intersect
},getSortedSegments:function(){var numSeg=this.components.length-1;
var segments=new Array(numSeg),point1,point2;
for(var i=0;
i<numSeg;
++i){point1=this.components[i];
point2=this.components[i+1];
if(point1.x<point2.x){segments[i]={x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}
}else{segments[i]={x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y}
}}function byX1(seg1,seg2){return seg1.x1-seg2.x1
}return segments.sort(byX1)
},splitWithSegment:function(seg,options){var edge=!(options&&options.edge===false);
var tolerance=options&&options.tolerance;
var lines=[];
var verts=this.getVertices();
var points=[];
var intersections=[];
var split=false;
var vert1,vert2,point;
var node,vertex,target;
var interOptions={point:true,tolerance:tolerance};
var result=null;
for(var i=0,stop=verts.length-2;
i<=stop;
++i){vert1=verts[i];
points.push(vert1.clone());
vert2=verts[i+1];
target={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y};
point=OpenLayers.Geometry.segmentsIntersect(seg,target,interOptions);
if(point instanceof OpenLayers.Geometry.Point){if((point.x===seg.x1&&point.y===seg.y1)||(point.x===seg.x2&&point.y===seg.y2)||point.equals(vert1)||point.equals(vert2)){vertex=true
}else{vertex=false
}if(vertex||edge){if(!point.equals(intersections[intersections.length-1])){intersections.push(point.clone())
}if(i===0){if(point.equals(vert1)){continue
}}if(point.equals(vert2)){continue
}split=true;
if(!point.equals(vert1)){points.push(point)
}lines.push(new OpenLayers.Geometry.LineString(points));
points=[point.clone()]
}}}if(split){points.push(vert2.clone());
lines.push(new OpenLayers.Geometry.LineString(points))
}if(intersections.length>0){var xDir=seg.x1<seg.x2?1:-1;
var yDir=seg.y1<seg.y2?1:-1;
result={lines:lines,points:intersections.sort(function(p1,p2){return(xDir*p1.x-xDir*p2.x)||(yDir*p1.y-yDir*p2.y)
})}
}return result
},split:function(target,options){var results=null;
var mutual=options&&options.mutual;
var sourceSplit,targetSplit,sourceParts,targetParts;
if(target instanceof OpenLayers.Geometry.LineString){var verts=this.getVertices();
var vert1,vert2,seg,splits,lines,point;
var points=[];
sourceParts=[];
for(var i=0,stop=verts.length-2;
i<=stop;
++i){vert1=verts[i];
vert2=verts[i+1];
seg={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y};
targetParts=targetParts||[target];
if(mutual){points.push(vert1.clone())
}for(var j=0;
j<targetParts.length;
++j){splits=targetParts[j].splitWithSegment(seg,options);
if(splits){lines=splits.lines;
if(lines.length>0){lines.unshift(j,1);
Array.prototype.splice.apply(targetParts,lines);
j+=lines.length-2
}if(mutual){for(var k=0,len=splits.points.length;
k<len;
++k){point=splits.points[k];
if(!point.equals(vert1)){points.push(point);
sourceParts.push(new OpenLayers.Geometry.LineString(points));
if(point.equals(vert2)){points=[]
}else{points=[point.clone()]
}}}}}}}if(mutual&&sourceParts.length>0&&points.length>0){points.push(vert2.clone());
sourceParts.push(new OpenLayers.Geometry.LineString(points))
}}else{results=target.splitWith(this,options)
}if(targetParts&&targetParts.length>1){targetSplit=true
}else{targetParts=[]
}if(sourceParts&&sourceParts.length>1){sourceSplit=true
}else{sourceParts=[]
}if(targetSplit||sourceSplit){if(mutual){results=[sourceParts,targetParts]
}else{results=targetParts
}}return results
},splitWith:function(geometry,options){return geometry.split(this,options)
},getVertices:function(nodes){var vertices;
if(nodes===true){vertices=[this.components[0],this.components[this.components.length-1]]
}else{if(nodes===false){vertices=this.components.slice(1,this.components.length-1)
}else{vertices=this.components.slice()
}}return vertices
},distanceTo:function(geometry,options){var edge=!(options&&options.edge===false);
var details=edge&&options&&options.details;
var result,best={};
var min=Number.POSITIVE_INFINITY;
if(geometry instanceof OpenLayers.Geometry.Point){var segs=this.getSortedSegments();
var x=geometry.x;
var y=geometry.y;
var seg;
for(var i=0,len=segs.length;
i<len;
++i){seg=segs[i];
result=OpenLayers.Geometry.distanceToSegment(geometry,seg);
if(result.distance<min){min=result.distance;
best=result;
if(min===0){break
}}else{if(seg.x2>x&&((y>seg.y1&&y<seg.y2)||(y<seg.y1&&y>seg.y2))){break
}}}if(details){best={distance:best.distance,x0:best.x,y0:best.y,x1:x,y1:y}
}else{best=best.distance
}}else{if(geometry instanceof OpenLayers.Geometry.LineString){var segs0=this.getSortedSegments();
var segs1=geometry.getSortedSegments();
var seg0,seg1,intersection,x0,y0;
var len1=segs1.length;
var interOptions={point:true};
outer:for(var i=0,len=segs0.length;
i<len;
++i){seg0=segs0[i];
x0=seg0.x1;
y0=seg0.y1;
for(var j=0;
j<len1;
++j){seg1=segs1[j];
intersection=OpenLayers.Geometry.segmentsIntersect(seg0,seg1,interOptions);
if(intersection){min=0;
best={distance:0,x0:intersection.x,y0:intersection.y,x1:intersection.x,y1:intersection.y};
break outer
}else{result=OpenLayers.Geometry.distanceToSegment({x:x0,y:y0},seg1);
if(result.distance<min){min=result.distance;
best={distance:min,x0:x0,y0:y0,x1:result.x,y1:result.y}
}}}}if(!details){best=best.distance
}if(min!==0){if(seg0){result=geometry.distanceTo(new OpenLayers.Geometry.Point(seg0.x2,seg0.y2),options);
var dist=details?result.distance:result;
if(dist<min){if(details){best={distance:min,x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0}
}else{best=dist
}}}}}else{best=geometry.distanceTo(this,options);
if(details){best={distance:best.distance,x0:best.x1,y0:best.y1,x1:best.x0,y1:best.y0}
}}}return best
},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(points){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)
},addComponent:function(point,index){var added=false;
var lastPoint=this.components.pop();
if(index!=null||!point.equals(lastPoint)){added=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)
}var firstPoint=this.components[0];
OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint]);
return added
},removeComponent:function(point){if(this.components.length>4){this.components.pop();
OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);
var firstPoint=this.components[0];
OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint])
}},move:function(x,y){for(var i=0,len=this.components.length;
i<len-1;
i++){this.components[i].move(x,y)
}},rotate:function(angle,origin){for(var i=0,len=this.components.length;
i<len-1;
++i){this.components[i].rotate(angle,origin)
}},resize:function(scale,origin,ratio){for(var i=0,len=this.components.length;
i<len-1;
++i){this.components[i].resize(scale,origin,ratio)
}return this
},transform:function(source,dest){if(source&&dest){for(var i=0,len=this.components.length;
i<len-1;
i++){var component=this.components[i];
component.transform(source,dest)
}this.bounds=null
}return this
},getCentroid:function(){if(this.components&&(this.components.length>2)){var sumX=0;
var sumY=0;
for(var i=0;
i<this.components.length-1;
i++){var b=this.components[i];
var c=this.components[i+1];
sumX+=(b.x+c.x)*(b.x*c.y-c.x*b.y);
sumY+=(b.y+c.y)*(b.x*c.y-c.x*b.y)
}var area=-1*this.getArea();
var x=sumX/(6*area);
var y=sumY/(6*area);
return new OpenLayers.Geometry.Point(x,y)
}else{return null
}},getArea:function(){var area=0;
if(this.components&&(this.components.length>2)){var sum=0;
for(var i=0,len=this.components.length;
i<len-1;
i++){var b=this.components[i];
var c=this.components[i+1];
sum+=(b.x+c.x)*(c.y-b.y)
}area=-sum/2
}return area
},getGeodesicArea:function(projection){var ring=this;
if(projection){var gg=new OpenLayers.Projection("EPSG:4326");
if(!gg.equals(projection)){ring=this.clone().transform(projection,gg)
}}var area=0;
var len=ring.components&&ring.components.length;
if(len>2){var p1,p2;
for(var i=0;
i<len-1;
i++){p1=ring.components[i];
p2=ring.components[i+1];
area+=OpenLayers.Util.rad(p2.x-p1.x)*(2+Math.sin(OpenLayers.Util.rad(p1.y))+Math.sin(OpenLayers.Util.rad(p2.y)))
}area=area*6378137*6378137/2
}return area
},containsPoint:function(point){var approx=OpenLayers.Number.limitSigDigs;
var digs=14;
var px=approx(point.x,digs);
var py=approx(point.y,digs);
function getX(y,x1,y1,x2,y2){return(((x1-x2)*y)+((x2*y1)-(x1*y2)))/(y1-y2)
}var numSeg=this.components.length-1;
var start,end,x1,y1,x2,y2,cx,cy;
var crosses=0;
for(var i=0;
i<numSeg;
++i){start=this.components[i];
x1=approx(start.x,digs);
y1=approx(start.y,digs);
end=this.components[i+1];
x2=approx(end.x,digs);
y2=approx(end.y,digs);
if(y1==y2){if(py==y1){if(x1<=x2&&(px>=x1&&px<=x2)||x1>=x2&&(px<=x1&&px>=x2)){crosses=-1;
break
}}continue
}cx=approx(getX(py,x1,y1,x2,y2),digs);
if(cx==px){if(y1<y2&&(py>=y1&&py<=y2)||y1>y2&&(py<=y1&&py>=y2)){crosses=-1;
break
}}if(cx<=px){continue
}if(x1!=x2&&(cx<Math.min(x1,x2)||cx>Math.max(x1,x2))){continue
}if(y1<y2&&(py>=y1&&py<y2)||y1>y2&&(py<y1&&py>=y2)){++crosses
}}var contained=(crosses==-1)?1:!!(crosses&1);
return contained
},intersects:function(geometry){var intersect=false;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){intersect=this.containsPoint(geometry)
}else{if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){intersect=geometry.intersects(this)
}else{if(geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){intersect=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[geometry])
}else{for(var i=0,len=geometry.components.length;
i<len;
++i){intersect=geometry.components[i].intersects(this);
if(intersect){break
}}}}}return intersect
},getVertices:function(nodes){return(nodes===true)?[]:this.components.slice(0,this.components.length-1)
},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(control,callbacks,options){OpenLayers.Util.extend(this,options);
this.control=control;
this.callbacks=callbacks;
var map=this.map||control.map;
if(map){this.setMap(map)
}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},setMap:function(map){this.map=map
},checkModifiers:function(evt){if(this.keyMask==null){return true
}var keyModifiers=(evt.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(evt.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(evt.altKey?OpenLayers.Handler.MOD_ALT:0);
return(keyModifiers==this.keyMask)
},activate:function(){if(this.active){return false
}var events=OpenLayers.Events.prototype.BROWSER_EVENTS;
for(var i=0,len=events.length;
i<len;
i++){if(this[events[i]]){this.register(events[i],this[events[i]])
}}this.active=true;
return true
},deactivate:function(){if(!this.active){return false
}var events=OpenLayers.Events.prototype.BROWSER_EVENTS;
for(var i=0,len=events.length;
i<len;
i++){if(this[events[i]]){this.unregister(events[i],this[events[i]])
}}this.active=false;
return true
},callback:function(name,args){if(name&&this.callbacks[name]){this.callbacks[name].apply(this.control,args)
}},register:function(name,method){this.map.events.registerPriority(name,this,method);
this.map.events.registerPriority(name,this,this.setEvent)
},unregister:function(name,method){this.map.events.unregister(name,this,method);
this.map.events.unregister(name,this,this.setEvent)
},setEvent:function(evt){this.evt=evt;
return true
},destroy:function(){this.deactivate();
this.control=this.map=null
},CLASS_NAME:"OpenLayers.Handler"});
OpenLayers.Handler.MOD_NONE=0;
OpenLayers.Handler.MOD_SHIFT=1;
OpenLayers.Handler.MOD_CTRL=2;
OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,layerOptions:null,initialize:function(control,callbacks,options){if(!(options&&options.layerOptions&&options.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})
}OpenLayers.Handler.prototype.initialize.apply(this,arguments)
},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false
}var options=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);
this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options);
this.map.addLayer(this.layer);
return true
},createFeature:function(pixel){var lonlat=this.map.getLonLatFromPixel(pixel);
this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat));
this.callback("create",[this.point.geometry,this.point]);
this.point.geometry.clearBounds();
this.layer.addFeatures([this.point],{silent:true})
},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false
}if(this.drawing){this.cancel()
}this.destroyFeature();
if(this.layer.map!=null){this.layer.destroy(false)
}this.layer=null;
return true
},destroyFeature:function(){if(this.layer){this.layer.destroyFeatures()
}this.point=null
},finalize:function(cancel){var key=cancel?"cancel":"done";
this.drawing=false;
this.mouseDown=false;
this.lastDown=null;
this.lastUp=null;
this.callback(key,[this.geometryClone()]);
if(cancel||!this.persist){this.destroyFeature()
}},cancel:function(){this.finalize(true)
},click:function(evt){OpenLayers.Event.stop(evt);
return false
},dblclick:function(evt){OpenLayers.Event.stop(evt);
return false
},modifyFeature:function(pixel){var lonlat=this.map.getLonLatFromPixel(pixel);
this.point.geometry.x=lonlat.lon;
this.point.geometry.y=lonlat.lat;
this.callback("modify",[this.point.geometry,this.point]);
this.point.geometry.clearBounds();
this.drawFeature()
},drawFeature:function(){this.layer.drawFeature(this.point,this.style)
},getGeometry:function(){var geometry=this.point&&this.point.geometry;
if(geometry&&this.multi){geometry=new OpenLayers.Geometry.MultiPoint([geometry])
}return geometry
},geometryClone:function(){var geom=this.getGeometry();
return geom&&geom.clone()
},mousedown:function(evt){if(!this.checkModifiers(evt)){return true
}if(this.lastDown&&this.lastDown.equals(evt.xy)){return true
}this.drawing=true;
if(this.lastDown==null){if(this.persist){this.destroyFeature()
}this.createFeature(evt.xy)
}else{this.modifyFeature(evt.xy)
}this.lastDown=evt.xy;
return false
},mousemove:function(evt){if(this.drawing){this.modifyFeature(evt.xy)
}return true
},mouseup:function(evt){if(this.drawing){this.finalize();
return false
}else{return true
}},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(control,callbacks,options){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments)
},createFeature:function(pixel){var lonlat=this.control.map.getLonLatFromPixel(pixel);
this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat));
this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));
this.callback("create",[this.point.geometry,this.getSketch()]);
this.point.geometry.clearBounds();
this.layer.addFeatures([this.line,this.point],{silent:true})
},destroyFeature:function(){OpenLayers.Handler.Point.prototype.destroyFeature.apply(this);
this.line=null
},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])
}},addPoint:function(pixel){this.layer.removeFeatures([this.point]);
var lonlat=this.control.map.getLonLatFromPixel(pixel);
this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat));
this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);
this.callback("point",[this.point.geometry,this.getGeometry()]);
this.callback("modify",[this.point.geometry,this.getSketch()]);
this.drawFeature()
},freehandMode:function(evt){return(this.freehandToggle&&evt[this.freehandToggle])?!this.freehand:this.freehand
},modifyFeature:function(pixel){var lonlat=this.control.map.getLonLatFromPixel(pixel);
this.point.geometry.x=lonlat.lon;
this.point.geometry.y=lonlat.lat;
this.callback("modify",[this.point.geometry,this.getSketch()]);
this.point.geometry.clearBounds();
this.drawFeature()
},drawFeature:function(){this.layer.drawFeature(this.line,this.style);
this.layer.drawFeature(this.point,this.style)
},getSketch:function(){return this.line
},getGeometry:function(){var geometry=this.line&&this.line.geometry;
if(geometry&&this.multi){geometry=new OpenLayers.Geometry.MultiLineString([geometry])
}return geometry
},mousedown:function(evt){if(this.lastDown&&this.lastDown.equals(evt.xy)){return false
}if(this.lastDown==null){if(this.persist){this.destroyFeature()
}this.createFeature(evt.xy)
}else{if((this.lastUp==null)||!this.lastUp.equals(evt.xy)){this.addPoint(evt.xy)
}}this.mouseDown=true;
this.lastDown=evt.xy;
this.drawing=true;
return false
},mousemove:function(evt){if(this.drawing){if(this.mouseDown&&this.freehandMode(evt)){this.addPoint(evt.xy)
}else{this.modifyFeature(evt.xy)
}}return true
},mouseup:function(evt){this.mouseDown=false;
if(this.drawing){if(this.freehandMode(evt)){this.removePoint();
this.finalize()
}else{if(this.lastUp==null){this.addPoint(evt.xy)
}this.lastUp=evt.xy
}return false
}return true
},dblclick:function(evt){if(!this.freehandMode(evt)){var index=this.line.geometry.components.length-1;
this.line.geometry.removeComponent(this.line.geometry.components[index]);
this.removePoint();
this.finalize()
}return false
},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(components){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)
},getArea:function(){var area=0;
if(this.components&&(this.components.length>0)){area+=Math.abs(this.components[0].getArea());
for(var i=1,len=this.components.length;
i<len;
i++){area-=Math.abs(this.components[i].getArea())
}}return area
},getGeodesicArea:function(projection){var area=0;
if(this.components&&(this.components.length>0)){area+=Math.abs(this.components[0].getGeodesicArea(projection));
for(var i=1,len=this.components.length;
i<len;
i++){area-=Math.abs(this.components[i].getGeodesicArea(projection))
}}return area
},containsPoint:function(point){var numRings=this.components.length;
var contained=false;
if(numRings>0){contained=this.components[0].containsPoint(point);
if(contained!==1){if(contained&&numRings>1){var hole;
for(var i=1;
i<numRings;
++i){hole=this.components[i].containsPoint(point);
if(hole){if(hole===1){contained=1
}else{contained=false
}break
}}}}}return contained
},intersects:function(geometry){var intersect=false;
var i,len;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){intersect=this.containsPoint(geometry)
}else{if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"||geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(i=0,len=this.components.length;
i<len;
++i){intersect=geometry.intersects(this.components[i]);
if(intersect){break
}}if(!intersect){for(i=0,len=geometry.components.length;
i<len;
++i){intersect=this.containsPoint(geometry.components[i]);
if(intersect){break
}}}}else{for(i=0,len=geometry.components.length;
i<len;
++i){intersect=this.intersects(geometry.components[i]);
if(intersect){break
}}}}if(!intersect&&geometry.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var ring=this.components[0];
for(i=0,len=ring.components.length;
i<len;
++i){intersect=geometry.containsPoint(ring.components[i]);
if(intersect){break
}}}return intersect
},distanceTo:function(geometry,options){var edge=!(options&&options.edge===false);
var result;
if(!edge&&this.intersects(geometry)){result=0
}else{result=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[geometry,options])
}return result
},CLASS_NAME:"OpenLayers.Geometry.Polygon"});
OpenLayers.Geometry.Polygon.createRegularPolygon=function(origin,radius,sides,rotation){var angle=Math.PI*((1/sides)-(1/2));
if(rotation){angle+=(rotation/180)*Math.PI
}var rotatedAngle,x,y;
var points=[];
for(var i=0;
i<sides;
++i){rotatedAngle=angle+(i*2*Math.PI/sides);
x=origin.x+(radius*Math.cos(rotatedAngle));
y=origin.y+(radius*Math.sin(rotatedAngle));
points.push(new OpenLayers.Geometry.Point(x,y))
}var ring=new OpenLayers.Geometry.LinearRing(points);
return new OpenLayers.Geometry.Polygon([ring])
};OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{polygon:null,initialize:function(control,callbacks,options){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments)
},createFeature:function(pixel){var lonlat=this.control.map.getLonLatFromPixel(pixel);
this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat));
this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));
this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));
this.callback("create",[this.point.geometry,this.getSketch()]);
this.point.geometry.clearBounds();
this.layer.addFeatures([this.polygon,this.point],{silent:true})
},destroyFeature:function(){OpenLayers.Handler.Path.prototype.destroyFeature.apply(this);
this.polygon=null
},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);
this.layer.drawFeature(this.point,this.style)
},getSketch:function(){return this.polygon
},getGeometry:function(){var geometry=this.polygon&&this.polygon.geometry;
if(geometry&&this.multi){geometry=new OpenLayers.Geometry.MultiPolygon([geometry])
}return geometry
},dblclick:function(evt){if(!this.freehandMode(evt)){var index=this.line.geometry.components.length-2;
this.line.geometry.removeComponent(this.line.geometry.components[index]);
this.removePoint();
this.finalize()
}return false
},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(components){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)
},split:function(geometry,options){var results=null;
var mutual=options&&options.mutual;
var splits,sourceLine,sourceLines,sourceSplit,targetSplit;
var sourceParts=[];
var targetParts=[geometry];
for(var i=0,len=this.components.length;
i<len;
++i){sourceLine=this.components[i];
sourceSplit=false;
for(var j=0;
j<targetParts.length;
++j){splits=sourceLine.split(targetParts[j],options);
if(splits){if(mutual){sourceLines=splits[0];
for(var k=0,klen=sourceLines.length;
k<klen;
++k){if(k===0&&sourceParts.length){sourceParts[sourceParts.length-1].addComponent(sourceLines[k])
}else{sourceParts.push(new OpenLayers.Geometry.MultiLineString([sourceLines[k]]))
}}sourceSplit=true;
splits=splits[1]
}if(splits.length){splits.unshift(j,1);
Array.prototype.splice.apply(targetParts,splits);
break
}}}if(!sourceSplit){if(sourceParts.length){sourceParts[sourceParts.length-1].addComponent(sourceLine.clone())
}else{sourceParts=[new OpenLayers.Geometry.MultiLineString(sourceLine.clone())]
}}}if(sourceParts&&sourceParts.length>1){sourceSplit=true
}else{sourceParts=[]
}if(targetParts&&targetParts.length>1){targetSplit=true
}else{targetParts=[]
}if(sourceSplit||targetSplit){if(mutual){results=[sourceParts,targetParts]
}else{results=targetParts
}}return results
},splitWith:function(geometry,options){var results=null;
var mutual=options&&options.mutual;
var splits,targetLine,sourceLines,sourceSplit,targetSplit,sourceParts,targetParts;
if(geometry instanceof OpenLayers.Geometry.LineString){targetParts=[];
sourceParts=[geometry];
for(var i=0,len=this.components.length;
i<len;
++i){targetSplit=false;
targetLine=this.components[i];
for(var j=0;
j<sourceParts.length;
++j){splits=sourceParts[j].split(targetLine,options);
if(splits){if(mutual){sourceLines=splits[0];
if(sourceLines.length){sourceLines.unshift(j,1);
Array.prototype.splice.apply(sourceParts,sourceLines);
j+=sourceLines.length-2
}splits=splits[1];
if(splits.length===0){splits=[targetLine.clone()]
}}for(var k=0,klen=splits.length;
k<klen;
++k){if(k===0&&targetParts.length){targetParts[targetParts.length-1].addComponent(splits[k])
}else{targetParts.push(new OpenLayers.Geometry.MultiLineString([splits[k]]))
}}targetSplit=true
}}if(!targetSplit){if(targetParts.length){targetParts[targetParts.length-1].addComponent(targetLine.clone())
}else{targetParts=[new OpenLayers.Geometry.MultiLineString([targetLine.clone()])]
}}}}else{results=geometry.split(this)
}if(sourceParts&&sourceParts.length>1){sourceSplit=true
}else{sourceParts=[]
}if(targetParts&&targetParts.length>1){targetSplit=true
}else{targetParts=[]
}if(sourceSplit||targetSplit){if(mutual){results=[sourceParts,targetParts]
}else{results=targetParts
}}return results
},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(components){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,initialize:function(options){OpenLayers.Format.JSON.prototype.initialize.apply(this,[options])
},read:function(json,type,filter){type=(type)?type:"FeatureCollection";
var results=null;
var obj=null;
if(typeof json=="string"){obj=OpenLayers.Format.JSON.prototype.read.apply(this,[json,filter])
}else{obj=json
}if(!obj){OpenLayers.Console.error("Bad JSON: "+json)
}else{if(typeof(obj.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+json)
}else{if(this.isValidType(obj,type)){switch(type){case"Geometry":try{results=this.parseGeometry(obj)
}catch(err){OpenLayers.Console.error(err)
}break;
case"Feature":try{results=this.parseFeature(obj);
results.type="Feature"
}catch(err){OpenLayers.Console.error(err)
}break;
case"FeatureCollection":results=[];
switch(obj.type){case"Feature":try{results.push(this.parseFeature(obj))
}catch(err){results=null;
OpenLayers.Console.error(err)
}break;
case"FeatureCollection":for(var i=0,len=obj.features.length;
i<len;
++i){try{results.push(this.parseFeature(obj.features[i]))
}catch(err){results=null;
OpenLayers.Console.error(err)
}}break;
default:try{var geom=this.parseGeometry(obj);
results.push(new OpenLayers.Feature.Vector(geom))
}catch(err){results=null;
OpenLayers.Console.error(err)
}}break
}}}}return results
},isValidType:function(obj,type){var valid=false;
switch(type){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],obj.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+obj.type)
}else{valid=true
}break;
case"FeatureCollection":valid=true;
break;
default:if(obj.type==type){valid=true
}else{OpenLayers.Console.error("Cannot convert types from "+obj.type+" to "+type)
}}return valid
},parseFeature:function(obj){var feature,geometry,attributes,bbox;
attributes=(obj.properties)?obj.properties:{};
bbox=(obj.geometry&&obj.geometry.bbox)||obj.bbox;
try{geometry=this.parseGeometry(obj.geometry)
}catch(err){throw err
}feature=new OpenLayers.Feature.Vector(geometry,attributes);
if(bbox){feature.bounds=OpenLayers.Bounds.fromArray(bbox)
}if(obj.id){feature.fid=obj.id
}return feature
},parseGeometry:function(obj){if(obj==null){return null
}var geometry,collection=false;
if(obj.type=="GeometryCollection"){if(!(obj.geometries instanceof Array)){throw"GeometryCollection must have geometries array: "+obj
}var numGeom=obj.geometries.length;
var components=new Array(numGeom);
for(var i=0;
i<numGeom;
++i){components[i]=this.parseGeometry.apply(this,[obj.geometries[i]])
}geometry=new OpenLayers.Geometry.Collection(components);
collection=true
}else{if(!(obj.coordinates instanceof Array)){throw"Geometry must have coordinates array: "+obj
}if(!this.parseCoords[obj.type.toLowerCase()]){throw"Unsupported geometry type: "+obj.type
}try{geometry=this.parseCoords[obj.type.toLowerCase()].apply(this,[obj.coordinates])
}catch(err){throw err
}}if(this.internalProjection&&this.externalProjection&&!collection){geometry.transform(this.externalProjection,this.internalProjection)
}return geometry
},parseCoords:{point:function(array){if(this.ignoreExtraDims==false&&array.length!=2){throw"Only 2D points are supported: "+array
}return new OpenLayers.Geometry.Point(array[0],array[1])
},multipoint:function(array){var points=[];
var p=null;
for(var i=0,len=array.length;
i<len;
++i){try{p=this.parseCoords.point.apply(this,[array[i]])
}catch(err){throw err
}points.push(p)
}return new OpenLayers.Geometry.MultiPoint(points)
},linestring:function(array){var points=[];
var p=null;
for(var i=0,len=array.length;
i<len;
++i){try{p=this.parseCoords.point.apply(this,[array[i]])
}catch(err){throw err
}points.push(p)
}return new OpenLayers.Geometry.LineString(points)
},multilinestring:function(array){var lines=[];
var l=null;
for(var i=0,len=array.length;
i<len;
++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])
}catch(err){throw err
}lines.push(l)
}return new OpenLayers.Geometry.MultiLineString(lines)
},polygon:function(array){var rings=[];
var r,l;
for(var i=0,len=array.length;
i<len;
++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])
}catch(err){throw err
}r=new OpenLayers.Geometry.LinearRing(l.components);
rings.push(r)
}return new OpenLayers.Geometry.Polygon(rings)
},multipolygon:function(array){var polys=[];
var p=null;
for(var i=0,len=array.length;
i<len;
++i){try{p=this.parseCoords.polygon.apply(this,[array[i]])
}catch(err){throw err
}polys.push(p)
}return new OpenLayers.Geometry.MultiPolygon(polys)
},box:function(array){if(array.length!=2){throw"GeoJSON box coordinates must have 2 elements"
}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(array[0][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[0][1])])])
}},write:function(obj,pretty){var geojson={type:null};
if(obj instanceof Array){geojson.type="FeatureCollection";
var numFeatures=obj.length;
geojson.features=new Array(numFeatures);
for(var i=0;
i<numFeatures;
++i){var element=obj[i];
if(!element instanceof OpenLayers.Feature.Vector){var msg="FeatureCollection only supports collections of features: "+element;
throw msg
}geojson.features[i]=this.extract.feature.apply(this,[element])
}}else{if(obj.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){geojson=this.extract.geometry.apply(this,[obj])
}else{if(obj instanceof OpenLayers.Feature.Vector){geojson=this.extract.feature.apply(this,[obj]);
if(obj.layer&&obj.layer.projection){geojson.crs=this.createCRSObject(obj)
}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[geojson,pretty])
},createCRSObject:function(object){var proj=object.layer.projection.toString();
var crs={};
if(proj.match(/epsg:/i)){var code=parseInt(proj.substring(proj.indexOf(":")+1));
if(code==4326){crs={type:"OGC",properties:{urn:"urn:ogc:def:crs:OGC:1.3:CRS84"}}
}else{crs={type:"EPSG",properties:{code:code}}
}}return crs
},extract:{feature:function(feature){var geom=this.extract.geometry.apply(this,[feature.geometry]);
return{type:"Feature",id:feature.fid==null?feature.id:feature.fid,properties:feature.attributes,geometry:geom}
},geometry:function(geometry){if(geometry==null){return null
}if(this.internalProjection&&this.externalProjection){geometry=geometry.clone();
geometry.transform(this.internalProjection,this.externalProjection)
}var geometryType=geometry.CLASS_NAME.split(".")[2];
var data=this.extract[geometryType.toLowerCase()].apply(this,[geometry]);
var json;
if(geometryType=="Collection"){json={type:"GeometryCollection",geometries:data}
}else{json={type:geometryType,coordinates:data}
}return json
},point:function(point){return[point.x,point.y]
},multipoint:function(multipoint){var array=[];
for(var i=0,len=multipoint.components.length;
i<len;
++i){array.push(this.extract.point.apply(this,[multipoint.components[i]]))
}return array
},linestring:function(linestring){var array=[];
for(var i=0,len=linestring.components.length;
i<len;
++i){array.push(this.extract.point.apply(this,[linestring.components[i]]))
}return array
},multilinestring:function(multilinestring){var array=[];
for(var i=0,len=multilinestring.components.length;
i<len;
++i){array.push(this.extract.linestring.apply(this,[multilinestring.components[i]]))
}return array
},polygon:function(polygon){var array=[];
for(var i=0,len=polygon.components.length;
i<len;
++i){array.push(this.extract.linestring.apply(this,[polygon.components[i]]))
}return array
},multipolygon:function(multipolygon){var array=[];
for(var i=0,len=multipolygon.components.length;
i<len;
++i){array.push(this.extract.polygon.apply(this,[multipolygon.components[i]]))
}return array
},collection:function(collection){var len=collection.components.length;
var array=new Array(len);
for(var i=0;
i<len;
++i){array[i]=this.extract.geometry.apply(this,[collection.components[i]])
}return array
}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(options){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};
OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var featureNodes=this.getElementsByTagNameNS(data.documentElement,this.gmlns,this.featureName);
var features=[];
for(var i=0;
i<featureNodes.length;
i++){var feature=this.parseFeature(featureNodes[i]);
if(feature){features.push(feature)
}}return features
},parseFeature:function(node){var order=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];
var type,nodeList,geometry,parser;
for(var i=0;
i<order.length;
++i){type=order[i];
nodeList=this.getElementsByTagNameNS(node,this.gmlns,type);
if(nodeList.length>0){parser=this.parseGeometry[type.toLowerCase()];
if(parser){geometry=parser.apply(this,[nodeList[0]]);
if(this.internalProjection&&this.externalProjection){geometry.transform(this.externalProjection,this.internalProjection)
}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:type}))
}break
}}var bounds;
var boxNodes=this.getElementsByTagNameNS(node,this.gmlns,"Box");
for(i=0;
i<boxNodes.length;
++i){var boxNode=boxNodes[i];
var box=this.parseGeometry.box.apply(this,[boxNode]);
var parentNode=boxNode.parentNode;
var parentName=parentNode.localName||parentNode.nodeName.split(":").pop();
if(parentName==="boundedBy"){bounds=box
}else{geometry=box.toGeometry()
}}var attributes;
if(this.extractAttributes){attributes=this.parseAttributes(node)
}var feature=new OpenLayers.Feature.Vector(geometry,attributes);
feature.bounds=bounds;
feature.gml={featureType:node.firstChild.nodeName.split(":")[1],featureNS:node.firstChild.namespaceURI,featureNSPrefix:node.firstChild.prefix};
var childNode=node.firstChild;
var fid;
while(childNode){if(childNode.nodeType==1){fid=childNode.getAttribute("fid")||childNode.getAttribute("id");
if(fid){break
}}childNode=childNode.nextSibling
}feature.fid=fid;
return feature
},parseGeometry:{point:function(node){var nodeList,coordString;
var coords=[];
var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"pos");
if(nodeList.length>0){coordString=nodeList[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.trimSpace,"");
coords=coordString.split(this.regExes.splitSpace)
}if(coords.length==0){nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates");
if(nodeList.length>0){coordString=nodeList[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.removeSpace,"");
coords=coordString.split(",")
}}if(coords.length==0){nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coord");
if(nodeList.length>0){var xList=this.getElementsByTagNameNS(nodeList[0],this.gmlns,"X");
var yList=this.getElementsByTagNameNS(nodeList[0],this.gmlns,"Y");
if(xList.length>0&&yList.length>0){coords=[xList[0].firstChild.nodeValue,yList[0].firstChild.nodeValue]
}}}if(coords.length==2){coords[2]=null
}if(this.xy){return new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{return new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}},multipoint:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"Point");
var components=[];
if(nodeList.length>0){var point;
for(var i=0;
i<nodeList.length;
++i){point=this.parseGeometry.point.apply(this,[nodeList[i]]);
if(point){components.push(point)
}}}return new OpenLayers.Geometry.MultiPoint(components)
},linestring:function(node,ring){var nodeList,coordString;
var coords=[];
var points=[];
nodeList=this.getElementsByTagNameNS(node,this.gmlns,"posList");
if(nodeList.length>0){coordString=this.getChildValue(nodeList[0]);
coordString=coordString.replace(this.regExes.trimSpace,"");
coords=coordString.split(this.regExes.splitSpace);
var dim=parseInt(nodeList[0].getAttribute("dimension"));
var j,x,y,z;
for(var i=0;
i<coords.length/dim;
++i){j=i*dim;
x=coords[j];
y=coords[j+1];
z=(dim==2)?null:coords[j+2];
if(this.xy){points.push(new OpenLayers.Geometry.Point(x,y,z))
}else{points.push(new OpenLayers.Geometry.Point(y,x,z))
}}}if(coords.length==0){nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates");
if(nodeList.length>0){coordString=this.getChildValue(nodeList[0]);
coordString=coordString.replace(this.regExes.trimSpace,"");
coordString=coordString.replace(this.regExes.trimComma,",");
var pointList=coordString.split(this.regExes.splitSpace);
for(var i=0;
i<pointList.length;
++i){coords=pointList[i].split(",");
if(coords.length==2){coords[2]=null
}if(this.xy){points.push(new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]))
}else{points.push(new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2]))
}}}}var line=null;
if(points.length!=0){if(ring){line=new OpenLayers.Geometry.LinearRing(points)
}else{line=new OpenLayers.Geometry.LineString(points)
}}return line
},multilinestring:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"LineString");
var components=[];
if(nodeList.length>0){var line;
for(var i=0;
i<nodeList.length;
++i){line=this.parseGeometry.linestring.apply(this,[nodeList[i]]);
if(line){components.push(line)
}}}return new OpenLayers.Geometry.MultiLineString(components)
},polygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"LinearRing");
var components=[];
if(nodeList.length>0){var ring;
for(var i=0;
i<nodeList.length;
++i){ring=this.parseGeometry.linestring.apply(this,[nodeList[i],true]);
if(ring){components.push(ring)
}}}return new OpenLayers.Geometry.Polygon(components)
},multipolygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"Polygon");
var components=[];
if(nodeList.length>0){var polygon;
for(var i=0;
i<nodeList.length;
++i){polygon=this.parseGeometry.polygon.apply(this,[nodeList[i]]);
if(polygon){components.push(polygon)
}}}return new OpenLayers.Geometry.MultiPolygon(components)
},envelope:function(node){var components=[];
var coordString;
var envelope;
var lpoint=this.getElementsByTagNameNS(node,this.gmlns,"lowerCorner");
if(lpoint.length>0){var coords=[];
if(lpoint.length>0){coordString=lpoint[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.trimSpace,"");
coords=coordString.split(this.regExes.splitSpace)
}if(coords.length==2){coords[2]=null
}if(this.xy){var lowerPoint=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{var lowerPoint=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}}var upoint=this.getElementsByTagNameNS(node,this.gmlns,"upperCorner");
if(upoint.length>0){var coords=[];
if(upoint.length>0){coordString=upoint[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.trimSpace,"");
coords=coordString.split(this.regExes.splitSpace)
}if(coords.length==2){coords[2]=null
}if(this.xy){var upperPoint=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{var upperPoint=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}}if(lowerPoint&&upperPoint){components.push(new OpenLayers.Geometry.Point(lowerPoint.x,lowerPoint.y));
components.push(new OpenLayers.Geometry.Point(upperPoint.x,lowerPoint.y));
components.push(new OpenLayers.Geometry.Point(upperPoint.x,upperPoint.y));
components.push(new OpenLayers.Geometry.Point(lowerPoint.x,upperPoint.y));
components.push(new OpenLayers.Geometry.Point(lowerPoint.x,lowerPoint.y));
var ring=new OpenLayers.Geometry.LinearRing(components);
envelope=new OpenLayers.Geometry.Polygon([ring])
}return envelope
},box:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates");
var coordString;
var coords,beginPoint=null,endPoint=null;
if(nodeList.length>0){coordString=nodeList[0].firstChild.nodeValue;
coords=coordString.split(" ");
if(coords.length==2){beginPoint=coords[0].split(",");
endPoint=coords[1].split(",")
}}if(beginPoint!==null&&endPoint!==null){return new OpenLayers.Bounds(parseFloat(beginPoint[0]),parseFloat(beginPoint[1]),parseFloat(endPoint[0]),parseFloat(endPoint[1]))
}}},parseAttributes:function(node){var attributes={};
var childNode=node.firstChild;
var children,i,child,grandchildren,grandchild,name,value;
while(childNode){if(childNode.nodeType==1){children=childNode.childNodes;
for(i=0;
i<children.length;
++i){child=children[i];
if(child.nodeType==1){grandchildren=child.childNodes;
if(grandchildren.length==1){grandchild=grandchildren[0];
if(grandchild.nodeType==3||grandchild.nodeType==4){name=(child.prefix)?child.nodeName.split(":")[1]:child.nodeName;
value=grandchild.nodeValue.replace(this.regExes.trimSpace,"");
attributes[name]=value
}}else{attributes[child.nodeName.split(":").pop()]=null
}}}break
}childNode=childNode.nextSibling
}return attributes
},write:function(features){if(!(features instanceof Array)){features=[features]
}var gml=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);
for(var i=0;
i<features.length;
i++){gml.appendChild(this.createFeatureXML(features[i]))
}return OpenLayers.Format.XML.prototype.write.apply(this,[gml])
},createFeatureXML:function(feature){var geometry=feature.geometry;
var geometryNode=this.buildGeometryNode(geometry);
var geomContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);
geomContainer.appendChild(geometryNode);
var featureNode=this.createElementNS(this.gmlns,"gml:"+this.featureName);
var featureContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);
var fid=feature.fid||feature.id;
featureContainer.setAttribute("fid",fid);
featureContainer.appendChild(geomContainer);
for(var attr in feature.attributes){var attrText=this.createTextNode(feature.attributes[attr]);
var nodename=attr.substring(attr.lastIndexOf(":")+1);
var attrContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+nodename);
attrContainer.appendChild(attrText);
featureContainer.appendChild(attrContainer)
}featureNode.appendChild(featureContainer);
return featureNode
},buildGeometryNode:function(geometry){if(this.externalProjection&&this.internalProjection){geometry=geometry.clone();
geometry.transform(this.internalProjection,this.externalProjection)
}var className=geometry.CLASS_NAME;
var type=className.substring(className.lastIndexOf(".")+1);
var builder=this.buildGeometry[type.toLowerCase()];
return builder.apply(this,[geometry])
},buildGeometry:{point:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:Point");
gml.appendChild(this.buildCoordinatesNode(geometry));
return gml
},multipoint:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:MultiPoint");
var points=geometry.components;
var pointMember,pointGeom;
for(var i=0;
i<points.length;
i++){pointMember=this.createElementNS(this.gmlns,"gml:pointMember");
pointGeom=this.buildGeometry.point.apply(this,[points[i]]);
pointMember.appendChild(pointGeom);
gml.appendChild(pointMember)
}return gml
},linestring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:LineString");
gml.appendChild(this.buildCoordinatesNode(geometry));
return gml
},multilinestring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:MultiLineString");
var lines=geometry.components;
var lineMember,lineGeom;
for(var i=0;
i<lines.length;
++i){lineMember=this.createElementNS(this.gmlns,"gml:lineStringMember");
lineGeom=this.buildGeometry.linestring.apply(this,[lines[i]]);
lineMember.appendChild(lineGeom);
gml.appendChild(lineMember)
}return gml
},linearring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:LinearRing");
gml.appendChild(this.buildCoordinatesNode(geometry));
return gml
},polygon:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:Polygon");
var rings=geometry.components;
var ringMember,ringGeom,type;
for(var i=0;
i<rings.length;
++i){type=(i==0)?"outerBoundaryIs":"innerBoundaryIs";
ringMember=this.createElementNS(this.gmlns,"gml:"+type);
ringGeom=this.buildGeometry.linearring.apply(this,[rings[i]]);
ringMember.appendChild(ringGeom);
gml.appendChild(ringMember)
}return gml
},multipolygon:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:MultiPolygon");
var polys=geometry.components;
var polyMember,polyGeom;
for(var i=0;
i<polys.length;
++i){polyMember=this.createElementNS(this.gmlns,"gml:polygonMember");
polyGeom=this.buildGeometry.polygon.apply(this,[polys[i]]);
polyMember.appendChild(polyGeom);
gml.appendChild(polyMember)
}return gml
},bounds:function(bounds){var gml=this.createElementNS(this.gmlns,"gml:Box");
gml.appendChild(this.buildCoordinatesNode(bounds));
return gml
}},buildCoordinatesNode:function(geometry){var coordinatesNode=this.createElementNS(this.gmlns,"gml:coordinates");
coordinatesNode.setAttribute("decimal",".");
coordinatesNode.setAttribute("cs",",");
coordinatesNode.setAttribute("ts"," ");
var parts=[];
if(geometry instanceof OpenLayers.Bounds){parts.push(geometry.left+","+geometry.bottom);
parts.push(geometry.right+","+geometry.top)
}else{var points=(geometry.components)?geometry.components:[geometry];
for(var i=0;
i<points.length;
i++){parts.push(points[i].x+","+points[i].y)
}}var txtNode=this.createTextNode(parts.join(" "));
coordinatesNode.appendChild(txtNode);
return coordinatesNode
},CLASS_NAME:"OpenLayers.Format.GML"});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={}
}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);
this.setGeometryTypes();
if(options&&options.featureNS){this.setNamespace("feature",options.featureNS)
}this.singleFeatureType=!options||(typeof options.featureType==="string")
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var features=[];
this.readNode(data,{features:features});
if(features.length==0){var elements=this.getElementsByTagNameNS(data,this.namespaces.gml,"featureMember");
if(elements.length){for(var i=0,len=elements.length;
i<len;
++i){this.readNode(elements[i],{features:features})
}}else{var elements=this.getElementsByTagNameNS(data,this.namespaces.gml,"featureMembers");
if(elements.length){this.readNode(elements[0],{features:features})
}}}return features
},readers:{gml:{featureMember:function(node,obj){this.readChildNodes(node,obj)
},featureMembers:function(node,obj){this.readChildNodes(node,obj)
},name:function(node,obj){obj.name=this.getChildValue(node)
},boundedBy:function(node,obj){var container={};
this.readChildNodes(node,container);
if(container.components&&container.components.length>0){obj.bounds=container.components[0]
}},Point:function(node,container){var obj={points:[]};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}container.components.push(obj.points[0])
},coordinates:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
str=str.replace(this.regExes.trimComma,",");
var pointList=str.split(this.regExes.splitSpace);
var coords;
var numPoints=pointList.length;
var points=new Array(numPoints);
for(var i=0;
i<numPoints;
++i){coords=pointList[i].split(",");
if(this.xy){points[i]=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{points[i]=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}}obj.points=points
},coord:function(node,obj){var coord={};
this.readChildNodes(node,coord);
if(!obj.points){obj.points=[]
}obj.points.push(new OpenLayers.Geometry.Point(coord.x,coord.y,coord.z))
},X:function(node,coord){coord.x=this.getChildValue(node)
},Y:function(node,coord){coord.y=this.getChildValue(node)
},Z:function(node,coord){coord.z=this.getChildValue(node)
},MultiPoint:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
container.components=[new OpenLayers.Geometry.MultiPoint(obj.components)]
},pointMember:function(node,obj){this.readChildNodes(node,obj)
},LineString:function(node,container){var obj={};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}container.components.push(new OpenLayers.Geometry.LineString(obj.points))
},MultiLineString:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
container.components=[new OpenLayers.Geometry.MultiLineString(obj.components)]
},lineStringMember:function(node,obj){this.readChildNodes(node,obj)
},Polygon:function(node,container){var obj={outer:null,inner:[]};
this.readChildNodes(node,obj);
obj.inner.unshift(obj.outer);
if(!container.components){container.components=[]
}container.components.push(new OpenLayers.Geometry.Polygon(obj.inner))
},LinearRing:function(node,obj){var container={};
this.readChildNodes(node,container);
obj.components=[new OpenLayers.Geometry.LinearRing(container.points)]
},MultiPolygon:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
container.components=[new OpenLayers.Geometry.MultiPolygon(obj.components)]
},polygonMember:function(node,obj){this.readChildNodes(node,obj)
},GeometryCollection:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
container.components=[new OpenLayers.Geometry.Collection(obj.components)]
},geometryMember:function(node,obj){this.readChildNodes(node,obj)
}},feature:{"*":function(node,obj){var name;
var local=node.localName||node.nodeName.split(":").pop();
if(obj.features){if(!this.singleFeatureType&&(OpenLayers.Util.indexOf(this.featureType,local)!==-1)){name="_typeName"
}else{if(local===this.featureType){name="_typeName"
}}}else{if(node.childNodes.length==0||(node.childNodes.length==1&&node.firstChild.nodeType==3)){if(this.extractAttributes){name="_attribute"
}}else{name="_geometry"
}}if(name){this.readers.feature[name].apply(this,[node,obj])
}},_typeName:function(node,obj){var container={components:[],attributes:{}};
this.readChildNodes(node,container);
if(container.name){container.attributes.name=container.name
}var feature=new OpenLayers.Feature.Vector(container.components[0],container.attributes);
if(!this.singleFeatureType){feature.type=node.nodeName.split(":").pop();
feature.namespace=node.namespaceURI
}var fid=node.getAttribute("fid")||this.getAttributeNS(node,this.namespaces.gml,"id");
if(fid){feature.fid=fid
}if(this.internalProjection&&this.externalProjection&&feature.geometry){feature.geometry.transform(this.externalProjection,this.internalProjection)
}if(container.bounds){feature.bounds=container.bounds
}obj.features.push(feature)
},_geometry:function(node,obj){this.readChildNodes(node,obj)
},_attribute:function(node,obj){var local=node.localName||node.nodeName.split(":").pop();
var value=this.getChildValue(node);
obj.attributes[local]=value
}},wfs:{FeatureCollection:function(node,obj){this.readChildNodes(node,obj)
}}},write:function(features){var name;
if(features instanceof Array){name="featureMembers"
}else{name="featureMember"
}var root=this.writeNode("gml:"+name,features);
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},writers:{gml:{featureMember:function(feature){var node=this.createElementNSPlus("gml:featureMember");
this.writeNode("feature:_typeName",feature,node);
return node
},MultiPoint:function(geometry){var node=this.createElementNSPlus("gml:MultiPoint");
for(var i=0;
i<geometry.components.length;
++i){this.writeNode("pointMember",geometry.components[i],node)
}return node
},pointMember:function(geometry){var node=this.createElementNSPlus("gml:pointMember");
this.writeNode("Point",geometry,node);
return node
},MultiLineString:function(geometry){var node=this.createElementNSPlus("gml:MultiLineString");
for(var i=0;
i<geometry.components.length;
++i){this.writeNode("lineStringMember",geometry.components[i],node)
}return node
},lineStringMember:function(geometry){var node=this.createElementNSPlus("gml:lineStringMember");
this.writeNode("LineString",geometry,node);
return node
},MultiPolygon:function(geometry){var node=this.createElementNSPlus("gml:MultiPolygon");
for(var i=0;
i<geometry.components.length;
++i){this.writeNode("polygonMember",geometry.components[i],node)
}return node
},polygonMember:function(geometry){var node=this.createElementNSPlus("gml:polygonMember");
this.writeNode("Polygon",geometry,node);
return node
},GeometryCollection:function(geometry){var node=this.createElementNSPlus("gml:GeometryCollection");
for(var i=0,len=geometry.components.length;
i<len;
++i){this.writeNode("geometryMember",geometry.components[i],node)
}return node
},geometryMember:function(geometry){var node=this.createElementNSPlus("gml:geometryMember");
var child=this.writeNode("feature:_geometry",geometry);
node.appendChild(child.firstChild);
return node
}},feature:{_typeName:function(feature){var node=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:feature.fid}});
if(feature.geometry){this.writeNode("feature:_geometry",feature.geometry,node)
}for(var name in feature.attributes){var value=feature.attributes[name];
if(value!=null){this.writeNode("feature:_attribute",{name:name,value:value},node)
}}return node
},_geometry:function(geometry){if(this.externalProjection&&this.internalProjection){geometry=geometry.clone().transform(this.internalProjection,this.externalProjection)
}var node=this.createElementNSPlus("feature:"+this.geometryName);
var type=this.geometryTypes[geometry.CLASS_NAME];
var child=this.writeNode("gml:"+type,geometry,node);
if(this.srsName){child.setAttribute("srsName",this.srsName)
}return node
},_attribute:function(obj){return this.createElementNSPlus("feature:"+obj.name,{value:obj.value})
}},wfs:{FeatureCollection:function(features){var node=this.createElementNSPlus("wfs:FeatureCollection");
for(var i=0,len=features.length;
i<len;
++i){this.writeNode("gml:featureMember",features[i],node)
}return node
}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}
},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(options){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[options])
},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(node,obj){this.readChildNodes(node,obj)
},Curve:function(node,container){var obj={points:[]};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}container.components.push(new OpenLayers.Geometry.LineString(obj.points))
},segments:function(node,obj){this.readChildNodes(node,obj)
},LineStringSegment:function(node,container){var obj={};
this.readChildNodes(node,obj);
if(obj.points){Array.prototype.push.apply(container.points,obj.points)
}},pos:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}obj.points=[point]
},posList:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var dim=parseInt(node.getAttribute("dimension"))||2;
var j,x,y,z;
var numPoints=coords.length/dim;
var points=new Array(numPoints);
for(var i=0,len=coords.length;
i<len;
i+=dim){x=coords[i];
y=coords[i+1];
z=(dim==2)?undefined:coords[i+2];
if(this.xy){points[i/dim]=new OpenLayers.Geometry.Point(x,y,z)
}else{points[i/dim]=new OpenLayers.Geometry.Point(y,x,z)
}}obj.points=points
},Surface:function(node,obj){this.readChildNodes(node,obj)
},patches:function(node,obj){this.readChildNodes(node,obj)
},PolygonPatch:function(node,obj){this.readers.gml.Polygon.apply(this,[node,obj])
},exterior:function(node,container){var obj={};
this.readChildNodes(node,obj);
container.outer=obj.components[0]
},interior:function(node,container){var obj={};
this.readChildNodes(node,obj);
container.inner.push(obj.components[0])
},MultiCurve:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
if(obj.components.length>0){container.components=[new OpenLayers.Geometry.MultiLineString(obj.components)]
}},curveMember:function(node,obj){this.readChildNodes(node,obj)
},MultiSurface:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
if(obj.components.length>0){container.components=[new OpenLayers.Geometry.MultiPolygon(obj.components)]
}},surfaceMember:function(node,obj){this.readChildNodes(node,obj)
},surfaceMembers:function(node,obj){this.readChildNodes(node,obj)
},pointMembers:function(node,obj){this.readChildNodes(node,obj)
},lineStringMembers:function(node,obj){this.readChildNodes(node,obj)
},polygonMembers:function(node,obj){this.readChildNodes(node,obj)
},geometryMembers:function(node,obj){this.readChildNodes(node,obj)
},Envelope:function(node,container){var obj={points:new Array(2)};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}var min=obj.points[0];
var max=obj.points[1];
container.components.push(new OpenLayers.Bounds(min.x,min.y,max.x,max.y))
},lowerCorner:function(node,container){var obj={};
this.readers.gml.pos.apply(this,[node,obj]);
container.points[0]=obj.points[0]
},upperCorner:function(node,container){var obj={};
this.readers.gml.pos.apply(this,[node,obj]);
container.points[1]=obj.points[0]
}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(features){var name;
if(features instanceof Array){name="featureMembers"
}else{name="featureMember"
}var root=this.writeNode("gml:"+name,features);
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(features){var node=this.createElementNSPlus("gml:featureMembers");
for(var i=0,len=features.length;
i<len;
++i){this.writeNode("feature:_typeName",features[i],node)
}return node
},Point:function(geometry){var node=this.createElementNSPlus("gml:Point");
this.writeNode("pos",geometry,node);
return node
},pos:function(point){var pos=(this.xy)?(point.x+" "+point.y):(point.y+" "+point.x);
return this.createElementNSPlus("gml:pos",{value:pos})
},LineString:function(geometry){var node=this.createElementNSPlus("gml:LineString");
this.writeNode("posList",geometry.components,node);
return node
},Curve:function(geometry){var node=this.createElementNSPlus("gml:Curve");
this.writeNode("segments",geometry,node);
return node
},segments:function(geometry){var node=this.createElementNSPlus("gml:segments");
this.writeNode("LineStringSegment",geometry,node);
return node
},LineStringSegment:function(geometry){var node=this.createElementNSPlus("gml:LineStringSegment");
this.writeNode("posList",geometry.components,node);
return node
},posList:function(points){var len=points.length;
var parts=new Array(len);
var point;
for(var i=0;
i<len;
++i){point=points[i];
if(this.xy){parts[i]=point.x+" "+point.y
}else{parts[i]=point.y+" "+point.x
}}return this.createElementNSPlus("gml:posList",{value:parts.join(" ")})
},Surface:function(geometry){var node=this.createElementNSPlus("gml:Surface");
this.writeNode("patches",geometry,node);
return node
},patches:function(geometry){var node=this.createElementNSPlus("gml:patches");
this.writeNode("PolygonPatch",geometry,node);
return node
},PolygonPatch:function(geometry){var node=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});
this.writeNode("exterior",geometry.components[0],node);
for(var i=1,len=geometry.components.length;
i<len;
++i){this.writeNode("interior",geometry.components[i],node)
}return node
},Polygon:function(geometry){var node=this.createElementNSPlus("gml:Polygon");
this.writeNode("exterior",geometry.components[0],node);
for(var i=1,len=geometry.components.length;
i<len;
++i){this.writeNode("interior",geometry.components[i],node)
}return node
},exterior:function(ring){var node=this.createElementNSPlus("gml:exterior");
this.writeNode("LinearRing",ring,node);
return node
},interior:function(ring){var node=this.createElementNSPlus("gml:interior");
this.writeNode("LinearRing",ring,node);
return node
},LinearRing:function(ring){var node=this.createElementNSPlus("gml:LinearRing");
this.writeNode("posList",ring.components,node);
return node
},MultiCurve:function(geometry){var node=this.createElementNSPlus("gml:MultiCurve");
for(var i=0,len=geometry.components.length;
i<len;
++i){this.writeNode("curveMember",geometry.components[i],node)
}return node
},curveMember:function(geometry){var node=this.createElementNSPlus("gml:curveMember");
if(this.curve){this.writeNode("Curve",geometry,node)
}else{this.writeNode("LineString",geometry,node)
}return node
},MultiSurface:function(geometry){var node=this.createElementNSPlus("gml:MultiSurface");
for(var i=0,len=geometry.components.length;
i<len;
++i){this.writeNode("surfaceMember",geometry.components[i],node)
}return node
},surfaceMember:function(polygon){var node=this.createElementNSPlus("gml:surfaceMember");
if(this.surface){this.writeNode("Surface",polygon,node)
}else{this.writeNode("Polygon",polygon,node)
}return node
},Envelope:function(bounds){var node=this.createElementNSPlus("gml:Envelope");
this.writeNode("lowerCorner",bounds,node);
this.writeNode("upperCorner",bounds,node);
if(this.srsName){node.setAttribute("srsName",this.srsName)
}return node
},lowerCorner:function(bounds){var pos=(this.xy)?(bounds.left+" "+bounds.bottom):(bounds.bottom+" "+bounds.left);
return this.createElementNSPlus("gml:lowerCorner",{value:pos})
},upperCorner:function(bounds){var pos=(this.xy)?(bounds.right+" "+bounds.top):(bounds.top+" "+bounds.right);
return this.createElementNSPlus("gml:upperCorner",{value:pos})
}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}
},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Element={visible:function(element){return OpenLayers.Util.getElement(element).style.display!="none"
},toggle:function(){for(var i=0,len=arguments.length;
i<len;
i++){var element=OpenLayers.Util.getElement(arguments[i]);
var display=OpenLayers.Element.visible(element)?"hide":"show";
OpenLayers.Element[display](element)
}},hide:function(){for(var i=0,len=arguments.length;
i<len;
i++){var element=OpenLayers.Util.getElement(arguments[i]);
if(element){element.style.display="none"
}}},show:function(){for(var i=0,len=arguments.length;
i<len;
i++){var element=OpenLayers.Util.getElement(arguments[i]);
if(element){element.style.display=""
}}},remove:function(element){element=OpenLayers.Util.getElement(element);
element.parentNode.removeChild(element)
},getHeight:function(element){element=OpenLayers.Util.getElement(element);
return element.offsetHeight
},getDimensions:function(element){element=OpenLayers.Util.getElement(element);
if(OpenLayers.Element.getStyle(element,"display")!="none"){return{width:element.offsetWidth,height:element.offsetHeight}
}var els=element.style;
var originalVisibility=els.visibility;
var originalPosition=els.position;
var originalDisplay=els.display;
els.visibility="hidden";
els.position="absolute";
els.display="";
var originalWidth=element.clientWidth;
var originalHeight=element.clientHeight;
els.display=originalDisplay;
els.position=originalPosition;
els.visibility=originalVisibility;
return{width:originalWidth,height:originalHeight}
},hasClass:function(element,name){var names=element.className;
return(!!names&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(names))
},addClass:function(element,name){if(!OpenLayers.Element.hasClass(element,name)){element.className+=(element.className?" ":"")+name
}return element
},removeClass:function(element,name){var names=element.className;
if(names){element.className=OpenLayers.String.trim(names.replace(new RegExp("(^|\\s+)"+name+"(\\s+|$)")," "))
}return element
},toggleClass:function(element,name){if(OpenLayers.Element.hasClass(element,name)){OpenLayers.Element.removeClass(element,name)
}else{OpenLayers.Element.addClass(element,name)
}return element
},getStyle:function(element,style){element=OpenLayers.Util.getElement(element);
var value=null;
if(element&&element.style){value=element.style[OpenLayers.String.camelize(style)];
if(!value){if(document.defaultView&&document.defaultView.getComputedStyle){var css=document.defaultView.getComputedStyle(element,null);
value=css?css.getPropertyValue(style):null
}else{if(element.currentStyle){value=element.currentStyle[OpenLayers.String.camelize(style)]
}}}var positions=["left","top","right","bottom"];
if(window.opera&&(OpenLayers.Util.indexOf(positions,style)!=-1)&&(OpenLayers.Element.getStyle(element,"position")=="static")){value="auto"
}}return value=="auto"?null:value
}};OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:true,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)
},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);
this.wheelListener=null
},onWheelEvent:function(e){if(!this.map||!this.checkModifiers(e)){return
}var overScrollableDiv=false;
var overLayerDiv=false;
var overMapDiv=false;
var elem=OpenLayers.Event.element(e);
while((elem!=null)&&!overMapDiv&&!overScrollableDiv){if(!overScrollableDiv){try{if(elem.currentStyle){overflow=elem.currentStyle.overflow
}else{var style=document.defaultView.getComputedStyle(elem,null);
var overflow=style.getPropertyValue("overflow")
}overScrollableDiv=(overflow&&(overflow=="auto")||(overflow=="scroll"))
}catch(err){}}if(!overLayerDiv){for(var i=0,len=this.map.layers.length;
i<len;
i++){if(elem==this.map.layers[i].div||elem==this.map.layers[i].pane){overLayerDiv=true;
break
}}}overMapDiv=(elem==this.map.div);
elem=elem.parentNode
}if(!overScrollableDiv&&overMapDiv){if(overLayerDiv){var delta=0;
if(!e){e=window.event
}if(e.wheelDelta){delta=e.wheelDelta/120;
if(window.opera&&window.opera.version()<9.2){delta=-delta
}}else{if(e.detail){delta=-e.detail/3
}}this.delta=this.delta+delta;
if(this.interval){window.clearTimeout(this._timeoutId);
this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(e)
},this),this.interval)
}else{this.wheelZoom(e)
}}OpenLayers.Event.stop(e)
}},wheelZoom:function(e){var delta=this.delta;
this.delta=0;
if(delta){if(this.mousePosition){e.xy=this.mousePosition
}if(!e.xy){e.xy=this.map.getPixelFromLonLat(this.map.getCenter())
}if(delta<0){this.callback("down",[e,this.cumulative?delta:-1])
}else{this.callback("up",[e,this.cumulative?delta:1])
}}},mousemove:function(evt){this.mousePosition=evt.xy
},activate:function(evt){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var wheelListener=this.wheelListener;
OpenLayers.Event.observe(window,"DOMMouseScroll",wheelListener);
OpenLayers.Event.observe(window,"mousewheel",wheelListener);
OpenLayers.Event.observe(document,"mousewheel",wheelListener);
return true
}else{return false
}},deactivate:function(evt){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var wheelListener=this.wheelListener;
OpenLayers.Event.stopObserving(window,"DOMMouseScroll",wheelListener);
OpenLayers.Event.stopObserving(window,"mousewheel",wheelListener);
OpenLayers.Event.stopObserving(document,"mousewheel",wheelListener);
return true
}else{return false
}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent()
}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(style,options){OpenLayers.Util.extend(this,options);
this.rules=[];
if(options&&options.rules){this.addRules(options.rules)
}this.setDefaultStyle(style||OpenLayers.Feature.Vector.style["default"]);
this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){for(var i=0,len=this.rules.length;
i<len;
i++){this.rules[i].destroy();
this.rules[i]=null
}this.rules=null;
this.defaultStyle=null
},createSymbolizer:function(feature){var style=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),feature);
var rules=this.rules;
var rule,context;
var elseRules=[];
var appliedRules=false;
for(var i=0,len=rules.length;
i<len;
i++){rule=rules[i];
var applies=rule.evaluate(feature);
if(applies){if(rule instanceof OpenLayers.Rule&&rule.elseFilter){elseRules.push(rule)
}else{appliedRules=true;
this.applySymbolizer(rule,style,feature)
}}}if(appliedRules==false&&elseRules.length>0){appliedRules=true;
for(var i=0,len=elseRules.length;
i<len;
i++){this.applySymbolizer(elseRules[i],style,feature)
}}if(rules.length>0&&appliedRules==false){style.display="none"
}return style
},applySymbolizer:function(rule,style,feature){var symbolizerPrefix=feature.geometry?this.getSymbolizerPrefix(feature.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];
var symbolizer=rule.symbolizer[symbolizerPrefix]||rule.symbolizer;
if(this.defaultsPerSymbolizer===true){var defaults=this.defaultStyle;
OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:defaults.pointRadius});
if(symbolizer.stroke===true||symbolizer.graphic===true){OpenLayers.Util.applyDefaults(symbolizer,{strokeWidth:defaults.strokeWidth,strokeColor:defaults.strokeColor,strokeOpacity:defaults.strokeOpacity,strokeDashstyle:defaults.strokeDashstyle,strokeLinecap:defaults.strokeLinecap})
}if(symbolizer.fill===true||symbolizer.graphic===true){OpenLayers.Util.applyDefaults(symbolizer,{fillColor:defaults.fillColor,fillOpacity:defaults.fillOpacity})
}if(symbolizer.graphic===true){OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})
}}return this.createLiterals(OpenLayers.Util.extend(style,symbolizer),feature)
},createLiterals:function(style,feature){var context=OpenLayers.Util.extend({},feature.attributes||feature.data);
OpenLayers.Util.extend(context,this.context);
for(var i in this.propertyStyles){style[i]=OpenLayers.Style.createLiteral(style[i],context,feature,i)
}return style
},findPropertyStyles:function(){var propertyStyles={};
var style=this.defaultStyle;
this.addPropertyStyles(propertyStyles,style);
var rules=this.rules;
var symbolizer,value;
for(var i=0,len=rules.length;
i<len;
i++){symbolizer=rules[i].symbolizer;
for(var key in symbolizer){value=symbolizer[key];
if(typeof value=="object"){this.addPropertyStyles(propertyStyles,value)
}else{this.addPropertyStyles(propertyStyles,symbolizer);
break
}}}return propertyStyles
},addPropertyStyles:function(propertyStyles,symbolizer){var property;
for(var key in symbolizer){property=symbolizer[key];
if(typeof property=="string"&&property.match(/\$\{\w+\}/)){propertyStyles[key]=true
}}return propertyStyles
},addRules:function(rules){Array.prototype.push.apply(this.rules,rules);
this.propertyStyles=this.findPropertyStyles()
},setDefaultStyle:function(style){this.defaultStyle=style;
this.propertyStyles=this.findPropertyStyles()
},getSymbolizerPrefix:function(geometry){var prefixes=OpenLayers.Style.SYMBOLIZER_PREFIXES;
for(var i=0,len=prefixes.length;
i<len;
i++){if(geometry.CLASS_NAME.indexOf(prefixes[i])!=-1){return prefixes[i]
}}},clone:function(){var options=OpenLayers.Util.extend({},this);
if(this.rules){options.rules=[];
for(var i=0,len=this.rules.length;
i<len;
++i){options.rules.push(this.rules[i].clone())
}}options.context=this.context&&OpenLayers.Util.extend({},this.context);
var defaultStyle=OpenLayers.Util.extend({},this.defaultStyle);
return new OpenLayers.Style(defaultStyle,options)
},CLASS_NAME:"OpenLayers.Style"});
OpenLayers.Style.createLiteral=function(value,context,feature,property){if(typeof value=="string"&&value.indexOf("${")!=-1){value=OpenLayers.String.format(value,context,[feature,property]);
value=(isNaN(value)||!value)?value:parseFloat(value)
}return value
};
OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(options){OpenLayers.Util.extend(this,options)
},destroy:function(){},evaluate:function(context){return true
},clone:function(){return null
},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,initialize:function(options){this.fids=[];
OpenLayers.Filter.prototype.initialize.apply(this,[options])
},evaluate:function(feature){for(var i=0,len=this.fids.length;
i<len;
i++){var fid=feature.fid||feature.id;
if(fid==this.fids[i]){return true
}}return false
},clone:function(){var filter=new OpenLayers.Filter.FeatureId();
OpenLayers.Util.extend(filter,this);
filter.fids=this.fids.slice();
return filter
},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(options){this.filters=[];
OpenLayers.Filter.prototype.initialize.apply(this,[options])
},destroy:function(){this.filters=null;
OpenLayers.Filter.prototype.destroy.apply(this)
},evaluate:function(context){switch(this.type){case OpenLayers.Filter.Logical.AND:for(var i=0,len=this.filters.length;
i<len;
i++){if(this.filters[i].evaluate(context)==false){return false
}}return true;
case OpenLayers.Filter.Logical.OR:for(var i=0,len=this.filters.length;
i<len;
i++){if(this.filters[i].evaluate(context)==true){return true
}}return false;
case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(context))
}},clone:function(){var filters=[];
for(var i=0,len=this.filters.length;
i<len;
++i){filters.push(this.filters[i].clone())
}return new OpenLayers.Filter.Logical({type:this.type,filters:filters})
},CLASS_NAME:"OpenLayers.Filter.Logical"});
OpenLayers.Filter.Logical.AND="&&";
OpenLayers.Filter.Logical.OR="||";
OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(options){OpenLayers.Filter.prototype.initialize.apply(this,[options])
},evaluate:function(context){if(context instanceof OpenLayers.Feature.Vector){context=context.attributes
}var result=false;
var got=context[this.property];
switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:var exp=this.value;
if(!this.matchCase&&typeof got=="string"&&typeof exp=="string"){result=(got.toUpperCase()==exp.toUpperCase())
}else{result=(got==exp)
}break;
case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:var exp=this.value;
if(!this.matchCase&&typeof got=="string"&&typeof exp=="string"){result=(got.toUpperCase()!=exp.toUpperCase())
}else{result=(got!=exp)
}break;
case OpenLayers.Filter.Comparison.LESS_THAN:result=got<this.value;
break;
case OpenLayers.Filter.Comparison.GREATER_THAN:result=got>this.value;
break;
case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:result=got<=this.value;
break;
case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:result=got>=this.value;
break;
case OpenLayers.Filter.Comparison.BETWEEN:result=(got>=this.lowerBoundary)&&(got<=this.upperBoundary);
break;
case OpenLayers.Filter.Comparison.LIKE:var regexp=new RegExp(this.value,"gi");
result=regexp.test(got);
break
}return result
},value2regex:function(wildCard,singleChar,escapeChar){if(wildCard=="."){var msg="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";
OpenLayers.Console.error(msg);
return null
}wildCard=wildCard?wildCard:"*";
singleChar=singleChar?singleChar:".";
escapeChar=escapeChar?escapeChar:"!";
this.value=this.value.replace(new RegExp("\\"+escapeChar+"(.|$)","g"),"\\$1");
this.value=this.value.replace(new RegExp("\\"+singleChar,"g"),".");
this.value=this.value.replace(new RegExp("\\"+wildCard,"g"),".*");
this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+wildCard);
this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+singleChar);
return this.value
},regex2value:function(){var value=this.value;
value=value.replace(/!/g,"!!");
value=value.replace(/(\\)?\\\./g,function($0,$1){return $1?$0:"!."
});
value=value.replace(/(\\)?\\\*/g,function($0,$1){return $1?$0:"!*"
});
value=value.replace(/\\\\/g,"\\");
value=value.replace(/\.\*/g,"*");
return value
},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison(),this)
},CLASS_NAME:"OpenLayers.Filter.Comparison"});
OpenLayers.Filter.Comparison.EQUAL_TO="==";
OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";
OpenLayers.Filter.Comparison.LESS_THAN="<";
OpenLayers.Filter.Comparison.GREATER_THAN=">";
OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";
OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";
OpenLayers.Filter.Comparison.BETWEEN="..";
OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},write:function(filter,options){var version=(options&&options.version)||this.version||this.defaultVersion;
if(!this.parser||this.parser.VERSION!=version){var format=OpenLayers.Format.Filter["v"+version.replace(/\./g,"_")];
if(!format){throw"Can't find a Filter parser for version "+version
}this.parser=new format(this.options)
}return this.parser.write(filter)
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var version=this.version;
if(!version){version=this.defaultVersion
}if(!this.parser||this.parser.VERSION!=version){var format=OpenLayers.Format.Filter["v"+version.replace(/\./g,"_")];
if(!format){throw"Can't find a Filter parser for version "+version
}this.parser=new format(this.options)
}var filter=this.parser.read(data);
return filter
},CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(options){options=options||{};
OpenLayers.Util.extend(this,options);
this.options=options
},mergeWithDefaultFilter:function(filter){var merged;
if(filter&&this.defaultFilter){merged=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,filter]})
}else{merged=filter||this.defaultFilter||undefined
}return merged
},destroy:function(){this.options=null;
this.format=null
},read:function(options){options=options||{};
options.filter=this.mergeWithDefaultFilter(options.filter)
},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(response){},createCallback:function(method,response,options){return OpenLayers.Function.bind(function(){method.apply(this,[response,options])
},this)
},CLASS_NAME:"OpenLayers.Protocol"});
OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,initialize:function(options){OpenLayers.Util.extend(this,options)
},success:function(){return this.code>0
},CLASS_NAME:"OpenLayers.Protocol.Response"});
OpenLayers.Protocol.Response.SUCCESS=1;
OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,wildcarded:false,initialize:function(options){options=options||{};
this.params={};
this.headers={};
OpenLayers.Protocol.prototype.initialize.apply(this,arguments)
},destroy:function(){this.params=null;
this.headers=null;
OpenLayers.Protocol.prototype.destroy.apply(this)
},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments);
options=OpenLayers.Util.applyDefaults(options,this.options);
options.params=OpenLayers.Util.applyDefaults(options.params,this.options.params);
if(options.filter){options.params=this.filterToParams(options.filter,options.params)
}var readWithPOST=(options.readWithPOST!==undefined)?options.readWithPOST:this.readWithPOST;
var resp=new OpenLayers.Protocol.Response({requestType:"read"});
if(readWithPOST){resp.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,resp,options),data:OpenLayers.Util.getParameterString(options.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})
}else{resp.priv=OpenLayers.Request.GET({url:options.url,callback:this.createCallback(this.handleRead,resp,options),params:options.params,headers:options.headers})
}return resp
},handleRead:function(resp,options){this.handleResponse(resp,options)
},filterToParams:function(filter,params){params=params||{};
var className=filter.CLASS_NAME;
var filterType=className.substring(className.lastIndexOf(".")+1);
switch(filterType){case"Spatial":switch(filter.type){case OpenLayers.Filter.Spatial.BBOX:params.bbox=filter.value.toArray();
break;
case OpenLayers.Filter.Spatial.DWITHIN:params.tolerance=filter.distance;
case OpenLayers.Filter.Spatial.WITHIN:params.lon=filter.value.x;
params.lat=filter.value.y;
break;
default:OpenLayers.Console.warn("Unknown spatial filter type "+filter.type)
}break;
case"Comparison":var op=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR[filter.type];
if(op!==undefined){var value=filter.value;
if(filter.type==OpenLayers.Filter.Comparison.LIKE){value=this.regex2value(value);
if(this.wildcarded){value="%"+value+"%"
}}params[filter.property+"__"+op]=value;
params.queryable=params.queryable||[];
params.queryable.push(filter.property)
}else{OpenLayers.Console.warn("Unknown comparison filter type "+filter.type)
}break;
case"Logical":if(filter.type===OpenLayers.Filter.Logical.AND){for(var i=0,len=filter.filters.length;
i<len;
i++){params=this.filterToParams(filter.filters[i],params)
}}else{OpenLayers.Console.warn("Unsupported logical filter type "+filter.type)
}break;
default:OpenLayers.Console.warn("Unknown filter type "+filterType)
}return params
},regex2value:function(value){value=value.replace(/%/g,"\\%");
value=value.replace(/\\\\\.(\*)?/g,function($0,$1){return $1?$0:"\\\\_"
});
value=value.replace(/\\\\\.\*/g,"\\\\%");
value=value.replace(/(\\)?\.(\*)?/g,function($0,$1,$2){return $1||$2?$0:"_"
});
value=value.replace(/(\\)?\.\*/g,function($0,$1){return $1?$0:"%"
});
value=value.replace(/\\\./g,".");
value=value.replace(/(\\)?\\\*/g,function($0,$1){return $1?$0:"*"
});
return value
},create:function(features,options){options=OpenLayers.Util.applyDefaults(options,this.options);
var resp=new OpenLayers.Protocol.Response({reqFeatures:features,requestType:"create"});
resp.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleCreate,resp,options),headers:options.headers,data:this.format.write(features)});
return resp
},handleCreate:function(resp,options){this.handleResponse(resp,options)
},update:function(feature,options){options=options||{};
var url=options.url||feature.url||this.options.url+"/"+feature.fid;
options=OpenLayers.Util.applyDefaults(options,this.options);
var resp=new OpenLayers.Protocol.Response({reqFeatures:feature,requestType:"update"});
resp.priv=OpenLayers.Request.PUT({url:url,callback:this.createCallback(this.handleUpdate,resp,options),headers:options.headers,data:this.format.write(feature)});
return resp
},handleUpdate:function(resp,options){this.handleResponse(resp,options)
},"delete":function(feature,options){options=options||{};
var url=options.url||feature.url||this.options.url+"/"+feature.fid;
options=OpenLayers.Util.applyDefaults(options,this.options);
var resp=new OpenLayers.Protocol.Response({reqFeatures:feature,requestType:"delete"});
resp.priv=OpenLayers.Request.DELETE({url:url,callback:this.createCallback(this.handleDelete,resp,options),headers:options.headers});
return resp
},handleDelete:function(resp,options){this.handleResponse(resp,options)
},handleResponse:function(resp,options){var request=resp.priv;
if(options.callback){if(request.status>=200&&request.status<300){if(resp.requestType!="delete"){resp.features=this.parseFeatures(request)
}resp.code=OpenLayers.Protocol.Response.SUCCESS
}else{resp.code=OpenLayers.Protocol.Response.FAILURE
}options.callback.call(options.scope,resp)
}},parseFeatures:function(request){var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}if(!doc||doc.length<=0){return null
}return this.format.read(doc)
},commit:function(features,options){options=OpenLayers.Util.applyDefaults(options,this.options);
var resp=[],nResponses=0;
var types={};
types[OpenLayers.State.INSERT]=[];
types[OpenLayers.State.UPDATE]=[];
types[OpenLayers.State.DELETE]=[];
var feature,list,requestFeatures=[];
for(var i=0,len=features.length;
i<len;
++i){feature=features[i];
list=types[feature.state];
if(list){list.push(feature);
requestFeatures.push(feature)
}}var nRequests=(types[OpenLayers.State.INSERT].length>0?1:0)+types[OpenLayers.State.UPDATE].length+types[OpenLayers.State.DELETE].length;
var success=true;
var finalResponse=new OpenLayers.Protocol.Response({reqFeatures:requestFeatures});
function insertCallback(response){var len=response.features?response.features.length:0;
var fids=new Array(len);
for(var i=0;
i<len;
++i){fids[i]=response.features[i].fid
}finalResponse.insertIds=fids;
callback.apply(this,[response])
}function callback(response){this.callUserCallback(response,options);
success=success&&response.success();
nResponses++;
if(nResponses>=nRequests){if(options.callback){finalResponse.code=success?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;
options.callback.apply(options.scope,[finalResponse])
}}}var queue=types[OpenLayers.State.INSERT];
if(queue.length>0){resp.push(this.create(queue,OpenLayers.Util.applyDefaults({callback:insertCallback,scope:this},options.create)))
}queue=types[OpenLayers.State.UPDATE];
for(var i=queue.length-1;
i>=0;
--i){resp.push(this.update(queue[i],OpenLayers.Util.applyDefaults({callback:callback,scope:this},options.update)))
}queue=types[OpenLayers.State.DELETE];
for(var i=queue.length-1;
i>=0;
--i){resp.push(this["delete"](queue[i],OpenLayers.Util.applyDefaults({callback:callback,scope:this},options["delete"])))
}return resp
},abort:function(response){if(response){response.priv.abort()
}},callUserCallback:function(resp,options){var opt=options[resp.requestType];
if(opt&&opt.callback){opt.callback.call(opt.scope,resp)
}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});
(function(){var o=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR={};
o[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";
o[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";
o[OpenLayers.Filter.Comparison.LESS_THAN]="lt";
o[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";
o[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";
o[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";
o[OpenLayers.Filter.Comparison.LIKE]="ilike"
})();OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(containerID,options){this.container=OpenLayers.Util.getElement(containerID)
},destroy:function(){this.container=null;
this.extent=null;
this.size=null;
this.resolution=null;
this.map=null
},supported:function(){return false
},setExtent:function(extent,resolutionChanged){this.extent=extent.clone();
if(resolutionChanged){this.resolution=null
}},setSize:function(size){this.size=size.clone();
this.resolution=null
},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();
return this.resolution
},drawFeature:function(feature,style){if(style==null){style=feature.style
}if(feature.geometry){var bounds=feature.geometry.getBounds();
if(bounds){if(!bounds.intersectsBounds(this.extent)){style={display:"none"}
}var rendered=this.drawGeometry(feature.geometry,style,feature.id);
if(style.display!="none"&&style.label&&rendered!==false){var location=feature.geometry.getCentroid();
if(style.labelXOffset||style.labelYOffset){xOffset=isNaN(style.labelXOffset)?0:style.labelXOffset;
yOffset=isNaN(style.labelYOffset)?0:style.labelYOffset;
var res=this.getResolution();
location.move(xOffset*res,yOffset*res)
}this.drawText(feature.id,style,location)
}else{this.removeText(feature.id)
}return rendered
}}},drawGeometry:function(geometry,style,featureId){},drawText:function(featureId,style,location){},removeText:function(featureId){},clear:function(){},getFeatureIdFromEvent:function(evt){},eraseFeatures:function(features){if(!(features instanceof Array)){features=[features]
}for(var i=0,len=features.length;
i<len;
++i){var feature=features[i];
this.eraseGeometry(feature.geometry,feature.id);
this.removeText(feature.id)
}},eraseGeometry:function(geometry,featureId){},moveRoot:function(renderer){},getRenderLayerId:function(){return this.container.id
},applyDefaultSymbolizer:function(symbolizer){var result=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);
if(symbolizer.stroke===false){delete result.strokeWidth;
delete result.strokeColor
}if(symbolizer.fill===false){delete result.fillColor
}OpenLayers.Util.extend(result,symbolizer);
return result
},CLASS_NAME:"OpenLayers.Renderer"});
OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0};OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(yOrdering){this.compare=yOrdering?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;
this.order=[];
this.indices={};
this.maxZIndex=0
},insert:function(newNode){if(this.exists(newNode)){this.remove(newNode)
}var nodeId=newNode.id;
this.determineZIndex(newNode);
var leftIndex=-1;
var rightIndex=this.order.length;
var middle;
while(rightIndex-leftIndex>1){middle=parseInt((leftIndex+rightIndex)/2);
var placement=this.compare(this,newNode,OpenLayers.Util.getElement(this.order[middle]));
if(placement>0){leftIndex=middle
}else{rightIndex=middle
}}this.order.splice(rightIndex,0,nodeId);
this.indices[nodeId]=this.getZIndex(newNode);
return this.getNextElement(rightIndex)
},remove:function(node){var nodeId=node.id;
var arrayIndex=OpenLayers.Util.indexOf(this.order,nodeId);
if(arrayIndex>=0){this.order.splice(arrayIndex,1);
delete this.indices[nodeId];
if(this.order.length>0){var lastId=this.order[this.order.length-1];
this.maxZIndex=this.indices[lastId]
}else{this.maxZIndex=0
}}},clear:function(){this.order=[];
this.indices={};
this.maxZIndex=0
},exists:function(node){return(this.indices[node.id]!=null)
},getZIndex:function(node){return node._style.graphicZIndex
},determineZIndex:function(node){var zIndex=node._style.graphicZIndex;
if(zIndex==null){zIndex=this.maxZIndex;
node._style.graphicZIndex=zIndex
}else{if(zIndex>this.maxZIndex){this.maxZIndex=zIndex
}}},getNextElement:function(index){var nextIndex=index+1;
if(nextIndex<this.order.length){var nextElement=OpenLayers.Util.getElement(this.order[nextIndex]);
if(nextElement==undefined){nextElement=this.getNextElement(nextIndex)
}return nextElement
}else{return null
}},CLASS_NAME:"OpenLayers.ElementsIndexer"});
OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(indexer,newNode,nextNode){var newZIndex=indexer.getZIndex(newNode);
var returnVal=0;
if(nextNode){var nextZIndex=indexer.getZIndex(nextNode);
returnVal=newZIndex-nextZIndex
}return returnVal
},Z_ORDER_DRAWING_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);
if(nextNode&&returnVal==0){returnVal=1
}return returnVal
},Z_ORDER_Y_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);
if(nextNode&&returnVal===0){var result=nextNode._boundsBottom-newNode._boundsBottom;
returnVal=(result===0)?1:result
}return returnVal
}};
OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(containerID,options){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);
this.rendererRoot=this.createRenderRoot();
this.root=this.createRoot("_root");
this.vectorRoot=this.createRoot("_vroot");
this.textRoot=this.createRoot("_troot");
this.root.appendChild(this.vectorRoot);
this.root.appendChild(this.textRoot);
this.rendererRoot.appendChild(this.root);
this.container.appendChild(this.rendererRoot);
if(options&&(options.zIndexing||options.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(options.yOrdering)
}},destroy:function(){this.clear();
this.rendererRoot=null;
this.root=null;
this.xmlns=null;
OpenLayers.Renderer.prototype.destroy.apply(this,arguments)
},clear:function(){var child;
var root=this.vectorRoot;
if(root){while(child=root.firstChild){root.removeChild(child)
}}root=this.textRoot;
if(root){while(child=root.firstChild){root.removeChild(child)
}}if(this.indexer){this.indexer.clear()
}},getNodeType:function(geometry,style){},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME;
var rendered=true;
if((className=="OpenLayers.Geometry.Collection")||(className=="OpenLayers.Geometry.MultiPoint")||(className=="OpenLayers.Geometry.MultiLineString")||(className=="OpenLayers.Geometry.MultiPolygon")){for(var i=0,len=geometry.components.length;
i<len;
i++){rendered=this.drawGeometry(geometry.components[i],style,featureId)&&rendered
}return rendered
}rendered=false;
if(style.display!="none"){if(style.backgroundGraphic){this.redrawBackgroundNode(geometry.id,geometry,style,featureId)
}rendered=this.redrawNode(geometry.id,geometry,style,featureId)
}if(rendered==false){var node=document.getElementById(geometry.id);
if(node){if(node._style.backgroundGraphic){node.parentNode.removeChild(document.getElementById(geometry.id+this.BACKGROUND_ID_SUFFIX))
}node.parentNode.removeChild(node)
}}return rendered
},redrawNode:function(id,geometry,style,featureId){style=this.applyDefaultSymbolizer(style);
var node=this.nodeFactory(id,this.getNodeType(geometry,style));
node._featureId=featureId;
node._boundsBottom=geometry.getBounds().bottom;
node._geometryClass=geometry.CLASS_NAME;
node._style=style;
var drawResult=this.drawGeometryNode(node,geometry,style);
if(drawResult===false){return false
}node=drawResult.node;
if(this.indexer){var insert=this.indexer.insert(node);
if(insert){this.vectorRoot.insertBefore(node,insert)
}else{this.vectorRoot.appendChild(node)
}}else{if(node.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(node)
}}this.postDraw(node);
return drawResult.complete
},redrawBackgroundNode:function(id,geometry,style,featureId){var backgroundStyle=OpenLayers.Util.extend({},style);
backgroundStyle.externalGraphic=backgroundStyle.backgroundGraphic;
backgroundStyle.graphicXOffset=backgroundStyle.backgroundXOffset;
backgroundStyle.graphicYOffset=backgroundStyle.backgroundYOffset;
backgroundStyle.graphicZIndex=backgroundStyle.backgroundGraphicZIndex;
backgroundStyle.graphicWidth=backgroundStyle.backgroundWidth||backgroundStyle.graphicWidth;
backgroundStyle.graphicHeight=backgroundStyle.backgroundHeight||backgroundStyle.graphicHeight;
backgroundStyle.backgroundGraphic=null;
backgroundStyle.backgroundXOffset=null;
backgroundStyle.backgroundYOffset=null;
backgroundStyle.backgroundGraphicZIndex=null;
return this.redrawNode(id+this.BACKGROUND_ID_SUFFIX,geometry,backgroundStyle,null)
},drawGeometryNode:function(node,geometry,style){style=style||node._style;
var options={isFilled:style.fill===undefined?true:style.fill,isStroked:style.stroke===undefined?!!style.strokeWidth:style.stroke};
var drawn;
switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":if(style.graphic===false){options.isFilled=false;
options.isStroked=false
}drawn=this.drawPoint(node,geometry);
break;
case"OpenLayers.Geometry.LineString":options.isFilled=false;
drawn=this.drawLineString(node,geometry);
break;
case"OpenLayers.Geometry.LinearRing":drawn=this.drawLinearRing(node,geometry);
break;
case"OpenLayers.Geometry.Polygon":drawn=this.drawPolygon(node,geometry);
break;
case"OpenLayers.Geometry.Surface":drawn=this.drawSurface(node,geometry);
break;
case"OpenLayers.Geometry.Rectangle":drawn=this.drawRectangle(node,geometry);
break;
default:break
}node._options=options;
if(drawn!=false){return{node:this.setStyle(node,style,options,geometry),complete:drawn}
}else{return false
}},postDraw:function(node){},drawPoint:function(node,geometry){},drawLineString:function(node,geometry){},drawLinearRing:function(node,geometry){},drawPolygon:function(node,geometry){},drawRectangle:function(node,geometry){},drawCircle:function(node,geometry){},drawSurface:function(node,geometry){},removeText:function(featureId){var label=document.getElementById(featureId+this.LABEL_ID_SUFFIX);
if(label){this.textRoot.removeChild(label)
}},getFeatureIdFromEvent:function(evt){var target=evt.target;
var useElement=target&&target.correspondingUseElement;
var node=useElement?useElement:(target||evt.srcElement);
var featureId=node._featureId;
return featureId
},eraseGeometry:function(geometry,featureId){if((geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(geometry.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(geometry.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var i=0,len=geometry.components.length;
i<len;
i++){this.eraseGeometry(geometry.components[i],featureId)
}}else{var element=OpenLayers.Util.getElement(geometry.id);
if(element&&element.parentNode){if(element.geometry){element.geometry.destroy();
element.geometry=null
}element.parentNode.removeChild(element);
if(this.indexer){this.indexer.remove(element)
}if(element._style.backgroundGraphic){var backgroundId=geometry.id+this.BACKGROUND_ID_SUFFIX;
var bElem=OpenLayers.Util.getElement(backgroundId);
if(bElem&&bElem.parentNode){bElem.parentNode.removeChild(bElem)
}}}}},nodeFactory:function(id,type){var node=OpenLayers.Util.getElement(id);
if(node){if(!this.nodeTypeCompare(node,type)){node.parentNode.removeChild(node);
node=this.nodeFactory(id,type)
}}else{node=this.createNode(type,id)
}return node
},nodeTypeCompare:function(node,type){},createNode:function(type,id){},moveRoot:function(renderer){var root=this.root;
if(renderer.root.parentNode==this.rendererRoot){root=renderer.root
}root.parentNode.removeChild(root);
renderer.rendererRoot.appendChild(root)
},getRenderLayerId:function(){return this.root.parentNode.parentNode.id
},isComplexSymbol:function(graphicName){return(graphicName!="circle")&&!!graphicName
},CLASS_NAME:"OpenLayers.Renderer.Elements"});
OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(control,layer,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,[control,callbacks,options]);
this.layer=layer
},mousedown:function(evt){this.down=evt.xy;
return this.handle(evt)?!this.stopDown:true
},mouseup:function(evt){this.up=evt.xy;
return this.handle(evt)?!this.stopUp:true
},click:function(evt){return this.handle(evt)?!this.stopClick:true
},mousemove:function(evt){if(!this.callbacks.over&&!this.callbacks.out){return true
}this.handle(evt);
return true
},dblclick:function(evt){return !this.handle(evt)
},geometryTypeMatches:function(feature){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1
},handle:function(evt){if(this.feature&&!this.feature.layer){this.feature=null
}var type=evt.type;
var handled=false;
var previouslyIn=!!(this.feature);
var click=(type=="click"||type=="dblclick");
this.feature=this.layer.getFeatureFromEvent(evt);
if(this.feature&&!this.feature.layer){this.feature=null
}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null
}if(this.feature){var inNew=(this.feature!=this.lastFeature);
if(this.geometryTypeMatches(this.feature)){if(previouslyIn&&inNew){if(this.lastFeature){this.triggerCallback(type,"out",[this.lastFeature])
}this.triggerCallback(type,"in",[this.feature])
}else{if(!previouslyIn||click){this.triggerCallback(type,"in",[this.feature])
}}this.lastFeature=this.feature;
handled=true
}else{if(this.lastFeature&&(previouslyIn&&inNew||click)){this.triggerCallback(type,"out",[this.lastFeature])
}this.feature=null
}}else{if(this.lastFeature&&(previouslyIn||click)){this.triggerCallback(type,"out",[this.lastFeature])
}}return handled
},triggerCallback:function(type,mode,args){var key=this.EVENTMAP[type][mode];
if(key){if(type=="click"&&this.up&&this.down){var dpx=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));
if(dpx<=this.clickTolerance){this.callback(key,args)
}}else{this.callback(key,args)
}}},activate:function(){var activated=false;
if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();
this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});
activated=true
}return activated
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();
this.feature=null;
this.lastFeature=null;
this.down=null;
this.up=null;
this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});
deactivated=true
}return deactivated
},handleMapEvents:function(evt){if(!evt.property||evt.property=="order"){this.moveLayerToTop()
}},moveLayerToTop:function(){var index=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;
this.layer.setZIndex(index)
},moveLayerBack:function(){var index=this.layer.getZIndex()-1;
if(index>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(index)
}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))
}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(style,options){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};
if(style instanceof OpenLayers.Style){this.styles["default"]=style;
this.styles.select=style;
this.styles.temporary=style;
this.styles["delete"]=style
}else{if(typeof style=="object"){for(var key in style){if(style[key] instanceof OpenLayers.Style){this.styles[key]=style[key]
}else{if(typeof style[key]=="object"){this.styles[key]=new OpenLayers.Style(style[key])
}else{this.styles["default"]=new OpenLayers.Style(style);
this.styles.select=new OpenLayers.Style(style);
this.styles.temporary=new OpenLayers.Style(style);
this.styles["delete"]=new OpenLayers.Style(style);
break
}}}}}OpenLayers.Util.extend(this,options)
},destroy:function(){for(var key in this.styles){this.styles[key].destroy()
}this.styles=null
},createSymbolizer:function(feature,intent){if(!feature){feature=new OpenLayers.Feature.Vector()
}if(!this.styles[intent]){intent="default"
}feature.renderIntent=intent;
var defaultSymbolizer={};
if(this.extendDefault&&intent!="default"){defaultSymbolizer=this.styles["default"].createSymbolizer(feature)
}return OpenLayers.Util.extend(defaultSymbolizer,this.styles[intent].createSymbolizer(feature))
},addUniqueValueRules:function(renderIntent,property,symbolizers,context){var rules=[];
for(var value in symbolizers){rules.push(new OpenLayers.Rule({symbolizer:symbolizers[value],context:context,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:property,value:value})}))
}this.styles[renderIntent].addRules(rules)
},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,isVector:true,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(name,options){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);
OpenLayers.Layer.prototype.initialize.apply(this,arguments);
if(!this.renderer||!this.renderer.supported()){this.assignRenderer()
}if(!this.renderer||!this.renderer.supported()){this.renderer=null;
this.displayError()
}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap()
}this.features=[];
this.selectedFeatures=[];
this.unrenderedFeatures={};
if(this.strategies){for(var i=0,len=this.strategies.length;
i<len;
i++){this.strategies[i].setLayer(this)
}}},destroy:function(){if(this.strategies){var strategy,i,len;
for(i=0,len=this.strategies.length;
i<len;
i++){strategy=this.strategies[i];
if(strategy.autoDestroy){strategy.destroy()
}}this.strategies=null
}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()
}this.protocol=null
}this.destroyFeatures();
this.features=null;
this.selectedFeatures=null;
this.unrenderedFeatures=null;
if(this.renderer){this.renderer.destroy()
}this.renderer=null;
this.geometryType=null;
this.drawn=null;
OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.Vector(this.name,this.getOptions())
}obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);
var features=this.features;
var len=features.length;
var clonedFeatures=new Array(len);
for(var i=0;
i<len;
++i){clonedFeatures[i]=features[i].clone()
}obj.features=clonedFeatures;
return obj
},refresh:function(obj){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",obj)
}},assignRenderer:function(){for(var i=0,len=this.renderers.length;
i<len;
i++){var rendererClass=this.renderers[i];
var renderer=(typeof rendererClass=="function")?rendererClass:OpenLayers.Renderer[rendererClass];
if(renderer&&renderer.prototype.supported()){this.renderer=new renderer(this.div,this.rendererOptions);
break
}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))
}},setMap:function(map){OpenLayers.Layer.prototype.setMap.apply(this,arguments);
if(!this.renderer){this.map.removeLayer(this)
}else{this.renderer.map=this.map;
this.renderer.setSize(this.map.getSize())
}},afterAdd:function(){if(this.strategies){var strategy,i,len;
for(i=0,len=this.strategies.length;
i<len;
i++){strategy=this.strategies[i];
if(strategy.autoActivate){strategy.activate()
}}}},removeMap:function(map){this.drawn=false;
if(this.strategies){var strategy,i,len;
for(i=0,len=this.strategies.length;
i<len;
i++){strategy=this.strategies[i];
if(strategy.autoActivate){strategy.deactivate()
}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);
this.renderer.setSize(this.map.getSize())
},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);
var coordSysUnchanged=true;
if(!dragging){this.renderer.root.style.visibility="hidden";
this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";
this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";
var extent=this.map.getExtent();
coordSysUnchanged=this.renderer.setExtent(extent,zoomChanged);
this.renderer.root.style.visibility="visible";
if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.div.scrollLeft=this.div.scrollLeft
}if(!zoomChanged&&coordSysUnchanged){for(var i in this.unrenderedFeatures){var feature=this.unrenderedFeatures[i];
this.drawFeature(feature)
}}}if(!this.drawn||zoomChanged||!coordSysUnchanged){this.drawn=true;
var feature;
for(var i=0,len=this.features.length;
i<len;
i++){this.renderer.locked=(i!==(len-1));
feature=this.features[i];
this.drawFeature(feature)
}}},display:function(display){OpenLayers.Layer.prototype.display.apply(this,arguments);
var currentDisplay=this.div.style.display;
if(currentDisplay!=this.renderer.root.style.display){this.renderer.root.style.display=currentDisplay
}},addFeatures:function(features,options){if(!(features instanceof Array)){features=[features]
}var notify=!options||!options.silent;
if(notify){var event={features:features};
var ret=this.events.triggerEvent("beforefeaturesadded",event);
if(ret===false){return
}features=event.features
}var featuresAdded=[];
for(var i=0,len=features.length;
i<len;
i++){if(i!=(features.length-1)){this.renderer.locked=true
}else{this.renderer.locked=false
}var feature=features[i];
if(this.geometryType&&!(feature.geometry instanceof this.geometryType)){var throwStr=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});
throw throwStr
}feature.layer=this;
if(!feature.style&&this.style){feature.style=OpenLayers.Util.extend({},this.style)
}if(notify){if(this.events.triggerEvent("beforefeatureadded",{feature:feature})===false){continue
}this.preFeatureInsert(feature)
}featuresAdded.push(feature);
this.features.push(feature);
this.drawFeature(feature);
if(notify){this.events.triggerEvent("featureadded",{feature:feature});
this.onFeatureInsert(feature)
}}if(notify){this.events.triggerEvent("featuresadded",{features:featuresAdded})
}},removeFeatures:function(features,options){if(!features||features.length===0){return
}if(features===this.features){return this.removeAllFeatures(options)
}if(!(features instanceof Array)){features=[features]
}if(features===this.selectedFeatures){features=features.slice()
}var notify=!options||!options.silent;
if(notify){this.events.triggerEvent("beforefeaturesremoved",{features:features})
}for(var i=features.length-1;
i>=0;
i--){if(i!=0&&features[i-1].geometry){this.renderer.locked=true
}else{this.renderer.locked=false
}var feature=features[i];
delete this.unrenderedFeatures[feature.id];
if(notify){this.events.triggerEvent("beforefeatureremoved",{feature:feature})
}this.features=OpenLayers.Util.removeItem(this.features,feature);
feature.layer=null;
if(feature.geometry){this.renderer.eraseFeatures(feature)
}if(OpenLayers.Util.indexOf(this.selectedFeatures,feature)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,feature)
}if(notify){this.events.triggerEvent("featureremoved",{feature:feature})
}}if(notify){this.events.triggerEvent("featuresremoved",{features:features})
}},removeAllFeatures:function(options){var notify=!options||!options.silent;
var features=this.features;
if(notify){this.events.triggerEvent("beforefeaturesremoved",{features:features})
}var feature;
for(var i=features.length-1;
i>=0;
i--){feature=features[i];
if(notify){this.events.triggerEvent("beforefeatureremoved",{feature:feature})
}feature.layer=null;
if(notify){this.events.triggerEvent("featureremoved",{feature:feature})
}}this.renderer.clear();
this.features=[];
this.unrenderedFeatures={};
this.selectedFeatures=[];
if(notify){this.events.triggerEvent("featuresremoved",{features:features})
}},destroyFeatures:function(features,options){var all=(features==undefined);
if(all){features=this.features
}if(features){this.removeFeatures(features,options);
for(var i=features.length-1;
i>=0;
i--){features[i].destroy()
}}},drawFeature:function(feature,style){if(!this.drawn){return
}if(typeof style!="object"){if(!style&&feature.state===OpenLayers.State.DELETE){style="delete"
}var renderIntent=style||feature.renderIntent;
style=feature.style||this.style;
if(!style){style=this.styleMap.createSymbolizer(feature,renderIntent)
}}if(!this.renderer.drawFeature(feature,style)){this.unrenderedFeatures[feature.id]=feature
}else{delete this.unrenderedFeatures[feature.id]
}},eraseFeatures:function(features){this.renderer.eraseFeatures(features)
},getFeatureFromEvent:function(evt){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));
return null
}var featureId=this.renderer.getFeatureIdFromEvent(evt);
return this.getFeatureById(featureId)
},getFeatureBy:function(property,value){var feature=null;
for(var i=0,len=this.features.length;
i<len;
++i){if(this.features[i][property]==value){feature=this.features[i];
break
}}return feature
},getFeatureById:function(featureId){return this.getFeatureBy("id",featureId)
},getFeatureByFid:function(featureFid){return this.getFeatureBy("fid",featureFid)
},onFeatureInsert:function(feature){},preFeatureInsert:function(feature){},getDataExtent:function(){var maxExtent=null;
var features=this.features;
if(features&&(features.length>0)){maxExtent=new OpenLayers.Bounds();
var geometry=null;
for(var i=0,len=features.length;
i<len;
i++){geometry=features[i].geometry;
if(geometry){maxExtent.extend(geometry.getBounds())
}}}return maxExtent
},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(name,options){OpenLayers.Layer.prototype.initialize.apply(this,arguments);
this.markers=[]
},destroy:function(){this.clearMarkers();
this.markers=null;
OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},setOpacity:function(opacity){if(opacity!=this.opacity){this.opacity=opacity;
for(var i=0,len=this.markers.length;
i<len;
i++){this.markers[i].setOpacity(this.opacity)
}}},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);
if(zoomChanged||!this.drawn){for(var i=0,len=this.markers.length;
i<len;
i++){this.drawMarker(this.markers[i])
}this.drawn=true
}},addMarker:function(marker){this.markers.push(marker);
if(this.opacity!=null){marker.setOpacity(this.opacity)
}if(this.map&&this.map.getExtent()){marker.map=this.map;
this.drawMarker(marker)
}},removeMarker:function(marker){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,marker);
marker.erase()
}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])
}}},drawMarker:function(marker){var px=this.map.getLayerPxFromLonLat(marker.lonlat);
if(px==null){marker.display(false)
}else{if(!marker.isDrawn()){var markerImg=marker.draw(px);
this.div.appendChild(markerImg)
}else{if(marker.icon){marker.icon.moveTo(px)
}}}},getDataExtent:function(){var maxExtent=null;
if(this.markers&&(this.markers.length>0)){var maxExtent=new OpenLayers.Bounds();
for(var i=0,len=this.markers.length;
i<len;
i++){var marker=this.markers[i];
maxExtent.extend(marker.lonlat)
}}return maxExtent
},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(name,options){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)
},display:function(){},getFeatureFromEvent:function(evt){var layers=this.layers;
var feature;
for(var i=0;
i<layers.length;
i++){feature=layers[i].getFeatureFromEvent(evt);
if(feature){return feature
}}},setMap:function(map){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);
this.collectRoots();
map.events.register("changelayer",this,this.handleChangeLayer)
},removeMap:function(map){map.events.unregister("changelayer",this,this.handleChangeLayer);
this.resetRoots();
OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)
},collectRoots:function(){var layer;
for(var i=0;
i<this.map.layers.length;
++i){layer=this.map.layers[i];
if(OpenLayers.Util.indexOf(this.layers,layer)!=-1){layer.renderer.moveRoot(this.renderer)
}}},resetRoots:function(){var layer;
for(var i=0;
i<this.layers.length;
++i){layer=this.layers[i];
if(this.renderer&&layer.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(layer.renderer)
}}},handleChangeLayer:function(evt){var layer=evt.layer;
if(evt.property=="order"&&OpenLayers.Util.indexOf(this.layers,layer)!=-1){this.resetRoots();
this.collectRoots()
}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(layers,options){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);
OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(this.scope===null){this.scope=this
}this.initLayer(layers);
var callbacks={click:this.clickFeature,clickout:this.clickoutFeature};
if(this.hover){callbacks.over=this.overFeature;
callbacks.out=this.outFeature
}this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks);
this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};
if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})
}},initLayer:function(layers){if(layers instanceof Array){this.layers=layers;
this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:layers})
}else{this.layer=layers
}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer)
}OpenLayers.Control.prototype.destroy.apply(this,arguments);
if(this.layers){this.layer.destroy()
}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)
}this.handlers.feature.activate();
if(this.box&&this.handlers.box){this.handlers.box.activate()
}}return OpenLayers.Control.prototype.activate.apply(this,arguments)
},deactivate:function(){if(this.active){this.handlers.feature.deactivate();
if(this.handlers.box){this.handlers.box.deactivate()
}if(this.layers){this.map.removeLayer(this.layer)
}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},unselectAll:function(options){var layers=this.layers||[this.layer];
var layer,feature;
for(var l=0;
l<layers.length;
++l){layer=layers[l];
for(var i=layer.selectedFeatures.length-1;
i>=0;
--i){feature=layer.selectedFeatures[i];
if(!options||options.except!=feature){this.unselect(feature)
}}}},clickFeature:function(feature){if(!this.hover){var selected=(OpenLayers.Util.indexOf(feature.layer.selectedFeatures,feature)>-1);
if(selected){if(this.toggleSelect()){this.unselect(feature)
}else{if(!this.multipleSelect()){this.unselectAll({except:feature})
}}}else{if(!this.multipleSelect()){this.unselectAll({except:feature})
}this.select(feature)
}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey])
},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey])
},clickoutFeature:function(feature){if(!this.hover&&this.clickout){this.unselectAll()
}},overFeature:function(feature){var layer=feature.layer;
if(this.hover){if(this.highlightOnly){this.highlight(feature)
}else{if(OpenLayers.Util.indexOf(layer.selectedFeatures,feature)==-1){this.select(feature)
}}}},outFeature:function(feature){if(this.hover){if(this.highlightOnly){if(feature._lastHighlighter==this.id){if(feature._prevHighlighter&&feature._prevHighlighter!=this.id){delete feature._lastHighlighter;
var control=this.map.getControl(feature._prevHighlighter);
if(control){control.highlight(feature)
}}else{this.unhighlight(feature)
}}}else{this.unselect(feature)
}}},highlight:function(feature){var layer=feature.layer;
var cont=this.events.triggerEvent("beforefeaturehighlighted",{feature:feature});
if(cont!==false){feature._prevHighlighter=feature._lastHighlighter;
feature._lastHighlighter=this.id;
var style=this.selectStyle||this.renderIntent;
layer.drawFeature(feature,style);
this.events.triggerEvent("featurehighlighted",{feature:feature})
}},unhighlight:function(feature){var layer=feature.layer;
feature._lastHighlighter=feature._prevHighlighter;
delete feature._prevHighlighter;
layer.drawFeature(feature,feature.style||feature.layer.style||"default");
this.events.triggerEvent("featureunhighlighted",{feature:feature})
},select:function(feature){var cont=this.onBeforeSelect.call(this.scope,feature);
var layer=feature.layer;
if(cont!==false){cont=layer.events.triggerEvent("beforefeatureselected",{feature:feature});
if(cont!==false){layer.selectedFeatures.push(feature);
this.highlight(feature);
if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=layer.selectedFeatures[0]
}layer.events.triggerEvent("featureselected",{feature:feature});
this.onSelect.call(this.scope,feature)
}}},unselect:function(feature){var layer=feature.layer;
this.unhighlight(feature);
OpenLayers.Util.removeItem(layer.selectedFeatures,feature);
layer.events.triggerEvent("featureunselected",{feature:feature});
this.onUnselect.call(this.scope,feature)
},selectBox:function(position){if(position instanceof OpenLayers.Bounds){var minXY=this.map.getLonLatFromPixel(new OpenLayers.Pixel(position.left,position.bottom));
var maxXY=this.map.getLonLatFromPixel(new OpenLayers.Pixel(position.right,position.top));
var bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);
if(!this.multipleSelect()){this.unselectAll()
}var prevMultiple=this.multiple;
this.multiple=true;
var layers=this.layers||[this.layer];
var layer;
for(var l=0;
l<layers.length;
++l){layer=layers[l];
for(var i=0,len=layer.features.length;
i<len;
++i){var feature=layer.features[i];
if(!feature.getVisibility()){continue
}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1){if(bounds.toGeometry().intersects(feature.geometry)){if(OpenLayers.Util.indexOf(layer.selectedFeatures,feature)==-1){this.select(feature)
}}}}}this.multiple=prevMultiple
}},setMap:function(map){this.handlers.feature.setMap(map);
if(this.box){this.handlers.box.setMap(map)
}OpenLayers.Control.prototype.setMap.apply(this,arguments)
},setLayer:function(layers){var isActive=this.active;
this.unselectAll();
this.deactivate();
if(this.layers){this.layer.destroy();
this.layers=null
}this.initLayer(layers);
this.handlers.feature.layer=this.layer;
if(isActive){this.activate()
}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);
var previousOptions={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};
OpenLayers.Util.extend(previousOptions,this.previousOptions);
this.previous=new OpenLayers.Control.Button(previousOptions);
var nextOptions={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};
OpenLayers.Util.extend(nextOptions,this.nextOptions);
this.next=new OpenLayers.Control.Button(nextOptions);
this.clear()
},onPreviousChange:function(state,length){if(state&&!this.previous.active){this.previous.activate()
}else{if(!state&&this.previous.active){this.previous.deactivate()
}}},onNextChange:function(state,length){if(state&&!this.next.active){this.next.activate()
}else{if(!state&&this.next.active){this.next.deactivate()
}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);
this.previous.destroy();
this.next.destroy();
this.deactivate();
for(var prop in this){this[prop]=null
}},setMap:function(map){this.map=map;
this.next.setMap(map);
this.previous.setMap(map)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
this.next.draw();
this.previous.draw()
},previousTrigger:function(){var current=this.previousStack.shift();
var state=this.previousStack.shift();
if(state!=undefined){this.nextStack.unshift(current);
this.previousStack.unshift(state);
this.restoring=true;
this.restore(state);
this.restoring=false;
this.onNextChange(this.nextStack[0],this.nextStack.length);
this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)
}else{this.previousStack.unshift(current)
}return state
},nextTrigger:function(){var state=this.nextStack.shift();
if(state!=undefined){this.previousStack.unshift(state);
this.restoring=true;
this.restore(state);
this.restoring=false;
this.onNextChange(this.nextStack[0],this.nextStack.length);
this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)
}return state
},clear:function(){this.previousStack=[];
this.previous.deactivate();
this.nextStack=[];
this.next.deactivate()
},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}
},restore:function(state){var center,zoom;
if(this.map.getProjectionObject()==state.projection){zoom=this.map.getZoomForResolution(state.resolution);
center=state.center
}else{center=state.center.clone();
center.transform(state.projection,this.map.getProjectionObject());
var sourceUnits=state.units;
var targetUnits=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;
var resolutionFactor=sourceUnits&&targetUnits?OpenLayers.INCHES_PER_UNIT[sourceUnits]/OpenLayers.INCHES_PER_UNIT[targetUnits]:1;
zoom=this.map.getZoomForResolution(resolutionFactor*state.resolution)
}this.map.setCenter(center,zoom)
},setListeners:function(){this.listeners={};
for(var type in this.registry){this.listeners[type]=OpenLayers.Function.bind(function(){if(!this.restoring){var state=this.registry[type].apply(this,arguments);
this.previousStack.unshift(state);
if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)
}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop()
}if(this.nextStack.length>0){this.nextStack=[];
this.onNextChange(null,0)
}}return true
},this)
}},activate:function(){var activated=false;
if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()
}for(var type in this.listeners){this.map.events.register(type,this,this.listeners[type])
}activated=true;
if(this.previousStack.length==0){this.initStack()
}}}return activated
},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()
}},deactivate:function(){var deactivated=false;
if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var type in this.listeners){this.map.events.unregister(type,this,this.listeners[type])
}if(this.clearOnDeactivate){this.clear()
}deactivated=true
}}return deactivated
},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});
this.updateAttribution();
return this.div
},updateAttribution:function(){var attributions=[];
if(this.map&&this.map.layers){for(var i=0,len=this.map.layers.length;
i<len;
i++){var layer=this.map.layers[i];
if(layer.attribution&&layer.getVisibility()){if(OpenLayers.Util.indexOf(attributions,layer.attribution)===-1){attributions.push(layer.attribution)
}}}this.div.innerHTML=attributions.join(this.separator)
}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","nogetfeatureinfo","getfeatureinfo"],initialize:function(options){this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);
options=options||{};
options.handlerOptions=options.handlerOptions||{};
OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(options.formatOptions)
}if(this.drillDown===true){this.hover=false
}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))
}else{var callbacks={};
callbacks[this.clickCallback]=this.getInfoForClick;
this.handler=new OpenLayers.Handler.Click(this,callbacks,this.handlerOptions.click||{})
}},activate:function(){if(!this.active){this.handler.activate()
}return OpenLayers.Control.prototype.activate.apply(this,arguments)
},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},getInfoForClick:function(evt){this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy});
OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");
this.request(evt.xy,{})
},getInfoForHover:function(evt){this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy});
this.request(evt.xy,{hover:true})
},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();
this.hoverRequest=null
}},findLayers:function(){var candidates=this.layers||this.map.layers;
var layers=[];
var layer,url;
for(var i=0,len=candidates.length;
i<len;
++i){layer=candidates[i];
if(layer instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||layer.getVisibility())){url=layer.url instanceof Array?layer.url[0]:layer.url;
if(this.drillDown===false&&!this.url){this.url=url
}if(this.drillDown===true||this.urlMatches(url)){layers.push(layer)
}}}return layers
},urlMatches:function(url){var matches=OpenLayers.Util.isEquivalentUrl(this.url,url);
if(!matches&&this.layerUrls){for(var i=0,len=this.layerUrls.length;
i<len;
++i){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],url)){matches=true;
break
}}}return matches
},buildWMSOptions:function(url,layers,clickPosition,format){var layerNames=[],styleNames=[];
for(var i=0,len=layers.length;
i<len;
i++){layerNames=layerNames.concat(layers[i].params.LAYERS);
styleNames=styleNames.concat(this.getStyleNames(layers[i]))
}var params=OpenLayers.Util.extend({service:"WMS",version:layers[0].params.VERSION,request:"GetFeatureInfo",layers:layerNames,query_layers:layerNames,styles:styleNames,bbox:this.map.getExtent().toBBOX(null,layers[0].reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:format,info_format:this.infoFormat},(parseFloat(layers[0].params.VERSION)>=1.3)?{crs:this.map.getProjection(),i:clickPosition.x,j:clickPosition.y}:{srs:this.map.getProjection(),x:clickPosition.x,y:clickPosition.y});
OpenLayers.Util.applyDefaults(params,this.vendorParams);
return{url:url,params:OpenLayers.Util.upperCaseObject(params),callback:function(request){this.handleResponse(clickPosition,request)
},scope:this}
},getStyleNames:function(layer){var styleNames;
if(layer.params.STYLES){styleNames=layer.params.STYLES
}else{if(layer.params.LAYERS instanceof Array){styleNames=new Array(layer.params.LAYERS.length)
}else{styleNames=layer.params.LAYERS.replace(/[^,]/g,"")
}}return styleNames
},request:function(clickPosition,options){var layers=this.findLayers();
if(layers.length==0){this.events.triggerEvent("nogetfeatureinfo");
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");
return
}options=options||{};
if(this.drillDown===false){var wmsOptions=this.buildWMSOptions(this.url,layers,clickPosition,layers[0].params.FORMAT);
var request=OpenLayers.Request.GET(wmsOptions);
if(options.hover===true){this.hoverRequest=request
}}else{this._requestCount=0;
this._numRequests=0;
this.features=[];
var services={},url;
for(var i=0,len=layers.length;
i<len;
i++){var layer=layers[i];
var service,found=false;
url=layer.url instanceof Array?layer.url[0]:layer.url;
if(url in services){services[url].push(layer)
}else{this._numRequests++;
services[url]=[layer]
}}var layers;
for(var url in services){layers=services[url];
var wmsOptions=this.buildWMSOptions(url,layers,clickPosition,layers[0].params.FORMAT);
OpenLayers.Request.GET(wmsOptions)
}}},triggerGetFeatureInfo:function(request,xy,features){this.events.triggerEvent("getfeatureinfo",{text:request.responseText,features:features,request:request,xy:xy});
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")
},handleResponse:function(xy,request){var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}var features=this.format.read(doc);
if(this.drillDown===false){this.triggerGetFeatureInfo(request,xy,features)
}else{this._requestCount++;
this._features=(this._features||[]).concat(features);
if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(request,xy,this._features.concat());
delete this._features;
delete this._requestCount;
delete this._numRequests
}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(config){var defaultConfig=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});
config=OpenLayers.Util.applyDefaults(config,defaultConfig);
var request=new OpenLayers.Request.XMLHttpRequest();
var url=config.url;
if(config.params){var paramString=OpenLayers.Util.getParameterString(config.params);
if(paramString.length>0){var separator=(url.indexOf("?")>-1)?"&":"?";
url+=separator+paramString
}}if(config.proxy&&(url.indexOf("http")==0)){if(typeof config.proxy=="function"){url=config.proxy(url)
}else{url=config.proxy+encodeURIComponent(url)
}}request.open(config.method,url,config.async,config.user,config.password);
for(var header in config.headers){request.setRequestHeader(header,config.headers[header])
}var events=this.events;
var self=this;
request.onreadystatechange=function(){if(request.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var proceed=events.triggerEvent("complete",{request:request,config:config,requestUrl:url});
if(proceed!==false){self.runCallbacks({request:request,config:config,requestUrl:url})
}}};
if(config.async===false){request.send(config.data)
}else{window.setTimeout(function(){if(request._aborted!==true){request.send(config.data)
}},0)
}return request
},runCallbacks:function(options){var request=options.request;
var config=options.config;
var complete=(config.scope)?OpenLayers.Function.bind(config.callback,config.scope):config.callback;
var success;
if(config.success){success=(config.scope)?OpenLayers.Function.bind(config.success,config.scope):config.success
}var failure;
if(config.failure){failure=(config.scope)?OpenLayers.Function.bind(config.failure,config.scope):config.failure
}complete(request);
if(!request.status||(request.status>=200&&request.status<300)){this.events.triggerEvent("success",options);
if(success){success(request)
}}if(request.status&&(request.status<200||request.status>=300)){this.events.triggerEvent("failure",options);
if(failure){failure(request)
}}},GET:function(config){config=OpenLayers.Util.extend(config,{method:"GET"});
return OpenLayers.Request.issue(config)
},POST:function(config){config=OpenLayers.Util.extend(config,{method:"POST"});
config.headers=config.headers?config.headers:{};
if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(config.headers))){config.headers["Content-Type"]="application/xml"
}return OpenLayers.Request.issue(config)
},PUT:function(config){config=OpenLayers.Util.extend(config,{method:"PUT"});
config.headers=config.headers?config.headers:{};
if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(config.headers))){config.headers["Content-Type"]="application/xml"
}return OpenLayers.Request.issue(config)
},DELETE:function(config){config=OpenLayers.Util.extend(config,{method:"DELETE"});
return OpenLayers.Request.issue(config)
},HEAD:function(config){config=OpenLayers.Util.extend(config,{method:"HEAD"});
return OpenLayers.Request.issue(config)
},OPTIONS:function(config){config=OpenLayers.Util.extend(config,{method:"OPTIONS"});
return OpenLayers.Request.issue(config)
}};(function(){var oXMLHttpRequest=window.XMLHttpRequest;
var bGecko=!!window.controllers,bIE=window.document.all&&!window.opera,bIE7=bIE&&window.navigator.userAgent.match(/MSIE ([\.0-9]+)/)&&RegExp.$1==7;
function cXMLHttpRequest(){this._object=oXMLHttpRequest&&!bIE7?new oXMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");
this._listeners=[]
}if(bGecko&&oXMLHttpRequest.wrapped){cXMLHttpRequest.wrapped=oXMLHttpRequest.wrapped
}cXMLHttpRequest.UNSENT=0;
cXMLHttpRequest.OPENED=1;
cXMLHttpRequest.HEADERS_RECEIVED=2;
cXMLHttpRequest.LOADING=3;
cXMLHttpRequest.DONE=4;
cXMLHttpRequest.prototype.readyState=cXMLHttpRequest.UNSENT;
cXMLHttpRequest.prototype.responseText="";
cXMLHttpRequest.prototype.responseXML=null;
cXMLHttpRequest.prototype.status=0;
cXMLHttpRequest.prototype.statusText="";
cXMLHttpRequest.prototype.onreadystatechange=null;
cXMLHttpRequest.onreadystatechange=null;
cXMLHttpRequest.onopen=null;
cXMLHttpRequest.onsend=null;
cXMLHttpRequest.onabort=null;
cXMLHttpRequest.prototype.open=function(sMethod,sUrl,bAsync,sUser,sPassword){delete this._headers;
if(arguments.length<3){bAsync=true
}this._async=bAsync;
var oRequest=this,nState=this.readyState,fOnUnload;
if(bIE&&bAsync){fOnUnload=function(){if(nState!=cXMLHttpRequest.DONE){fCleanTransport(oRequest);
oRequest.abort()
}};
window.attachEvent("onunload",fOnUnload)
}if(cXMLHttpRequest.onopen){cXMLHttpRequest.onopen.apply(this,arguments)
}if(arguments.length>4){this._object.open(sMethod,sUrl,bAsync,sUser,sPassword)
}else{if(arguments.length>3){this._object.open(sMethod,sUrl,bAsync,sUser)
}else{this._object.open(sMethod,sUrl,bAsync)
}}if(!bGecko&&!bIE){this.readyState=cXMLHttpRequest.OPENED;
fReadyStateChange(this)
}this._object.onreadystatechange=function(){if(bGecko&&!bAsync){return
}oRequest.readyState=oRequest._object.readyState;
fSynchronizeValues(oRequest);
if(oRequest._aborted){oRequest.readyState=cXMLHttpRequest.UNSENT;
return
}if(oRequest.readyState==cXMLHttpRequest.DONE){fCleanTransport(oRequest);
if(bIE&&bAsync){window.detachEvent("onunload",fOnUnload)
}}if(nState!=oRequest.readyState){fReadyStateChange(oRequest)
}nState=oRequest.readyState
}
};
cXMLHttpRequest.prototype.send=function(vData){if(cXMLHttpRequest.onsend){cXMLHttpRequest.onsend.apply(this,arguments)
}if(vData&&vData.nodeType){vData=window.XMLSerializer?new window.XMLSerializer().serializeToString(vData):vData.xml;
if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml")
}}this._object.send(vData);
if(bGecko&&!this._async){this.readyState=cXMLHttpRequest.OPENED;
fSynchronizeValues(this);
while(this.readyState<cXMLHttpRequest.DONE){this.readyState++;
fReadyStateChange(this);
if(this._aborted){return
}}}};
cXMLHttpRequest.prototype.abort=function(){if(cXMLHttpRequest.onabort){cXMLHttpRequest.onabort.apply(this,arguments)
}if(this.readyState>cXMLHttpRequest.UNSENT){this._aborted=true
}this._object.abort();
fCleanTransport(this)
};
cXMLHttpRequest.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()
};
cXMLHttpRequest.prototype.getResponseHeader=function(sName){return this._object.getResponseHeader(sName)
};
cXMLHttpRequest.prototype.setRequestHeader=function(sName,sValue){if(!this._headers){this._headers={}
}this._headers[sName]=sValue;
return this._object.setRequestHeader(sName,sValue)
};
cXMLHttpRequest.prototype.addEventListener=function(sName,fHandler,bUseCapture){for(var nIndex=0,oListener;
oListener=this._listeners[nIndex];
nIndex++){if(oListener[0]==sName&&oListener[1]==fHandler&&oListener[2]==bUseCapture){return
}}this._listeners.push([sName,fHandler,bUseCapture])
};
cXMLHttpRequest.prototype.removeEventListener=function(sName,fHandler,bUseCapture){for(var nIndex=0,oListener;
oListener=this._listeners[nIndex];
nIndex++){if(oListener[0]==sName&&oListener[1]==fHandler&&oListener[2]==bUseCapture){break
}}if(oListener){this._listeners.splice(nIndex,1)
}};
cXMLHttpRequest.prototype.dispatchEvent=function(oEvent){var oEventPseudo={type:oEvent.type,target:this,currentTarget:this,eventPhase:2,bubbles:oEvent.bubbles,cancelable:oEvent.cancelable,timeStamp:oEvent.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};
if(oEventPseudo.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[oEventPseudo])
}for(var nIndex=0,oListener;
oListener=this._listeners[nIndex];
nIndex++){if(oListener[0]==oEventPseudo.type&&!oListener[2]){(oListener[1].handleEvent||oListener[1]).apply(this,[oEventPseudo])
}}};
cXMLHttpRequest.prototype.toString=function(){return"[object XMLHttpRequest]"
};
cXMLHttpRequest.toString=function(){return"[XMLHttpRequest]"
};
function fReadyStateChange(oRequest){if(cXMLHttpRequest.onreadystatechange){cXMLHttpRequest.onreadystatechange.apply(oRequest)
}oRequest.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0})
}function fGetDocument(oRequest){var oDocument=oRequest.responseXML,sResponse=oRequest.responseText;
if(bIE&&sResponse&&oDocument&&!oDocument.documentElement&&oRequest.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){oDocument=new window.ActiveXObject("Microsoft.XMLDOM");
oDocument.async=false;
oDocument.validateOnParse=false;
oDocument.loadXML(sResponse)
}if(oDocument){if((bIE&&oDocument.parseError!=0)||!oDocument.documentElement||(oDocument.documentElement&&oDocument.documentElement.tagName=="parsererror")){return null
}}return oDocument
}function fSynchronizeValues(oRequest){try{oRequest.responseText=oRequest._object.responseText
}catch(e){}try{oRequest.responseXML=fGetDocument(oRequest._object)
}catch(e){}try{oRequest.status=oRequest._object.status
}catch(e){}try{oRequest.statusText=oRequest._object.statusText
}catch(e){}}function fCleanTransport(oRequest){oRequest._object.onreadystatechange=new window.Function
}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(oRequest,oArguments){if(!oArguments){oArguments=[]
}oRequest.__func=this;
oRequest.__func(oArguments[0],oArguments[1],oArguments[2],oArguments[3],oArguments[4]);
delete oRequest.__func
}
}OpenLayers.Request.XMLHttpRequest=cXMLHttpRequest
})();OpenLayers.ProxyHost="";
OpenLayers.nullHandler=function(request){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:request.statusText}))
};
OpenLayers.loadURL=function(uri,params,caller,onComplete,onFailure){if(typeof params=="string"){params=OpenLayers.Util.getParameters(params)
}var success=(onComplete)?onComplete:OpenLayers.nullHandler;
var failure=(onFailure)?onFailure:OpenLayers.nullHandler;
return OpenLayers.Request.GET({url:uri,params:params,success:success,failure:failure,scope:caller})
};
OpenLayers.parseXMLString=function(text){var index=text.indexOf("<");
if(index>0){text=text.substring(index)
}var ajaxResponse=OpenLayers.Util.Try(function(){var xmldom=new ActiveXObject("Microsoft.XMLDOM");
xmldom.loadXML(text);
return xmldom
},function(){return new DOMParser().parseFromString(text,"text/xml")
},function(){var req=new XMLHttpRequest();
req.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(text),false);
if(req.overrideMimeType){req.overrideMimeType("text/xml")
}req.send(null);
return req.responseXML
});
return ajaxResponse
};
OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest()
},function(){return new ActiveXObject("Msxml2.XMLHTTP")
},function(){return new ActiveXObject("Microsoft.XMLHTTP")
})||false
},activeRequestCount:0};
OpenLayers.Ajax.Responders={responders:[],register:function(responderToAdd){for(var i=0;
i<this.responders.length;
i++){if(responderToAdd==this.responders[i]){return
}}this.responders.push(responderToAdd)
},unregister:function(responderToRemove){OpenLayers.Util.removeItem(this.reponders,responderToRemove)
},dispatch:function(callback,request,transport){var responder;
for(var i=0;
i<this.responders.length;
i++){responder=this.responders[i];
if(responder[callback]&&typeof responder[callback]=="function"){try{responder[callback].apply(responder,[request,transport])
}catch(e){}}}}};
OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++
},onComplete:function(){OpenLayers.Ajax.activeRequestCount--
}});
OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(options){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};
OpenLayers.Util.extend(this.options,options||{});
this.options.method=this.options.method.toLowerCase();
if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters)
}}});
OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(url,options){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[options]);
if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(url,"http")){url=OpenLayers.ProxyHost+encodeURIComponent(url)
}this.transport=OpenLayers.Ajax.getTransport();
this.request(url)
},request:function(url){this.url=url;
this.method=this.options.method;
var params=OpenLayers.Util.extend({},this.options.parameters);
if(this.method!="get"&&this.method!="post"){params._method=this.method;
this.method="post"
}this.parameters=params;
if(params=OpenLayers.Util.getParameterString(params)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+params
}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){params+="&_="
}}}try{var response=new OpenLayers.Ajax.Response(this);
if(this.options.onCreate){this.options.onCreate(response)
}OpenLayers.Ajax.Responders.dispatch("onCreate",this,response);
this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);
if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10)
}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);
this.setRequestHeaders();
this.body=this.method=="post"?(this.options.postBody||params):null;
this.transport.send(this.body);
if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()
}}catch(e){this.dispatchException(e)
}},onStateChange:function(){var readyState=this.transport.readyState;
if(readyState>1&&!((readyState==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)
}},setRequestHeaders:function(){var headers={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};
if(this.method=="post"){headers["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");
if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){headers.Connection="close"
}}if(typeof this.options.requestHeaders=="object"){var extras=this.options.requestHeaders;
if(typeof extras.push=="function"){for(var i=0,length=extras.length;
i<length;
i+=2){headers[extras[i]]=extras[i+1]
}}else{for(var i in extras){headers[i]=extras[i]
}}}for(var name in headers){this.transport.setRequestHeader(name,headers[name])
}},success:function(){var status=this.getStatus();
return !status||(status>=200&&status<300)
},getStatus:function(){try{return this.transport.status||0
}catch(e){return 0
}},respondToReadyState:function(readyState){var state=OpenLayers.Ajax.Request.Events[readyState];
var response=new OpenLayers.Ajax.Response(this);
if(state=="Complete"){try{this._complete=true;
(this.options["on"+response.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(response)
}catch(e){this.dispatchException(e)
}var contentType=response.getHeader("Content-type")
}try{(this.options["on"+state]||OpenLayers.Ajax.emptyFunction)(response);
OpenLayers.Ajax.Responders.dispatch("on"+state,this,response)
}catch(e){this.dispatchException(e)
}if(state=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction
}},getHeader:function(name){try{return this.transport.getResponseHeader(name)
}catch(e){return null
}},dispatchException:function(exception){var handler=this.options.onException;
if(handler){handler(this,exception);
OpenLayers.Ajax.Responders.dispatch("onException",this,exception)
}else{var listener=false;
var responders=OpenLayers.Ajax.Responders.responders;
for(var i=0;
i<responders.length;
i++){if(responders[i].onException){listener=true;
break
}}if(listener){OpenLayers.Ajax.Responders.dispatch("onException",this,exception)
}else{throw exception
}}}});
OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(request){this.request=request;
var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;
if((readyState>2&&!(!!(window.attachEvent&&!window.opera)))||readyState==4){this.status=this.getStatus();
this.statusText=this.getStatusText();
this.responseText=transport.responseText==null?"":String(transport.responseText)
}if(readyState==4){var xml=transport.responseXML;
this.responseXML=xml===undefined?null:xml
}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""
}catch(e){return""
}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(name){return this.transport.getResponseHeader(name)
}});
OpenLayers.Ajax.getElementsByTagNameNS=function(parentnode,nsuri,nsprefix,tagname){var elem=null;
if(parentnode.getElementsByTagNameNS){elem=parentnode.getElementsByTagNameNS(nsuri,tagname)
}else{elem=parentnode.getElementsByTagName(nsprefix+":"+tagname)
}return elem
};
OpenLayers.Ajax.serializeXMLToString=function(xmldom){var serializer=new XMLSerializer();
var data=serializer.serializeToString(xmldom);
return data
};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(lon,lat){this.lon=OpenLayers.Util.toFloat(lon);
this.lat=OpenLayers.Util.toFloat(lat)
},toString:function(){return("lon="+this.lon+",lat="+this.lat)
},toShortString:function(){return(this.lon+", "+this.lat)
},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)
},add:function(lon,lat){if((lon==null)||(lat==null)){var msg=OpenLayers.i18n("lonlatAddError");
OpenLayers.Console.error(msg);
return null
}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(lon),this.lat+OpenLayers.Util.toFloat(lat))
},equals:function(ll){var equals=false;
if(ll!=null){equals=((this.lon==ll.lon&&this.lat==ll.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(ll.lon)&&isNaN(ll.lat)))
}return equals
},transform:function(source,dest){var point=OpenLayers.Projection.transform({x:this.lon,y:this.lat},source,dest);
this.lon=point.x;
this.lat=point.y;
return this
},wrapDateLine:function(maxExtent){var newLonLat=this.clone();
if(maxExtent){while(newLonLat.lon<maxExtent.left){newLonLat.lon+=maxExtent.getWidth()
}while(newLonLat.lon>maxExtent.right){newLonLat.lon-=maxExtent.getWidth()
}}return newLonLat
},CLASS_NAME:"OpenLayers.LonLat"});
OpenLayers.LonLat.fromString=function(str){var pair=str.split(",");
return new OpenLayers.LonLat(pair[0],pair[1])
};OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(w,h){this.w=parseFloat(w);
this.h=parseFloat(h)
},toString:function(){return("w="+this.w+",h="+this.h)
},clone:function(){return new OpenLayers.Size(this.w,this.h)
},equals:function(sz){var equals=false;
if(sz!=null){equals=((this.w==sz.w&&this.h==sz.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(sz.w)&&isNaN(sz.h)))
}return equals
},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(x,y){this.x=parseFloat(x);
this.y=parseFloat(y)
},toString:function(){return("x="+this.x+",y="+this.y)
},clone:function(){return new OpenLayers.Pixel(this.x,this.y)
},equals:function(px){var equals=false;
if(px!=null){equals=((this.x==px.x&&this.y==px.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(px.x)&&isNaN(px.y)))
}return equals
},add:function(x,y){if((x==null)||(y==null)){var msg=OpenLayers.i18n("pixelAddError");
OpenLayers.Console.error(msg);
return null
}return new OpenLayers.Pixel(this.x+x,this.y+y)
},offset:function(px){var newPx=this.clone();
if(px){newPx=this.add(px.x,px.y)
}return newPx
},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()
}return OpenLayers.Lang.code
},setCode:function(code){var lang;
if(!code){code=(OpenLayers.Util.getBrowserName()=="msie")?navigator.userLanguage:navigator.language
}var parts=code.split("-");
parts[0]=parts[0].toLowerCase();
if(typeof OpenLayers.Lang[parts[0]]=="object"){lang=parts[0]
}if(parts[1]){var testLang=parts[0]+"-"+parts[1].toUpperCase();
if(typeof OpenLayers.Lang[testLang]=="object"){lang=testLang
}}if(!lang){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+parts.join("-")+" dictionary, falling back to default language");
lang=OpenLayers.Lang.defaultCode
}OpenLayers.Lang.code=lang
},translate:function(key,context){var dictionary=OpenLayers.Lang[OpenLayers.Lang.getCode()];
var message=dictionary[key];
if(!message){message=key
}if(context){message=OpenLayers.String.format(message,context)
}return message
}};
OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Base Layer",sameProjection:"The overview map only works when it is in the same projection as the main map",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file http://geonetwork-opensource.org/geonetwork-client",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>",scale:"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced.",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",end:""};OpenLayers.Lang.fr=OpenLayers.Util.applyDefaults({unhandledRequest:"Requte non gre, retournant ${statusText}",permalink:"Permalien",overlays:"Calques",baseLayer:"Calque de base",sameProjection:"La carte de situation ne fonctionne que lorsque sa projection est la mme que celle de la carte principale",readNotImplemented:"Lecture non implmente.",writeNotImplemented:"Ecriture non implmente.",noFID:"Impossible de mettre  jour un objet sans identifiant (fid).",errorLoadingGML:"Erreur au chargement du fichier GML http://geonetwork-opensource.org/geonetwork-client",browserNotSupported:"Votre navigateur ne supporte pas le rendu vectoriel. Les renderers actuellement supports sont : \n${renderers}",componentShouldBe:"addFeatures : le composant devrait tre de type ${geomType}",getFeatureError:"getFeatureFromEvent a t appel sur un calque sans renderer. Cela signifie gnralement que vous avez dtruit cette couche, mais que vous avez conserv un handler qui lui tait associ.",minZoomLevelError:"La proprit minZoomLevel doit seulement tre utilise pour des couches FixedZoomLevels-descendent. Le fait que cette couche WFS vrifie la prsence de minZoomLevel est une relique du pass. Nous ne pouvons toutefois la supprimer sans casser des applications qui pourraient en dpendre. C'est pourquoi nous la dprcions -- la vrification du minZoomLevel sera supprime en version 3.0. A la place, merci d'utiliser les paramtres de rsolutions min/max tel que dcrit sur : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaction WFS : SUCCES ${response}",commitFailed:"Transaction WFS : ECHEC ${response}",googleWarning:"La couche Google n'a pas t en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le slecteur de couche en haut  droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement caus par la non-inclusion de la librairie Google Maps, ou alors parce que la cl de l'API ne correspond pas  votre site.\x3cbr\x3e\x3cbr\x3eDveloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3ecliquez ici\x3c/a\x3e",getLayerWarning:"La couche ${layerType} n'est pas en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le slecteur de couche en haut  droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement caus par la non-inclusion de la librairie ${layerLib}.\x3cbr\x3e\x3cbr\x3eDveloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3ecliquez ici\x3c/a\x3e",scale:"Echelle ~ 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S",layerAlreadyAdded:"Vous avez essay d'ajouter  la carte le calque : ${layerName}, mais il est dj prsent",reprojectDeprecated:"Vous utilisez l'option 'reproject' sur la couche ${layerName}. Cette option est dprcie : Son usage permettait d'afficher des donnes au dessus de couches raster commerciales.Cette fonctionalit est maintenant supporte en utilisant le support de la projection Mercator Sphrique. Plus d'information est disponible sur http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Cette mthode est dprcie, et sera supprime  la version 3.0. Merci d'utiliser ${newMethod}  la place.",boundsAddError:"Vous devez passer les deux valeurs x et y  la fonction add.",lonlatAddError:"Vous devez passer les deux valeurs lon et lat  la fonction add.",pixelAddError:"Vous devez passer les deux valeurs x et y  la fonction add.",unsupportedGeometryType:"Type de gomtrie non support : ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition a chou: l'lment d'id ${elemId} pourrait tre mal positionn.",filterEvaluateNotImplemented:"valuer n'a pas encore t implment pour ce type de filtre."});OpenLayers.Lang.de=OpenLayers.Util.applyDefaults({unhandledRequest:"Unbehandelte Anfragerckmeldung ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Grundkarte",sameProjection:"Die bersichtskarte funktioniert nur, wenn sie dieselbe Projektion wie die Hauptkarte verwendet",readNotImplemented:"Lesen nicht implementiert.",writeNotImplemented:"Schreiben nicht implementiert.",noFID:"Ein Feature, fr das keine FID existiert, kann nicht aktualisiert werden.",errorLoadingGML:"Fehler beim Laden der GML-Datei http://geonetwork-opensource.org/geonetwork-client",browserNotSupported:"Ihr Browser untersttzt keine Vektordarstellung. Aktuell untersttzte Renderer:\n${renderers}",componentShouldBe:"addFeatures: Komponente muss vom Typ ${geomType} sein",getFeatureError:"getFeatureFromEvent wurde vom einem Layer ohne Renderer aufgerufen. Dies bedeutet normalerweise, dass ein Layer entfernt wurde, aber nicht Handler, die auf ihn verweisen.",minZoomLevelError:"Die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft ist nur fr die Verwendung mit \x3ccode\x3eFixedZoomLevels\x3c/code\x3e-untergeordneten Layers vorgesehen. Das dieser \x3ctt\x3ewfs\x3c/tt\x3e-Layer die \x3ccode\x3eminZoomLevel\x3c/code\x3e-Eigenschaft berprft ist ein Relikt der Vergangenheit. Wir knnen diese berprfung nicht entfernen, ohne das OL basierende Applikationen nicht mehr funktionieren. Daher markieren wir es als veraltet - die \x3ccode\x3eminZoomLevel\x3c/code\x3e-berprfung wird in Version 3.0 entfernt werden. Bitte verwenden Sie stattdessen die Min-/Max-Lsung, wie sie unter http://trac.openlayers.org/wiki/SettingZoomLevels beschrieben ist.",commitSuccess:"WFS-Transaktion: Erfolgreich ${response}",commitFailed:"WFS-Transaktion: Fehlgeschlagen ${response}",googleWarning:"Der Google-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, whlen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der Google-Maps-Bibliothek nicht eingebunden wurde oder keinen gltigen API-Schlssel fr Ihre URL enthlt.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3edas Wiki\x3c/a\x3e fr Hilfe zum korrekten Einbinden des Google-Layers",getLayerWarning:"Der ${layerType}-Layer konnte nicht korrekt geladen werden.\x3cbr\x3e\x3cbr\x3eUm diese Meldung nicht mehr zu erhalten, whlen Sie einen anderen Hintergrundlayer aus dem LayerSwitcher in der rechten oberen Ecke.\x3cbr\x3e\x3cbr\x3eSehr wahrscheinlich tritt dieser Fehler auf, weil das Skript der '${layerLib}'-Bibliothek nicht eingebunden wurde.\x3cbr\x3e\x3cbr\x3eEntwickler: Besuche \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3edas Wiki\x3c/a\x3e fr Hilfe zum korrekten Einbinden von Layern",scale:"Mastab = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"S",layerAlreadyAdded:"Sie versuchen den Layer ${layerName} zur Karte hinzuzufgen, er wurde aber bereits hinzugefgt",reprojectDeprecated:"Sie verwenden die Reproject-Option des Layers ${layerName}. Diese Option ist veraltet: Sie wurde entwickelt um die Anzeige von Daten auf kommerziellen Basiskarten zu untersttzen, aber diese Funktion sollte jetzt durch Untersttzung der Spherical Mercator erreicht werden. Weitere Informationen sind unter http://trac.openlayers.org/wiki/SphericalMercator verfgbar.",methodDeprecated:"Die Methode ist veraltet und wird in 3.0 entfernt. Bitte verwende stattdessen ${newMethod}.",boundsAddError:"Beide Werte (x und y) mssen der add-Funktion bergeben werden.",lonlatAddError:"Beide Werte (lon und lat) mssen der add-Funktion bergeben werden.",pixelAddError:"Beide Werte (x und y) mssen der add-Funktion bergeben werden.",unsupportedGeometryType:"Nicht untersttzter Geometrie-Typ: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition fehlgeschlagen: Element mit Id ${elemId} mglicherweise falsch platziert.",filterEvaluateNotImplemented:"evaluate ist fr diesen Filter-Typ nicht implementiert."});OpenLayers.Lang.nl=OpenLayers.Util.applyDefaults({unhandledRequest:"Het verzoek is niet afgehandeld met de volgende melding: ${statusText}",permalink:"Permanente verwijzing",overlays:"Overlays",baseLayer:"Achtergrondkaart",sameProjection:"De overzichtskaart werkt alleen als de projectie gelijk is aan de projectie van de hoofdkaart",readNotImplemented:"Lezen is niet gemplementeerd.",writeNotImplemented:"Schrijven is niet gemplementeerd.",noFID:"Een optie die geen FID heeft kan niet bijgewerkt worden.",errorLoadingGML:"Er is een fout opgetreden bij het laden van het GML bestand van http://geonetwork-opensource.org/geonetwork-client",browserNotSupported:"Uw browser ondersteunt het weergeven van vectoren niet.\nMomenteel ondersteunde weergavemogelijkheden:\n${renderers}",componentShouldBe:"addFeatures : component moet van het type ${geomType} zijn",getFeatureError:"getFeatureFromEvent is aangeroepen op een laag zonder rederer.\nDit betekent meestal dat u een laag hebt verwijderd, maar niet een handler die ermee geassocieerd was.",minZoomLevelError:"De eigenschap minZoomLevel is alleen bedoeld voor gebruik lagen met die afstammen van FixedZoomLevels-lagen.\nDat deze WFS-laag minZoomLevel controleert, is een overblijfsel uit het verleden.\nWe kunnen deze controle echter niet verwijderen zonder op OL gebaseerde applicaties die hervan afhankelijk zijn stuk te maken.\nDaarom heeft deze functionaliteit de eigenschap 'deprecated' gekregen - de minZoomLevel wordt verwijderd in versie 3.0.\nGebruik in plaats van deze functie de mogelijkheid om min/max voor resolutie in te stellen zoals op de volgende pagina wordt beschreven:\nhttp://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-transactie: succesvol ${response}",commitFailed:"WFS-transactie: mislukt ${response}",googleWarning:"De Google-Layer kon niet correct geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct ingevoegd is.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",getLayerWarning:"De laag ${layerType} kon niet goed geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct is ingevoegd.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",scale:"Schaal = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"Z",layerAlreadyAdded:"U hebt geprobeerd om de laag  ${layerName} aan de kaart toe te voegen, maar deze is al toegevoegd",reprojectDeprecated:"U gebruikt de optie 'reproject' op de laag ${layerName}.\nDeze optie is vervallen: deze optie was ontwikkeld om gegevens over commercile basiskaarten weer te geven, maar deze functionaliteit wordt nu bereikt door ondersteuning van Spherical Mercator.\nMeer informatie is beschikbaar op http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Deze methode is verouderd en wordt verwijderd in versie 3.0.\nGebruik ${newMethod}.",boundsAddError:"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie.",lonlatAddError:"U moet zowel de lengte- als de breedtewaarde doorgeven aan de toevoegfunctie.",pixelAddError:"U moet zowel de x- als de y-waarde doorgeven aan de toevoegfunctie.",unsupportedGeometryType:"Dit geometrietype wordt niet ondersteund: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition is mislukt: het element met id ${elemId} is wellicht onjuist geplaatst.",filterEvaluateNotImplemented:"evalueren is niet gemplementeerd voor dit filtertype."});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments)
},down:function(evt){},move:function(evt){},up:function(evt){},out:function(evt){},mousedown:function(evt){var propagate=true;
this.dragging=false;
if(this.checkModifiers(evt)&&OpenLayers.Event.isLeftClick(evt)){this.started=true;
this.start=evt.xy;
this.last=evt.xy;
OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");
this.down(evt);
this.callback("down",[evt.xy]);
OpenLayers.Event.stop(evt);
if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:OpenLayers.Function.True
}document.onselectstart=OpenLayers.Function.False;
propagate=!this.stopDown
}else{this.started=false;
this.start=null;
this.last=null
}return propagate
},mousemove:function(evt){if(this.started&&!this.timeoutId&&(evt.xy.x!=this.last.x||evt.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(evt.element===document){this.adjustXY(evt);
this.setEvent(evt)
}else{this.destroyDocumentEvents()
}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)
}this.dragging=true;
this.move(evt);
this.callback("move",[evt.xy]);
if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;
document.onselectstart=OpenLayers.Function.False
}this.last=this.evt.xy
}return true
},removeTimeout:function(){this.timeoutId=null
},mouseup:function(evt){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(evt);
this.destroyDocumentEvents()
}var dragged=(this.start!=this.last);
this.started=false;
this.dragging=false;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");
this.up(evt);
this.callback("up",[evt.xy]);
if(dragged){this.callback("done",[evt.xy])
}document.onselectstart=this.oldOnselectstart
}return true
},mouseout:function(evt){if(this.started&&OpenLayers.Util.mouseLeft(evt,this.map.div)){if(this.documentDrag===true){this.documentEvents=new OpenLayers.Events(this,document,null,null,{includeXY:true});
this.documentEvents.on({mousemove:this.mousemove,mouseup:this.mouseup});
OpenLayers.Element.addClass(document.body,"olDragDown")
}else{var dragged=(this.start!=this.last);
this.started=false;
this.dragging=false;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");
this.out(evt);
this.callback("out",[]);
if(dragged){this.callback("done",[evt.xy])
}if(document.onselectstart){document.onselectstart=this.oldOnselectstart
}}}return true
},click:function(evt){return(this.start==this.last)
},activate:function(){var activated=false;
if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;
activated=true
}return activated
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;
this.dragging=false;
this.start=null;
this.last=null;
deactivated=true;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")
}return deactivated
},adjustXY:function(evt){var pos=OpenLayers.Util.pagePosition(this.map.div);
evt.xy.x-=pos[0];
evt.xy.y-=pos[1]
},destroyDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");
this.documentEvents.destroy();
this.documentEvents=null
},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
var callbacks={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};
this.dragHandler=new OpenLayers.Handler.Drag(this,callbacks,{keyMask:this.keyMask})
},destroy:function(){if(this.dragHandler){this.dragHandler.destroy();
this.dragHandler=null
}OpenLayers.Handler.prototype.destroy.apply(this,arguments)
},setMap:function(map){OpenLayers.Handler.prototype.setMap.apply(this,arguments);
if(this.dragHandler){this.dragHandler.setMap(map)
}},startBox:function(xy){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);
this.zoomBox.className=this.boxDivClassName;
this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;
this.map.viewPortDiv.appendChild(this.zoomBox);
OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")
},moveBox:function(xy){var startX=this.dragHandler.start.x;
var startY=this.dragHandler.start.y;
var deltaX=Math.abs(startX-xy.x);
var deltaY=Math.abs(startY-xy.y);
this.zoomBox.style.width=Math.max(1,deltaX)+"px";
this.zoomBox.style.height=Math.max(1,deltaY)+"px";
this.zoomBox.style.left=xy.x<startX?xy.x+"px":startX+"px";
this.zoomBox.style.top=xy.y<startY?xy.y+"px":startY+"px";
var box=this.getBoxCharacteristics();
if(box.newBoxModel){if(xy.x>startX){this.zoomBox.style.width=Math.max(1,deltaX-box.xOffset)+"px"
}if(xy.y>startY){this.zoomBox.style.height=Math.max(1,deltaY-box.yOffset)+"px"
}}},endBox:function(end){var result;
if(Math.abs(this.dragHandler.start.x-end.x)>5||Math.abs(this.dragHandler.start.y-end.y)>5){var start=this.dragHandler.start;
var top=Math.min(start.y,end.y);
var bottom=Math.max(start.y,end.y);
var left=Math.min(start.x,end.x);
var right=Math.max(start.x,end.x);
result=new OpenLayers.Bounds(left,bottom,right,top)
}else{result=this.dragHandler.start.clone()
}this.removeBox();
this.callback("done",[result])
},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);
this.zoomBox=null;
this.boxCharacteristics=null;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")
},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();
return true
}else{return false
}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();
return true
}else{return false
}},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var xOffset=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1;
var yOffset=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1;
var newBoxModel=OpenLayers.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;
this.boxCharacteristics={xOffset:xOffset,yOffset:yOffset,newBoxModel:newBoxModel}
}return this.boxCharacteristics
},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})
},zoomBox:function(position){if(position instanceof OpenLayers.Bounds){var bounds;
if(!this.out){var minXY=this.map.getLonLatFromPixel(new OpenLayers.Pixel(position.left,position.bottom));
var maxXY=this.map.getLonLatFromPixel(new OpenLayers.Pixel(position.right,position.top));
bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat)
}else{var pixWidth=Math.abs(position.right-position.left);
var pixHeight=Math.abs(position.top-position.bottom);
var zoomFactor=Math.min((this.map.size.h/pixHeight),(this.map.size.w/pixWidth));
var extent=this.map.getExtent();
var center=this.map.getLonLatFromPixel(position.getCenterPixel());
var xmin=center.lon-(extent.getWidth()/2)*zoomFactor;
var xmax=center.lon+(extent.getWidth()/2)*zoomFactor;
var ymin=center.lat-(extent.getHeight()/2)*zoomFactor;
var ymax=center.lat+(extent.getHeight()/2)*zoomFactor;
bounds=new OpenLayers.Bounds(xmin,ymin,xmax,ymax)
}var lastZoom=this.map.getZoom();
this.map.zoomToExtent(bounds);
if(lastZoom==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(lastZoom+(this.out?-1:1))
}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(position),this.map.getZoom()+1)
}else{this.map.setCenter(this.map.getLonLatFromPixel(position),this.map.getZoom()-1)
}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:25,documentDrag:false,draw:function(){this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval,documentDrag:this.documentDrag})
},panMap:function(xy){this.panned=true;
this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:this.handler.dragging,animate:false})
},panMapDone:function(xy){if(this.panned){this.panMap(xy);
this.panned=false
}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
if(this.pixelTolerance!=null){this.mousedown=function(evt){this.down=evt.xy;
return true
}
}},mousedown:null,mouseup:function(evt){var propagate=true;
if(this.checkModifiers(evt)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(evt)){propagate=this.rightclick(evt)
}return propagate
},rightclick:function(evt){if(this.passesTolerance(evt)){if(this.rightclickTimerId!=null){this.clearTimer();
this.callback("dblrightclick",[evt]);
return !this.stopDouble
}else{var clickEvent=this["double"]?OpenLayers.Util.extend({},evt):this.callback("rightclick",[evt]);
var delayedRightCall=OpenLayers.Function.bind(this.delayedRightCall,this,clickEvent);
this.rightclickTimerId=window.setTimeout(delayedRightCall,this.delay)
}}return !this.stopSingle
},delayedRightCall:function(evt){this.rightclickTimerId=null;
if(evt){this.callback("rightclick",[evt])
}return !this.stopSingle
},dblclick:function(evt){if(this.passesTolerance(evt)){if(this["double"]){this.callback("dblclick",[evt])
}this.clearTimer()
}return !this.stopDouble
},click:function(evt){if(this.passesTolerance(evt)){if(this.timerId!=null){this.clearTimer()
}else{var clickEvent=this.single?OpenLayers.Util.extend({},evt):null;
this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,clickEvent),this.delay)
}}return !this.stopSingle
},passesTolerance:function(evt){var passes=true;
if(this.pixelTolerance!=null&&this.down){var dpx=Math.sqrt(Math.pow(this.down.x-evt.xy.x,2)+Math.pow(this.down.y-evt.xy.y,2));
if(dpx>this.pixelTolerance){passes=false
}}return passes
},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);
this.timerId=null
}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);
this.rightclickTimerId=null
}},delayedCall:function(evt){this.timerId=null;
if(evt){this.callback("click",[evt])
}},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();
this.down=null;
deactivated=true
}return deactivated
},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:true,initialize:function(options){this.handlers={};
OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){this.deactivate();
if(this.dragPan){this.dragPan.destroy()
}this.dragPan=null;
if(this.zoomBox){this.zoomBox.destroy()
}this.zoomBox=null;
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},activate:function(){this.dragPan.activate();
if(this.zoomWheelEnabled){this.handlers.wheel.activate()
}this.handlers.click.activate();
if(this.zoomBoxEnabled){this.zoomBox.activate()
}return OpenLayers.Control.prototype.activate.apply(this,arguments)
},deactivate:function(){this.zoomBox.deactivate();
this.dragPan.deactivate();
this.handlers.click.deactivate();
this.handlers.wheel.deactivate();
return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False
}var clickCallbacks={dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};
var clickOptions={"double":true,stopDouble:true};
this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,clickOptions);
this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));
this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});
this.dragPan.draw();
this.zoomBox.draw();
this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions)
},defaultDblClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);
this.map.setCenter(newCenter,this.map.zoom+1)
},defaultDblRightClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);
this.map.setCenter(newCenter,this.map.zoom-1)
},wheelChange:function(evt,deltaZ){var currentZoom=this.map.getZoom();
var newZoom=this.map.getZoom()+Math.round(deltaZ);
newZoom=Math.max(newZoom,0);
newZoom=Math.min(newZoom,this.map.getNumZoomLevels());
if(newZoom===currentZoom){return
}var size=this.map.getSize();
var deltaX=size.w/2-evt.xy.x;
var deltaY=evt.xy.y-size.h/2;
var newRes=this.map.baseLayer.getResolutionForZoom(newZoom);
var zoomPoint=this.map.getLonLatFromPixel(evt.xy);
var newCenter=new OpenLayers.LonLat(zoomPoint.lon+deltaX*newRes,zoomPoint.lat+deltaY*newRes);
this.map.setCenter(newCenter,newZoom)
},wheelUp:function(evt,delta){this.wheelChange(evt,delta||1)
},wheelDown:function(evt,delta){this.wheelChange(evt,delta||-1)
},disableZoomBox:function(){this.zoomBoxEnabled=false;
this.zoomBox.deactivate()
},enableZoomBox:function(){this.zoomBoxEnabled=true;
if(this.active){this.zoomBox.activate()
}},disableZoomWheel:function(){this.zoomWheelEnabled=false;
this.handlers.wheel.deactivate()
},enableZoomWheel:function(){this.zoomWheelEnabled=true;
if(this.active){this.handlers.wheel.activate()
}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(name,url,params,options){var newArguments=arguments;
newArguments=[name,options];
OpenLayers.Layer.prototype.initialize.apply(this,newArguments);
this.url=url;
this.params=OpenLayers.Util.extend({},params)
},destroy:function(){this.url=null;
this.params=null;
OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);
return obj
},setUrl:function(newUrl){this.url=newUrl
},mergeNewParams:function(newParams){this.params=OpenLayers.Util.extend(this.params,newParams);
var ret=this.redraw();
if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"})
}return ret
},redraw:function(force){if(force){return this.mergeNewParams({_olSalt:Math.random()})
}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])
}},selectUrl:function(paramString,urls){var product=1;
for(var i=0,len=paramString.length;
i<len;
i++){product*=paramString.charCodeAt(i)*this.URL_HASH_FACTOR;
product-=Math.floor(product)
}return urls[Math.floor(product*urls.length)]
},getFullRequestString:function(newParams,altUrl){var url=altUrl||this.url;
var allParams=OpenLayers.Util.extend({},this.params);
allParams=OpenLayers.Util.extend(allParams,newParams);
var paramsString=OpenLayers.Util.getParameterString(allParams);
if(url instanceof Array){url=this.selectUrl(paramsString,url)
}var urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));
for(var key in allParams){if(key.toUpperCase() in urlParams){delete allParams[key]
}}paramsString=OpenLayers.Util.getParameterString(allParams);
return OpenLayers.Util.urlAppend(url,paramsString)
},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(name,url,params,options){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);
this.events.addEventType("tileloaded");
this.grid=[]
},destroy:function(){this.clearGrid();
this.grid=null;
this.tileSize=null;
OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)
},clearGrid:function(){if(this.grid){for(var iRow=0,len=this.grid.length;
iRow<len;
iRow++){var row=this.grid[iRow];
for(var iCol=0,clen=row.length;
iCol<clen;
iCol++){var tile=row[iCol];
this.removeTileMonitoringHooks(tile);
tile.destroy()
}}this.grid=[]
}},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[obj]);
if(this.tileSize!=null){obj.tileSize=this.tileSize.clone()
}obj.grid=[];
return obj
},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);
bounds=bounds||this.map.getExtent();
if(bounds!=null){var forceReTile=!this.grid.length||zoomChanged;
var tilesBounds=this.getTilesBounds();
if(this.singleTile){if(forceReTile||(!dragging&&!tilesBounds.containsBounds(bounds))){this.initSingleTile(bounds)
}}else{if(forceReTile||!tilesBounds.containsBounds(bounds,true)){this.initGriddedTiles(bounds)
}else{this.moveGriddedTiles(bounds)
}}}},setTileSize:function(size){if(this.singleTile){size=this.map.getSize();
size.h=parseInt(size.h*this.ratio);
size.w=parseInt(size.w*this.ratio)
}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[size])
},getGridBounds:function(){var msg="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";
OpenLayers.Console.warn(msg);
return this.getTilesBounds()
},getTilesBounds:function(){var bounds=null;
if(this.grid.length){var bottom=this.grid.length-1;
var bottomLeftTile=this.grid[bottom][0];
var right=this.grid[0].length-1;
var topRightTile=this.grid[0][right];
bounds=new OpenLayers.Bounds(bottomLeftTile.bounds.left,bottomLeftTile.bounds.bottom,topRightTile.bounds.right,topRightTile.bounds.top)
}return bounds
},initSingleTile:function(bounds){var center=bounds.getCenterLonLat();
var tileWidth=bounds.getWidth()*this.ratio;
var tileHeight=bounds.getHeight()*this.ratio;
var tileBounds=new OpenLayers.Bounds(center.lon-(tileWidth/2),center.lat-(tileHeight/2),center.lon+(tileWidth/2),center.lat+(tileHeight/2));
var ul=new OpenLayers.LonLat(tileBounds.left,tileBounds.top);
var px=this.map.getLayerPxFromLonLat(ul);
if(!this.grid.length){this.grid[0]=[]
}var tile=this.grid[0][0];
if(!tile){tile=this.addTile(tileBounds,px);
this.addTileMonitoringHooks(tile);
tile.draw();
this.grid[0][0]=tile
}else{tile.moveTo(tileBounds,px)
}this.removeExcessTiles(1,1)
},calculateGridLayout:function(bounds,extent,resolution){var tilelon=resolution*this.tileSize.w;
var tilelat=resolution*this.tileSize.h;
var offsetlon=bounds.left-extent.left;
var tilecol=Math.floor(offsetlon/tilelon)-this.buffer;
var tilecolremain=offsetlon/tilelon-tilecol;
var tileoffsetx=-tilecolremain*this.tileSize.w;
var tileoffsetlon=extent.left+tilecol*tilelon;
var offsetlat=bounds.top-(extent.bottom+tilelat);
var tilerow=Math.ceil(offsetlat/tilelat)+this.buffer;
var tilerowremain=tilerow-offsetlat/tilelat;
var tileoffsety=-tilerowremain*this.tileSize.h;
var tileoffsetlat=extent.bottom+tilerow*tilelat;
return{tilelon:tilelon,tilelat:tilelat,tileoffsetlon:tileoffsetlon,tileoffsetlat:tileoffsetlat,tileoffsetx:tileoffsetx,tileoffsety:tileoffsety}
},initGriddedTiles:function(bounds){var viewSize=this.map.getSize();
var minRows=Math.ceil(viewSize.h/this.tileSize.h)+Math.max(1,2*this.buffer);
var minCols=Math.ceil(viewSize.w/this.tileSize.w)+Math.max(1,2*this.buffer);
var extent=this.getMaxExtent();
var resolution=this.map.getResolution();
var tileLayout=this.calculateGridLayout(bounds,extent,resolution);
var tileoffsetx=Math.round(tileLayout.tileoffsetx);
var tileoffsety=Math.round(tileLayout.tileoffsety);
var tileoffsetlon=tileLayout.tileoffsetlon;
var tileoffsetlat=tileLayout.tileoffsetlat;
var tilelon=tileLayout.tilelon;
var tilelat=tileLayout.tilelat;
this.origin=new OpenLayers.Pixel(tileoffsetx,tileoffsety);
var startX=tileoffsetx;
var startLon=tileoffsetlon;
var rowidx=0;
var layerContainerDivLeft=parseInt(this.map.layerContainerDiv.style.left);
var layerContainerDivTop=parseInt(this.map.layerContainerDiv.style.top);
do{var row=this.grid[rowidx++];
if(!row){row=[];
this.grid.push(row)
}tileoffsetlon=startLon;
tileoffsetx=startX;
var colidx=0;
do{var tileBounds=new OpenLayers.Bounds(tileoffsetlon,tileoffsetlat,tileoffsetlon+tilelon,tileoffsetlat+tilelat);
var x=tileoffsetx;
x-=layerContainerDivLeft;
var y=tileoffsety;
y-=layerContainerDivTop;
var px=new OpenLayers.Pixel(x,y);
var tile=row[colidx++];
if(!tile){tile=this.addTile(tileBounds,px);
this.addTileMonitoringHooks(tile);
row.push(tile)
}else{tile.moveTo(tileBounds,px,false)
}tileoffsetlon+=tilelon;
tileoffsetx+=this.tileSize.w
}while((tileoffsetlon<=bounds.right+tilelon*this.buffer)||colidx<minCols);
tileoffsetlat-=tilelat;
tileoffsety+=this.tileSize.h
}while((tileoffsetlat>=bounds.bottom-tilelat*this.buffer)||rowidx<minRows);
this.removeExcessTiles(rowidx,colidx);
this.spiralTileLoad()
},getMaxExtent:function(){return this.maxExtent
},spiralTileLoad:function(){var tileQueue=[];
var directions=["right","down","left","up"];
var iRow=0;
var iCell=-1;
var direction=OpenLayers.Util.indexOf(directions,"right");
var directionsTried=0;
while(directionsTried<directions.length){var testRow=iRow;
var testCell=iCell;
switch(directions[direction]){case"right":testCell++;
break;
case"down":testRow++;
break;
case"left":testCell--;
break;
case"up":testRow--;
break
}var tile=null;
if((testRow<this.grid.length)&&(testRow>=0)&&(testCell<this.grid[0].length)&&(testCell>=0)){tile=this.grid[testRow][testCell]
}if((tile!=null)&&(!tile.queued)){tileQueue.unshift(tile);
tile.queued=true;
directionsTried=0;
iRow=testRow;
iCell=testCell
}else{direction=(direction+1)%4;
directionsTried++
}}for(var i=0,len=tileQueue.length;
i<len;
i++){var tile=tileQueue[i];
tile.draw();
tile.queued=false
}},addTile:function(bounds,position){},addTileMonitoringHooks:function(tile){tile.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")
}this.numLoadingTiles++
};
tile.events.register("loadstart",this,tile.onLoadStart);
tile.onLoadEnd=function(){this.numLoadingTiles--;
this.events.triggerEvent("tileloaded");
if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")
}};
tile.events.register("loadend",this,tile.onLoadEnd);
tile.events.register("unload",this,tile.onLoadEnd)
},removeTileMonitoringHooks:function(tile){tile.unload();
tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,scope:this})
},moveGriddedTiles:function(bounds){var buffer=this.buffer||1;
while(true){var tlLayer=this.grid[0][0].position;
var tlViewPort=this.map.getViewPortPxFromLayerPx(tlLayer);
if(tlViewPort.x>-this.tileSize.w*(buffer-1)){this.shiftColumn(true)
}else{if(tlViewPort.x<-this.tileSize.w*buffer){this.shiftColumn(false)
}else{if(tlViewPort.y>-this.tileSize.h*(buffer-1)){this.shiftRow(true)
}else{if(tlViewPort.y<-this.tileSize.h*buffer){this.shiftRow(false)
}else{break
}}}}}},shiftRow:function(prepend){var modelRowIndex=(prepend)?0:(this.grid.length-1);
var grid=this.grid;
var modelRow=grid[modelRowIndex];
var resolution=this.map.getResolution();
var deltaY=(prepend)?-this.tileSize.h:this.tileSize.h;
var deltaLat=resolution*-deltaY;
var row=(prepend)?grid.pop():grid.shift();
for(var i=0,len=modelRow.length;
i<len;
i++){var modelTile=modelRow[i];
var bounds=modelTile.bounds.clone();
var position=modelTile.position.clone();
bounds.bottom=bounds.bottom+deltaLat;
bounds.top=bounds.top+deltaLat;
position.y=position.y+deltaY;
row[i].moveTo(bounds,position)
}if(prepend){grid.unshift(row)
}else{grid.push(row)
}},shiftColumn:function(prepend){var deltaX=(prepend)?-this.tileSize.w:this.tileSize.w;
var resolution=this.map.getResolution();
var deltaLon=resolution*deltaX;
for(var i=0,len=this.grid.length;
i<len;
i++){var row=this.grid[i];
var modelTileIndex=(prepend)?0:(row.length-1);
var modelTile=row[modelTileIndex];
var bounds=modelTile.bounds.clone();
var position=modelTile.position.clone();
bounds.left=bounds.left+deltaLon;
bounds.right=bounds.right+deltaLon;
position.x=position.x+deltaX;
var tile=prepend?this.grid[i].pop():this.grid[i].shift();
tile.moveTo(bounds,position);
if(prepend){row.unshift(tile)
}else{row.push(tile)
}}},removeExcessTiles:function(rows,columns){while(this.grid.length>rows){var row=this.grid.pop();
for(var i=0,l=row.length;
i<l;
i++){var tile=row[i];
this.removeTileMonitoringHooks(tile);
tile.destroy()
}}while(this.grid[0].length>columns){for(var i=0,l=this.grid.length;
i<l;
i++){var row=this.grid[i];
var tile=row.pop();
this.removeTileMonitoringHooks(tile);
tile.destroy()
}}},onMapResize:function(){if(this.singleTile){this.clearGrid();
this.setTileSize()
}},getTileBounds:function(viewPortPx){var maxExtent=this.maxExtent;
var resolution=this.getResolution();
var tileMapWidth=resolution*this.tileSize.w;
var tileMapHeight=resolution*this.tileSize.h;
var mapPoint=this.getLonLatFromViewPortPx(viewPortPx);
var tileLeft=maxExtent.left+(tileMapWidth*Math.floor((mapPoint.lon-maxExtent.left)/tileMapWidth));
var tileBottom=maxExtent.bottom+(tileMapHeight*Math.floor((mapPoint.lat-maxExtent.bottom)/tileMapHeight));
return new OpenLayers.Bounds(tileLeft,tileBottom,tileLeft+tileMapWidth,tileBottom+tileMapHeight)
},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{"EPSG:4326":true},initialize:function(name,url,params,options){var newArguments=[];
params=OpenLayers.Util.upperCaseObject(params);
if(parseFloat(params.VERSION)>=1.3&&!params.EXCEPTIONS){params.EXCEPTIONS="INIMAGE"
}newArguments.push(name,url,params,options);
OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments);
OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));
if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((options==null)||(!options.isBaseLayer)){this.isBaseLayer=false
}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"
}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},reverseAxisOrder:function(){return(parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()])
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var imageSize=this.getImageSize();
var newParams={};
var reverseAxisOrder=this.reverseAxisOrder();
newParams.BBOX=this.encodeBBOX?bounds.toBBOX(null,reverseAxisOrder):bounds.toArray(reverseAxisOrder);
newParams.WIDTH=imageSize.w;
newParams.HEIGHT=imageSize.h;
var requestString=this.getFullRequestString(newParams);
return requestString
},addTile:function(bounds,position){return new OpenLayers.Tile.Image(this,position,bounds,null,this.tileSize)
},mergeNewParams:function(newParams){var upperParams=OpenLayers.Util.upperCaseObject(newParams);
var newArguments=[upperParams];
return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,newArguments)
},getFullRequestString:function(newParams,altUrl){var projectionCode=this.map.getProjection();
var value=(projectionCode=="none")?null:projectionCode;
if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=value
}else{this.params.SRS=value
}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,initialize:function(name,url,options){if(options&&options.sphericalMercator||this.sphericalMercator){options=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.0339,numZoomLevels:19,units:"m",projection:"EPSG:900913"},options)
}url=url||this.url;
name=name||this.name;
var newArguments=[name,url,{},options];
OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){var res=this.map.getResolution();
var x=Math.round((bounds.left-this.maxExtent.left)/(res*this.tileSize.w));
var y=Math.round((this.maxExtent.top-bounds.top)/(res*this.tileSize.h));
var z=this.map.getZoom()+this.zoomOffset;
var url=this.url;
var s=""+x+y+z;
if(url instanceof Array){url=this.selectUrl(s,url)
}var path=OpenLayers.String.format(url,{x:x,y:y,z:z});
return path
},addTile:function(bounds,position){return new OpenLayers.Tile.Image(this,position,bounds,null,this.tileSize)
},setMap:function(map){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);
if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom)
}},CLASS_NAME:"OpenLayers.Layer.XYZ"});
OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())
}obj=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj]);
return obj
},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,isGecko:null,supportUse:null,initialize:function(containerID){if(!this.supported()){return
}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);
this.translationParameters={x:0,y:0};
this.supportUse=(navigator.userAgent.toLowerCase().indexOf("applewebkit/5")==-1);
this.isGecko=(navigator.userAgent.toLowerCase().indexOf("gecko/")!=-1);
this.symbolMetrics={}
},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)
},supported:function(){var svgFeature="http://www.w3.org/TR/SVG11/feature#";
return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(svgFeature+"SVG","1.1")||document.implementation.hasFeature(svgFeature+"BasicStructure","1.1")))
},inValidRange:function(x,y,xyOnly){var left=x+(xyOnly?0:this.translationParameters.x);
var top=y+(xyOnly?0:this.translationParameters.y);
return(left>=-this.MAX_PIXEL&&left<=this.MAX_PIXEL&&top>=-this.MAX_PIXEL&&top<=this.MAX_PIXEL)
},setExtent:function(extent,resolutionChanged){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);
var resolution=this.getResolution();
var left=-extent.left/resolution;
var top=extent.top/resolution;
if(resolutionChanged){this.left=left;
this.top=top;
var extentString="0 0 "+this.size.w+" "+this.size.h;
this.rendererRoot.setAttributeNS(null,"viewBox",extentString);
this.translate(0,0);
return true
}else{var inRange=this.translate(left-this.left,top-this.top);
if(!inRange){this.setExtent(extent,true)
}return inRange
}},translate:function(x,y){if(!this.inValidRange(x,y,true)){return false
}else{var transformString="";
if(x||y){transformString="translate("+x+","+y+")"
}this.root.setAttributeNS(null,"transform",transformString);
this.translationParameters={x:x,y:y};
return true
}},setSize:function(size){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);
this.rendererRoot.setAttributeNS(null,"width",this.size.w);
this.rendererRoot.setAttributeNS(null,"height",this.size.h)
},getNodeType:function(geometry,style){var nodeType=null;
switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":if(style.externalGraphic){nodeType="image"
}else{if(this.isComplexSymbol(style.graphicName)){nodeType=this.supportUse===false?"svg":"use"
}else{nodeType="circle"
}}break;
case"OpenLayers.Geometry.Rectangle":nodeType="rect";
break;
case"OpenLayers.Geometry.LineString":nodeType="polyline";
break;
case"OpenLayers.Geometry.LinearRing":nodeType="polygon";
break;
case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":nodeType="path";
break;
default:break
}return nodeType
},setStyle:function(node,style,options){style=style||node._style;
options=options||node._options;
var r=parseFloat(node.getAttributeNS(null,"r"));
var widthFactor=1;
var pos;
if(node._geometryClass=="OpenLayers.Geometry.Point"&&r){node.style.visibility="";
if(style.graphic===false){node.style.visibility="hidden"
}else{if(style.externalGraphic){pos=this.getPosition(node);
if(style.graphicTitle){node.setAttributeNS(null,"title",style.graphicTitle)
}if(style.graphicWidth&&style.graphicHeight){node.setAttributeNS(null,"preserveAspectRatio","none")
}var width=style.graphicWidth||style.graphicHeight;
var height=style.graphicHeight||style.graphicWidth;
width=width?width:style.pointRadius*2;
height=height?height:style.pointRadius*2;
var xOffset=(style.graphicXOffset!=undefined)?style.graphicXOffset:-(0.5*width);
var yOffset=(style.graphicYOffset!=undefined)?style.graphicYOffset:-(0.5*height);
var opacity=style.graphicOpacity||style.fillOpacity;
node.setAttributeNS(null,"x",(pos.x+xOffset).toFixed());
node.setAttributeNS(null,"y",(pos.y+yOffset).toFixed());
node.setAttributeNS(null,"width",width);
node.setAttributeNS(null,"height",height);
node.setAttributeNS(this.xlinkns,"href",style.externalGraphic);
node.setAttributeNS(null,"style","opacity: "+opacity)
}else{if(this.isComplexSymbol(style.graphicName)){var offset=style.pointRadius*3;
var size=offset*2;
var id=this.importSymbol(style.graphicName);
pos=this.getPosition(node);
widthFactor=this.symbolMetrics[id][0]*3/size;
var parent=node.parentNode;
var nextSibling=node.nextSibling;
if(parent){parent.removeChild(node)
}if(this.supportUse===false){var src=document.getElementById(id);
node.firstChild&&node.removeChild(node.firstChild);
node.appendChild(src.firstChild.cloneNode(true));
node.setAttributeNS(null,"viewBox",src.getAttributeNS(null,"viewBox"))
}else{node.setAttributeNS(this.xlinkns,"href","#"+id)
}node.setAttributeNS(null,"width",size);
node.setAttributeNS(null,"height",size);
node.setAttributeNS(null,"x",pos.x-offset);
node.setAttributeNS(null,"y",pos.y-offset);
if(nextSibling){parent.insertBefore(node,nextSibling)
}else{if(parent){parent.appendChild(node)
}}}else{node.setAttributeNS(null,"r",style.pointRadius)
}}}var rotation=style.rotation;
if((rotation!==undefined||node._rotation!==undefined)&&pos){node._rotation=rotation;
rotation|=0;
if(node.nodeName!=="svg"){node.setAttributeNS(null,"transform","rotate("+rotation+" "+pos.x+" "+pos.y+")")
}else{var metrics=this.symbolMetrics[id];
node.firstChild.setAttributeNS(null,"transform","rotate("+style.rotation+" "+metrics[1]+" "+metrics[2]+")")
}}}if(options.isFilled){node.setAttributeNS(null,"fill",style.fillColor);
node.setAttributeNS(null,"fill-opacity",style.fillOpacity)
}else{node.setAttributeNS(null,"fill","none")
}if(options.isStroked){node.setAttributeNS(null,"stroke",style.strokeColor);
node.setAttributeNS(null,"stroke-opacity",style.strokeOpacity);
node.setAttributeNS(null,"stroke-width",style.strokeWidth*widthFactor);
node.setAttributeNS(null,"stroke-linecap",style.strokeLinecap||"round");
node.setAttributeNS(null,"stroke-linejoin","round");
style.strokeDashstyle&&node.setAttributeNS(null,"stroke-dasharray",this.dashStyle(style,widthFactor))
}else{node.setAttributeNS(null,"stroke","none")
}if(style.pointerEvents){node.setAttributeNS(null,"pointer-events",style.pointerEvents)
}if(style.cursor!=null){node.setAttributeNS(null,"cursor",style.cursor)
}return node
},dashStyle:function(style,widthFactor){var w=style.strokeWidth*widthFactor;
var str=style.strokeDashstyle;
switch(str){case"solid":return"none";
case"dot":return[1,4*w].join();
case"dash":return[4*w,4*w].join();
case"dashdot":return[4*w,4*w,1,4*w].join();
case"longdash":return[8*w,4*w].join();
case"longdashdot":return[8*w,4*w,1,4*w].join();
default:return OpenLayers.String.trim(str).replace(/\s+/g,",")
}},createNode:function(type,id){var node=document.createElementNS(this.xmlns,type);
if(id){node.setAttributeNS(null,"id",id)
}return node
},nodeTypeCompare:function(node,type){return(type==node.nodeName)
},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")
},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"g")
},createDefs:function(){var defs=this.nodeFactory(this.container.id+"_defs","defs");
this.rendererRoot.appendChild(defs);
return defs
},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)
},drawCircle:function(node,geometry,radius){var resolution=this.getResolution();
var x=(geometry.x/resolution+this.left);
var y=(this.top-geometry.y/resolution);
if(this.inValidRange(x,y)){node.setAttributeNS(null,"cx",x);
node.setAttributeNS(null,"cy",y);
node.setAttributeNS(null,"r",radius);
return node
}else{return false
}},drawLineString:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);
if(componentsResult.path){node.setAttributeNS(null,"points",componentsResult.path);
return(componentsResult.complete?node:null)
}else{return false
}},drawLinearRing:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);
if(componentsResult.path){node.setAttributeNS(null,"points",componentsResult.path);
return(componentsResult.complete?node:null)
}else{return false
}},drawPolygon:function(node,geometry){var d="";
var draw=true;
var complete=true;
var linearRingResult,path;
for(var j=0,len=geometry.components.length;
j<len;
j++){d+=" M";
linearRingResult=this.getComponentsString(geometry.components[j].components," ");
path=linearRingResult.path;
if(path){d+=" "+path;
complete=linearRingResult.complete&&complete
}else{draw=false
}}d+=" z";
if(draw){node.setAttributeNS(null,"d",d);
node.setAttributeNS(null,"fill-rule","evenodd");
return complete?node:null
}else{return false
}},drawRectangle:function(node,geometry){var resolution=this.getResolution();
var x=(geometry.x/resolution+this.left);
var y=(this.top-geometry.y/resolution);
if(this.inValidRange(x,y)){node.setAttributeNS(null,"x",x);
node.setAttributeNS(null,"y",y);
node.setAttributeNS(null,"width",geometry.width/resolution);
node.setAttributeNS(null,"height",geometry.height/resolution);
return node
}else{return false
}},drawSurface:function(node,geometry){var d=null;
var draw=true;
for(var i=0,len=geometry.components.length;
i<len;
i++){if((i%3)==0&&(i/3)==0){var component=this.getShortString(geometry.components[i]);
if(!component){draw=false
}d="M "+component
}else{if((i%3)==1){var component=this.getShortString(geometry.components[i]);
if(!component){draw=false
}d+=" C "+component
}else{var component=this.getShortString(geometry.components[i]);
if(!component){draw=false
}d+=" "+component
}}}d+=" Z";
if(draw){node.setAttributeNS(null,"d",d);
return node
}else{return false
}},drawText:function(featureId,style,location){var resolution=this.getResolution();
var x=(location.x/resolution+this.left);
var y=(location.y/resolution-this.top);
var label=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX,"text");
var tspan=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX+"_tspan","tspan");
label.setAttributeNS(null,"x",x);
label.setAttributeNS(null,"y",-y);
if(style.fontColor){label.setAttributeNS(null,"fill",style.fontColor)
}if(style.fontOpacity){label.setAttributeNS(null,"opacity",style.fontOpacity)
}if(style.fontFamily){label.setAttributeNS(null,"font-family",style.fontFamily)
}if(style.fontSize){label.setAttributeNS(null,"font-size",style.fontSize)
}if(style.fontWeight){label.setAttributeNS(null,"font-weight",style.fontWeight)
}if(style.labelSelect===true){label.setAttributeNS(null,"pointer-events","visible");
label._featureId=featureId;
tspan._featureId=featureId;
tspan._geometry=location;
tspan._geometryClass=location.CLASS_NAME
}else{label.setAttributeNS(null,"pointer-events","none")
}var align=style.labelAlign||"cm";
label.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[0]]||"middle");
if(this.isGecko){label.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[1]]||"central")
}else{tspan.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[align[1]]||"-35%")
}tspan.textContent=style.label;
if(!label.parentNode){label.appendChild(tspan);
this.textRoot.appendChild(label)
}},getComponentsString:function(components,separator){var renderCmp=[];
var complete=true;
var len=components.length;
var strings=[];
var str,component;
for(var i=0;
i<len;
i++){component=components[i];
renderCmp.push(component);
str=this.getShortString(component);
if(str){strings.push(str)
}else{if(i>0){if(this.getShortString(components[i-1])){strings.push(this.clipLine(components[i],components[i-1]))
}}if(i<len-1){if(this.getShortString(components[i+1])){strings.push(this.clipLine(components[i],components[i+1]))
}}complete=false
}}return{path:strings.join(separator||","),complete:complete}
},clipLine:function(badComponent,goodComponent){if(goodComponent.equals(badComponent)){return""
}var resolution=this.getResolution();
var maxX=this.MAX_PIXEL-this.translationParameters.x;
var maxY=this.MAX_PIXEL-this.translationParameters.y;
var x1=goodComponent.x/resolution+this.left;
var y1=this.top-goodComponent.y/resolution;
var x2=badComponent.x/resolution+this.left;
var y2=this.top-badComponent.y/resolution;
var k;
if(x2<-maxX||x2>maxX){k=(y2-y1)/(x2-x1);
x2=x2<0?-maxX:maxX;
y2=y1+(x2-x1)*k
}if(y2<-maxY||y2>maxY){k=(x2-x1)/(y2-y1);
y2=y2<0?-maxY:maxY;
x2=x1+(y2-y1)*k
}return x2+","+y2
},getShortString:function(point){var resolution=this.getResolution();
var x=(point.x/resolution+this.left);
var y=(this.top-point.y/resolution);
if(this.inValidRange(x,y)){return x+","+y
}else{return false
}},getPosition:function(node){return({x:parseFloat(node.getAttributeNS(null,"cx")),y:parseFloat(node.getAttributeNS(null,"cy"))})
},importSymbol:function(graphicName){if(!this.defs){this.defs=this.createDefs()
}var id=this.container.id+"-"+graphicName;
if(document.getElementById(id)!=null){return id
}var symbol=OpenLayers.Renderer.symbol[graphicName];
if(!symbol){throw new Error(graphicName+" is not a valid symbol name")
}var symbolNode=this.nodeFactory(id,"symbol");
var node=this.nodeFactory(null,"polygon");
symbolNode.appendChild(node);
var symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);
var points=[];
var x,y;
for(var i=0;
i<symbol.length;
i=i+2){x=symbol[i];
y=symbol[i+1];
symbolExtent.left=Math.min(symbolExtent.left,x);
symbolExtent.bottom=Math.min(symbolExtent.bottom,y);
symbolExtent.right=Math.max(symbolExtent.right,x);
symbolExtent.top=Math.max(symbolExtent.top,y);
points.push(x,",",y)
}node.setAttributeNS(null,"points",points.join(" "));
var width=symbolExtent.getWidth();
var height=symbolExtent.getHeight();
var viewBox=[symbolExtent.left-width,symbolExtent.bottom-height,width*3,height*3];
symbolNode.setAttributeNS(null,"viewBox",viewBox.join(" "));
this.symbolMetrics[id]=[Math.max(width,height),symbolExtent.getCenterLonLat().lon,symbolExtent.getCenterLonLat().lat];
this.defs.appendChild(symbolNode);
return symbolNode.id
},getFeatureIdFromEvent:function(evt){var featureId=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);
if(this.supportUse===false&&!featureId){var target=evt.target;
featureId=target.parentNode&&target!=this.rendererRoot&&target.parentNode._featureId
}return featureId
},CLASS_NAME:"OpenLayers.Renderer.SVG"});
OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};
OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(name,url,layername,options){this.layername=layername;
OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,{},options]);
this.extension=this.format.split("/")[1].toLowerCase();
this.extension=(this.extension=="jpg")?"jpeg":this.extension
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){var res=this.map.getResolution();
var bbox=this.maxExtent;
var size=this.tileSize;
var tileX=Math.round((bounds.left-bbox.left)/(res*size.w));
var tileY=Math.round((bounds.bottom-bbox.bottom)/(res*size.h));
var tileZ=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,res):this.map.getZoom();
function zeroPad(number,length){number=String(number);
var zeros=[];
for(var i=0;
i<length;
++i){zeros.push("0")
}return zeros.join("").substring(0,length-number.length)+number
}var components=[this.layername,zeroPad(tileZ,2),zeroPad(parseInt(tileX/1000000),3),zeroPad((parseInt(tileX/1000)%1000),3),zeroPad((parseInt(tileX)%1000),3),zeroPad(parseInt(tileY/1000000),3),zeroPad((parseInt(tileY/1000)%1000),3),zeroPad((parseInt(tileY)%1000),3)+"."+this.extension];
var path=components.join("/");
var url=this.url;
if(url instanceof Array){url=this.selectUrl(path,url)
}url=(url.charAt(url.length-1)=="/")?url:url+"/";
return url+path
},addTile:function(bounds,position){var url=this.getURL(bounds);
return new OpenLayers.Tile.Image(this,position,bounds,url,this.tileSize)
},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options])
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(!this.eTop){this.eTop=document.createElement("div");
this.eTop.className=this.displayClass+"Top";
var theLen=this.topInUnits.length;
this.div.appendChild(this.eTop);
if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"
}else{this.eTop.style.visibility="visible"
}this.eBottom=document.createElement("div");
this.eBottom.className=this.displayClass+"Bottom";
this.div.appendChild(this.eBottom);
if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"
}else{this.eBottom.style.visibility="visible"
}}this.map.events.register("moveend",this,this.update);
this.update();
return this.div
},getBarLen:function(maxLen){var digits=parseInt(Math.log(maxLen)/Math.log(10));
var pow10=Math.pow(10,digits);
var firstChar=parseInt(maxLen/pow10);
var barLen;
if(firstChar>5){barLen=5
}else{if(firstChar>2){barLen=2
}else{barLen=1
}}return barLen*pow10
},update:function(){var res=this.map.getResolution();
if(!res){return
}var curMapUnits=this.map.getUnits();
var inches=OpenLayers.INCHES_PER_UNIT;
var maxSizeData=this.maxWidth*res*inches[curMapUnits];
var geodesicRatio=1;
if(this.geodesic===true){var maxSizeGeodesic=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth;
var maxSizeKilometers=maxSizeData/inches.km;
geodesicRatio=maxSizeGeodesic/maxSizeKilometers;
maxSizeData*=geodesicRatio
}var topUnits;
var bottomUnits;
if(maxSizeData>100000){topUnits=this.topOutUnits;
bottomUnits=this.bottomOutUnits
}else{topUnits=this.topInUnits;
bottomUnits=this.bottomInUnits
}var topMax=maxSizeData/inches[topUnits];
var bottomMax=maxSizeData/inches[bottomUnits];
var topRounded=this.getBarLen(topMax);
var bottomRounded=this.getBarLen(bottomMax);
topMax=topRounded/inches[curMapUnits]*inches[topUnits];
bottomMax=bottomRounded/inches[curMapUnits]*inches[bottomUnits];
var topPx=topMax/res/geodesicRatio;
var bottomPx=bottomMax/res/geodesicRatio;
if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(bottomPx)+"px";
this.eBottom.innerHTML=bottomRounded+" "+bottomUnits
}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(topPx)+"px";
this.eTop.innerHTML=topRounded+" "+topUnits
}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(options){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[options])
},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(node,container){var obj={};
this.readChildNodes(node,obj);
container.outer=obj.components[0]
},innerBoundaryIs:function(node,container){var obj={};
this.readChildNodes(node,obj);
container.inner.push(obj.components[0])
},Box:function(node,container){var obj={};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}var min=obj.points[0];
var max=obj.points[1];
container.components.push(new OpenLayers.Bounds(min.x,min.y,max.x,max.y))
}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(features){var name;
if(features instanceof Array){name="wfs:FeatureCollection"
}else{name="gml:featureMember"
}var root=this.writeNode(name,features);
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(geometry){var node=this.createElementNSPlus("gml:Point");
this.writeNode("coordinates",[geometry],node);
return node
},coordinates:function(points){var numPoints=points.length;
var parts=new Array(numPoints);
var point;
for(var i=0;
i<numPoints;
++i){point=points[i];
if(this.xy){parts[i]=point.x+","+point.y
}else{parts[i]=point.y+","+point.x
}if(point.z!=undefined){parts[i]+=","+point.z
}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(numPoints==1)?parts[0]:parts.join(" ")})
},LineString:function(geometry){var node=this.createElementNSPlus("gml:LineString");
this.writeNode("coordinates",geometry.components,node);
return node
},Polygon:function(geometry){var node=this.createElementNSPlus("gml:Polygon");
this.writeNode("outerBoundaryIs",geometry.components[0],node);
for(var i=1;
i<geometry.components.length;
++i){this.writeNode("innerBoundaryIs",geometry.components[i],node)
}return node
},outerBoundaryIs:function(ring){var node=this.createElementNSPlus("gml:outerBoundaryIs");
this.writeNode("LinearRing",ring,node);
return node
},innerBoundaryIs:function(ring){var node=this.createElementNSPlus("gml:innerBoundaryIs");
this.writeNode("LinearRing",ring,node);
return node
},LinearRing:function(ring){var node=this.createElementNSPlus("gml:LinearRing");
this.writeNode("coordinates",ring.components,node);
return node
},Box:function(bounds){var node=this.createElementNSPlus("gml:Box");
this.writeNode("coordinates",[{x:bounds.left,y:bounds.bottom},{x:bounds.right,y:bounds.top}],node);
if(this.srsName){node.setAttribute("srsName",this.srsName)
}return node
}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,initialize:function(options){OpenLayers.Format.prototype.initialize.apply(this,[options])
},read:function(json,filter){try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var object=eval("("+json+")");
if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])
}}}return filter(k,v)
}object=walk("",object)
}if(this.keepData){this.data=object
}return object
}}catch(e){}return null
},write:function(value,pretty){this.pretty=!!pretty;
var json=null;
var type=typeof value;
if(this.serialize[type]){try{json=this.serialize[type].apply(this,[value])
}catch(err){OpenLayers.Console.error("Trouble serializing: "+err)
}}return json
},writeIndent:function(){var pieces=[];
if(this.pretty){for(var i=0;
i<this.level;
++i){pieces.push(this.indent)
}}return pieces.join("")
},writeNewline:function(){return(this.pretty)?this.newline:""
},writeSpace:function(){return(this.pretty)?this.space:""
},serialize:{object:function(object){if(object==null){return"null"
}if(object.constructor==Date){return this.serialize.date.apply(this,[object])
}if(object.constructor==Array){return this.serialize.array.apply(this,[object])
}var pieces=["{"];
this.level+=1;
var key,keyJSON,valueJSON;
var addComma=false;
for(key in object){if(object.hasOwnProperty(key)){keyJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[key,this.pretty]);
valueJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[object[key],this.pretty]);
if(keyJSON!=null&&valueJSON!=null){if(addComma){pieces.push(",")
}pieces.push(this.writeNewline(),this.writeIndent(),keyJSON,":",this.writeSpace(),valueJSON);
addComma=true
}}}this.level-=1;
pieces.push(this.writeNewline(),this.writeIndent(),"}");
return pieces.join("")
},array:function(array){var json;
var pieces=["["];
this.level+=1;
for(var i=0,len=array.length;
i<len;
++i){json=OpenLayers.Format.JSON.prototype.write.apply(this,[array[i],this.pretty]);
if(json!=null){if(i>0){pieces.push(",")
}pieces.push(this.writeNewline(),this.writeIndent(),json)
}}this.level-=1;
pieces.push(this.writeNewline(),this.writeIndent(),"]");
return pieces.join("")
},string:function(string){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};
if(/["\\\x00-\x1f]/.test(string)){return'"'+string.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];
if(c){return c
}c=b.charCodeAt();
return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)
})+'"'
}return'"'+string+'"'
},number:function(number){return isFinite(number)?String(number):"null"
},"boolean":function(bool){return String(bool)
},date:function(date){function format(number){return(number<10)?"0"+number:number
}return'"'+date.getFullYear()+"-"+format(date.getMonth()+1)+"-"+format(date.getDate())+"T"+format(date.getHours())+":"+format(date.getMinutes())+":"+format(date.getSeconds())+'"'
}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){var obj={};
this.readers.ogc.Filter.apply(this,[data,obj]);
return obj.filter
},readers:{ogc:{Filter:function(node,parent){var obj={fids:[],filters:[]};
this.readChildNodes(node,obj);
if(obj.fids.length>0){parent.filter=new OpenLayers.Filter.FeatureId({fids:obj.fids})
}else{if(obj.filters.length>0){parent.filter=obj.filters[0]
}}},FeatureId:function(node,obj){var fid=node.getAttribute("fid");
if(fid){obj.fids.push(fid)
}},And:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},Or:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},Not:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsLessThan:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsGreaterThan:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsLessThanOrEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsGreaterThanOrEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsBetween:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},Literal:function(node,obj){obj.value=OpenLayers.String.numericIf(this.getChildValue(node))
},PropertyName:function(node,filter){filter.property=this.getChildValue(node)
},LowerBoundary:function(node,filter){filter.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(node))
},UpperBoundary:function(node,filter){filter.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(node))
},Intersects:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.INTERSECTS)
},Within:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.WITHIN)
},Contains:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.CONTAINS)
},DWithin:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.DWITHIN)
},Distance:function(node,obj){obj.distance=parseInt(this.getChildValue(node));
obj.distanceUnits=node.getAttribute("units")
}}},readSpatial:function(node,obj,type){var filter=new OpenLayers.Filter.Spatial({type:type});
this.readChildNodes(node,filter);
filter.value=filter.components[0];
delete filter.components;
obj.filters.push(filter)
},readOgcExpression:function(node){var obj={};
this.readChildNodes(node,obj);
var value=obj.value;
if(value===undefined){value=this.getChildValue(node)
}return value
},write:function(filter){return this.writers.ogc.Filter.apply(this,[filter])
},writers:{ogc:{Filter:function(filter){var node=this.createElementNSPlus("ogc:Filter");
var sub=filter.CLASS_NAME.split(".").pop();
if(sub=="FeatureId"){for(var i=0;
i<filter.fids.length;
++i){this.writeNode("FeatureId",filter.fids[i],node)
}}else{this.writeNode(this.getFilterType(filter),filter,node)
}return node
},FeatureId:function(fid){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:fid}})
},And:function(filter){var node=this.createElementNSPlus("ogc:And");
var childFilter;
for(var i=0;
i<filter.filters.length;
++i){childFilter=filter.filters[i];
this.writeNode(this.getFilterType(childFilter),childFilter,node)
}return node
},Or:function(filter){var node=this.createElementNSPlus("ogc:Or");
var childFilter;
for(var i=0;
i<filter.filters.length;
++i){childFilter=filter.filters[i];
this.writeNode(this.getFilterType(childFilter),childFilter,node)
}return node
},Not:function(filter){var node=this.createElementNSPlus("ogc:Not");
var childFilter=filter.filters[0];
this.writeNode(this.getFilterType(childFilter),childFilter,node);
return node
},PropertyIsLessThan:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLessThan");
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.value,node);
return node
},PropertyIsGreaterThan:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsGreaterThan");
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.value,node);
return node
},PropertyIsLessThanOrEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.value,node);
return node
},PropertyIsGreaterThanOrEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.value,node);
return node
},PropertyIsBetween:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsBetween");
this.writeNode("PropertyName",filter,node);
this.writeNode("LowerBoundary",filter,node);
this.writeNode("UpperBoundary",filter,node);
return node
},PropertyName:function(filter){return this.createElementNSPlus("ogc:PropertyName",{value:filter.property})
},Literal:function(value){return this.createElementNSPlus("ogc:Literal",{value:value})
},LowerBoundary:function(filter){var node=this.createElementNSPlus("ogc:LowerBoundary");
this.writeNode("Literal",filter.lowerBoundary,node);
return node
},UpperBoundary:function(filter){var node=this.createElementNSPlus("ogc:UpperBoundary");
this.writeNode("Literal",filter.upperBoundary,node);
return node
},INTERSECTS:function(filter){return this.writeSpatial(filter,"Intersects")
},WITHIN:function(filter){return this.writeSpatial(filter,"Within")
},CONTAINS:function(filter){return this.writeSpatial(filter,"Contains")
},DWITHIN:function(filter){var node=this.writeSpatial(filter,"DWithin");
this.writeNode("Distance",filter,node);
return node
},Distance:function(filter){return this.createElementNSPlus("ogc:Distance",{attributes:{units:filter.distanceUnits},value:filter.distance})
}}},getFilterType:function(filter){var filterType=this.filterMap[filter.type];
if(!filterType){throw"Filter writing not supported for rule type: "+filter.type
}return filterType
},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(options){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[options])
},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsNotEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsLike:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});
this.readChildNodes(node,filter);
var wildCard=node.getAttribute("wildCard");
var singleChar=node.getAttribute("singleChar");
var esc=node.getAttribute("escape");
filter.value2regex(wildCard,singleChar,esc);
obj.filters.push(filter)
}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsEqualTo");
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.value,node);
return node
},PropertyIsNotEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.value,node);
return node
},PropertyIsLike:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.regex2value(),node);
return node
},BBOX:function(filter){var node=this.createElementNSPlus("ogc:BBOX");
this.writeNode("PropertyName",filter,node);
var box=this.writeNode("gml:Box",filter.value,node);
if(filter.projection){box.setAttribute("srsName",filter.projection)
}return node
}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(filter,name){var node=this.createElementNSPlus("ogc:"+name);
this.writeNode("PropertyName",filter,node);
var child;
if(filter.value instanceof OpenLayers.Geometry){child=this.writeNode("feature:_geometry",filter.value).firstChild
}else{child=this.writeNode("gml:Box",filter.value)
}if(filter.projection){child.setAttribute("srsName",filter.projection)
}node.appendChild(child);
return node
},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(options){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[options])
},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(node,obj){var matchCase=node.getAttribute("matchCase");
var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(matchCase==="false"||matchCase==="0")});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsNotEqualTo:function(node,obj){var matchCase=node.getAttribute("matchCase");
var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(matchCase==="false"||matchCase==="0")});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsLike:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});
this.readChildNodes(node,filter);
var wildCard=node.getAttribute("wildCard");
var singleChar=node.getAttribute("singleChar");
var esc=node.getAttribute("escapeChar");
filter.value2regex(wildCard,singleChar,esc);
obj.filters.push(filter)
}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:filter.matchCase}});
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.value,node);
return node
},PropertyIsNotEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:filter.matchCase}});
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.value,node);
return node
},PropertyIsLike:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escapeChar:"!"}});
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.regex2value(),node);
return node
},BBOX:function(filter){var node=this.createElementNSPlus("ogc:BBOX");
this.writeNode("PropertyName",filter,node);
var box=this.writeNode("gml:Envelope",filter.value);
if(filter.projection){box.setAttribute("srsName",filter.projection)
}node.appendChild(box);
return node
}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(filter,name){var node=this.createElementNSPlus("ogc:"+name);
this.writeNode("PropertyName",filter,node);
var child;
if(filter.value instanceof OpenLayers.Geometry){child=this.writeNode("feature:_geometry",filter.value).firstChild
}else{child=this.writeNode("gml:Envelope",filter.value)
}if(filter.projection){child.setAttribute("srsName",filter.projection)
}node.appendChild(child);
return node
},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var obj={};
this.readNode(data,obj);
return obj
},readers:{csw:{GetRecordsResponse:function(node,obj){obj.records=[];
this.readChildNodes(node,obj);
var version=this.getAttributeNS(node,"","version");
if(version!=""){obj.version=version
}},RequestId:function(node,obj){obj.RequestId=this.getChildValue(node)
},SearchStatus:function(node,obj){obj.SearchStatus={};
var timestamp=this.getAttributeNS(node,"","timestamp");
if(timestamp!=""){obj.SearchStatus.timestamp=timestamp
}},SearchResults:function(node,obj){this.readChildNodes(node,obj);
var attrs=node.attributes;
var SearchResults={};
for(var i=0,len=attrs.length;
i<len;
++i){if((attrs[i].name=="numberOfRecordsMatched")||(attrs[i].name=="numberOfRecordsReturned")||(attrs[i].name=="nextRecord")){SearchResults[attrs[i].name]=parseInt(attrs[i].nodeValue)
}else{SearchResults[attrs[i].name]=attrs[i].nodeValue
}}obj.SearchResults=SearchResults
},SummaryRecord:function(node,obj){var record={type:"SummaryRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},BriefRecord:function(node,obj){var record={type:"BriefRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},DCMIRecord:function(node,obj){var record={type:"DCMIRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},Record:function(node,obj){var record={type:"Record"};
this.readChildNodes(node,record);
obj.records.push(record)
}},dc:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
if(!(obj[name] instanceof Array)){obj[name]=new Array()
}var dc_element={};
var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){dc_element[attrs[i].name]=attrs[i].nodeValue
}dc_element.value=this.getChildValue(node);
obj[name].push(dc_element)
}},dct:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
if(!(obj[name] instanceof Array)){obj[name]=new Array()
}obj[name].push(this.getChildValue(node))
}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(node,obj){if(obj.bounds){obj.BoundingBox=[{crs:obj.projection,value:[obj.bounds.left,obj.bounds.bottom,obj.bounds.right,obj.bounds.top]}];
delete obj.projection;
delete obj.bounds
}OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows["BoundingBox"].apply(this,arguments)
}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(options){var node=this.writeNode("csw:GetRecords",options);
return OpenLayers.Format.XML.prototype.write.apply(this,[node])
},writers:{csw:{GetRecords:function(options){if(!options){options={}
}var node=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:options.requestId||this.requestId,resultType:options.resultType||this.resultType,outputFormat:options.outputFormat||this.outputFormat,outputSchema:options.outputSchema||this.outputSchema,startPosition:options.startPosition||this.startPosition,maxRecords:options.maxRecords||this.maxRecords}});
if(options.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",options.DistributedSearch||this.DistributedSearch,node)
}var ResponseHandler=options.ResponseHandler||this.ResponseHandler;
if(ResponseHandler instanceof Array&&ResponseHandler.length>0){for(var i=0,len=ResponseHandler.length;
i<len;
i++){this.writeNode("csw:ResponseHandler",ResponseHandler[i],node)
}}this.writeNode("Query",options.Query||this.Query,node);
return node
},DistributedSearch:function(options){var node=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:options.hopCount}});
return node
},ResponseHandler:function(options){var node=this.createElementNSPlus("csw:ResponseHandler",{value:options.value});
return node
},Query:function(options){if(!options){options={}
}var node=this.createElementNSPlus("csw:Query",{attributes:{typeNames:options.typeNames||"csw:Record"}});
var ElementName=options.ElementName;
if(ElementName instanceof Array&&ElementName.length>0){for(var i=0,len=ElementName.length;
i<len;
i++){this.writeNode("csw:ElementName",ElementName[i],node)
}}else{this.writeNode("csw:ElementSetName",options.ElementSetName||{value:"summary"},node)
}if(options.Constraint){this.writeNode("csw:Constraint",options.Constraint,node)
}return node
},ElementName:function(options){var node=this.createElementNSPlus("csw:ElementName",{value:options.value});
return node
},ElementSetName:function(options){var node=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:options.typeNames},value:options.value});
return node
},Constraint:function(options){var node=this.createElementNSPlus("csw:Constraint",{attributes:{version:options.version}});
if(options.Filter){var format=new OpenLayers.Format.Filter({version:options.version});
node.appendChild(format.write(options.Filter))
}else{if(options.CqlText){var child=this.createElementNSPlus("CqlText",{value:options.CqlText.value});
node.appendChild(child)
}}return node
}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,parser:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);
this.options=options
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
var version=this.version||root.getAttribute("version")||this.defaultVersion;
if(!this.parser||this.parser.version!==version){var constr=OpenLayers.Format.WMSCapabilities["v"+version.replace(/\./g,"_")];
if(!constr){throw"Can't find a WMS capabilities parser for version "+version
}this.parser=new constr(this.options)
}var capabilities=this.parser.read(data);
capabilities.version=version;
return capabilities
},CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var capabilities={};
this.readNode(data,capabilities);
this.postProcessLayers(capabilities);
return capabilities
},postProcessLayers:function(capabilities){if(capabilities.capability){capabilities.capability.layers=[];
var layers=capabilities.capability.nestedLayers;
for(var i=0,len=layers.length;
i<len;
++i){var layer=layers[i];
this.processLayer(capabilities.capability,layer)
}}},processLayer:function(capability,layer,parentLayer){if(layer.formats===undefined){layer.formats=capability.request.getmap.formats
}if(parentLayer){layer.styles=layer.styles.concat(parentLayer.styles);
var attributes=["queryable","cascaded","fixedWidth","fixedHeight","opaque","noSubsets","llbbox","minScale","maxScale","attribution"];
var complexAttr=["srs","bbox","dimensions","authorityURLs"];
var key;
for(var j=0;
j<attributes.length;
j++){key=attributes[j];
if(key in parentLayer){if(layer[key]==null){layer[key]=parentLayer[key]
}if(layer[key]==null){var intAttr=["cascaded","fixedWidth","fixedHeight"];
var boolAttr=["queryable","opaque","noSubsets"];
if(OpenLayers.Util.indexOf(intAttr,key)!=-1){layer[key]=0
}if(OpenLayers.Util.indexOf(boolAttr,key)!=-1){layer[key]=false
}}}}for(var j=0;
j<complexAttr.length;
j++){key=complexAttr[j];
layer[key]=OpenLayers.Util.extend(layer[key],parentLayer[key])
}}for(var i=0,len=layer.nestedLayers.length;
i<len;
i++){var childLayer=layer.nestedLayers[i];
this.processLayer(capability,childLayer,layer)
}if(layer.name){capability.layers.push(layer)
}},readers:{wms:{Service:function(node,obj){obj.service={};
this.readChildNodes(node,obj.service)
},Name:function(node,obj){obj.name=this.getChildValue(node)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,obj){obj["abstract"]=this.getChildValue(node)
},BoundingBox:function(node,obj){var bbox={};
bbox.bbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))];
var res={x:parseFloat(node.getAttribute("resx")),y:parseFloat(node.getAttribute("resy"))};
if(!(isNaN(res.x)&&isNaN(res.y))){bbox.res=res
}return bbox
},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")
},ContactInformation:function(node,obj){obj.contactInformation={};
this.readChildNodes(node,obj.contactInformation)
},ContactPersonPrimary:function(node,obj){obj.personPrimary={};
this.readChildNodes(node,obj.personPrimary)
},ContactPerson:function(node,obj){obj.person=this.getChildValue(node)
},ContactOrganization:function(node,obj){obj.organization=this.getChildValue(node)
},ContactPosition:function(node,obj){obj.position=this.getChildValue(node)
},ContactAddress:function(node,obj){obj.contactAddress={};
this.readChildNodes(node,obj.contactAddress)
},AddressType:function(node,obj){obj.type=this.getChildValue(node)
},Address:function(node,obj){obj.address=this.getChildValue(node)
},City:function(node,obj){obj.city=this.getChildValue(node)
},StateOrProvince:function(node,obj){obj.stateOrProvince=this.getChildValue(node)
},PostCode:function(node,obj){obj.postcode=this.getChildValue(node)
},Country:function(node,obj){obj.country=this.getChildValue(node)
},ContactVoiceTelephone:function(node,obj){obj.phone=this.getChildValue(node)
},ContactFacsimileTelephone:function(node,obj){obj.fax=this.getChildValue(node)
},ContactElectronicMailAddress:function(node,obj){obj.email=this.getChildValue(node)
},Fees:function(node,obj){var fees=this.getChildValue(node);
if(fees&&fees.toLowerCase()!="none"){obj.fees=fees
}},AccessConstraints:function(node,obj){var constraints=this.getChildValue(node);
if(constraints&&constraints.toLowerCase()!="none"){obj.accessConstraints=constraints
}},Capability:function(node,obj){obj.capability={nestedLayers:[]};
this.readChildNodes(node,obj.capability)
},Request:function(node,obj){obj.request={};
this.readChildNodes(node,obj.request)
},GetCapabilities:function(node,obj){obj.getcapabilities={formats:[]};
this.readChildNodes(node,obj.getcapabilities)
},Format:function(node,obj){if(obj.formats instanceof Array){obj.formats.push(this.getChildValue(node))
}else{obj.format=this.getChildValue(node)
}},DCPType:function(node,obj){this.readChildNodes(node,obj)
},HTTP:function(node,obj){this.readChildNodes(node,obj)
},Get:function(node,obj){this.readChildNodes(node,obj)
},Post:function(node,obj){this.readChildNodes(node,obj)
},GetMap:function(node,obj){obj.getmap={formats:[]};
this.readChildNodes(node,obj.getmap)
},GetFeatureInfo:function(node,obj){obj.getfeatureinfo={formats:[]};
this.readChildNodes(node,obj.getfeatureinfo)
},Exception:function(node,obj){obj.exception={formats:[]};
this.readChildNodes(node,obj.exception)
},Layer:function(node,obj){var attrNode=node.getAttributeNode("queryable");
var queryable=(attrNode&&attrNode.specified)?node.getAttribute("queryable"):null;
attrNode=node.getAttributeNode("cascaded");
var cascaded=(attrNode&&attrNode.specified)?node.getAttribute("cascaded"):null;
attrNode=node.getAttributeNode("opaque");
var opaque=(attrNode&&attrNode.specified)?node.getAttribute("opaque"):null;
var noSubsets=node.getAttribute("noSubsets");
var fixedWidth=node.getAttribute("fixedWidth");
var fixedHeight=node.getAttribute("fixedHeight");
var layer={nestedLayers:[],styles:[],srs:{},metadataURLs:[],bbox:{},dimensions:{},authorityURLs:{},identifiers:{},keywords:[],queryable:(queryable&&queryable!=="")?(queryable==="1"||queryable==="true"):null,cascaded:(cascaded!==null)?parseInt(cascaded):null,opaque:opaque?(opaque==="1"||opaque==="true"):null,noSubsets:(noSubsets!==null)?(noSubsets==="1"||noSubsets==="true"):null,fixedWidth:(fixedWidth!=null)?parseInt(fixedWidth):null,fixedHeight:(fixedHeight!=null)?parseInt(fixedHeight):null};
obj.nestedLayers.push(layer);
this.readChildNodes(node,layer);
if(layer.name){var parts=layer.name.split(":");
if(parts.length>0){layer.prefix=parts[0]
}}},Attribution:function(node,obj){obj.attribution={};
this.readChildNodes(node,obj.attribution)
},LogoURL:function(node,obj){obj.logo={width:node.getAttribute("width"),height:node.getAttribute("height")};
this.readChildNodes(node,obj.logo)
},Style:function(node,obj){var style={};
obj.styles.push(style);
this.readChildNodes(node,style)
},LegendURL:function(node,obj){var legend={width:node.getAttribute("width"),height:node.getAttribute("height")};
obj.legend=legend;
this.readChildNodes(node,legend)
},MetadataURL:function(node,obj){var metadataURL={type:node.getAttribute("type")};
obj.metadataURLs.push(metadataURL);
this.readChildNodes(node,metadataURL)
},DataURL:function(node,obj){obj.dataURL={};
this.readChildNodes(node,obj.dataURL)
},FeatureListURL:function(node,obj){obj.featureListURL={};
this.readChildNodes(node,obj.featureListURL)
},AuthorityURL:function(node,obj){var name=node.getAttribute("name");
var authority={};
this.readChildNodes(node,authority);
obj.authorityURLs[name]=authority.href
},Identifier:function(node,obj){var authority=node.getAttribute("authority");
obj.identifiers[authority]=this.getChildValue(node)
},KeywordList:function(node,obj){this.readChildNodes(node,obj)
},SRS:function(node,obj){obj.srs[this.getChildValue(node)]=true
}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(node,obj){this.readChildNodes(node,obj)
},Keyword:function(node,obj){if(obj.keywords){obj.keywords.push(this.getChildValue(node))
}},DescribeLayer:function(node,obj){obj.describelayer={formats:[]};
this.readChildNodes(node,obj.describelayer)
},GetLegendGraphic:function(node,obj){obj.getlegendgraphic={formats:[]};
this.readChildNodes(node,obj.getlegendgraphic)
},GetStyles:function(node,obj){obj.getstyles={formats:[]};
this.readChildNodes(node,obj.getstyles)
},PutStyles:function(node,obj){obj.putstyles={formats:[]};
this.readChildNodes(node,obj.putstyles)
},UserDefinedSymbolization:function(node,obj){var userSymbols={supportSLD:parseInt(node.getAttribute("SupportSLD"))==1,userLayer:parseInt(node.getAttribute("UserLayer"))==1,userStyle:parseInt(node.getAttribute("UserStyle"))==1,remoteWFS:parseInt(node.getAttribute("RemoteWFS"))==1};
obj.userSymbols=userSymbols
},LatLonBoundingBox:function(node,obj){obj.llbbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))]
},BoundingBox:function(node,obj){var bbox=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[node,obj]);
bbox.srs=node.getAttribute("SRS");
obj.bbox[bbox.srs]=bbox
},ScaleHint:function(node,obj){var min=node.getAttribute("min");
var max=node.getAttribute("max");
var rad2=Math.pow(2,0.5);
var ipm=OpenLayers.INCHES_PER_UNIT.m;
obj.maxScale=parseFloat(((min/rad2)*ipm*OpenLayers.DOTS_PER_INCH).toPrecision(13));
obj.minScale=parseFloat(((max/rad2)*ipm*OpenLayers.DOTS_PER_INCH).toPrecision(13))
},Dimension:function(node,obj){var name=node.getAttribute("name").toLowerCase();
var dim={name:name,units:node.getAttribute("units"),unitsymbol:node.getAttribute("unitSymbol")};
obj.dimensions[dim.name]=dim
},Extent:function(node,obj){var name=node.getAttribute("name").toLowerCase();
if(name in obj.dimensions){var extent=obj.dimensions[name];
extent.nearestVal=node.getAttribute("nearestValue")==="1";
extent.multipleVal=node.getAttribute("multipleValues")==="1";
extent.current=node.getAttribute("current")==="1";
extent["default"]=node.getAttribute("default")||"";
var values=this.getChildValue(node);
extent.values=values.split(",")
}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",initialize:function(options){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[options])
},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(node,obj){var srs=this.getChildValue(node);
var values=srs.split(/ +/);
for(var i=0,len=values.length;
i<len;
i++){obj.srs[values[i]]=true
}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",initialize:function(options){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[options])
},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(node,obj){obj.srs[this.getChildValue(node)]=true
}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(node,obj){this.readChildNodes(node,obj)
},LayerLimit:function(node,obj){obj.layerLimit=parseInt(this.getChildValue(node))
},MaxWidth:function(node,obj){obj.maxWidth=parseInt(this.getChildValue(node))
},MaxHeight:function(node,obj){obj.maxHeight=parseInt(this.getChildValue(node))
},BoundingBox:function(node,obj){var bbox=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[node,obj]);
bbox.srs=node.getAttribute("CRS");
obj.bbox[bbox.srs]=bbox
},CRS:function(node,obj){this.readers.wms.SRS.apply(this,[node,obj])
},EX_GeographicBoundingBox:function(node,obj){obj.llbbox=[];
this.readChildNodes(node,obj.llbbox)
},westBoundLongitude:function(node,obj){obj[0]=this.getChildValue(node)
},eastBoundLongitude:function(node,obj){obj[2]=this.getChildValue(node)
},southBoundLatitude:function(node,obj){obj[1]=this.getChildValue(node)
},northBoundLatitude:function(node,obj){obj[3]=this.getChildValue(node)
},MinScaleDenominator:function(node,obj){obj.maxScale=parseFloat(this.getChildValue(node)).toPrecision(16)
},MaxScaleDenominator:function(node,obj){obj.minScale=parseFloat(this.getChildValue(node)).toPrecision(16)
},Dimension:function(node,obj){var name=node.getAttribute("name").toLowerCase();
var dim={name:name,units:node.getAttribute("units"),unitsymbol:node.getAttribute("unitSymbol"),nearestVal:node.getAttribute("nearestValue")==="1",multipleVal:node.getAttribute("multipleValues")==="1","default":node.getAttribute("default")||"",current:node.getAttribute("current")==="1",values:this.getChildValue(node).split(",")};
obj.dimensions[dim.name]=dim
},Keyword:function(node,obj){var keyword={value:this.getChildValue(node),vocabulary:node.getAttribute("vocabulary")};
if(obj.keywords){obj.keywords.push(keyword)
}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(node,obj){this.readers.wms.UserDefinedSymbolization.apply(this,[node,obj]);
obj.userSymbols.inlineFeature=parseInt(node.getAttribute("InlineFeature"))==1;
obj.userSymbols.remoteWCS=parseInt(node.getAttribute("RemoteWCS"))==1
},DescribeLayer:function(node,obj){this.readers.wms.DescribeLayer.apply(this,[node,obj])
},GetLegendGraphic:function(node,obj){this.readers.wms.GetLegendGraphic.apply(this,[node,obj])
}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:false,initialize:function(element,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.element=OpenLayers.Util.getElement(element)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(!this.element){this.element=document.createElement("div");
this.div.appendChild(this.element)
}this.map.events.register("moveend",this,this.updateScale);
this.updateScale();
return this.div
},updateScale:function(){var scale;
if(this.geodesic===true){var units=this.map.getUnits();
if(!units){return
}var inches=OpenLayers.INCHES_PER_UNIT;
scale=(this.map.getGeodesicPixelSize().w||0.000001)*inches.km*OpenLayers.DOTS_PER_INCH
}else{scale=this.map.getScale()
}if(!scale){return
}if(scale>=9500&&scale<=950000){scale=Math.round(scale/1000)+"K"
}else{if(scale>=950000){scale=Math.round(scale/1000000)+"M"
}else{scale=Math.round(scale)
}}this.element.innerHTML=OpenLayers.i18n("scale",{scaleDenom:scale})
},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],multi:false,featureAdded:function(){},handlerOptions:null,initialize:function(layer,handler,options){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);
OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(vertex,feature){this.layer.events.triggerEvent("sketchmodified",{vertex:vertex,feature:feature})
},create:function(vertex,feature){this.layer.events.triggerEvent("sketchstarted",{vertex:vertex,feature:feature})
}},this.callbacks);
this.layer=layer;
this.handlerOptions=this.handlerOptions||{};
if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi
}var sketchStyle=this.layer.styleMap&&this.layer.styleMap.styles.temporary;
if(sketchStyle){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":sketchStyle})})
}this.handler=new handler(this,this.callbacks,this.handlerOptions)
},drawFeature:function(geometry){var feature=new OpenLayers.Feature.Vector(geometry);
var proceed=this.layer.events.triggerEvent("sketchcomplete",{feature:feature});
if(proceed!==false){feature.state=OpenLayers.State.INSERT;
this.layer.addFeatures([feature]);
this.featureAdded(feature);
this.events.triggerEvent("featureadded",{feature:feature})
}},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(options){this.symbolizer={};
OpenLayers.Util.extend(this,options);
if(this.symbolizers){delete this.symbolizer
}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){for(var i in this.symbolizer){this.symbolizer[i]=null
}this.symbolizer=null;
delete this.symbolizers
},evaluate:function(feature){var context=this.getContext(feature);
var applies=true;
if(this.minScaleDenominator||this.maxScaleDenominator){var scale=feature.layer.map.getScale()
}if(this.minScaleDenominator){applies=scale>=OpenLayers.Style.createLiteral(this.minScaleDenominator,context)
}if(applies&&this.maxScaleDenominator){applies=scale<OpenLayers.Style.createLiteral(this.maxScaleDenominator,context)
}if(applies&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){applies=this.filter.evaluate(feature)
}else{applies=this.filter.evaluate(context)
}}return applies
},getContext:function(feature){var context=this.context;
if(!context){context=feature.attributes||feature.data
}if(typeof this.context=="function"){context=this.context(feature)
}return context
},clone:function(){var options=OpenLayers.Util.extend({},this);
if(this.symbolizers){var len=this.symbolizers.length;
options.symbolizers=new Array(len);
for(var i=0;
i<len;
++i){options.symbolizers[i]=this.symbolizers[i].clone()
}}else{options.symbolizer={};
var value,type;
for(var key in this.symbolizer){value=this.symbolizer[key];
type=typeof value;
if(type==="object"){options.symbolizer[key]=OpenLayers.Util.extend({},value)
}else{if(type==="string"){options.symbolizer[key]=value
}}}}options.filter=this.filter&&this.filter.clone();
options.context=this.context&&OpenLayers.Util.extend({},this.context);
return new OpenLayers.Rule(options)
},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments)
},mousemove:function(evt){if(this.passesTolerance(evt.xy)){this.clearTimer();
this.callback("move",[evt]);
this.px=evt.xy;
evt=OpenLayers.Util.extend({},evt);
this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,evt),this.delay)
}return !this.stopMove
},mouseout:function(evt){if(OpenLayers.Util.mouseLeft(evt,this.map.div)){this.clearTimer();
this.callback("move",[evt])
}return true
},passesTolerance:function(px){var passes=true;
if(this.pixelTolerance&&this.px){var dpx=Math.sqrt(Math.pow(this.px.x-px.x,2)+Math.pow(this.px.y-px.y,2));
if(dpx<this.pixelTolerance){passes=false
}}return passes
},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);
this.timerId=null
}},delayedCall:function(evt){this.callback("pause",[evt])
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();
deactivated=true
}return deactivated
},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){if(this.handler){this.handler.destroy()
}this.handler=null;
this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});
OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);
OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);
OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);
this.wheelObserver=null;
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});
this.registerWheelEvents()
},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);
OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);
OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);
OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)
},defaultClick:function(evt){if(!OpenLayers.Event.isLeftClick(evt)){return
}var notAfterDrag=!this.performedDrag;
this.performedDrag=false;
return notAfterDrag
},defaultDblClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);
this.map.setCenter(newCenter,this.map.zoom+1);
OpenLayers.Event.stop(evt);
return false
},defaultMouseDown:function(evt){if(!OpenLayers.Event.isLeftClick(evt)){return
}this.mouseDragStart=evt.xy.clone();
this.performedDrag=false;
if(evt.shiftKey){this.map.div.style.cursor="crosshair";
this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");
this.zoomBox.style.backgroundColor="white";
this.zoomBox.style.filter="alpha(opacity=50)";
this.zoomBox.style.opacity="0.50";
this.zoomBox.style.fontSize="1px";
this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;
this.map.viewPortDiv.appendChild(this.zoomBox)
}document.onselectstart=OpenLayers.Function.False;
OpenLayers.Event.stop(evt)
},defaultMouseMove:function(evt){this.mousePosition=evt.xy.clone();
if(this.mouseDragStart!=null){if(this.zoomBox){var deltaX=Math.abs(this.mouseDragStart.x-evt.xy.x);
var deltaY=Math.abs(this.mouseDragStart.y-evt.xy.y);
this.zoomBox.style.width=Math.max(1,deltaX)+"px";
this.zoomBox.style.height=Math.max(1,deltaY)+"px";
if(evt.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=evt.xy.x+"px"
}if(evt.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=evt.xy.y+"px"
}}else{var deltaX=this.mouseDragStart.x-evt.xy.x;
var deltaY=this.mouseDragStart.y-evt.xy.y;
var size=this.map.getSize();
var newXY=new OpenLayers.Pixel(size.w/2+deltaX,size.h/2+deltaY);
var newCenter=this.map.getLonLatFromViewPortPx(newXY);
this.map.setCenter(newCenter,null,true);
this.mouseDragStart=evt.xy.clone();
this.map.div.style.cursor="move"
}this.performedDrag=true
}},defaultMouseUp:function(evt){if(!OpenLayers.Event.isLeftClick(evt)){return
}if(this.zoomBox){this.zoomBoxEnd(evt)
}else{if(this.performedDrag){this.map.setCenter(this.map.center)
}}document.onselectstart=null;
this.mouseDragStart=null;
this.map.div.style.cursor=""
},defaultMouseOut:function(evt){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(evt,this.map.div)){if(this.zoomBox){this.removeZoomBox()
}this.mouseDragStart=null
}},defaultWheelUp:function(evt){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(evt.xy),this.map.getZoom()+1)
}},defaultWheelDown:function(evt){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(evt.xy),this.map.getZoom()-1)
}},zoomBoxEnd:function(evt){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-evt.xy.x)>5||Math.abs(this.mouseDragStart.y-evt.xy.y)>5){var start=this.map.getLonLatFromViewPortPx(this.mouseDragStart);
var end=this.map.getLonLatFromViewPortPx(evt.xy);
var top=Math.max(start.lat,end.lat);
var bottom=Math.min(start.lat,end.lat);
var left=Math.min(start.lon,end.lon);
var right=Math.max(start.lon,end.lon);
var bounds=new OpenLayers.Bounds(left,bottom,right,top);
this.map.zoomToExtent(bounds)
}else{var end=this.map.getLonLatFromViewPortPx(evt.xy);
this.map.setCenter(new OpenLayers.LonLat((end.lon),(end.lat)),this.map.getZoom()+1)
}this.removeZoomBox()
}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);
this.zoomBox=null
},onWheelEvent:function(e){var inMap=false;
var elem=OpenLayers.Event.element(e);
while(elem!=null){if(this.map&&elem==this.map.div){inMap=true;
break
}elem=elem.parentNode
}if(inMap){var delta=0;
if(!e){e=window.event
}if(e.wheelDelta){delta=e.wheelDelta/120;
if(window.opera&&window.opera.version()<9.2){delta=-delta
}}else{if(e.detail){delta=-e.detail/3
}}if(delta){e.xy=this.mousePosition;
if(delta<0){this.defaultWheelDown(e)
}else{this.defaultWheelUp(e)
}}OpenLayers.Event.stop(e)
}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){this.deactivate();
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);
this.map.events.register("mouseout",this,this.reset);
this.redraw();
return true
}else{return false
}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);
this.map.events.unregister("mouseout",this,this.reset);
this.element.innerHTML="";
return true
}else{return false
}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(!this.element){this.div.left="";
this.div.top="";
this.element=this.div
}return this.div
},redraw:function(evt){var lonLat;
if(evt==null){this.reset();
return
}else{if(this.lastXy==null||Math.abs(evt.xy.x-this.lastXy.x)>this.granularity||Math.abs(evt.xy.y-this.lastXy.y)>this.granularity){this.lastXy=evt.xy;
return
}lonLat=this.map.getLonLatFromPixel(evt.xy);
if(!lonLat){return
}if(this.displayProjection){lonLat.transform(this.map.getProjectionObject(),this.displayProjection)
}this.lastXy=evt.xy
}var newHtml=this.formatOutput(lonLat);
if(newHtml!=this.element.innerHTML){this.element.innerHTML=newHtml
}},reset:function(evt){if(this.emptyString!=null){this.element.innerHTML=this.emptyString
}},formatOutput:function(lonLat){var digits=parseInt(this.numDigits);
var newHtml=this.prefix+lonLat.lon.toFixed(digits)+this.separator+lonLat.lat.toFixed(digits)+this.suffix;
return newHtml
},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(control,callbacks,options){if(!(options&&options.layerOptions&&options.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})
}OpenLayers.Handler.prototype.initialize.apply(this,[control,callbacks,options]);
this.options=(options)?options:{}
},setOptions:function(newOptions){OpenLayers.Util.extend(this.options,newOptions);
OpenLayers.Util.extend(this,newOptions)
},activate:function(){var activated=false;
if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var options=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);
this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options);
this.map.addLayer(this.layer);
activated=true
}return activated
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel()
}if(this.layer.map!=null){this.layer.destroy(false);
if(this.feature){this.feature.destroy()
}}this.layer=null;
this.feature=null;
deactivated=true
}return deactivated
},down:function(evt){this.fixedRadius=!!(this.radius);
var maploc=this.map.getLonLatFromPixel(evt.xy);
this.origin=new OpenLayers.Geometry.Point(maploc.lon,maploc.lat);
if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()
}if(this.persist){this.clear()
}this.feature=new OpenLayers.Feature.Vector();
this.createGeometry();
this.callback("create",[this.origin,this.feature]);
this.layer.addFeatures([this.feature],{silent:true});
this.layer.drawFeature(this.feature,this.style)
},move:function(evt){var maploc=this.map.getLonLatFromPixel(evt.xy);
var point=new OpenLayers.Geometry.Point(maploc.lon,maploc.lat);
if(this.irregular){var ry=Math.sqrt(2)*Math.abs(point.y-this.origin.y)/2;
this.radius=Math.max(this.map.getResolution()/2,ry)
}else{if(this.fixedRadius){this.origin=point
}else{this.calculateAngle(point,evt);
this.radius=Math.max(this.map.getResolution()/2,point.distanceTo(this.origin))
}}this.modifyGeometry();
if(this.irregular){var dx=point.x-this.origin.x;
var dy=point.y-this.origin.y;
var ratio;
if(dy==0){ratio=dx/(this.radius*Math.sqrt(2))
}else{ratio=dx/dy
}this.feature.geometry.resize(1,this.origin,ratio);
this.feature.geometry.move(dx/2,dy/2)
}this.layer.drawFeature(this.feature,this.style)
},up:function(evt){this.finalize();
if(this.start==this.last){this.callback("done",[evt.xy])
}},out:function(evt){this.finalize()
},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));
if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180)
}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)
},modifyGeometry:function(){var angle,point;
var ring=this.feature.geometry.components[0];
if(ring.components.length!=(this.sides+1)){this.createGeometry();
ring=this.feature.geometry.components[0]
}for(var i=0;
i<this.sides;
++i){point=ring.components[i];
angle=this.angle+(i*2*Math.PI/this.sides);
point.x=this.origin.x+(this.radius*Math.cos(angle));
point.y=this.origin.y+(this.radius*Math.sin(angle));
point.clearBounds()
}},calculateAngle:function(point,evt){var alpha=Math.atan2(point.y-this.origin.y,point.x-this.origin.x);
if(this.snapAngle&&(this.snapToggle&&!evt[this.snapToggle])){var snapAngleRad=(Math.PI/180)*this.snapAngle;
this.angle=Math.round(alpha/snapAngleRad)*snapAngleRad
}else{this.angle=alpha
}},cancel:function(){this.callback("cancel",null);
this.finalize()
},finalize:function(){this.origin=null;
this.radius=this.options.radius
},clear:function(){if(this.layer){this.layer.renderer.clear();
this.layer.destroyFeatures()
}},callback:function(name,args){if(this.callbacks[name]){this.callbacks[name].apply(this.control,[this.feature.geometry.clone()])
}if(!this.persist&&(name=="done"||name=="cancel")){this.clear()
}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(containerID){if(!this.supported()){return
}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);
var style=document.createStyleSheet();
var shapes=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];
for(var i=0,len=shapes.length;
i<len;
i++){style.addRule("olv\\:"+shapes[i],"behavior: url(#default#VML); position: absolute; display: inline-block;")
}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)
},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)
},supported:function(){return !!(document.namespaces)
},setExtent:function(extent,resolutionChanged){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);
var resolution=this.getResolution();
var left=(extent.left/resolution)|0;
var top=(extent.top/resolution-this.size.h)|0;
if(resolutionChanged||!this.offset){this.offset={x:left,y:top};
left=0;
top=0
}else{left=left-this.offset.x;
top=top-this.offset.y
}var org=left+" "+top;
this.root.coordorigin=org;
var roots=[this.root,this.vectorRoot,this.textRoot];
var root;
for(var i=0,len=roots.length;
i<len;
++i){root=roots[i];
var size=this.size.w+" "+this.size.h;
root.coordsize=size
}this.root.style.flip="y";
return true
},setSize:function(size){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);
var roots=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];
var w=this.size.w+"px";
var h=this.size.h+"px";
var root;
for(var i=0,len=roots.length;
i<len;
++i){root=roots[i];
root.style.width=w;
root.style.height=h
}},getNodeType:function(geometry,style){var nodeType=null;
switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":if(style.externalGraphic){nodeType="olv:rect"
}else{if(this.isComplexSymbol(style.graphicName)){nodeType="olv:shape"
}else{nodeType="olv:oval"
}}break;
case"OpenLayers.Geometry.Rectangle":nodeType="olv:rect";
break;
case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":nodeType="olv:shape";
break;
default:break
}return nodeType
},setStyle:function(node,style,options,geometry){style=style||node._style;
options=options||node._options;
var fillColor=style.fillColor;
if(node._geometryClass==="OpenLayers.Geometry.Point"){if(style.externalGraphic){if(style.graphicTitle){node.title=style.graphicTitle
}var width=style.graphicWidth||style.graphicHeight;
var height=style.graphicHeight||style.graphicWidth;
width=width?width:style.pointRadius*2;
height=height?height:style.pointRadius*2;
var resolution=this.getResolution();
var xOffset=(style.graphicXOffset!=undefined)?style.graphicXOffset:-(0.5*width);
var yOffset=(style.graphicYOffset!=undefined)?style.graphicYOffset:-(0.5*height);
node.style.left=(((geometry.x/resolution-this.offset.x)+xOffset)|0)+"px";
node.style.top=(((geometry.y/resolution-this.offset.y)-(yOffset+height))|0)+"px";
node.style.width=width+"px";
node.style.height=height+"px";
node.style.flip="y";
fillColor="none";
options.isStroked=false
}else{if(this.isComplexSymbol(style.graphicName)){var cache=this.importSymbol(style.graphicName);
node.path=cache.path;
node.coordorigin=cache.left+","+cache.bottom;
var size=cache.size;
node.coordsize=size+","+size;
this.drawCircle(node,geometry,style.pointRadius);
node.style.flip="y"
}else{this.drawCircle(node,geometry,style.pointRadius)
}}}if(options.isFilled){node.fillcolor=fillColor
}else{node.filled="false"
}var fills=node.getElementsByTagName("fill");
var fill=(fills.length==0)?null:fills[0];
if(!options.isFilled){if(fill){node.removeChild(fill)
}}else{if(!fill){fill=this.createNode("olv:fill",node.id+"_fill")
}fill.opacity=style.fillOpacity;
if(node._geometryClass==="OpenLayers.Geometry.Point"&&style.externalGraphic){if(style.graphicOpacity){fill.opacity=style.graphicOpacity
}fill.src=style.externalGraphic;
fill.type="frame";
if(!(style.graphicWidth&&style.graphicHeight)){fill.aspect="atmost"
}}if(fill.parentNode!=node){node.appendChild(fill)
}}var rotation=style.rotation;
if((rotation!==undefined||node._rotation!==undefined)){node._rotation=rotation;
if(style.externalGraphic){this.graphicRotate(node,xOffset,yOffset,style);
fill.opacity=0
}else{if(node._geometryClass==="OpenLayers.Geometry.Point"){node.style.rotation=rotation||0
}}}var strokes=node.getElementsByTagName("stroke");
var stroke=(strokes.length==0)?null:strokes[0];
if(!options.isStroked){node.stroked=false;
if(stroke){stroke.on=false
}}else{if(!stroke){stroke=this.createNode("olv:stroke",node.id+"_stroke");
node.appendChild(stroke)
}stroke.on=true;
stroke.color=style.strokeColor;
stroke.weight=style.strokeWidth+"px";
stroke.opacity=style.strokeOpacity;
stroke.endcap=style.strokeLinecap=="butt"?"flat":(style.strokeLinecap||"round");
if(style.strokeDashstyle){stroke.dashstyle=this.dashStyle(style)
}}if(style.cursor!="inherit"&&style.cursor!=null){node.style.cursor=style.cursor
}return node
},graphicRotate:function(node,xOffset,yOffset,style){var style=style||node._style;
var rotation=style.rotation||0;
var aspectRatio,size;
if(!(style.graphicWidth&&style.graphicHeight)){var img=new Image();
img.onreadystatechange=OpenLayers.Function.bind(function(){if(img.readyState=="complete"||img.readyState=="interactive"){aspectRatio=img.width/img.height;
size=Math.max(style.pointRadius*2,style.graphicWidth||0,style.graphicHeight||0);
xOffset=xOffset*aspectRatio;
style.graphicWidth=size*aspectRatio;
style.graphicHeight=size;
this.graphicRotate(node,xOffset,yOffset,style)
}},this);
img.src=style.externalGraphic;
return
}else{size=Math.max(style.graphicWidth,style.graphicHeight);
aspectRatio=style.graphicWidth/style.graphicHeight
}var width=Math.round(style.graphicWidth||size*aspectRatio);
var height=Math.round(style.graphicHeight||size);
node.style.width=width+"px";
node.style.height=height+"px";
var image=document.getElementById(node.id+"_image");
if(!image){image=this.createNode("olv:imagedata",node.id+"_image");
node.appendChild(image)
}image.style.width=width+"px";
image.style.height=height+"px";
image.src=style.externalGraphic;
image.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";
var rot=rotation*Math.PI/180;
var sintheta=Math.sin(rot);
var costheta=Math.cos(rot);
var filter="progid:DXImageTransform.Microsoft.Matrix(M11="+costheta+",M12="+(-sintheta)+",M21="+sintheta+",M22="+costheta+",SizingMethod='auto expand')\n";
var opacity=style.graphicOpacity||style.fillOpacity;
if(opacity&&opacity!=1){filter+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+opacity+")\n"
}node.style.filter=filter;
var centerPoint=new OpenLayers.Geometry.Point(-xOffset,-yOffset);
var imgBox=new OpenLayers.Bounds(0,0,width,height).toGeometry();
imgBox.rotate(style.rotation,centerPoint);
var imgBounds=imgBox.getBounds();
node.style.left=Math.round(parseInt(node.style.left)+imgBounds.left)+"px";
node.style.top=Math.round(parseInt(node.style.top)-imgBounds.bottom)+"px"
},postDraw:function(node){node.style.visibility="visible";
var fillColor=node._style.fillColor;
var strokeColor=node._style.strokeColor;
if(fillColor=="none"&&node.fillcolor!=fillColor){node.fillcolor=fillColor
}if(strokeColor=="none"&&node.strokecolor!=strokeColor){node.strokecolor=strokeColor
}},setNodeDimension:function(node,geometry){var bbox=geometry.getBounds();
if(bbox){var resolution=this.getResolution();
var scaledBox=new OpenLayers.Bounds((bbox.left/resolution-this.offset.x)|0,(bbox.bottom/resolution-this.offset.y)|0,(bbox.right/resolution-this.offset.x)|0,(bbox.top/resolution-this.offset.y)|0);
node.style.left=scaledBox.left+"px";
node.style.top=scaledBox.top+"px";
node.style.width=scaledBox.getWidth()+"px";
node.style.height=scaledBox.getHeight()+"px";
node.coordorigin=scaledBox.left+" "+scaledBox.top;
node.coordsize=scaledBox.getWidth()+" "+scaledBox.getHeight()
}},dashStyle:function(style){var dash=style.strokeDashstyle;
switch(dash){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return dash;
default:var parts=dash.split(/[ ,]/);
if(parts.length==2){if(1*parts[0]>=2*parts[1]){return"longdash"
}return(parts[0]==1||parts[1]==1)?"dot":"dash"
}else{if(parts.length==4){return(1*parts[0]>=2*parts[1])?"longdashdot":"dashdot"
}}return"solid"
}},createNode:function(type,id){var node=document.createElement(type);
if(id){node.id=id
}node.unselectable="on";
node.onselectstart=OpenLayers.Function.False;
return node
},nodeTypeCompare:function(node,type){var subType=type;
var splitIndex=subType.indexOf(":");
if(splitIndex!=-1){subType=subType.substr(splitIndex+1)
}var nodeName=node.nodeName;
splitIndex=nodeName.indexOf(":");
if(splitIndex!=-1){nodeName=nodeName.substr(splitIndex+1)
}return(subType==nodeName)
},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")
},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"olv:group")
},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)
},drawCircle:function(node,geometry,radius){if(!isNaN(geometry.x)&&!isNaN(geometry.y)){var resolution=this.getResolution();
node.style.left=(((geometry.x/resolution-this.offset.x)|0)-radius)+"px";
node.style.top=(((geometry.y/resolution-this.offset.y)|0)-radius)+"px";
var diameter=radius*2;
node.style.width=diameter+"px";
node.style.height=diameter+"px";
return node
}return false
},drawLineString:function(node,geometry){return this.drawLine(node,geometry,false)
},drawLinearRing:function(node,geometry){return this.drawLine(node,geometry,true)
},drawLine:function(node,geometry,closeLine){this.setNodeDimension(node,geometry);
var resolution=this.getResolution();
var numComponents=geometry.components.length;
var parts=new Array(numComponents);
var comp,x,y;
for(var i=0;
i<numComponents;
i++){comp=geometry.components[i];
x=(comp.x/resolution-this.offset.x)|0;
y=(comp.y/resolution-this.offset.y)|0;
parts[i]=" "+x+","+y+" l "
}var end=(closeLine)?" x e":" e";
node.path="m"+parts.join("")+end;
return node
},drawPolygon:function(node,geometry){this.setNodeDimension(node,geometry);
var resolution=this.getResolution();
var path=[];
var linearRing,i,j,len,ilen,comp,x,y;
for(j=0,len=geometry.components.length;
j<len;
j++){linearRing=geometry.components[j];
path.push("m");
for(i=0,ilen=linearRing.components.length;
i<ilen;
i++){comp=linearRing.components[i];
x=(comp.x/resolution-this.offset.x)|0;
y=(comp.y/resolution-this.offset.y)|0;
path.push(" "+x+","+y);
if(i==0){path.push(" l")
}}path.push(" x ")
}path.push("e");
node.path=path.join("");
return node
},drawRectangle:function(node,geometry){var resolution=this.getResolution();
node.style.left=((geometry.x/resolution-this.offset.x)|0)+"px";
node.style.top=((geometry.y/resolution-this.offset.y)|0)+"px";
node.style.width=((geometry.width/resolution)|0)+"px";
node.style.height=((geometry.height/resolution)|0)+"px";
return node
},drawText:function(featureId,style,location){var label=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX,"olv:rect");
var textbox=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");
var resolution=this.getResolution();
label.style.left=((location.x/resolution-this.offset.x)|0)+"px";
label.style.top=((location.y/resolution-this.offset.y)|0)+"px";
label.style.flip="y";
textbox.innerText=style.label;
if(style.fontColor){textbox.style.color=style.fontColor
}if(style.fontOpacity){textbox.style.filter="alpha(opacity="+(style.fontOpacity*100)+")"
}if(style.fontFamily){textbox.style.fontFamily=style.fontFamily
}if(style.fontSize){textbox.style.fontSize=style.fontSize
}if(style.fontWeight){textbox.style.fontWeight=style.fontWeight
}if(style.labelSelect===true){label._featureId=featureId;
textbox._featureId=featureId;
textbox._geometry=location;
textbox._geometryClass=location.CLASS_NAME
}textbox.style.whiteSpace="nowrap";
textbox.inset="1px,0px,0px,0px";
if(!label.parentNode){label.appendChild(textbox);
this.textRoot.appendChild(label)
}var align=style.labelAlign||"cm";
if(align.length==1){align+="m"
}var xshift=textbox.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[align.substr(0,1)]);
var yshift=textbox.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[align.substr(1,1)]);
label.style.left=parseInt(label.style.left)-xshift-1+"px";
label.style.top=parseInt(label.style.top)+yshift+"px"
},drawSurface:function(node,geometry){this.setNodeDimension(node,geometry);
var resolution=this.getResolution();
var path=[];
var comp,x,y;
for(var i=0,len=geometry.components.length;
i<len;
i++){comp=geometry.components[i];
x=(comp.x/resolution-this.offset.x)|0;
y=(comp.y/resolution-this.offset.y)|0;
if((i%3)==0&&(i/3)==0){path.push("m")
}else{if((i%3)==1){path.push(" c")
}}path.push(" "+x+","+y)
}path.push(" x e");
node.path=path.join("");
return node
},moveRoot:function(renderer){var layer=this.map.getLayer(renderer.container.id);
if(layer instanceof OpenLayers.Layer.Vector.RootContainer){layer=this.map.getLayer(this.container.id)
}layer&&layer.renderer.clear();
OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);
layer&&layer.redraw()
},importSymbol:function(graphicName){var id=this.container.id+"-"+graphicName;
var cache=this.symbolCache[id];
if(cache){return cache
}var symbol=OpenLayers.Renderer.symbol[graphicName];
if(!symbol){throw new Error(graphicName+" is not a valid symbol name")
}var symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);
var pathitems=["m"];
for(var i=0;
i<symbol.length;
i=i+2){var x=symbol[i];
var y=symbol[i+1];
symbolExtent.left=Math.min(symbolExtent.left,x);
symbolExtent.bottom=Math.min(symbolExtent.bottom,y);
symbolExtent.right=Math.max(symbolExtent.right,x);
symbolExtent.top=Math.max(symbolExtent.top,y);
pathitems.push(x);
pathitems.push(y);
if(i==0){pathitems.push("l")
}}pathitems.push("x e");
var path=pathitems.join(" ");
var diff=(symbolExtent.getWidth()-symbolExtent.getHeight())/2;
if(diff>0){symbolExtent.bottom=symbolExtent.bottom-diff;
symbolExtent.top=symbolExtent.top+diff
}else{symbolExtent.left=symbolExtent.left+diff;
symbolExtent.right=symbolExtent.right-diff
}cache={path:path,size:symbolExtent.getWidth(),left:symbolExtent.left,bottom:symbolExtent.bottom};
this.symbolCache[id]=cache;
return cache
},CLASS_NAME:"OpenLayers.Renderer.VML"});
OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,arguments)
},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
for(var i=0,len=this.map.controls.length;
i<len;
i++){var control=this.map.controls[i];
if((control!=this)&&(control.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(control.displayProjection!=this.displayProjection){this.displayProjection=control.displayProjection
}break
}}if(i==this.map.controls.length){var args=OpenLayers.Util.getParameters();
if(args.layers){this.layers=args.layers;
this.map.events.register("addlayer",this,this.configureLayers);
this.configureLayers()
}if(args.lat&&args.lon){this.center=new OpenLayers.LonLat(parseFloat(args.lon),parseFloat(args.lat));
if(args.zoom){this.zoom=parseInt(args.zoom)
}this.map.events.register("changebaselayer",this,this.setCenter);
this.setCenter()
}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);
if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())
}this.map.setCenter(this.center,this.zoom)
}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);
for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.map.layers[i];
var c=this.layers.charAt(i);
if(c=="B"){this.map.setBaseLayer(layer)
}else{if((c=="T")||(c=="F")){layer.setVisibility(c=="T")
}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:false,visible:true,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options])
},setVisible:function(visible){this.visible=visible;
if(visible){OpenLayers.Element.show(this.div)
}else{OpenLayers.Element.hide(this.div)
}},getVisible:function(){return this.visible
},hide:function(){this.setVisible(false)
},show:function(){this.setVisible(true)
},toggle:function(){this.setVisible(!this.getVisible())
},addLayer:function(evt){if(evt.layer){evt.layer.events.register("loadstart",this,this.increaseCounter);
evt.layer.events.register("loadend",this,this.decreaseCounter)
}},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
this.map.events.register("preaddlayer",this,this.addLayer);
for(var i=0;
i<this.map.layers.length;
i++){var layer=this.map.layers[i];
layer.events.register("loadstart",this,this.increaseCounter);
layer.events.register("loadend",this,this.decreaseCounter)
}},increaseCounter:function(){this.counter++;
if(this.counter>0){if(!this.maximized&&this.visible){this.maximizeControl()
}}},decreaseCounter:function(){if(this.counter>0){this.counter--
}if(this.counter==0){if(this.maximized&&this.visible){this.minimizeControl()
}}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
return this.div
},minimizeControl:function(evt){this.div.style.display="none";
this.div.style.width="0px";
this.div.style.height="0px";
this.maximized=false;
if(evt!=null){OpenLayers.Event.stop(evt)
}},maximizeControl:function(evt){var viewSize=this.map.getSize();
var msgW=viewSize.w;
var msgH=viewSize.h;
this.div.style.width=msgW+"px";
this.div.style.height=msgH+"px";
this.div.style.display="block";
this.maximized=true;
if(evt!=null){OpenLayers.Event.stop(evt)
}},destroy:function(){if(this.map){this.map.events.unregister("preaddlayer",this,this.addLayer);
if(this.map.layers){for(var i=0;
i<this.map.layers.length;
i++){var layer=this.map.layers[i];
layer.events.unregister("loadstart",this,this.increaseCounter);
layer.events.unregister("loadend",this,this.decreaseCounter)
}}}OpenLayers.Control.prototype.destroy.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});OpenLayers.Control.ScaleBar=OpenLayers.Class(OpenLayers.Control,{element:null,scale:1,displaySystem:"metric",minWidth:100,maxWidth:200,divisions:2,subdivisions:2,showMinorMeasures:false,abbreviateLabel:false,singleLine:false,align:"left",div:null,scaleText:"scale 1:",thousandsSeparator:"",measurementProperties:{english:{units:["miles","feet","inches"],abbr:["mi","ft","in"],inches:[63360,12,1]},metric:{units:["kilometers","meters","centimeters"],abbr:["km","m","cm"],inches:[39370.07874,39.370079,0.393701]}},limitedStyle:false,customStyles:null,defaultStyles:{Bar:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},BarAlt:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMajor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMinor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},NumbersBox:{height:13,width:40,top:24},LabelBox:{height:15,top:-2},LabelBoxSingleLine:{height:15,width:35,top:5,left:10}},appliedStyles:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(!document.styleSheets){this.limitedStyle=true
}if(this.limitedStyle){this.appliedStyles=OpenLayers.Util.extend({},this.defaultStyles);
OpenLayers.Util.extend(this.appliedStyles,this.customStyles)
}this.element=document.createElement("div");
this.element.style.position="relative";
this.element.className=this.displayClass+"Wrapper";
this.labelContainer=document.createElement("div");
this.labelContainer.className=this.displayClass+"Units";
this.labelContainer.style.position="absolute";
this.graphicsContainer=document.createElement("div");
this.graphicsContainer.style.position="absolute";
this.graphicsContainer.className=this.displayClass+"Graphics";
this.numbersContainer=document.createElement("div");
this.numbersContainer.style.position="absolute";
this.numbersContainer.className=this.displayClass+"Numbers";
this.element.appendChild(this.graphicsContainer);
this.element.appendChild(this.labelContainer);
this.element.appendChild(this.numbersContainer)
},destroy:function(){this.map.events.unregister("moveend",this,this.onMoveend);
this.div.innerHTML="";
OpenLayers.Control.prototype.destroy.apply(this)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
this.dxMarkerMajor=(this.styleValue("MarkerMajor","borderLeftWidth")+this.styleValue("MarkerMajor","width")+this.styleValue("MarkerMajor","borderRightWidth"))/2;
this.dxMarkerMinor=(this.styleValue("MarkerMinor","borderLeftWidth")+this.styleValue("MarkerMinor","width")+this.styleValue("MarkerMinor","borderRightWidth"))/2;
this.dxBar=(this.styleValue("Bar","borderLeftWidth")+this.styleValue("Bar","borderRightWidth"))/2;
this.dxBarAlt=(this.styleValue("BarAlt","borderLeftWidth")+this.styleValue("BarAlt","borderRightWidth"))/2;
this.dxNumbersBox=this.styleValue("NumbersBox","width")/2;
var classNames=["Bar","BarAlt","MarkerMajor","MarkerMinor"];
if(this.singleLine){classNames.push("LabelBoxSingleLine")
}else{classNames.push("NumbersBox","LabelBox")
}var vertDisp=0;
for(var classIndex=0;
classIndex<classNames.length;
++classIndex){var cls=classNames[classIndex];
vertDisp=Math.max(vertDisp,this.styleValue(cls,"top")+this.styleValue(cls,"height"))
}this.element.style.height=vertDisp+"px";
this.xOffsetSingleLine=this.styleValue("LabelBoxSingleLine","width")+this.styleValue("LabelBoxSingleLine","left");
this.div.appendChild(this.element);
this.map.events.register("moveend",this,this.onMoveend);
this.update();
return this.div
},onMoveend:function(){this.update()
},update:function(scale){if(this.map.baseLayer==null||!this.map.getScale()){return
}this.scale=(scale!=undefined)?scale:this.map.getScale();
this.element.title=this.scaleText+OpenLayers.Number.format(this.scale);
this.element.style.width=this.maxWidth+"px";
var comp=this.getComp();
this.setSubProps(comp);
this.labelContainer.innerHTML="";
this.graphicsContainer.innerHTML="";
this.numbersContainer.innerHTML="";
var numDiv=this.divisions*this.subdivisions;
var alignmentOffset={left:0+(this.singleLine?0:this.dxNumbersBox),center:(this.maxWidth/2)-(numDiv*this.subProps.pixels/2)-(this.singleLine?this.xOffsetSingleLine/2:0),right:this.maxWidth-(numDiv*this.subProps.pixels)-(this.singleLine?this.xOffsetSingleLine:this.dxNumbersBox)};
var xPos,measure,divNum,cls,left;
for(var di=0;
di<this.divisions;
++di){xPos=di*this.subdivisions*this.subProps.pixels+alignmentOffset[this.align];
this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",xPos-this.dxMarkerMajor));
if(!this.singleLine){measure=(di==0)?0:OpenLayers.Number.format((di*this.subdivisions)*this.subProps.length,this.subProps.dec,this.thousandsSeparator);
this.numbersContainer.appendChild(this.createElement("NumbersBox",measure,xPos-this.dxNumbersBox))
}for(var si=0;
si<this.subdivisions;
++si){if((si%2)==0){cls="Bar";
left=xPos-this.dxBar
}else{cls="BarAlt";
left=xPos-this.dxBarAlt
}this.graphicsContainer.appendChild(this.createElement(cls," ",left,this.subProps.pixels));
if(si<this.subdivisions-1){divNum=(di*this.subdivisions)+si+1;
xPos=divNum*this.subProps.pixels+alignmentOffset[this.align];
this.graphicsContainer.appendChild(this.createElement("MarkerMinor"," ",xPos-this.dxMarkerMinor));
if(this.showMinorMeasures&&!this.singleLine){measure=divNum*this.subProps.length;
this.numbersContainer.appendChild(this.createElement("NumbersBox",measure,xPos-this.dxNumbersBox))
}}}}xPos=numDiv*this.subProps.pixels;
xPos+=alignmentOffset[this.align];
this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",xPos-this.dxMarkerMajor));
measure=OpenLayers.Number.format(numDiv*this.subProps.length,this.subProps.dec,this.thousandsSeparator);
if(!this.singleLine){this.numbersContainer.appendChild(this.createElement("NumbersBox",measure,xPos-this.dxNumbersBox))
}var labelBox=document.createElement("div");
labelBox.style.position="absolute";
var labelText;
if(this.singleLine){labelText=measure;
labelBox.className=this.displayClass+"LabelBoxSingleLine";
labelBox.style.left=Math.round(xPos+this.styleValue("LabelBoxSingleLine","left"))+"px"
}else{labelText="";
labelBox.className=this.displayClass+"LabelBox";
labelBox.style.textAlign="center";
labelBox.style.width=Math.round(numDiv*this.subProps.pixels)+"px";
labelBox.style.left=Math.round(alignmentOffset[this.align])+"px";
labelBox.style.overflow="hidden"
}if(this.abbreviateLabel){labelText+=" "+this.subProps.abbr
}else{labelText+=" "+this.subProps.units
}labelBox.appendChild(document.createTextNode(labelText));
this.labelContainer.appendChild(labelBox)
},createElement:function(cls,text,left,width){var element=document.createElement("div");
element.className=this.displayClass+cls;
OpenLayers.Util.extend(element.style,{position:"absolute",textAlign:"center",overflow:"hidden",left:Math.round(left)+"px"});
element.appendChild(document.createTextNode(text));
if(width){element.style.width=Math.round(width)+"px"
}return element
},getComp:function(){var system=this.measurementProperties[this.displaySystem];
var numUnits=system.units.length;
var comp=new Array(numUnits);
var numDiv=this.divisions*this.subdivisions;
for(var unitIndex=0;
unitIndex<numUnits;
++unitIndex){comp[unitIndex]={};
var ppdu=OpenLayers.DOTS_PER_INCH*system.inches[unitIndex]/this.scale;
var minSDDisplayLength=((this.minWidth-this.dxNumbersBox)/ppdu)/numDiv;
var maxSDDisplayLength=((this.maxWidth-this.dxNumbersBox)/ppdu)/numDiv;
for(var vi=0;
vi<numDiv;
++vi){var minNumber=minSDDisplayLength*(vi+1);
var maxNumber=maxSDDisplayLength*(vi+1);
var num=this.getHandsomeNumber(minNumber,maxNumber);
var compNum={value:(num.value/(vi+1)),score:0,tie:0,dec:0,displayed:0};
for(var vi2=0;
vi2<numDiv;
++vi2){var position=num.value*(vi2+1)/(vi+1);
var num2=this.getHandsomeNumber(position,position);
var major=((vi2+1)%this.subdivisions==0);
var last=((vi2+1)==numDiv);
if((this.singleLine&&last)||(!this.singleLine&&(major||this.showMinorMeasures))){compNum.score+=num2.score;
compNum.tie+=num2.tie;
compNum.dec=Math.max(compNum.dec,num2.dec);
compNum.displayed+=1
}else{compNum.score+=num2.score/this.subdivisions;
compNum.tie+=num2.tie/this.subdivisions
}}compNum.score*=(unitIndex+1)*compNum.tie/compNum.displayed;
comp[unitIndex][vi]=compNum
}}return comp
},setSubProps:function(comp){var system=this.measurementProperties[this.displaySystem];
var score=Number.POSITIVE_INFINITY;
var tie=Number.POSITIVE_INFINITY;
for(var unitIndex=0;
unitIndex<comp.length;
++unitIndex){var ppdu=OpenLayers.DOTS_PER_INCH*system.inches[unitIndex]/this.scale;
for(var vi in comp[unitIndex]){var compNum=comp[unitIndex][vi];
if((compNum.score<score)||((compNum.score==score)&&(compNum.tie<tie))){this.subProps={length:compNum.value,pixels:ppdu*compNum.value,units:system.units[unitIndex],abbr:system.abbr[unitIndex],dec:compNum.dec};
score=compNum.score;
tie=compNum.tie
}}}},styleValue:function(selector,key){var value=0;
if(this.limitedStyle){value=this.appliedStyles[selector][key]
}else{selector="."+this.displayClass+selector;
rules:for(var i=document.styleSheets.length-1;
i>=0;
--i){var sheet=document.styleSheets[i];
if(!sheet.disabled){var allRules;
try{if(typeof(sheet.cssRules)=="undefined"){if(typeof(sheet.rules)=="undefined"){continue
}else{allRules=sheet.rules
}}else{allRules=sheet.cssRules
}}catch(err){continue
}for(var ruleIndex=0;
ruleIndex<allRules.length;
++ruleIndex){var rule=allRules[ruleIndex];
if(rule.selectorText&&(rule.selectorText.toLowerCase()==selector.toLowerCase())){if(rule.style[key]!=""){value=parseInt(rule.style[key]);
break rules
}}}}}}return value?value:0
},getHandsomeNumber:function(small,big,sigFigs){sigFigs=(sigFigs==null)?10:sigFigs;
var num={value:small,score:Number.POSITIVE_INFINITY,tie:Number.POSITIVE_INFINITY,dec:3};
var cmult,max,dec,tmult,multiplier,score,tie;
for(var hexp=0;
hexp<3;
++hexp){cmult=Math.pow(2,(-1*hexp));
max=Math.floor(Math.log(big/cmult)/Math.LN10);
for(var texp=max;
texp>(max-sigFigs+1);
--texp){dec=Math.max(hexp-texp,0);
tmult=cmult*Math.pow(10,texp);
if((tmult*Math.floor(big/tmult))>=small){if(small%tmult==0){multiplier=small/tmult
}else{multiplier=Math.floor(small/tmult)+1
}score=multiplier+(2*hexp);
tie=(texp<0)?(Math.abs(texp)+1):texp;
if((score<num.score)||((score==num.score)&&(tie<num.tie))){num.value=parseFloat((tmult*multiplier).toFixed(dec));
num.score=score;
num.tie=tie;
num.dec=dec
}}}}return num
},CLASS_NAME:"OpenLayers.Control.ScaleBar"});OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork=OpenLayers.Class(OpenLayers.Format.CSWGetRecords.v2_0_2,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows",geonet:"http://www.fao.org/geonetwork"},initialize:function(options){OpenLayers.Format.CSWGetRecords.v2_0_2.prototype.initialize.apply(this,[options])
},readers:{csw:{GetRecordsResponse:function(node,obj){obj.records=[];
this.readChildNodes(node,obj);
var version=this.getAttributeNS(node,"","version");
if(version!=""){obj.version=version
}},RequestId:function(node,obj){obj.RequestId=this.getChildValue(node)
},SearchStatus:function(node,obj){obj.SearchStatus={};
var timestamp=this.getAttributeNS(node,"","timestamp");
if(timestamp!=""){obj.SearchStatus.timestamp=timestamp
}},SearchResults:function(node,obj){this.readChildNodes(node,obj);
var attrs=node.attributes;
var SearchResults={};
for(var i=0,len=attrs.length;
i<len;
++i){if((attrs[i].name=="numberOfRecordsMatched")||(attrs[i].name=="numberOfRecordsReturned")||(attrs[i].name=="nextRecord")){SearchResults[attrs[i].name]=parseInt(attrs[i].nodeValue)
}else{SearchResults[attrs[i].name]=attrs[i].nodeValue
}}obj.SearchResults=SearchResults
},SummaryRecord:function(node,obj){var record={type:"SummaryRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},BriefRecord:function(node,obj){var record={type:"BriefRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},DCMIRecord:function(node,obj){var record={type:"DCMIRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},Record:function(node,obj){var record={type:"Record"};
this.readChildNodes(node,record);
obj.records.push(record)
},"*":function(node,obj){var info=node.localName;
if(!(obj.geonet_info[info] instanceof Array)){obj.geonet_info[info]=new Array()
}var value=this.getChildValue(node);
obj.geonet_info[info].push(value)
}},dc:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
if(!(obj[name] instanceof Array)){obj[name]=new Array()
}var dc_element={};
var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){dc_element[attrs[i].name]=attrs[i].nodeValue
}dc_element.value=this.getChildValue(node);
obj[name].push(dc_element)
}},dct:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
if(!(obj[name] instanceof Array)){obj[name]=new Array()
}obj[name].push(this.getChildValue(node))
}},geonet:{info:function(node,obj){if(!(obj.geonet_info instanceof Array)){obj.geonet_info=new Array()
}this.readChildNodes(node,obj)
}},ows:{WGS84BoundingBox:function(node,obj){if(!(obj.BoundingBox instanceof Array)){obj.BoundingBox=new Array()
}var lc=this.getChildValue(this.getElementsByTagNameNS(node,this.namespaces.ows,"LowerCorner")[0]).split(" ",2);
var uc=this.getChildValue(this.getElementsByTagNameNS(node,this.namespaces.ows,"UpperCorner")[0]).split(" ",2);
var boundingBox={value:[parseFloat(lc[0]),parseFloat(lc[1]),parseFloat(uc[0]),parseFloat(uc[1])]};
var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){boundingBox[attrs[i].name]=attrs[i].nodeValue
}obj.BoundingBox.push(boundingBox)
},BoundingBox:function(node,obj){this.readers.ows["WGS84BoundingBox"].apply(this,[node,obj])
}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork"});OpenLayers.Format.GeoNetworkRecords=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"nons",namespaces:{nons:"",geonet:"http://www.fao.org/geonetwork"},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var obj={};
this.readNode(data,obj);
return obj
},readers:{nons:{response:function(node,obj){obj.records=[];
this.readChildNodes(node,obj);
var from=this.getAttributeNS(node,"","from");
if(from!=""){obj.from=from
}var to=this.getAttributeNS(node,"","to");
if(to!=""){obj.to=to
}},summary:function(node,obj){obj.summary={};
var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){obj.summary[attrs[i].name]=attrs[i].nodeValue
}this.readChildNodes(node,obj.summary)
},metadata:function(node,obj){var record={type:"metadata"};
this.readChildNodes(node,record);
obj.records.push(record)
},geoBox:function(node,obj){if(!(obj.BoundingBox instanceof Array)){obj.BoundingBox=new Array()
}var s,w,e,n;
for(var child=node.firstChild;
child;
child=child.nextSibling){switch(child.nodeName){case"southBL":s=this.getChildValue(child);
break;
case"westBL":w=this.getChildValue(child);
break;
case"eastBL":e=this.getChildValue(child);
break;
case"northBL":n=this.getChildValue(child);
break
}}var boundingBox={value:[parseFloat(w),parseFloat(s),parseFloat(e),parseFloat(n)]};
obj.BoundingBox.push(boundingBox)
},"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
var parentName=node.parentNode.localName||node.parentNode.nodeName.split(":").pop();
var value={};
value.value=this.getChildValue(node);
if(parentName=="info"){if(!(obj.geonet_info[name] instanceof Array)){obj.geonet_info[name]=new Array()
}obj.geonet_info[name].push(value);
if(name=="harvestInfo"||name=="valid_details"){this.readChildNodes(node,obj.geonet_info[name])
}}else{if(!(obj[name] instanceof Array)){obj[name]=new Array()
}var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){value[attrs[i].name]=attrs[i].nodeValue
}obj[name].push(value);
this.readChildNodes(node,obj[name])
}}},geonet:{info:function(node,obj){if(!(obj.geonet_info instanceof Array)){obj.geonet_info=new Array()
}this.readChildNodes(node,obj)
}}},CLASS_NAME:"OpenLayers.Format.GeoNetworkRecords"});(function(){var createComplete=function(fn,cb){return function(request){if(cb&&cb[fn]){cb[fn].call(cb.scope||window,{responseText:request.responseText,responseXML:request.responseXML,argument:cb.argument})
}}
};
Ext.apply(Ext.lib.Ajax,{request:function(method,uri,cb,data,options){options=options||{};
method=method||options.method;
var hs=options.headers;
if(options.xmlData){if(!hs||!hs["Content-Type"]){hs=hs||{};
hs["Content-Type"]="text/xml"
}method=method||"POST";
data=options.xmlData
}else{if(options.jsonData){if(!hs||!hs["Content-Type"]){hs=hs||{};
hs["Content-Type"]="application/json"
}method=method||"POST";
data=typeof options.jsonData=="object"?Ext.encode(options.jsonData):options.jsonData
}}if((method&&method.toLowerCase()=="post")&&(options.form||options.params)&&(!hs||!hs["Content-Type"])){hs=hs||{};
hs["Content-Type"]="application/x-www-form-urlencoded"
}return OpenLayers.Request.issue({success:createComplete("success",cb),failure:createComplete("failure",cb),method:method,headers:hs,data:data,url:uri})
},isCallInProgress:function(request){return true
},abort:function(request){request.abort()
}})
})();Ext.namespace("GeoExt");
GeoExt.singleFile=true;(function(){var singleFile=(typeof GeoExt=="object"&&GeoExt.singleFile);
var scriptName=singleFile?"GeoExt.js":"lib/GeoExt.js";
var getScriptLocation=function(){var scriptLocation="";
var scripts=document.documentElement.getElementsByTagName("script");
for(var i=0,len=scripts.length;
i<len;
i++){var src=scripts[i].getAttribute("src");
if(src){var index=src.lastIndexOf(scriptName);
var pathLength=src.lastIndexOf("?");
if(pathLength<0){pathLength=src.length
}if((index>-1)&&(index+scriptName.length==pathLength)){scriptLocation=src.slice(0,pathLength-scriptName.length);
break
}}}return scriptLocation
};
if(!singleFile){var jsfiles=new Array("GeoExt/data/AttributeReader.js","GeoExt/data/AttributeStore.js","GeoExt/data/FeatureRecord.js","GeoExt/data/FeatureReader.js","GeoExt/data/FeatureStore.js","GeoExt/data/LayerRecord.js","GeoExt/data/LayerReader.js","GeoExt/data/LayerStore.js","GeoExt/data/ScaleStore.js","GeoExt/data/WMSCapabilitiesReader.js","GeoExt/data/WMSCapabilitiesStore.js","GeoExt/data/WFSCapabilitiesReader.js","GeoExt/data/WFSCapabilitiesStore.js","GeoExt/data/WMSDescribeLayerReader.js","GeoExt/data/WMSDescribeLayerStore.js","GeoExt/data/WMCReader.js","GeoExt/widgets/Action.js","GeoExt/data/ProtocolProxy.js","GeoExt/widgets/FeatureRenderer.js","GeoExt/widgets/MapPanel.js","GeoExt/widgets/Popup.js","GeoExt/widgets/form.js","GeoExt/widgets/form/SearchAction.js","GeoExt/widgets/form/BasicForm.js","GeoExt/widgets/form/FormPanel.js","GeoExt/widgets/tips/SliderTip.js","GeoExt/widgets/tips/LayerOpacitySliderTip.js","GeoExt/widgets/tips/ZoomSliderTip.js","GeoExt/widgets/tree/LayerNode.js","GeoExt/widgets/tree/TreeNodeUIEventMixin.js","GeoExt/plugins/TreeNodeComponent.js","GeoExt/plugins/TreeNodeRadioButton.js","GeoExt/widgets/tree/LayerLoader.js","GeoExt/widgets/tree/LayerContainer.js","GeoExt/widgets/tree/BaseLayerContainer.js","GeoExt/widgets/tree/OverlayLayerContainer.js","GeoExt/widgets/tree/LayerParamNode.js","GeoExt/widgets/tree/LayerParamLoader.js","GeoExt/widgets/tree/WMSCapabilitiesLoader.js","GeoExt/widgets/LayerOpacitySlider.js","GeoExt/widgets/LayerLegend.js","GeoExt/widgets/LegendImage.js","GeoExt/widgets/UrlLegend.js","GeoExt/widgets/WMSLegend.js","GeoExt/widgets/VectorLegend.js","GeoExt/widgets/LegendPanel.js","GeoExt/widgets/ZoomSlider.js","GeoExt/widgets/grid/FeatureSelectionModel.js","GeoExt/data/PrintPage.js","GeoExt/data/PrintProvider.js","GeoExt/plugins/PrintPageField.js","GeoExt/plugins/PrintProviderField.js","GeoExt/plugins/PrintExtent.js","GeoExt/plugins/AttributeForm.js","GeoExt/widgets/PrintMapPanel.js","GeoExt/state/PermalinkProvider.js");
var agent=navigator.userAgent;
var docWrite=(agent.match("MSIE")||agent.match("Safari"));
if(docWrite){var allScriptTags=new Array(jsfiles.length)
}var host=getScriptLocation()+"lib/";
for(var i=0,len=jsfiles.length;
i<len;
i++){if(docWrite){allScriptTags[i]="<script src='"+host+jsfiles[i]+"'><\/script>"
}else{var s=document.createElement("script");
s.src=host+jsfiles[i];
var h=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;
h.appendChild(s)
}}if(docWrite){document.write(allScriptTags.join(""))
}}})();Ext.namespace("GeoExt.data");
GeoExt.data.AttributeReader=function(meta,recordType){meta=meta||{};
if(!meta.format){meta.format=new OpenLayers.Format.WFSDescribeFeatureType()
}GeoExt.data.AttributeReader.superclass.constructor.call(this,meta,recordType||meta.fields);
if(meta.feature){this.recordType.prototype.fields.add(new Ext.data.Field("value"))
}};
Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(request){var data=request.responseXML;
if(!data||!data.documentElement){data=request.responseText
}return this.readRecords(data)
},readRecords:function(data){var attributes;
if(data instanceof Array){attributes=data
}else{attributes=this.meta.format.read(data).featureTypes[0].properties
}var feature=this.meta.feature;
var recordType=this.recordType;
var fields=recordType.prototype.fields;
var numFields=fields.length;
var attr,values,name,record,ignore,value,records=[];
for(var i=0,len=attributes.length;
i<len;
++i){ignore=false;
attr=attributes[i];
values={};
for(var j=0;
j<numFields;
++j){name=fields.items[j].name;
value=attr[name];
if(this.ignoreAttribute(name,value)){ignore=true;
break
}values[name]=value
}if(feature){value=feature.attributes[values.name];
if(value!==undefined){if(this.ignoreAttribute("value",value)){ignore=true
}else{values.value=value
}}}if(!ignore){records[records.length]=new recordType(values)
}}return{success:true,records:records,totalRecords:records.length}
},ignoreAttribute:function(name,value){var ignore=false;
if(this.meta.ignore&&this.meta.ignore[name]){var matches=this.meta.ignore[name];
if(typeof matches=="string"){ignore=(matches===value)
}else{if(matches instanceof Array){ignore=(matches.indexOf(value)>-1)
}else{if(matches instanceof RegExp){ignore=(matches.test(value))
}}}}return ignore
}});Ext.namespace("GeoExt.data");
GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(c){c=c||{};
arguments.callee.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new Ext.data.HttpProxy({url:c.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.AttributeReader(c,c.fields||["name","type","restriction"])}));
if(this.feature){this.bind()
}},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});
var records=[];
this.each(function(record){records.push(record)
});
this.updateFeature(records)
},onUpdate:function(store,record,operation){this.updateFeature([record])
},onLoad:function(store,records,options){if(!options||options.add!==true){this.updateFeature(records)
}},onAdd:function(store,records,index){this.updateFeature(records)
},updateFeature:function(records){var feature=this.feature,layer=feature.layer;
var i,len,record,name,value,oldValue,dirty;
for(i=0,len=records.length;
i<len;
i++){record=records[i];
name=record.get("name");
value=record.get("value");
oldValue=feature.attributes[name];
if(oldValue!==value){dirty=true
}}if(dirty&&layer&&layer.events&&layer.events.triggerEvent("beforefeaturemodified",{feature:feature})!==false){for(i=0,len=records.length;
i<len;
i++){record=records[i];
name=record.get("name");
value=record.get("value");
feature.attributes[name]=value
}layer.events.triggerEvent("featuremodified",{feature:feature});
layer.drawFeature(feature)
}}}
};
GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin());Ext.namespace("GeoExt","GeoExt.data");
GeoExt.data.FeatureReader=function(meta,recordType){meta=meta||{};
if(!(recordType instanceof Function)){recordType=GeoExt.data.FeatureRecord.create(recordType||meta.fields||{})
}GeoExt.data.FeatureReader.superclass.constructor.call(this,meta,recordType)
};
Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(response){return this.readRecords(response.features)
},readRecords:function(features){var records=[];
if(features){var recordType=this.recordType,fields=recordType.prototype.fields;
var i,lenI,j,lenJ,feature,values,field,v;
for(i=0,lenI=features.length;
i<lenI;
i++){feature=features[i];
values={};
if(feature.attributes){for(j=0,lenJ=fields.length;
j<lenJ;
j++){field=fields.items[j];
if(/[\[\.]/.test(field.mapping)){try{v=new Function("obj","return obj."+field.mapping)(feature.attributes)
}catch(e){v=field.defaultValue
}}else{v=feature.attributes[field.mapping||field.name]||field.defaultValue
}if(field.convert){v=field.convert(v)
}values[field.name]=v
}}values.feature=feature;
values.state=feature.state;
values.fid=feature.fid;
var id=(feature.state===OpenLayers.State.INSERT)?undefined:feature.id;
records[records.length]=new recordType(values,id)
}}return{records:records,totalRecords:this.totalRecords!=null?this.totalRecords:records.length}
}});Ext.namespace("GeoExt.data");
GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(config){config=config||{};
config.reader=config.reader||new GeoExt.data.FeatureReader({},config.fields);
var layer=config.layer;
delete config.layer;
if(config.features){config.data=config.features
}delete config.features;
var options={initDir:config.initDir};
delete config.initDir;
arguments.callee.superclass.constructor.call(this,config);
if(layer){this.bind(layer,options)
}},bind:function(layer,options){if(this.layer){return
}this.layer=layer;
options=options||{};
var initDir=options.initDir;
if(options.initDir==undefined){initDir=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER
}var features=layer.features.slice(0);
if(initDir&GeoExt.data.FeatureStore.STORE_TO_LAYER){var records=this.getRange();
for(var i=records.length-1;
i>=0;
i--){this.layer.addFeatures([records[i].getFeature()])
}}if(initDir&GeoExt.data.FeatureStore.LAYER_TO_STORE){this.loadData(features,true)
}layer.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});
this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this})
},unbind:function(){if(this.layer){this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});
this.un("load",this.onLoad,this);
this.un("clear",this.onClear,this);
this.un("add",this.onAdd,this);
this.un("remove",this.onRemove,this);
this.un("update",this.onUpdate,this);
this.layer=null
}},getRecordFromFeature:function(feature){var record=null;
if(feature.state!==OpenLayers.State.INSERT){record=this.getById(feature.id)
}else{var index=this.findBy(function(r){return r.getFeature()===feature
});
if(index>-1){record=this.getAt(index)
}}return record
},onFeaturesAdded:function(evt){if(!this._adding){var features=evt.features,toAdd=features;
if(this.featureFilter){toAdd=[];
var i,len,feature;
for(var i=0,len=features.length;
i<len;
i++){feature=features[i];
if(this.featureFilter.evaluate(feature)!==false){toAdd.push(feature)
}}}this._adding=true;
this.loadData(toAdd,true);
delete this._adding
}},onFeaturesRemoved:function(evt){if(!this._removing){var features=evt.features,feature,record,i;
for(i=features.length-1;
i>=0;
i--){feature=features[i];
record=this.getRecordFromFeature(feature);
if(record!==undefined){this._removing=true;
this.remove(record);
delete this._removing
}}}},onFeatureModified:function(evt){if(!this._updating){var feature=evt.feature;
var record=this.getRecordFromFeature(feature);
if(record!==undefined){record.beginEdit();
var attributes=feature.attributes;
if(attributes){var fields=this.recordType.prototype.fields;
for(var i=0,len=fields.length;
i<len;
i++){var field=fields.items[i];
var key=field.mapping||field.name;
if(key in attributes){record.set(field.name,field.convert(attributes[key]))
}}}record.set("state",feature.state);
record.set("fid",feature.fid);
record.setFeature(feature);
this._updating=true;
record.endEdit();
delete this._updating
}}},addFeaturesToLayer:function(records){var i,len,features;
features=new Array((len=records.length));
for(i=0;
i<len;
i++){features[i]=records[i].getFeature()
}if(features.length>0){this._adding=true;
this.layer.addFeatures(features);
delete this._adding
}},onLoad:function(store,records,options){if(!options||options.add!==true){this._removing=true;
this.layer.removeFeatures(this.layer.features);
delete this._removing;
this.addFeaturesToLayer(records)
}},onClear:function(store){this._removing=true;
this.layer.removeFeatures(this.layer.features);
delete this._removing
},onAdd:function(store,records,index){if(!this._adding){this.addFeaturesToLayer(records)
}},onRemove:function(store,record,index){if(!this._removing){var feature=record.getFeature();
if(this.layer.getFeatureById(feature.id)!=null){this._removing=true;
this.layer.removeFeatures([record.getFeature()]);
delete this._removing
}}},onUpdate:function(store,record,operation){if(!this._updating){var defaultFields=new GeoExt.data.FeatureRecord().fields;
var feature=record.getFeature();
if(record.fields){var cont=this.layer.events.triggerEvent("beforefeaturemodified",{feature:feature});
if(cont!==false){var attributes=feature.attributes;
record.fields.each(function(field){var key=field.mapping||field.name;
if(!defaultFields.containsKey(key)){attributes[key]=record.get(field.name)
}});
this._updating=true;
this.layer.events.triggerEvent("featuremodified",{feature:feature});
delete this._updating;
if(this.layer.getFeatureById(feature.id)!=null){this.layer.drawFeature(feature)
}}}}}}
};
GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin);
GeoExt.data.FeatureStore.LAYER_TO_STORE=1;
GeoExt.data.FeatureStore.STORE_TO_LAYER=2;Ext.namespace("GeoExt.data");
GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]);
GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer")
};
GeoExt.data.LayerRecord.prototype.setLayer=function(layer){if(layer!==this.data.layer){this.dirty=true;
if(!this.modified){this.modified={}
}if(this.modified.layer===undefined){this.modified.layer=this.data.layer
}this.data.layer=layer;
if(!this.editing){this.afterEdit()
}}};
GeoExt.data.LayerRecord.prototype.clone=function(id){var layer=this.getLayer()&&this.getLayer().clone();
return new this.constructor(Ext.applyIf({layer:layer},this.data),id||layer.id)
};
GeoExt.data.LayerRecord.create=function(o){var f=Ext.extend(GeoExt.data.LayerRecord,{});
var p=f.prototype;
p.fields=new Ext.util.MixedCollection(false,function(field){return field.name
});
GeoExt.data.LayerRecord.prototype.fields.each(function(f){p.fields.add(f)
});
if(o){for(var i=0,len=o.length;
i<len;
i++){p.fields.add(new Ext.data.Field(o[i]))
}}f.getField=function(name){return p.fields.get(name)
};
return f
};Ext.namespace("GeoExt","GeoExt.data");
GeoExt.data.LayerReader=function(meta,recordType){meta=meta||{};
if(!(recordType instanceof Function)){recordType=GeoExt.data.LayerRecord.create(recordType||meta.fields||{})
}GeoExt.data.LayerReader.superclass.constructor.call(this,meta,recordType)
};
Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(layers){var records=[];
if(layers){var recordType=this.recordType,fields=recordType.prototype.fields;
var i,lenI,j,lenJ,layer,values,field,v;
for(i=0,lenI=layers.length;
i<lenI;
i++){layer=layers[i];
values={};
for(j=0,lenJ=fields.length;
j<lenJ;
j++){field=fields.items[j];
v=layer[field.mapping||field.name]||field.defaultValue;
v=field.convert(v);
values[field.name]=v
}values.layer=layer;
records[records.length]=new recordType(values,layer.id)
}}return{records:records,totalRecords:this.totalRecords!=null?this.totalRecords:records.length}
}});Ext.namespace("GeoExt.data");
GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(config){config=config||{};
config.reader=config.reader||new GeoExt.data.LayerReader({},config.fields);
delete config.fields;
var map=config.map instanceof GeoExt.MapPanel?config.map.map:config.map;
delete config.map;
if(config.layers){config.data=config.layers
}delete config.layers;
var options={initDir:config.initDir};
delete config.initDir;
arguments.callee.superclass.constructor.call(this,config);
if(map){this.bind(map,options)
}},bind:function(map,options){if(this.map){return
}this.map=map;
options=options||{};
var initDir=options.initDir;
if(options.initDir==undefined){initDir=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP
}var layers=map.layers.slice(0);
if(initDir&GeoExt.data.LayerStore.STORE_TO_MAP){this.each(function(record){this.map.addLayer(record.getLayer())
},this)
}if(initDir&GeoExt.data.LayerStore.MAP_TO_STORE){this.loadData(layers,true)
}map.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});
this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});
this.data.on({replace:this.onReplace,scope:this})
},unbind:function(){if(this.map){this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});
this.un("load",this.onLoad,this);
this.un("clear",this.onClear,this);
this.un("add",this.onAdd,this);
this.un("remove",this.onRemove,this);
this.data.un("replace",this.onReplace,this);
this.map=null
}},onChangeLayer:function(evt){var layer=evt.layer;
var recordIndex=this.findBy(function(rec,id){return rec.getLayer()===layer
});
if(recordIndex>-1){var record=this.getAt(recordIndex);
if(evt.property==="order"){if(!this._adding&&!this._removing){var layerIndex=this.map.getLayerIndex(layer);
if(layerIndex!==recordIndex){this._removing=true;
this.remove(record);
delete this._removing;
this._adding=true;
this.insert(layerIndex,[record]);
delete this._adding
}}}else{if(evt.property==="name"){record.set("title",layer.name)
}else{this.fireEvent("update",this,record,Ext.data.Record.EDIT)
}}}},onAddLayer:function(evt){if(!this._adding){var layer=evt.layer;
this._adding=true;
this.loadData([layer],true);
delete this._adding
}},onRemoveLayer:function(evt){if(this.map.unloadDestroy){if(!this._removing){var layer=evt.layer;
this._removing=true;
this.remove(this.getById(layer.id));
delete this._removing
}}else{this.unbind()
}},onLoad:function(store,records,options){if(!Ext.isArray(records)){records=[records]
}if(options&&!options.add){this._removing=true;
for(var i=this.map.layers.length-1;
i>=0;
i--){this.map.removeLayer(this.map.layers[i])
}delete this._removing;
var len=records.length;
if(len>0){var layers=new Array(len);
for(var j=0;
j<len;
j++){layers[j]=records[j].getLayer()
}this._adding=true;
this.map.addLayers(layers);
delete this._adding
}}},onClear:function(store){this._removing=true;
for(var i=this.map.layers.length-1;
i>=0;
i--){this.map.removeLayer(this.map.layers[i])
}delete this._removing
},onAdd:function(store,records,index){if(!this._adding){this._adding=true;
var layer;
for(var i=records.length-1;
i>=0;
--i){layer=records[i].getLayer();
this.map.addLayer(layer);
if(index!==this.map.layers.length-1){this.map.setLayerIndex(layer,index)
}}delete this._adding
}},onRemove:function(store,record,index){if(!this._removing){var layer=record.getLayer();
if(this.map.getLayer(layer.id)!=null){this._removing=true;
this.removeMapLayer(record);
delete this._removing
}}},onUpdate:function(store,record,operation){if(operation===Ext.data.Record.EDIT){if(record.modified&&record.modified.title){var layer=record.getLayer();
var title=record.get("title");
if(title!==layer.name){layer.setName(title)
}}}},removeMapLayer:function(record){this.map.removeLayer(record.getLayer())
},onReplace:function(key,oldRecord,newRecord){this.removeMapLayer(oldRecord)
},getByLayer:function(layer){var index=this.findBy(function(r){return r.getLayer()===layer
});
if(index>-1){return this.getAt(index)
}},destroy:function(){this.unbind();
GeoExt.data.LayerStore.superclass.destroy.call(this)
}}
};
GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin);
GeoExt.data.LayerStore.MAP_TO_STORE=1;
GeoExt.data.LayerStore.STORE_TO_MAP=2;Ext.namespace("GeoExt.data");
GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(config){var map=(config.map instanceof GeoExt.MapPanel?config.map.map:config.map);
delete config.map;
config=Ext.applyIf(config,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])});
GeoExt.data.ScaleStore.superclass.constructor.call(this,config);
if(map){this.bind(map)
}},bind:function(map,options){this.map=(map instanceof GeoExt.MapPanel?map.map:map);
this.map.events.register("changebaselayer",this,this.populateFromMap);
if(this.map.baseLayer){this.populateFromMap()
}else{this.map.events.register("addlayer",this,this.populateOnAdd)
}},unbind:function(){if(this.map){this.map.events.unregister("addlayer",this,this.populateOnAdd);
this.map.events.unregister("changebaselayer",this,this.populateFromMap);
delete this.map
}},populateOnAdd:function(evt){if(evt.layer.isBaseLayer){this.populateFromMap();
this.map.events.unregister("addlayer",this,this.populateOnAdd)
}},populateFromMap:function(){var zooms=[];
var resolutions=this.map.baseLayer.resolutions;
var units=this.map.baseLayer.units;
for(var i=resolutions.length-1;
i>=0;
i--){var res=resolutions[i];
zooms.push({level:i,resolution:res,scale:OpenLayers.Util.getScaleFromResolution(res,units)})
}this.loadData(zooms)
},destroy:function(){this.unbind();
GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments)
}});Ext.namespace("GeoExt.data");
GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(config){this.initialConfig=config;
Ext.apply(this,config);
if(!this.customParams){this.customParams={}
}this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer");
GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments);
this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]});
this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]});
this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]});
if(config.capabilities){this.loadStores()
}else{if(this.url.split("/").pop()){this.url+="/"
}this.initialConfig.autoLoad&&this.loadCapabilities()
}},setLayout:function(layout){this.layout=layout;
this.fireEvent("layoutchange",this,layout)
},setDpi:function(dpi){this.dpi=dpi;
this.fireEvent("dpichange",this,dpi)
},print:function(map,pages,options){if(map instanceof GeoExt.MapPanel){map=map.map
}pages=pages instanceof Array?pages:[pages];
options=options||{};
if(this.fireEvent("beforeprint",this,map,pages,options)===false){return
}var jsonData=Ext.apply({units:map.getUnits(),srs:map.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams);
var pagesLayer=pages[0].feature.layer;
var encodedLayers=[];
Ext.each(map.layers,function(layer){if(layer!==pagesLayer&&layer.getVisibility()===true){var enc=this.encodeLayer(layer);
enc&&encodedLayers.push(enc)
}},this);
jsonData.layers=encodedLayers;
var encodedPages=[];
Ext.each(pages,function(page){encodedPages.push(Ext.apply({center:[page.center.lon,page.center.lat],scale:page.scale.get("value"),rotation:page.rotation},page.customParams))
},this);
jsonData.pages=encodedPages;
if(options.overview){var encodedOverviewLayers=[];
Ext.each(options.overview.layers,function(layer){var enc=this.encodeLayer(layer);
enc&&encodedOverviewLayers.push(enc)
},this);
jsonData.overviewLayers=encodedOverviewLayers
}if(options.legend){var legend=options.legend;
var rendered=legend.rendered;
if(!rendered){legend=legend.cloneConfig({renderTo:document.body,hidden:true})
}var encodedLegends=[];
legend.items.each(function(cmp){if(!cmp.hidden){var encFn=this.encoders.legends[cmp.getXType()];
encodedLegends=encodedLegends.concat(encFn.call(this,cmp))
}},this);
if(!rendered){legend.destroy()
}jsonData.legends=encodedLegends
}if(this.method==="GET"){var url=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(jsonData)));
window.open(url);
this.fireEvent("print",this,url)
}else{Ext.Ajax.request({url:this.capabilities.createURL,jsonData:jsonData,success:function(response){var url=Ext.decode(response.responseText).getURL+(Ext.isIE?"?inline=true":"");
if(Ext.isOpera||Ext.isIE){window.open(url)
}else{window.location.href=url
}this.fireEvent("print",this,url)
},failure:function(response){this.fireEvent("printexception",this,response)
},params:this.initialConfig.baseParams,scope:this})
}},loadCapabilities:function(){if(!this.url){return
}var url=this.url+"info.json";
Ext.Ajax.request({url:url,method:"GET",disableCaching:false,success:function(response){this.capabilities=Ext.decode(response.responseText);
this.loadStores()
},params:this.initialConfig.baseParams,scope:this})
},loadStores:function(){this.scales.loadData(this.capabilities);
this.dpis.loadData(this.capabilities);
this.layouts.loadData(this.capabilities);
this.setLayout(this.layouts.getAt(0));
this.setDpi(this.dpis.getAt(0));
this.fireEvent("loadcapabilities",this,this.capabilities)
},encodeLayer:function(layer){var encLayer;
for(var c in this.encoders.layers){if(OpenLayers.Layer[c]&&layer instanceof OpenLayers.Layer[c]){if(this.fireEvent("beforeencodelayer",this,layer)===false){return
}encLayer=this.encoders.layers[c].call(this,layer);
this.fireEvent("encodelayer",this,layer,encLayer);
break
}}return(encLayer&&encLayer.type)?encLayer:null
},getAbsoluteUrl:function(url){var a;
if(Ext.isIE){a=document.createElement("<a href='"+url+"'/>");
a.style.display="none";
document.body.appendChild(a);
a.href=a.href;
document.body.removeChild(a)
}else{a=document.createElement("a");
a.href=url
}return a.href
},encoders:{layers:{WMS:function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);
Ext.apply(enc,{type:"WMS",layers:[layer.params.LAYERS].join(",").split(","),format:layer.params.FORMAT,styles:[layer.params.STYLES].join(",").split(",")});
var param;
for(var p in layer.params){param=p.toLowerCase();
if(!layer.DEFAULT_PARAMS[param]&&"layers,styles,width,height,srs".indexOf(param)==-1){if(!enc.customParams){enc.customParams={}
}enc.customParams[p]=layer.params[p]
}}return enc
},OSM:function(layer){var enc=this.encoders.layers.TileCache.call(this,layer);
return Ext.apply(enc,{type:"OSM",baseURL:enc.baseURL.substr(0,enc.baseURL.indexOf("$")),extension:"png"})
},TMS:function(layer){var enc=this.encoders.layers.TileCache.call(this,layer);
return Ext.apply(enc,{type:"TMS",format:layer.type})
},TileCache:function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);
return Ext.apply(enc,{type:"TileCache",layer:layer.layername,maxExtent:layer.maxExtent.toArray(),tileSize:[layer.tileSize.w,layer.tileSize.h],extension:layer.extension,resolutions:layer.serverResolutions||layer.resolutions})
},KaMapCache:function(layer){var enc=this.encoders.layers.KaMap.call(this,layer);
return Ext.apply(enc,{type:"KaMapCache",group:layer.params.g,metaTileWidth:layer.params.metaTileSize["w"],metaTileHeight:layer.params.metaTileSize["h"]})
},KaMap:function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);
return Ext.apply(enc,{type:"KaMap",map:layer.params.map,extension:layer.params.i,group:layer.params.g||"",maxExtent:layer.maxExtent.toArray(),tileSize:[layer.tileSize.w,layer.tileSize.h],resolutions:layer.serverResolutions||layer.resolutions})
},HTTPRequest:function(layer){return{baseURL:this.getAbsoluteUrl(layer.url instanceof Array?layer.url[0]:layer.url),opacity:(layer.opacity!=null)?layer.opacity:1,singleTile:layer.singleTile}
},Image:function(layer){return{type:"Image",baseURL:this.getAbsoluteUrl(layer.getURL(layer.extent)),opacity:(layer.opacity!=null)?layer.opacity:1,extent:layer.extent.toArray(),pixelSize:[layer.size.w,layer.size.h],name:layer.name}
},Vector:function(layer){if(!layer.features.length){return
}var encFeatures=[];
var encStyles={};
var features=layer.features;
var featureFormat=new OpenLayers.Format.GeoJSON();
var styleFormat=new OpenLayers.Format.JSON();
var nextId=1;
var styleDict={};
var feature,style,dictKey,dictItem,styleName;
for(var i=0,len=features.length;
i<len;
++i){feature=features[i];
style=feature.style||layer.style||layer.styleMap.createSymbolizer(feature,feature.renderIntent);
dictKey=styleFormat.write(style);
dictItem=styleDict[dictKey];
if(dictItem){styleName=dictItem
}else{styleDict[dictKey]=styleName=nextId++;
if(style.externalGraphic){encStyles[styleName]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(style.externalGraphic)},style)
}else{encStyles[styleName]=style
}}var featureGeoJson=featureFormat.extract.feature.call(featureFormat,feature);
featureGeoJson.properties=OpenLayers.Util.extend({_gx_style:styleName},featureGeoJson.properties);
encFeatures.push(featureGeoJson)
}return{type:"Vector",styles:encStyles,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:encFeatures},name:layer.name,opacity:(layer.opacity!=null)?layer.opacity:1}
}},legends:{gx_wmslegend:function(legend){var enc=this.encoders.legends.base.call(this,legend);
var icons=[];
for(var i=1,len=legend.items.getCount();
i<len;
++i){icons.push(this.getAbsoluteUrl(legend.items.get(i).url))
}enc[0].classes[0]={name:"",icons:icons};
return enc
},gx_urllegend:function(legend){var enc=this.encoders.legends.base.call(this,legend);
enc[0].classes.push({name:"",icon:this.getAbsoluteUrl(legend.items.get(1).url)});
return enc
},base:function(legend){return[{name:legend.items.get(0).text,classes:[]}]
}}}});Ext.namespace("GeoExt.data");
GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(config){this.initialConfig=config;
Ext.apply(this,config);
if(!this.customParams){this.customParams={}
}this.addEvents("change");
GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments);
this.feature=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POLYGON((-1 -1,1 -1,1 1,-1 1,-1 -1))"));
if(this.printProvider.capabilities){this.setScale(this.printProvider.scales.getAt(0))
}else{this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0))
},scope:this,single:true})
}this.printProvider.on({layoutchange:this.onLayoutChange,scope:this})
},getPrintExtent:function(map){map=map instanceof GeoExt.MapPanel?map.map:map;
return this.calculatePageBounds(this.scale,map.getUnits())
},setScale:function(scale,units){var bounds=this.calculatePageBounds(scale,units);
var geom=bounds.toGeometry();
var rotation=this.rotation;
if(rotation!=0){geom.rotate(-rotation,geom.getCentroid())
}this.updateFeature(geom,{scale:scale})
},setCenter:function(center){var geom=this.feature.geometry;
var oldCenter=geom.getBounds().getCenterLonLat();
var dx=center.lon-oldCenter.lon;
var dy=center.lat-oldCenter.lat;
geom.move(dx,dy);
this.updateFeature(geom,{center:center})
},setRotation:function(rotation,force){if(force||this.printProvider.layout.get("rotation")===true){var geom=this.feature.geometry;
geom.rotate(this.rotation-rotation,geom.getCentroid());
this.updateFeature(geom,{rotation:rotation})
}},fit:function(fitTo,options){options=options||{};
var map=fitTo,extent;
if(fitTo instanceof GeoExt.MapPanel){map=fitTo.map
}else{if(fitTo instanceof OpenLayers.Feature.Vector){map=fitTo.layer.map;
extent=fitTo.geometry.getBounds()
}}if(!extent){extent=map.getExtent();
if(!extent){return
}}this._updating=true;
var center=extent.getCenterLonLat();
this.setCenter(center);
var units=map.getUnits();
var scale=this.printProvider.scales.getAt(0);
var closest=Number.POSITIVE_INFINITY;
var mapWidth=extent.getWidth();
var mapHeight=extent.getHeight();
this.printProvider.scales.each(function(rec){var bounds=this.calculatePageBounds(rec,units);
if(options.mode=="closest"){var diff=Math.abs(bounds.getWidth()-mapWidth)+Math.abs(bounds.getHeight()-mapHeight);
if(diff<closest){closest=diff;
scale=rec
}}else{var contains=options.mode=="screen"?!extent.containsBounds(bounds):bounds.containsBounds(extent);
if(contains||(options.mode=="screen"&&!contains)){scale=rec
}return contains
}},this);
this.setScale(scale,units);
delete this._updating;
this.updateFeature(this.feature.geometry,{center:center,scale:scale})
},updateFeature:function(geometry,mods){var f=this.feature;
var modified=f.geometry!==geometry;
geometry.id=f.geometry.id;
f.geometry=geometry;
if(!this._updating){for(var property in mods){if(mods[property]===this[property]){delete mods[property]
}else{this[property]=mods[property];
modified=true
}}Ext.apply(this,mods);
f.layer&&f.layer.drawFeature(f);
modified&&this.fireEvent("change",this,mods)
}},calculatePageBounds:function(scale,units){var s=scale.get("value");
var f=this.feature;
var geom=this.feature.geometry;
var center=geom.getBounds().getCenterLonLat();
var size=this.printProvider.layout.get("size");
var units=units||(f.layer&&f.layer.map&&f.layer.map.getUnits())||"dd";
var unitsRatio=OpenLayers.INCHES_PER_UNIT[units];
var w=size.width/72/unitsRatio*s/2;
var h=size.height/72/unitsRatio*s/2;
return new OpenLayers.Bounds(center.lon-w,center.lat-h,center.lon+w,center.lat+h)
},onLayoutChange:function(){if(this.printProvider.layout.get("rotation")===false){this.setRotation(0,true)
}this.scale&&this.setScale(this.scale)
},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this)
}});Ext.namespace("GeoExt.data");
GeoExt.data.WMSCapabilitiesReader=function(meta,recordType){meta=meta||{};
if(!meta.format){meta.format=new OpenLayers.Format.WMSCapabilities()
}if(typeof recordType!=="function"){recordType=GeoExt.data.LayerRecord.create(recordType||meta.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"}])
}GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,meta,recordType)
};
Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(request){var data=request.responseXML;
if(!data||!data.documentElement){data=request.responseText
}return this.readRecords(data)
},serviceExceptionFormat:function(formats){if(OpenLayers.Util.indexOf(formats,"application/vnd.ogc.se_inimage")>-1){return"application/vnd.ogc.se_inimage"
}if(OpenLayers.Util.indexOf(formats,"application/vnd.ogc.se_xml")>-1){return"application/vnd.ogc.se_xml"
}return formats[0]
},imageFormat:function(layer){var formats=layer.formats;
if(layer.opaque&&OpenLayers.Util.indexOf(formats,"image/jpeg")>-1){return"image/jpeg"
}if(OpenLayers.Util.indexOf(formats,"image/png")>-1){return"image/png"
}if(OpenLayers.Util.indexOf(formats,"image/png; mode=24bit")>-1){return"image/png; mode=24bit"
}if(OpenLayers.Util.indexOf(formats,"image/gif")>-1){return"image/gif"
}return formats[0]
},imageTransparent:function(layer){return layer.opaque==undefined||!layer.opaque
},readRecords:function(data){if(typeof data==="string"||data.nodeType){data=this.meta.format.read(data)
}var version=data.version;
var capability=data.capability||{};
var url=capability.request&&capability.request.getmap&&capability.request.getmap.href;
var layers=capability.layers;
var formats=capability.exception?capability.exception.formats:[];
var exceptions=this.serviceExceptionFormat(formats);
var records=[];
if(url&&layers){var fields=this.recordType.prototype.fields;
var layer,values,options,params,field,v;
for(var i=0,lenI=layers.length;
i<lenI;
i++){layer=layers[i];
if(layer.name){values={};
for(var j=0,lenJ=fields.length;
j<lenJ;
j++){field=fields.items[j];
v=layer[field.mapping||field.name]||field.defaultValue;
v=field.convert(v);
values[field.name]=v
}options={attribution:layer.attribution?this.attributionMarkup(layer.attribution):undefined,minScale:layer.minScale,maxScale:layer.maxScale};
if(this.meta.layerOptions){Ext.apply(options,this.meta.layerOptions)
}params={layers:layer.name,exceptions:exceptions,format:this.imageFormat(layer),transparent:this.imageTransparent(layer),version:version};
if(this.meta.layerParams){Ext.apply(params,this.meta.layerParams)
}values.layer=new OpenLayers.Layer.WMS(layer.title||layer.name,url,params,options);
records.push(new this.recordType(values,values.layer.id))
}}}return{totalRecords:records.length,success:true,records:records}
},attributionMarkup:function(attribution){var markup=[];
if(attribution.logo){markup.push("<img class='"+this.attributionCls+"-image' src='"+attribution.logo.href+"' />")
}if(attribution.title){markup.push("<span class='"+this.attributionCls+"-title'>"+attribution.title+"</span>")
}if(attribution.href){for(var i=0;
i<markup.length;
i++){markup[i]="<a class='"+this.attributionCls+"-link' href="+attribution.href+">"+markup[i]+"</a>"
}}return markup.join(" ")
}});Ext.namespace("GeoExt.data");
GeoExt.data.WMSCapabilitiesStore=function(c){c=c||{};
GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new Ext.data.HttpProxy({url:c.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSCapabilitiesReader(c,c.fields)}))
};
Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store);Ext.namespace("GeoExt.data");
GeoExt.data.WMSDescribeLayerReader=function(meta,recordType){meta=meta||{};
if(!meta.format){meta.format=new OpenLayers.Format.WMSDescribeLayer()
}if(!(typeof recordType==="function")){recordType=Ext.data.Record.create(recordType||meta.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}])
}GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,meta,recordType)
};
Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(request){var data=request.responseXML;
if(!data||!data.documentElement){data=request.responseText
}return this.readRecords(data)
},readRecords:function(data){if(typeof data==="string"||data.nodeType){data=this.meta.format.read(data)
}var records=[],description;
for(var i=0,len=data.length;
i<len;
i++){description=data[i];
if(description){records.push(new this.recordType(description))
}}return{totalRecords:records.length,success:true,records:records}
}});Ext.namespace("GeoExt.data");
GeoExt.data.WMSDescribeLayerStore=function(c){c=c||{};
GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new Ext.data.HttpProxy({url:c.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSDescribeLayerReader(c,c.fields)}))
};
Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store);Ext.namespace("GeoExt");
GeoExt.Action=Ext.extend(Ext.Action,{control:null,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(config){this.uScope=config.scope;
this.uHandler=config.handler;
this.uToggleHandler=config.toggleHandler;
this.uCheckHandler=config.checkHandler;
config.scope=this;
config.handler=this.pHandler;
config.toggleHandler=this.pToggleHandler;
config.checkHandler=this.pCheckHandler;
var ctrl=this.control=config.control;
delete config.control;
if(ctrl){if(config.map){config.map.addControl(ctrl);
delete config.map
}if((config.pressed||config.checked)&&ctrl.map){ctrl.activate()
}ctrl.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})
}arguments.callee.superclass.constructor.call(this,config)
},pHandler:function(cmp){var ctrl=this.control;
if(ctrl&&ctrl.type==OpenLayers.Control.TYPE_BUTTON){ctrl.trigger()
}if(this.uHandler){this.uHandler.apply(this.uScope,arguments)
}},pToggleHandler:function(cmp,state){this.changeControlState(state);
if(this.uToggleHandler){this.uToggleHandler.apply(this.uScope,arguments)
}},pCheckHandler:function(cmp,state){this.changeControlState(state);
if(this.uCheckHandler){this.uCheckHandler.apply(this.uScope,arguments)
}},changeControlState:function(state){if(state){if(!this._activating){this._activating=true;
this.control.activate();
this._activating=false
}}else{if(!this._deactivating){this._deactivating=true;
this.control.deactivate();
this._deactivating=false
}}},onCtrlActivate:function(){var ctrl=this.control;
if(ctrl.type==OpenLayers.Control.TYPE_BUTTON){this.enable()
}else{this.safeCallEach("toggle",[true]);
this.safeCallEach("setChecked",[true])
}},onCtrlDeactivate:function(){var ctrl=this.control;
if(ctrl.type==OpenLayers.Control.TYPE_BUTTON){this.disable()
}else{this.safeCallEach("toggle",[false]);
this.safeCallEach("setChecked",[false])
}},safeCallEach:function(fnName,args){var cs=this.items;
for(var i=0,len=cs.length;
i<len;
i++){if(cs[i][fnName]){cs[i].rendered?cs[i][fnName].apply(cs[i],args):cs[i].on({render:cs[i][fnName].createDelegate(cs[i],args),single:true})
}}}});Ext.namespace("GeoExt");
GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,prettyStateKeys:false,extent:null,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange"],initComponent:function(){if(!(this.map instanceof OpenLayers.Map)){this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:true}))
}var layers=this.layers;
if(!layers||layers instanceof Array){this.layers=new GeoExt.data.LayerStore({layers:layers,map:this.map.layers.length>0?this.map:null})
}if(typeof this.center=="string"){this.center=OpenLayers.LonLat.fromString(this.center)
}else{if(this.center instanceof Array){this.center=new OpenLayers.LonLat(this.center[0],this.center[1])
}}if(typeof this.extent=="string"){this.extent=OpenLayers.Bounds.fromString(this.extent)
}else{if(this.extent instanceof Array){this.extent=OpenLayers.Bounds.fromArray(this.extent)
}}GeoExt.MapPanel.superclass.initComponent.call(this);
this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange");
this.map.events.on({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this})
},onMoveend:function(){this.fireEvent("aftermapmove")
},onLayerchange:function(e){if(e.property){if(e.property==="visibility"){this.fireEvent("afterlayervisibilitychange")
}else{if(e.property==="opacity"){this.fireEvent("afterlayeropacitychange")
}}}},applyState:function(state){this.center=new OpenLayers.LonLat(state.x,state.y);
this.zoom=state.zoom;
var i,l,layer,layerId,visibility,opacity;
var layers=this.map.layers;
for(i=0,l=layers.length;
i<l;
i++){layer=layers[i];
layerId=this.prettyStateKeys?layer.name:layer.id;
visibility=state["visibility_"+layerId];
if(visibility!==undefined){visibility=(/^true$/i).test(visibility);
if(layer.isBaseLayer){if(visibility){this.map.setBaseLayer(layer)
}}else{layer.setVisibility(visibility)
}}opacity=state["opacity_"+layerId];
if(opacity!==undefined){layer.setOpacity(opacity)
}}},getState:function(){var state;
if(!this.map){return
}var center=this.map.getCenter();
state={x:center.lon,y:center.lat,zoom:this.map.getZoom()};
var i,l,layer,layerId,layers=this.map.layers;
for(i=0,l=layers.length;
i<l;
i++){layer=layers[i];
layerId=this.prettyStateKeys?layer.name:layer.id;
state["visibility_"+layerId]=layer.getVisibility();
state["opacity_"+layerId]=layer.opacity==null?1:layer.opacity
}return state
},updateMapSize:function(){if(this.map){this.map.updateSize()
}},renderMap:function(){var map=this.map;
map.render(this.body.dom);
this.layers.bind(map);
if(map.layers.length>0){if(this.center||this.zoom!=null){map.setCenter(this.center,this.zoom)
}else{if(this.extent){map.zoomToExtent(this.extent)
}else{map.zoomToMaxExtent()
}}}},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments);
if(!this.ownerCt){this.renderMap()
}else{this.ownerCt.on("move",this.updateMapSize,this);
this.ownerCt.on({afterlayout:{fn:this.renderMap,scope:this,single:true}})
}},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments);
this.updateMapSize()
},onBeforeAdd:function(item){if(typeof item.addToMapPanel==="function"){item.addToMapPanel(this)
}GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments)
},remove:function(item,autoDestroy){if(typeof item.removeFromMapPanel==="function"){item.removeFromMapPanel(this)
}GeoExt.MapPanel.superclass.remove.apply(this,arguments)
},beforeDestroy:function(){if(this.ownerCt){this.ownerCt.un("move",this.updateMapSize,this)
}if(this.map&&this.map.events){this.map.events.un({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this})
}if(!this.initialConfig.map||!(this.initialConfig.map instanceof OpenLayers.Map)){if(this.map&&this.map.destroy){this.map.destroy()
}}delete this.map;
GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments)
}});
GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(o){return o instanceof GeoExt.MapPanel
})
};
Ext.reg("gx_mappanel",GeoExt.MapPanel);Ext.namespace("GeoExt");
GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this);
if(this.defaultImgSrc===null){this.defaultImgSrc=Ext.BLANK_IMAGE_URL
}this.autoEl={tag:"img","class":(this.imgCls?this.imgCls:""),src:this.defaultImgSrc}
},setUrl:function(url){this.url=url;
var el=this.getEl();
if(el){el.un("error",this.onImageLoadError,this);
el.on("error",this.onImageLoadError,this,{single:true});
el.dom.src=url
}},onRender:function(ct,position){GeoExt.LegendImage.superclass.onRender.call(this,ct,position);
if(this.url){this.setUrl(this.url)
}},onDestroy:function(){var el=this.getEl();
if(el){el.un("error",this.onImageLoadError,this)
}GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments)
},onImageLoadError:function(){this.getEl().dom.src=this.defaultImgSrc
}});
Ext.reg("gx_legendimage",GeoExt.LegendImage);Ext.namespace("GeoExt");
GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:true,layerStore:null,preferredTypes:null,filter:function(record){return true
},initComponent:function(){GeoExt.LegendPanel.superclass.initComponent.call(this)
},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments);
if(!this.layerStore){this.layerStore=GeoExt.MapPanel.guess().layers
}this.layerStore.each(function(record){this.addLegend(record)
},this);
if(this.dynamic){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this})
}},recordIndexToPanelIndex:function(index){var store=this.layerStore;
var count=store.getCount();
var panelIndex=-1;
var legendCount=this.items?this.items.length:0;
var record,layer;
for(var i=count-1;
i>=0;
--i){record=store.getAt(i);
layer=record.getLayer();
var types=GeoExt.LayerLegend.getTypes(record);
if(layer.displayInLayerSwitcher&&types.length>0&&(store.getAt(i).get("hideInLegend")!==true)){++panelIndex;
if(index===i||panelIndex>legendCount-1){break
}}}return panelIndex
},getIdForLayer:function(layer){return this.id+"-"+layer.id
},onStoreAdd:function(store,records,index){var panelIndex=this.recordIndexToPanelIndex(index+records.length-1);
for(var i=0,len=records.length;
i<len;
i++){this.addLegend(records[i],panelIndex)
}this.doLayout()
},onStoreRemove:function(store,record,index){this.removeLegend(record)
},removeLegend:function(record){if(this.items){var legend=this.getComponent(this.getIdForLayer(record.getLayer()));
if(legend){this.remove(legend,true);
this.doLayout()
}}},onStoreClear:function(store){this.removeAllLegends()
},removeAllLegends:function(){this.removeAll(true);
this.doLayout()
},addLegend:function(record,index){if(this.filter(record)===true){var layer=record.getLayer();
index=index||0;
var legend;
var types=GeoExt.LayerLegend.getTypes(record,this.preferredTypes);
if(layer.displayInLayerSwitcher&&!record.get("hideInLegend")&&types.length>0){this.insert(index,{xtype:types[0],id:this.getIdForLayer(layer),layerRecord:record,hidden:!((!layer.map&&layer.visibility)||(layer.getVisibility()&&layer.calculateInRange()))})
}}},onDestroy:function(){if(this.layerStore){this.layerStore.un("add",this.onStoreAdd,this);
this.layerStore.un("remove",this.onStoreRemove,this);
this.layerStore.un("clear",this.onStoreClear,this)
}GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments)
}});
Ext.reg("gx_legendpanel",GeoExt.LegendPanel);Ext.namespace("GeoExt");
GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:true,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this);
this.autoEl={};
this.add({xtype:"label",text:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")});
if(this.layerRecord&&this.layerRecord.store){this.layerStore=this.layerRecord.store;
this.layerStore.on("update",this.onStoreUpdate,this)
}},onStoreUpdate:function(store,record,operation){if(record===this.layerRecord&&this.items.getCount()>0){var layer=record.getLayer();
this.setVisible(layer.getVisibility()&&layer.calculateInRange()&&layer.displayInLayerSwitcher&&!record.get("hideInLegend"));
this.update()
}},update:function(){var title=this.getLayerTitle(this.layerRecord);
if(this.items.get(0).text!==title){this.items.get(0).setText(title)
}},getLayerTitle:function(record){var title=this.legendTitle||"";
if(this.showTitle&&!title){if(record&&!record.get("hideTitle")){title=record.get("title")||record.get("name")||record.getLayer().name||""
}}return title
},beforeDestroy:function(){this.layerStore&&this.layerStore.un("update",this.onStoreUpdate,this);
GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments)
}});
GeoExt.LayerLegend.getTypes=function(layerRecord,preferredTypes){var types=(preferredTypes||[]).concat();
var goodTypes=[];
for(var type in GeoExt.LayerLegend.types){if(GeoExt.LayerLegend.types[type].supports(layerRecord)){types.indexOf(type)==-1&&goodTypes.push(type)
}else{types.remove(type)
}}return types.concat(goodTypes)
};
GeoExt.LayerLegend.supports=function(layerRecord){};
GeoExt.LayerLegend.types={};Ext.namespace("GeoExt");
GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:true,useScaleParameter:true,baseParams:null,initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);
var layer=this.layerRecord.getLayer();
this._noMap=!layer.map;
layer.events.register("moveend",this,this.onLayerMoveend);
this.update()
},onLayerMoveend:function(e){if((e.zoomChanged===true&&this.useScaleParameter===true)||this._noMap){delete this._noMap;
this.update()
}},getLegendUrl:function(layerName,layerNames){var rec=this.layerRecord;
var url;
var styles=rec&&rec.get("styles");
var layer=rec.getLayer();
layerNames=layerNames||[layer.params.LAYERS].join(",").split(",");
var styleNames=layer.params.STYLES&&[layer.params.STYLES].join(",").split(",");
var idx=layerNames.indexOf(layerName);
var styleName=styleNames&&styleNames[idx];
if(styles&&styles.length>0){if(styleName){Ext.each(styles,function(s){url=(s.name==styleName&&s.legend)&&s.legend.href;
return !url
})
}else{if(this.defaultStyleIsFirst===true&&!styleNames&&!layer.params.SLD&&!layer.params.SLD_BODY){url=styles[0].legend&&styles[0].legend.href
}}}if(!url){url=layer.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:layerName,LAYERS:null,STYLE:(styleName!=="")?styleName:null,STYLES:null,SRS:null,FORMAT:null})
}if(this.useScaleParameter===true&&url.toLowerCase().indexOf("request=getlegendgraphic")!=-1){var scale=layer.map.getScale();
url=Ext.urlAppend(url,"SCALE="+scale)
}var params=this.baseParams||{};
Ext.applyIf(params,{FORMAT:"image/gif"});
if(url.indexOf("?")>0){url=Ext.urlEncode(params,url)
}return url
},update:function(){var layer=this.layerRecord.getLayer();
if(!(layer&&layer.map)){return
}GeoExt.WMSLegend.superclass.update.apply(this,arguments);
var layerNames,layerName,i,len;
layerNames=[layer.params.LAYERS].join(",").split(",");
var destroyList=[];
var textCmp=this.items.get(0);
this.items.each(function(cmp){i=layerNames.indexOf(cmp.itemId);
if(i<0&&cmp!=textCmp){destroyList.push(cmp)
}else{if(cmp!==textCmp){layerName=layerNames[i];
var newUrl=this.getLegendUrl(layerName,layerNames);
if(!OpenLayers.Util.isEquivalentUrl(newUrl,cmp.url)){cmp.setUrl(newUrl)
}}}},this);
for(i=0,len=destroyList.length;
i<len;
i++){var cmp=destroyList[i];
this.remove(cmp);
cmp.destroy()
}for(i=0,len=layerNames.length;
i<len;
i++){layerName=layerNames[i];
if(!this.items||!this.getComponent(layerName)){this.add({xtype:"gx_legendimage",url:this.getLegendUrl(layerName,layerNames),itemId:layerName})
}}this.doLayout()
},beforeDestroy:function(){if(this.useScaleParameter===true){var layer=this.layerRecord.getLayer();
layer&&layer.events&&layer.events.unregister("moveend",this,this.onLayerMoveend)
}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments)
}});
GeoExt.WMSLegend.supports=function(layerRecord){return layerRecord.getLayer() instanceof OpenLayers.Layer.WMS
};
GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend;
Ext.reg("gx_wmslegend",GeoExt.WMSLegend);Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{constructor:function(config){config=Ext.applyIf(config||{},{text:"Layers"});
this.loader=config.loader instanceof GeoExt.tree.LayerLoader?config.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(config.loader||{},{store:config.layerStore}));
GeoExt.tree.LayerContainer.superclass.constructor.call(this,config)
},recordIndexToNodeIndex:function(index){var store=this.loader.store;
var count=store.getCount();
var nodeCount=this.childNodes.length;
var nodeIndex=-1;
for(var i=count-1;
i>=0;
--i){if(this.loader.filter(store.getAt(i))===true){++nodeIndex;
if(index===i||nodeIndex>nodeCount-1){break
}}}return nodeIndex
},destroy:function(){delete this.layerStore;
GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments)
}});
Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer;Ext.namespace("GeoExt.tree");
GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(config){config=Ext.applyIf(config||{},{text:"Base Layer",loader:{}});
config.loader=Ext.applyIf(config.loader,{baseAttrs:Ext.applyIf(config.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(record){var layer=record.getLayer();
return layer.displayInLayerSwitcher===true&&layer.isBaseLayer===true
}});
GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,config)
}});
Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer;Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerLoader=function(config){Ext.apply(this,config);
this.addEvents("beforeload","load");
GeoExt.tree.LayerLoader.superclass.constructor.call(this)
};
Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(record){return record.getLayer().displayInLayerSwitcher==true
},baseAttrs:null,uiProviders:null,load:function(node,callback){if(this.fireEvent("beforeload",this,node)){this.removeStoreHandlers();
while(node.firstChild){node.removeChild(node.firstChild)
}if(!this.uiProviders){this.uiProviders=node.getOwnerTree().getLoader().uiProviders
}if(!this.store){this.store=GeoExt.MapPanel.guess().layers
}this.store.each(function(record){this.addLayerNode(node,record)
},this);
this.addStoreHandlers(node);
if(typeof callback=="function"){callback()
}this.fireEvent("load",this,node)
}},onStoreAdd:function(store,records,index,node){if(!this._reordering){var nodeIndex=node.recordIndexToNodeIndex(index+records.length-1);
for(var i=0;
i<records.length;
++i){this.addLayerNode(node,records[i],nodeIndex)
}}},onStoreRemove:function(store,record,index,node){if(!this._reordering){this.removeLayerNode(node,record)
}},addLayerNode:function(node,layerRecord,index){index=index||0;
if(this.filter(layerRecord)===true){var child=this.createNode({nodeType:"gx_layer",layer:layerRecord.getLayer(),layerStore:this.store});
var sibling=node.item(index);
if(sibling){node.insertBefore(child,sibling)
}else{node.appendChild(child)
}child.on("move",this.onChildMove,this)
}},removeLayerNode:function(node,layerRecord){if(this.filter(layerRecord)===true){var child=node.findChildBy(function(node){return node.layer==layerRecord.getLayer()
});
if(child){child.un("move",this.onChildMove,this);
child.remove();
node.reload()
}}},onChildMove:function(tree,node,oldParent,newParent,index){this._reordering=true;
var record=this.store.getByLayer(node.layer);
if(newParent instanceof GeoExt.tree.LayerContainer&&this.store===newParent.loader.store){newParent.loader._reordering=true;
this.store.remove(record);
var newRecordIndex;
if(newParent.childNodes.length>1){var searchIndex=(index===0)?index+1:index-1;
newRecordIndex=this.store.findBy(function(r){return newParent.childNodes[searchIndex].layer===r.getLayer()
});
index===0&&newRecordIndex++
}else{if(oldParent.parentNode===newParent.parentNode){var prev=newParent;
do{prev=prev.previousSibling
}while(prev&&!(prev instanceof GeoExt.tree.LayerContainer&&prev.lastChild));
if(prev){newRecordIndex=this.store.findBy(function(r){return prev.lastChild.layer===r.getLayer()
})
}else{var next=newParent;
do{next=next.nextSibling
}while(next&&!(next instanceof GeoExt.tree.LayerContainer&&next.firstChild));
if(next){newRecordIndex=this.store.findBy(function(r){return next.firstChild.layer===r.getLayer()
})
}newRecordIndex++
}}}if(newRecordIndex!==undefined){this.store.insert(newRecordIndex,[record]);
window.setTimeout(function(){newParent.reload();
oldParent.reload()
})
}else{this.store.insert(oldRecordIndex,[record])
}delete newParent.loader._reordering
}delete this._reordering
},addStoreHandlers:function(node){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[node],true),remove:this.onStoreRemove.createDelegate(this,[node],true)};
for(var evt in this._storeHandlers){this.store.on(evt,this._storeHandlers[evt],this)
}}},removeStoreHandlers:function(){if(this._storeHandlers){for(var evt in this._storeHandlers){this.store.un(evt,this._storeHandlers[evt],this)
}delete this._storeHandlers
}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs)
}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}attr.nodeType=attr.nodeType||"gx_layer";
return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)
},destroy:function(){this.removeStoreHandlers()
}});Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(config){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments)
},render:function(bulkRender){var a=this.node.attributes;
if(a.checked===undefined){a.checked=this.node.layer.getVisibility()
}GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);
var cb=this.checkbox;
if(a.checkedGroup){var radio=Ext.DomHelper.insertAfter(cb,['<input type="radio" name="',a.checkedGroup,'_checkbox" class="',cb.className,cb.checked?'" checked="checked"':"",'"></input>'].join(""));
radio.defaultChecked=cb.defaultChecked;
Ext.get(cb).remove();
this.checkbox=radio
}this.enforceOneVisible()
},onClick:function(e){if(e.getTarget(".x-tree-node-cb",1)){this.toggleCheck(this.isChecked())
}else{GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments)
}},toggleCheck:function(value){value=(value===undefined?!this.isChecked():value);
GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,value);
this.enforceOneVisible()
},enforceOneVisible:function(){var attributes=this.node.attributes;
var group=attributes.checkedGroup;
if(group&&group!=="gx_baselayer"){var layer=this.node.layer;
var checkedNodes=this.node.getOwnerTree().getChecked();
var checkedCount=0;
Ext.each(checkedNodes,function(n){var l=n.layer;
if(!n.hidden&&n.attributes.checkedGroup===group){checkedCount++;
if(l!=layer&&attributes.checked){l.setVisibility(false)
}}});
if(checkedCount===0&&attributes.checked==false){layer.setVisibility(true)
}}},appendDDGhost:function(ghostNode){var n=this.elNode.cloneNode(true);
var radio=Ext.DomQuery.select("input[type='radio']",n);
Ext.each(radio,function(r){r.name=r.name+"_clone"
});
ghostNode.appendChild(n)
}});
GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,layerStore:null,constructor:function(config){config.leaf=config.leaf||!(config.children||config.loader);
if(!config.iconCls&&!config.children){config.iconCls="gx-tree-layer-icon"
}if(config.loader&&!(config.loader instanceof Ext.tree.TreeLoader)){config.loader=new GeoExt.tree.LayerParamLoader(config.loader)
}this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI;
Ext.apply(this,{layer:config.layer,layerStore:config.layerStore});
if(config.text){this.fixedText=true
}GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments)
},render:function(bulkRender){var layer=this.layer instanceof OpenLayers.Layer&&this.layer;
if(!layer){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers
}var i=this.layerStore.findBy(function(o){return o.get("title")==this.layer
},this);
if(i!=-1){layer=this.layerStore.getAt(i).getLayer()
}}if(!this.rendered||!layer){var ui=this.getUI();
if(layer){this.layer=layer;
if(layer.isBaseLayer){this.draggable=false;
Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"})
}if(!this.text){this.text=layer.name
}ui.show();
this.addVisibilityEventHandlers()
}else{ui.hide()
}if(this.layerStore instanceof GeoExt.data.LayerStore){this.addStoreEventHandlers(layer)
}}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments)
},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});
this.on({checkchange:this.onCheckChange,scope:this})
},onLayerVisibilityChanged:function(){if(!this._visibilityChanging){this.getUI().toggleCheck(this.layer.getVisibility())
}},onCheckChange:function(node,checked){if(checked!=this.layer.getVisibility()){this._visibilityChanging=true;
var layer=this.layer;
if(checked&&layer.isBaseLayer&&layer.map){layer.map.setBaseLayer(layer)
}else{layer.setVisibility(checked)
}delete this._visibilityChanging
}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this})
},onStoreAdd:function(store,records,index){var l;
for(var i=0;
i<records.length;
++i){l=records[i].getLayer();
if(this.layer==l){this.getUI().show();
break
}else{if(this.layer==l.name){this.render();
break
}}}},onStoreRemove:function(store,record,index){if(this.layer==record.getLayer()){this.getUI().hide()
}},onStoreUpdate:function(store,record,operation){var layer=record.getLayer();
if(!this.fixedText&&(this.layer==layer&&this.text!==layer.name)){this.setText(layer.name)
}},destroy:function(){var layer=this.layer;
if(layer instanceof OpenLayers.Layer){layer.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})
}delete this.layer;
var layerStore=this.layerStore;
if(layerStore){layerStore.un("add",this.onStoreAdd,this);
layerStore.un("remove",this.onStoreRemove,this);
layerStore.un("update",this.onStoreUpdate,this)
}delete this.layerStore;
this.un("checkchange",this.onCheckChange,this);
GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments)
}});
Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode;Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerParamLoader=function(config){Ext.apply(this,config);
this.addEvents("beforeload","load");
GeoExt.tree.LayerParamLoader.superclass.constructor.call(this)
};
Ext.extend(GeoExt.tree.LayerParamLoader,Ext.util.Observable,{param:null,delimiter:",",load:function(node,callback){if(this.fireEvent("beforeload",this,node)){while(node.firstChild){node.removeChild(node.firstChild)
}var paramValue=(node.layer instanceof OpenLayers.Layer.HTTPRequest)&&node.layer.params[this.param];
if(paramValue){var items=(paramValue instanceof Array)?paramValue.slice():paramValue.split(this.delimiter);
Ext.each(items,function(item,index,allItems){this.addParamNode(item,allItems,node)
},this)
}if(typeof callback=="function"){callback()
}this.fireEvent("load",this,node)
}},addParamNode:function(paramItem,allParamItems,node){var child=this.createNode({layer:node.layer,param:this.param,item:paramItem,allItems:allParamItems,delimiter:this.delimiter});
var sibling=node.item(0);
if(sibling){node.insertBefore(child,sibling)
}else{node.appendChild(child)
}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs)
}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}attr.nodeType=attr.nodeType||"gx_layerparam";
return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)
}});Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(attributes){var config=attributes||{};
config.iconCls=config.iconCls||"gx-tree-layerparam-icon";
config.text=config.text||config.item;
this.param=config.param;
this.item=config.item;
this.delimiter=config.delimiter||",";
this.allItems=config.allItems;
GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments);
this.getLayer();
if(this.layer){if(!this.allItems){this.allItems=this.getItemsFromLayer()
}if(this.attributes.checked==null){this.attributes.checked=this.layer.getVisibility()&&this.getItemsFromLayer().indexOf(this.item)>=0
}else{this.onCheckChange(this,this.attributes.checked)
}this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});
this.on({checkchange:this.onCheckChange,scope:this})
}},getLayer:function(){if(!this.layer){var layer=this.attributes.layer;
if(typeof layer=="string"){var store=this.attributes.layerStore||GeoExt.MapPanel.guess().layers;
var i=store.findBy(function(o){return o.get("title")==layer
});
layer=i!=-1?store.getAt(i).getLayer():null
}this.layer=layer
}return this.layer
},getItemsFromLayer:function(){var paramValue=this.layer.params[this.param];
return paramValue instanceof Array?paramValue:(paramValue?paramValue.split(this.delimiter):[])
},createParams:function(items){var params={};
params[this.param]=this.layer.params[this.param] instanceof Array?items:items.join(this.delimiter);
return params
},onLayerVisibilityChanged:function(){if(this.getItemsFromLayer().length===0){this.layer.mergeNewParams(this.createParams(this.allItems))
}var visible=this.layer.getVisibility();
if(visible&&this.getItemsFromLayer().indexOf(this.item)!==-1){this.getUI().toggleCheck(true)
}if(!visible){this.layer.mergeNewParams(this.createParams([]));
this.getUI().toggleCheck(false)
}},onCheckChange:function(node,checked){var layer=this.layer;
var newItems=[];
var curItems=this.getItemsFromLayer();
if(checked===true&&layer.getVisibility()===false&&curItems.length===this.allItems.length){curItems=[]
}Ext.each(this.allItems,function(item){if((item!==this.item&&curItems.indexOf(item)!==-1)||(checked===true&&item===this.item)){newItems.push(item)
}},this);
var visible=(newItems.length>0);
visible&&layer.mergeNewParams(this.createParams(newItems));
if(visible!==layer.getVisibility()){layer.setVisibility(visible)
}(!visible)&&layer.mergeNewParams(this.createParams([]))
},destroy:function(){var layer=this.layer;
if(layer instanceof OpenLayers.Layer){layer.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})
}delete this.layer;
this.un("checkchange",this.onCheckChange,this);
GeoExt.tree.LayerParamNode.superclass.destroy.apply(this,arguments)
}});
Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode;Ext.namespace("GeoExt.tree");
GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(config){config=Ext.applyIf(config||{},{text:"Overlays"});
config.loader=Ext.applyIf(config.loader||{},{filter:function(record){var layer=record.getLayer();
return layer.displayInLayerSwitcher===true&&layer.isBaseLayer===false
}});
GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,config)
}});
Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer;Ext.namespace("GeoExt.tree");
GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(node){node.addEvents("rendernode","rawclicknode");
this.superclass=arguments.callee.superclass;
this.superclass.constructor.apply(this,arguments)
},render:function(bulkRender){if(!this.rendered){this.superclass.render.apply(this,arguments);
this.fireEvent("rendernode",this.node)
}},onClick:function(e){if(this.fireEvent("rawclicknode",this.node,e)!==false){this.superclass.onClick.apply(this,arguments)
}}}
};Ext.namespace("GeoExt.plugins");
GeoExt.plugins.TreeNodeRadioButton=Ext.extend(Ext.util.Observable,{constructor:function(config){Ext.apply(this.initialConfig,Ext.apply({},config));
Ext.apply(this,config);
this.addEvents("radiochange");
GeoExt.plugins.TreeNodeRadioButton.superclass.constructor.apply(this,arguments)
},init:function(tree){tree.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this})
},onRenderNode:function(node){var a=node.attributes;
if(a.radioGroup&&!a.radio){a.radio=Ext.DomHelper.insertBefore(node.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',a.radioGroup,'_radio"></input>'].join(""))
}},onRawClickNode:function(node,e){var el=e.getTarget(".gx-tree-radio",1);
if(el){el.defaultChecked=el.checked;
this.fireEvent("radiochange",node);
return false
}},onBeforeDestroy:function(tree){tree.un("rendernode",this.onRenderNode,this);
tree.un("rawclicknode",this.onRenderNode,this);
tree.un("beforedestroy",this.onBeforeDestroy,this)
}});
Ext.preg("gx_treenoderadiobutton",GeoExt.plugins.TreeNodeRadioButton);Ext.namespace("GeoExt.plugins");
GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(config){this.initialConfig=config;
Ext.apply(this,config);
GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments)
},init:function(target){this.target=target;
var onCfg={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};
onCfg[target instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange;
target.on(onCfg)
},onRender:function(field){var printProvider=this.printProvider||field.ownerCt.printProvider;
if(field.store===printProvider.layouts){field.setValue(printProvider.layout.get(field.displayField));
printProvider.on({layoutchange:this.onProviderChange,scope:this})
}else{if(field.store===printProvider.dpis){field.setValue(printProvider.dpi.get(field.displayField));
printProvider.on({dpichange:this.onProviderChange,scope:this})
}else{if(field.initialConfig.value===undefined){field.setValue(printProvider.customParams[field.name])
}}}},onFieldChange:function(field,record){var printProvider=this.printProvider||field.ownerCt.printProvider;
var value=field.getValue();
this._updating=true;
if(record){switch(field.store){case printProvider.layouts:printProvider.setLayout(record);
break;
case printProvider.dpis:printProvider.setDpi(record)
}}else{printProvider.customParams[field.name]=value
}delete this._updating
},onProviderChange:function(printProvider,rec){if(!this._updating){this.target.setValue(rec.get(this.target.displayField))
}},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);
this.target.un("render",this.onRender,this);
this.target.un("select",this.onFieldChange,this);
this.target.un("valid",this.onFieldChange,this);
this.printProvider.un("layoutchange",this.onProviderChange,this);
this.printProvider.un("dpichange",this.onProviderChange,this)
}});
Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField);Ext.namespace("GeoExt.plugins");
GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(config){this.initialConfig=config;
Ext.apply(this,config);
GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments)
},init:function(target){this.target=target;
var onCfg={beforedestroy:this.onBeforeDestroy,scope:this};
var eventName=target instanceof Ext.form.ComboBox?"select":target instanceof Ext.form.Checkbox?"check":"valid";
onCfg[eventName]=this.onFieldChange;
target.on(onCfg);
this.printPage.on({change:this.onPageChange,scope:this});
this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this});
this.setValue(this.printPage)
},onFieldChange:function(field,record){var printProvider=this.printPage.printProvider;
var value=field.getValue();
this._updating=true;
if(field.store===printProvider.scales||field.name==="scale"){this.printPage.setScale(record)
}else{if(field.name=="rotation"){!isNaN(value)&&this.printPage.setRotation(value)
}else{this.printPage.customParams[field.name]=value
}}delete this._updating
},onPageChange:function(printPage){if(!this._updating){this.setValue(printPage)
}},onLayoutChange:function(printProvider,layout){var t=this.target;
t.name=="rotation"&&t.setDisabled(!layout.get("rotation"))
},setValue:function(printPage){var t=this.target;
t.suspendEvents();
if(t.store===printPage.printProvider.scales||t.name==="scale"){if(printPage.scale){t.setValue(printPage.scale.get(t.displayField))
}}else{if(t.name=="rotation"){t.setValue(printPage.rotation)
}}t.resumeEvents()
},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);
this.target.un("select",this.onFieldChange,this);
this.target.un("valid",this.onFieldChange,this);
this.printPage.un("change",this.onPageChange,this);
this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this)
}});
Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField);Ext.namespace("GeoExt");
GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:true,minWidth:10,offsets:[0,-10],dragging:false,init:function(slider){GeoExt.SliderTip.superclass.init.apply(this,arguments);
if(this.hover){slider.on("render",this.registerThumbListeners,this)
}this.slider=slider
},registerThumbListeners:function(){var thumb,el;
for(var i=0,ii=this.slider.thumbs.length;
i<ii;
++i){thumb=this.slider.thumbs[i];
el=thumb.tracker.el;
(function(thumb,el){el.on({mouseover:function(e){this.onSlide(this.slider,e,thumb);
this.dragging=false
},mouseout:function(){if(!this.dragging){this.hide.apply(this,arguments)
}},scope:this})
}).apply(this,[thumb,el])
}},onSlide:function(slider,e,thumb){this.dragging=true;
return GeoExt.SliderTip.superclass.onSlide.apply(this,arguments)
}});Ext.namespace("GeoExt");
GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(slider){this.compiledTemplate=new Ext.Template(this.template);
GeoExt.LayerOpacitySliderTip.superclass.init.call(this,slider)
},getText:function(thumb){var data={opacity:thumb.value};
return this.compiledTemplate.apply(data)
}});Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerOpacitySliderPlugin=Ext.extend(Ext.util.Observable,{constructor:function(config){Ext.apply(this.initialConfig,Ext.apply({},config));
Ext.apply(this,config);
this.addEvents("opacityslide");
GeoExt.tree.LayerOpacitySliderPlugin.superclass.constructor.apply(this,arguments)
},init:function(tree){tree.on({rendernode:this.onRenderNode,scope:this})
},onRenderNode:function(node){var a=node.attributes;
var layer=node.layer;
if(a.slider){this.indentMarkup=node.parentNode?node.parentNode.ui.getChildIndent():"";
var elID=node.id+"-tree-slider-";
elID=Ext.id(null,elID);
buf=["<br/>","<table><tr>","<td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>","<a id=",elID,"></a>","</td>","</tr></table>"];
Ext.DomHelper.insertAfter(node.ui.anchor,buf.join(""));
var initValue=100;
var slider=new Ext.Slider({minValue:0,maxValue:100,value:initValue,width:100,aggressive:true,layer:layer,plugins:new GeoExt.LayerOpacitySliderTip()});
Ext.override(Ext.Slider,{getRatio:function(){var w=this.innerEl.getComputedWidth();
var v=this.maxValue-this.minValue;
return v==0?w:(w/v)
}});
slider.on("change",function(slider,value,oldValue){this.layer.setOpacity(value/100)
});
slider.render(elID)
}}});
Ext.preg&&Ext.preg("gx_layeropacitysliderplugin",GeoExt.tree.LayerOpacitySliderPlugin);Ext.namespace("GeoNetwork");
GeoNetwork.singleFile=true;Ext.namespace("GeoNetwork");
GeoNetwork.Lang={};
GeoNetwork.Util={defaultLocale:"en",locales:[["ar","","ara"],["ca","Catal","cat"],["cn","","chi"],["de","Deutsch","ger"],["en","English","eng"],["es","Espaol","spa"],["fr","Franais","fre"],["nl","Nederlands","dut"],["no","Norsk","nor"],["pt","ortugus","por"],["ru","","rus"]],setLang:function(lang,baseUrl){lang=lang||GeoNetwork.Util.defaultLocale;
OpenLayers.Lang.setCode(lang);
var s=document.createElement("script");
s.type="text/javascript";
s.src=baseUrl+"/js/ext/src/locale/ext-lang-"+lang+".js";
document.getElementsByTagName("head")[0].appendChild(s)
},getCatalogueLang:function(lang){var i;
for(i=0;
i<GeoNetwork.Util.locales.length;
i++){if(GeoNetwork.Util.locales[i][0]===lang){return GeoNetwork.Util.locales[i][0]
}}return GeoNetwork.Util.defaultLocale
},getISO3LangCode:function(lang){var i;
for(i=0;
i<GeoNetwork.Util.locales.length;
i++){if(GeoNetwork.Util.locales[i][0]===lang){return GeoNetwork.Util.locales[i][2]
}}return"eng"
},getParameters:function(url){var parameters=OpenLayers.Util.getParameters(url);
if(OpenLayers.String.contains(url,"#")){var start=url.indexOf("#")+1;
var end=url.length;
var paramsString=url.substring(start,end);
var pairs=paramsString.split(/[\/]/);
for(var i=0,len=pairs.length;
i<len;
++i){var keyValue=pairs[i].split("=");
var key=keyValue[0];
var value=keyValue[1]||"";
parameters[key]=value
}}return parameters
},getBaseUrl:function(url){return url.substring(0,url.indexOf("?")||url.indexOf("#")||url.length)
}};Ext.namespace("GeoNetwork");
GeoNetwork.Catalogue=Ext.extend(Ext.util.Observable,{SERVERURL:null,URL:null,LANG:"en",DEFAULT_LANG:"en",EDITOR_MODE:{IN_OTHER_WINDOW:1,IN_EDITOR_POPUP:2},editMode:1,hostUrl:null,servlet:null,extentMap:null,services:{},windowOption:"menubar=no,location=no,toolbar=no,directories=no",windowName:"",startRecord:1,mdStore:null,summaryStore:null,statusBarId:null,mdDisplayPanelId:undefined,resultsView:undefined,mdOverlayedCmpId:undefined,identifiedUser:undefined,adminUser:false,metadataEditFn:undefined,adminAppUrl:"",selectedRecords:0,constructor:function(config){config=config||{};
Ext.apply(this,config);
if(this.hostUrl){if(this.hostUrl.indexOf("http")===-1){this.hostUrl=window.location.href.match(/http.*\//,"")+this.hostUrl
}this.SERVERURL=this.hostUrl
}else{this.SERVERURL="http://"+window.location.host+"/"
}if(this.hostUrl){this.URL=this.SERVERURL
}else{if(this.servlet){this.URL=this.SERVERURL+this.servlet
}else{this.URL=this.SERVERURL+"geonetwork"
}}this.LANG=(this.lang?this.lang:this.DEFAULT_LANG);
var serviceUrl=this.URL+"/srv/"+this.LANG+"/";
this.services={rootUrl:serviceUrl,csw:serviceUrl+"csw",xmlSearch:serviceUrl+"xml.search",mdSelect:serviceUrl+"metadata.select",mdView:serviceUrl+"view",mdXMLInsert:serviceUrl+"xml.metadata.insert",mdShow:serviceUrl+"metadata.show.embedded",mdMEF:serviceUrl+"mef.export",mdXMLGet:serviceUrl+"xml.metadata.get",mdXMLGet19139:serviceUrl+"iso19139.xml",mdXMLGetDC:serviceUrl+"dc.xml",mdXMLGetFGDC:serviceUrl+"fgdc.xml",mdXMLGet19115:serviceUrl+"iso19115to19139.xml",mdDuplicate:serviceUrl+"metadata.duplicate.form",mdDelete:serviceUrl+"metadata.delete",mdPrint:serviceUrl+"pdf",mdEdit:serviceUrl+"edit",mdCreate:serviceUrl+"metadata.create.new",mdUpdate:serviceUrl+"metadata.update.new",mdProcessingXml:serviceUrl+"xml.metadata.processing",mdProcessing:serviceUrl+"metadata.processing.new",mdMassiveChildrenForm:serviceUrl+"metadata.batch.children.form",mdAdmin:serviceUrl+"metadata.admin.form",mdValidate:serviceUrl+"xml.metadata.validate",mdSuggestion:serviceUrl+"metadata.suggestion",mdCategory:serviceUrl+"metadata.category.form",mdRelationInsert:serviceUrl+"xml.relation.insert",mdRelationDelete:serviceUrl+"xml.relation.delete",mdRelation:serviceUrl+"xml.relation",mdGetThumbnail:serviceUrl+"metadata.thumbnail",mdSetThumbnail:serviceUrl+"metadata.thumbnail.set.new",mdUnsetThumbnail:serviceUrl+"metadata.thumbnail.unset.new",mdImport:serviceUrl+"metadata.xmlinsert.form",subTemplateType:serviceUrl+"subtemplate.types",subTemplate:serviceUrl+"subtemplate",upload:serviceUrl+"resources.upload.new",prepareDownload:serviceUrl+"prepare.file.download",fileDisclaimer:serviceUrl+"file.disclaimer",fileDownload:serviceUrl+"file.download",geopublisher:serviceUrl+"geoserver.publisher",login:serviceUrl+"xml.user.login",logout:serviceUrl+"xml.user.logout",mef:serviceUrl+"mef.export?format=full&version=2",csv:serviceUrl+"csv.search",pdf:serviceUrl+"pdf.selection.search",harvestingStart:serviceUrl+"xml.harvesting.start",harvestingStop:serviceUrl+"xml.harvesting.stop",harvestingRun:serviceUrl+"xml.harvesting.run",harvestingAdd:serviceUrl+"xml.harvesting.add",harvestingUpdate:serviceUrl+"xml.harvesting.update",harvestingRemove:serviceUrl+"xml.harvesting.remove",thesaurusAdd:serviceUrl+"thesaurus.add",thesaurusActivate:serviceUrl+"thesaurus.activate",thesaurusDelete:serviceUrl+"thesaurus.delete",thesaurusUpload:serviceUrl+"xml.thesaurus.upload",thesaurusDownload:serviceUrl+"thesaurus.download",thesaurusConceptAdd:serviceUrl+"thesaurus.addelement",thesaurusConceptUpdate:serviceUrl+"thesaurus.updateelement",thesaurusConceptDelete:serviceUrl+"thesaurus.deleteelement",getIcons:serviceUrl+"xml.harvesting.info?type=icons",opensearchSuggest:serviceUrl+"main.search.suggest",massiveOp:{NewOwner:serviceUrl+"metadata.batch.newowner.form",Categories:serviceUrl+"metadata.batch.category.form",Delete:serviceUrl+"metadata.batch.delete",Privileges:serviceUrl+"metadata.batch.admin.form"},metadataMassiveUpdatePrivilege:serviceUrl+"metadata.batch.update.privileges",metadataMassiveUpdateCategories:serviceUrl+"metadata.batch.update.categories",getGroups:serviceUrl+"xml.info?type=groups",getRegions:serviceUrl+"xml.info?type=regions",getSources:serviceUrl+"xml.info?type=sources",getUsers:serviceUrl+"xml.info?type=users",getSiteInfo:serviceUrl+"xml.info?type=site",schemaInfo:serviceUrl+"xml.schema.info",getZ3950repositories:serviceUrl+"xml.info?type=z3950repositories",getCategories:serviceUrl+"xml.info?type=categories",getHarvesters:serviceUrl+"xml.harvesting.get",rate:serviceUrl+"xml.metadata.rate",xmlConfig:serviceUrl+"xml.config.get",admin:serviceUrl+"admin",xmlError:serviceUrl+"xml.main.error",searchKeyword:serviceUrl+"xml.search.keywords",getThesaurus:serviceUrl+"xml.thesaurus.getList",getKeyword:serviceUrl+"xml.keyword.get",searchCRS:serviceUrl+"crs.search",getCRSTypes:serviceUrl+"crs.types",logoAdd:serviceUrl+"logo.add",logoUrl:this.URL+"/images/logos/",imgUrl:this.URL+"/images/",harvesterLogoUrl:this.URL+"/images/harvesting/"};
this.extentMap=new GeoNetwork.map.ExtentMap();
this.addEvents("selectionchange","afterLogin","afterLogout","afterBadLogin","afterBadLogout","afterDelete");
GeoNetwork.Catalogue.superclass.constructor.call(this,config)
},setServiceUrl:function(serviceName,url){this.services[serviceName]=this.services.rootUrl+url
},isIdentified:function(){return !this.identifiedUser?false:true
},isAdmin:function(){return this.adminUser
},onAfterLogin:function(){this.fireEvent("afterLogin",this,this.isIdentified())
},onAfterBadLogin:function(){this.fireEvent("afterBadLogin",this,this.isIdentified())
},onAfterLogout:function(){this.fireEvent("afterLogout",this,this.isIdentified())
},onAfterBadLogout:function(){this.fireEvent("afterBadLogout",this,this.isIdentified())
},onAfterDelete:function(){this.fireEvent("afterDelete",this)
},onAfterRating:function(){this.fireEvent("afterRating",this)
},setSelectedRecords:function(nb){this.selectedRecords=parseInt(nb,10);
this.onSelectionChange()
},getSelectedRecords:function(){return this.selectedRecords
},onSelectionChange:function(){this.fireEvent("selectionchange",this,this.getSelectedRecords())
},getInfo:function(){var info={};
var properties=["name","organization","siteId"];
var request=OpenLayers.Request.GET({url:this.services.getSiteInfo,async:false});
if(request.responseXML){var xml=request.responseXML.documentElement;
Ext.each(properties,function(item,idx){info[item]=xml.getElementsByTagName(item)[0].childNodes[0].nodeValue
})
}return info
},updateStatus:function(msg){if(this.statusBarId){var el=Ext.getCmp(this.statusBarId);
if(el){el.update(msg);
return
}el=Ext.getDom(this.statusBarId);
if(el){el.innerHTML=msg;
return
}}},search:function(formOrParams,onSuccess,onFailure,startRecord,updateStore,metadataStore,summaryStore){this.updateStatus(OpenLayers.i18n("searching"));
if(updateStore!==false){updateStore=true
}if(!startRecord){startRecord=this.startRecord
}if(!onSuccess){onSuccess=Ext.emptyFn
}if(!onFailure){onFailure=Ext.emptyFn
}if(!metadataStore){metadataStore=this.metadataStore
}if(!summaryStore){summaryStore=this.summaryStore
}if(updateStore){metadataStore.removeAll()
}if(typeof formOrParams==="object"){GeoNetwork.util.SearchTools.doQueryFromParams(formOrParams,this,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore)
}else{GeoNetwork.util.SearchTools.doQueryFromForm(formOrParams,this,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore)
}},kvpSearch:function(query,onSuccess,onFailure,startRecord,updateStore,metadataStore,summaryStore){if(updateStore!==false){updateStore=true
}if(!startRecord){startRecord=this.startRecord
}if(!onSuccess){onSuccess=Ext.emptyFn
}if(!onFailure){onFailure=Ext.emptyFn
}if(!metadataStore){metadataStore=this.metadataStore
}if(!summaryStore){summaryStore=this.summaryStore
}if(updateStore){metadataStore.removeAll()
}GeoNetwork.util.SearchTools.doQuery(query,this,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore)
},cswSearch:function(formId,onSuccess,onFailure,startRecord){this.metadataCSWStore.removeAll();
if(onSuccess){onSuccess=Ext.emptyFn
}if(onFailure){onFailure=Ext.emptyFn
}if(startRecord){startRecord=this.startRecord
}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(formId,this,startRecord,onSuccess,null,onFailure)
},metadataSelect:function(type,uuids){this.setSelectedRecords(0);
var app=this;
var i=0;
for(i=0;
i<uuids.length;
i++){OpenLayers.Request.GET({url:this.services.mdSelect,params:{id:uuids[i],selected:type},success:function(response){var nb=response.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;
if(nb){app.setSelectedRecords(nb)
}},failure:function(response){Ext.Msg.alert("Selection failed",response.responseText)
}})
}},metadataRate:function(uuid,rating,onSuccess){OpenLayers.Request.GET({url:this.services.rate,params:{uuid:uuid,rating:rating},success:function(response){var nb=response.responseXML.documentElement.childNodes[0].nodeValue;
if(onSuccess){onSuccess(nb)
}catalogue.onAfterRating();
return nb
},failure:function(response){Ext.Msg.alert("Rating failed",response.responseText)
}})
},metadataSelectAll:function(onSuccess){this.metadataSelection("add-all",onSuccess)
},metadataSelectNone:function(onSuccess){this.metadataSelection("remove-all",onSuccess)
},metadataSelection:function(type,onSuccess){var app=this;
OpenLayers.Request.GET({url:this.services.mdSelect,params:{selected:type},success:function(response){var nb=response.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;
if(nb){app.setSelectedRecords(nb)
}if(onSuccess){onSuccess()
}},failure:function(response){}})
},csvExport:function(){window.open(this.services.csv,this.windowName,this.windowOption)
},mefExport:function(){location.replace(this.services.mef)
},pdfExport:function(){location.replace(this.services.pdf)
},metadataShow:function(uuid,maximized,width,height){var url=this.services.mdView+"?uuid="+uuid;
if(this.resultsView){var win=new GeoNetwork.view.ViewWindow({serviceUrl:url,currTab:GeoNetwork.defaultViewMode||"simple",catalogue:this,maximized:maximized||false,metadataUuid:uuid,record:this.metadataStore.getAt(this.metadataStore.find("uuid",uuid)),resultsView:this.resultsView});
win.show(this.resultsView);
win.alignTo(Ext.getBody(),"r-r")
}else{window.open(this.services.mdShow+"?uuid="+uuid,this.windowName,this.windowOption)
}},metadataShowById:function(id,maximized,width,height){var url=this.services.mdView+"?id="+id;
if(this.resultsView){var win=new GeoNetwork.view.ViewWindow({serviceUrl:url,currTab:GeoNetwork.defaultViewMode||"simple",catalogue:this,maximized:maximized||false,resultsView:this.resultsView});
win.show(this.resultsView);
win.alignTo(Ext.getBody(),"r-r")
}},metadataXMLShow:function(uuid,schema){var service=this.services.mdXMLGet;
if(schema==="iso19139"){service=this.services.mdXMLGet19139
}else{if(schema==="dublin-core"){service=this.services.mdXMLGetDC
}else{if(schema==="fgdc"){service=this.services.mdXMLGetFGDC
}else{if(schema==="iso19115"){service=this.services.mdXMLGet19115
}}}}var url=service+"?uuid="+uuid;
window.open(url,this.windowName,this.windowOption)
},metadataPrint:function(uuid){var url=this.services.mdPrint+"?uuid="+uuid;
location.replace(url)
},metadataMEF:function(uuid){var url=this.services.mdMEF+"?version=2&uuid="+uuid;
location.replace(url)
},metadataEdit:function(id,create,group,child,isTemplate){switch(this.editMode){case this.EDITOR_MODE.IN_EDITOR_POPUP:if(this.metadataEditFn){this.metadataEditFn(id,create,group,child,isTemplate)
}break;
default:window.open(this.services.mdEdit+"?id="+id,this.windowName,this.windowOption)
}},metadataDuplicate:function(uuid){window.open(this.services.mdDuplicate+"?uuid="+uuid,this.windowName,this.windowOption)
},metadataCreateChild:function(uuid){window.open(this.services.mdDuplicate+"?child=y&uuid="+uuid,this.windowName,this.windowOption)
},metadataDuplicateWithSchema:function(uuid,schema){window.open(this.services.mdDuplicate+"?uuid="+uuid+"&schema="+schema,this.windowName,this.windowOption)
},metadataDelete:function(uuid){Ext.Msg.confirm(OpenLayers.i18n("deleteRecord"),OpenLayers.i18n("deleteConfirm"),this.metadataDeleteDo,uuid)
},metadataDeleteDo:function(btn){if(btn==="yes"){var params={uuid:this};
catalogue.doAction(catalogue.services.mdDelete,params,OpenLayers.i18n("deleteRecordSuccess"),OpenLayers.i18n("deleteRecordFailure"),catalogue.onAfterDelete.bind(catalogue))
}},doAction:function(url,params,msgSuccess,msgFailure,onSuccess,onFailure){if(url.indexOf("http")===-1){url=this.services.rootUrl+url
}OpenLayers.Request.GET({url:url,params:params,success:function(response){if(msgSuccess){Ext.Msg.alert(msgSuccess,response.responseText)
}if(onSuccess){onSuccess(response)
}},failure:function(response){if(msgFailure){Ext.Msg.alert(msgFailure,response.responseText)
}if(onFailure){onFailure(response)
}}})
},isLoggedIn:function(){var response=OpenLayers.Request.GET({url:this.services.admin,async:false}),exception;
exception=response.responseText.indexOf("Exception")!==-1;
if(response.status===200&&!exception){this.identifiedUser={firstName:"TODO",surName:"TODO",role:"admin"};
this.onAfterLogin();
return true
}else{if(response.status===404){this.showError(OpenLayers.i18n("connectIssue"),OpenLayers.i18n("connectIssueMsg")+this.services.rootUrl+".")
}else{if(exception){this.checkError()
}else{return false
}}}},login:function(username,password){var app=this,user;
OpenLayers.Request.GET({url:this.services.login,params:{username:username,password:password,info:"true"},success:function(response){user=response.responseXML.getElementsByTagName("record")[0];
app.identifiedUser={username:user?user.getElementsByTagName("username")[0].firstChild.nodeValue:"-",name:user?user.getElementsByTagName("name")[0].firstChild.nodeValue:"-",surname:user?user.getElementsByTagName("surname")[0].firstChild.nodeValue:"-",role:user?user.getElementsByTagName("profile")[0].firstChild.nodeValue:"guest"};
app.onAfterLogin()
},failure:function(response){app.identifiedUser=undefined;
app.onAfterBadLogin()
}})
},logout:function(){var app=this;
OpenLayers.Request.GET({url:this.services.logout,success:function(response){app.identifiedUser=undefined;
app.onAfterLogout()
},failure:function(response){app.identifiedUser=undefined;
app.onAfterBadLogout()
}})
},checkError:function(successCb){var app=this,error,msg;
OpenLayers.Request.GET({url:this.services.xmlError,success:function(response){error=app.parseError(response.responseXML);
msg=error.info+" "+error.exc+"<br/>"+error.stack;
app.showError("Catalogue error",msg);
if(successCb){successCb(app,response)
}},failure:function(response){app.showError("Catalogue error",response.status)
}})
},showError:function(title,msg){Ext.MessageBox.show({title:title,msg:msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})
},parseError:function(xml){var error=xml.getElementsByTagName("error")[0];
return{stack:error.getElementsByTagName("Stack")[0].firstChild.nodeValue,exc:error.getElementsByTagName("Exception")[0].firstChild.nodeValue,resource:error.getElementsByTagName("Resource")[0].firstChild.nodeValue,msg:error.getElementsByTagName("Message")[0].firstChild.nodeValue,provider:error.getElementsByTagName("Provider")[0].firstChild.nodeValue,info:error.getElementsByTagName("Error")[0].firstChild.nodeValue}
},admin:function(){location.replace(this.adminAppUrl)
},metadataImport:function(){location.replace(this.services.mdImport)
},massiveOp:function(type){var url=this.services.massiveOp[type];
this.modalAction(OpenLayers.i18n("massiveOp")+" - "+type,url)
},modalAction:function(title,url,cb){if(url){var win=new Ext.Window({id:"modalWindow",layout:"fit",width:700,height:400,closeAction:"destroy",plain:true,modal:true,draggable:false,title:title,items:new Ext.Panel({autoLoad:{url:url,callback:cb,scope:win},border:false,frame:false})});
win.show(this);
win.alignTo(Ext.getBody(),"t-t")
}},metadataAdmin:function(id){var url=this.services.mdAdmin+"?id="+id;
this.modalAction(OpenLayers.i18n("setPrivileges"),url)
},metadataCategory:function(id){var url=this.services.mdCategory+"?id="+id;
this.modalAction(OpenLayers.i18n("setCategories"),url)
},metadataPrepareDownload:function(id){var url=this.services.prepareDownload+"?id="+id;
this.modalAction(OpenLayers.i18n("prepareDownload"),url)
}});
Ext.reg("gn_catalogue",GeoNetwork.Catalogue);Ext.namespace("GeoNetwork.util");
GeoNetwork.util.SearchTools={fast:"false",output:"full",sortBy:"relevance",hitsPerPage:"50",doQuery:function(query,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore){OpenLayers.Request.GET({url:cat.services.xmlSearch+"?"+query,success:function(result){if(updateStore){var getRecordsFormat=new OpenLayers.Format.GeoNetworkRecords();
var currentRecords=getRecordsFormat.read(result.responseText);
var values=currentRecords.records;
if(values.length>0){metadataStore.loadData(currentRecords)
}var summary=currentRecords.summary;
if(summary&&summary.count>0&&summaryStore){summaryStore.loadData(summary)
}if(cat){cat.updateStatus(currentRecords.from+"-"+currentRecords.to+OpenLayers.i18n("resultBy")+summary.count)
}}if(onSuccess){onSuccess(result,query)
}},failure:function(response){if(onFailure){onFailure(response)
}}})
},doQueryFromForm:function(formId,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore){var query=GeoNetwork.util.SearchTools.buildQueryFromForm(Ext.getCmp(formId),startRecord,GeoNetwork.util.SearchTools.sortBy,metadataStore.fast);
GeoNetwork.util.SearchTools.doQuery(query,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore)
},doQueryFromParams:function(params,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore){var filters=[],query;
GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(params,filters,startRecord);
query=GeoNetwork.util.SearchTools.buildQueryGET(filters,startRecord,GeoNetwork.util.SearchTools.sortBy,metadataStore.fast);
GeoNetwork.util.SearchTools.doQuery(query,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore)
},buildQueryFromForm:function(form,startRecord,sortBy,fast){var values=GeoNetwork.util.SearchTools.getFormValues(form);
var filters=[];
GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(values,filters,startRecord);
return GeoNetwork.util.SearchTools.buildQueryGET(filters,startRecord,sortBy,fast)
},populateFormFromParams:function(form,map){form.cascade(function(cur){if(cur.getName){var name=cur.getName();
if(name.indexOf("_")!==-1){name=name.substring(2);
if(map[name]){cur.setValue(map[name])
}}else{if(map[name]){cur.setValue(map[name])
}}}})
},addFiltersFromPropertyMap:function(values,filters,startRecord){var defaultSimilarity=".8",key,similarity=values.E_similarity,hits=values.E_hitsperpage;
if(similarity!==undefined){defaultSimilarity=values.E_similarity;
GeoNetwork.util.SearchTools.addFilter(filters,"E_similarity",defaultSimilarity)
}if(!hits){hits=GeoNetwork.util.SearchTools.hitsPerPage
}var to=parseInt(startRecord,10)+parseInt(hits,10)-1;
GeoNetwork.util.SearchTools.addFilter(filters,"E_from",startRecord);
GeoNetwork.util.SearchTools.addFilter(filters,"E_to",to);
for(key in values){if(values.hasOwnProperty(key)){var value=values[key];
if(value!==""&&key!=="E_similarity"){GeoNetwork.util.SearchTools.addFilter(filters,key,value)
}}}},addFilter:function(filters,key,value){var field=key.match("^(\\[?)([^_]+)_(.*)$"),i,or=[];
if(field){if(field[1]==="["){var values=value.split(",");
for(i=0;
i<values.length;
++i){GeoNetwork.util.SearchTools.addFilterImpl(values.length>1?or:filters,field[2],field[3],values[i])
}}else{GeoNetwork.util.SearchTools.addFilterImpl(filters,field[2],field[3],value)
}}},addFilterImpl:function(filters,type,name,value){if(type.charAt(0)==="E"){filters.push(name+"="+escape(value)+"")
}else{if(type==="B"){filters.push(name+"="+(value?"on":"off")+"")
}else{alert("Cannot parse "+type)
}}},sortByMappings:{relevance:{name:"relevance",order:""},rating:{name:"changeDate",order:""},popularity:{name:"popularity",order:""},date:{name:"date",order:""},title:{name:"title",order:"reverse"}},buildQueryGET:function(filter,startRecord,sortBy,fast){var query="fast="+(fast?fast:GeoNetwork.util.SearchTools.fast)+"&";
if(filter){query+=filter.join("&")
}return query
},getFormValues:function(form){var result=form.getForm().getValues()||{};
form.cascade(function(cur){if(cur.disabled!==true&&cur.rendered){if(cur.isXType("boxselect")){if(cur.getValue&&cur.getValue()){result[cur.getName()]=cur.getValue()
}}else{if(cur.isXType("combo")){if(cur.getValue&&cur.getValue()){result[cur.getName()]=cur.getValue()
}}else{if(cur.isXType("fieldset")){if(cur.checkbox){result[cur.checkboxName]=!cur.collapsed
}}else{if(cur.isXType("radiogroup")){var first=cur.items.get(0);
result[first.getName()]=first.getGroupValue()
}else{if(cur.isXType("checkbox")){result[cur.getName()]=cur.getValue()
}else{if(cur.isXType("datefield")){if(cur.getValue()!==""){result[cur.getName()]=cur.getValue().format("Y-m-d")+(cur.postfix?cur.postfix:"")
}}else{if(cur.getName){if(cur.getValue&&cur.getValue()!==""){result[cur.getName()]=cur.getValue()
}}}}}}}}}return true
});
return result
}};var translations={};
function translate(text){return translations[text]||text
}function checkAllInputsIn(id,checked){var list=Ext.getDom(id).getElementsByTagName("input"),i;
for(i=0;
i<list.length;
i++){list[i].checked=checked
}}function setAll(id){checkAllInputsIn(id,true)
}function clearAll(id){checkAllInputsIn(id,false)
}function checkBoxModalUpdate(div,service,modalbox,title){var boxes=Ext.DomQuery.select('input[type="checkbox"]');
var pars="?";
if(service==="metadata.admin"||service==="metadata.category"){pars+="id="+Ext.getDom("metadataid").value
}Ext.each(boxes,function(s){if(s.checked&&s.name!=""){pars+="&"+s.name+"=on"
}});
catalogue.doAction(service+pars,null,null,title,function(response){Ext.getDom(div).innerHTML=response.responseText;
if(service==="metadata.admin"||service==="metadata.category"){Ext.getCmp("modalWindow").close()
}},null)
}function addGroups(xmlRes){var list=xmlRes.getElementsByTagName("group"),i;
Ext.getDom("group").options.length=0;
for(i=0;
i<list.length;
i++){var id=list[i].getElementsByTagName("id")[0].firstChild.nodeValue;
var name=list[i].getElementsByTagName("name")[0].firstChild.nodeValue;
var opt=document.createElement("option");
opt.text=name;
opt.value=id;
if(list.length===1){opt.selected=true
}Ext.getDom("group").options.add(opt)
}}function doGroups(userid){catalogue.doAction("xml.usergroups.list?id="+userid,null,null,"Error retrieving groups",function(xmlRes){if(xmlRes.nodeName==="error"){Ext.getDom("group").options.length=0;
Ext.getDom("group").value="";
var user=Ext.getDom("user");
for(i=0;
i<user.options.length;
i++){user.options[i].selected=false
}}else{addGroups(xmlRes.responseXML)
}})
}function checkMassiveNewOwner(action,title){var user=Ext.getDom("user").value;
var group=Ext.getDom("group").value;
if(user===""){Ext.Msg.alert(title,"selectNewOwner");
return false
}if(group.value===""){Ext.Msg.alert(title,"selectOwnerGroup");
return false
}catalogue.doAction(action+"?user="+user+"&group="+group,null,null,null,function(response){Ext.getDom("massivenewowner").parentNode.innerHTML=response.responseText
})
}function doDownload(id,all){var list=Ext.getDom("downloadlist").getElementsByTagName("INPUT"),pars="&id="+id+"&access=private",selected=false;
for(var i=0;
i<list.length;
i++){if(list[i].checked||all!==null){selected=true;
var name=list[i].getAttribute("name");
pars+="&fname="+name
}}if(!selected){Ext.Msg.alert("Alert",OpenLayers.i18n("selectOneFile"));
return
}catalogue.doAction(catalogue.services.fileDisclaimer+"?"+pars,null,null,null,function(response){Ext.getDom("downloadlist").parentNode.innerHTML=response.responseText
})
}function feedbackSubmit(){var f=Ext.getDom("feedbackf");
catalogue.doAction(catalogue.services.fileDownload+"?"+Ext.Ajax.serializeForm(f),null,null,null,function(response){Ext.getDom("feedbackf").parentNode.innerHTML=response.responseText
})
}function goSubmit(form_name){document.forms[form_name].submit()
};Ext.namespace("GeoNetwork.util");
GeoNetwork.util.SearchFormTools={getSimpleFormFields:function(services,layers,mapOptions,withTypes,activeMapControlExtent,typeCodelist){var fields=[];
if(services){fields.push(new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:services.opensearchSuggest}))
}else{fields.push(GeoNetwork.util.SearchFormTools.getFullTextField())
}if(withTypes){fields.push(GeoNetwork.util.SearchFormTools.getTypesField(typeCodelist))
}if(layers){fields.push(GeoNetwork.util.SearchFormTools.getSimpleMap(layers,mapOptions,activeMapControlExtent))
}fields.push(GeoNetwork.util.SearchFormTools.getOptions());
return fields
},getAdvancedFormFields:function(services,layers,mapOptions){var fields=[],fullTextField,themekeyField,orgNameField;
if(services){fullTextField=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:services.opensearchSuggest});
orgNameField=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:services.opensearchSuggest,field:"orgName",name:"E_orgName",fieldLabel:OpenLayers.i18n("org")});
themekeyField=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:services.opensearchSuggest,field:"keyword",name:"E_themekey",fieldLabel:OpenLayers.i18n("keyword")})
}else{fullTextField=GeoNetwork.util.SearchFormTools.getFullTextField();
themekeyField=GeoNetwork.util.SearchFormTools.getKeywordsField();
orgNameField=GeoNetwork.util.SearchFormTools.getOrgNameField()
}var advancedTextField=GeoNetwork.util.SearchFormTools.getAdvancedTextFields();
var titleField=GeoNetwork.util.SearchFormTools.getTitleField();
var abstractField=GeoNetwork.util.SearchFormTools.getAbstractField();
var types=GeoNetwork.util.SearchFormTools.getTypesField();
var mapTypes={xtype:"fieldset",title:OpenLayers.i18n("mapTypes"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"checkbox",defaults:{width:160},items:GeoNetwork.util.SearchFormTools.getMapTypesField()};
var accuracySettings={xtype:"fieldset",title:OpenLayers.i18n("similarity"),autoHeight:true,autoWidth:true,layout:"column",collapsible:true,collapsed:true,items:[GeoNetwork.util.SearchFormTools.getSimilarityField()]};
var geomField=new Ext.form.TextField({name:"E_geometry",id:"geometry",fieldLabel:OpenLayers.i18n("wkt"),hideLabel:false});
var mapLayers=[],i;
for(i=0;
i<layers.length;
i++){mapLayers.push(layers[i].clone())
}var geomWithMapField={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",layers:mapLayers,mapOptions:mapOptions};
var nearYouButton=GeoNetwork.util.SearchFormTools.getNearYouButton("geometry");
var geoRelationField=GeoNetwork.util.SearchFormTools.getRelationField();
var denominatorField=GeoNetwork.util.SearchFormTools.getScaleDenominatorField(true);
var geoFields=new Ext.form.FieldSet({title:OpenLayers.i18n("spatialSearch"),autoWidth:true,collapsible:true,collapsed:true,items:[geomField,nearYouButton,geomWithMapField,geoRelationField]});
var when=new Ext.form.FieldSet({title:OpenLayers.i18n("when"),autoWidth:true,defaultType:"datefield",collapsible:true,collapsed:true,items:GeoNetwork.util.SearchFormTools.getWhen()});
var catalogueField=GeoNetwork.util.SearchFormTools.getCatalogueField(services.getSources,services.logoUrl);
var groupField=GeoNetwork.util.SearchFormTools.getGroupField(services.getGroups);
var metadataTypeField=GeoNetwork.util.SearchFormTools.getMetadataTypeField();
var categoryField=GeoNetwork.util.SearchFormTools.getCategoryField(services.getCategories);
var options=GeoNetwork.util.SearchFormTools.getOptions();
fields.push(fullTextField,advancedTextField,titleField,abstractField,themekeyField,orgNameField,geoFields,types,mapTypes,denominatorField,when,catalogueField,groupField,metadataTypeField,categoryField,options,accuracySettings);
return fields
},getSimpleMap:function(layers,mapOptions,activeMapControlExtent){var fields=[],mapLayers=[],i;
var geomField=new Ext.form.TextField({name:"E_geometry",id:"geometry",inputType:"hidden"});
for(i=0;
i<layers.length;
i++){mapLayers.push(layers[i].clone())
}var geomWithMapField={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",width:290,layers:mapLayers,mapOptions:mapOptions,activated:activeMapControlExtent};
fields.push(geomField,geomWithMapField);
return fields
},getOptions:function(hitsPerPageOptions){var hitsPerPage=hitsPerPageOptions||[["10"],["20"],["50"],["100"]];
var sortByFields=GeoNetwork.util.SearchFormTools.getSortByCombo();
var hitsPerPageField=new Ext.form.ComboBox({id:"E_hitsperpage",name:"E_hitsperpage",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("hitsPerPage"),value:hitsPerPage[1],store:new Ext.data.ArrayStore({id:0,fields:["id"],data:hitsPerPage}),valueField:"id",displayField:"id"});
var options=new Ext.form.FieldSet({title:"Options",autoWidth:true,collapsible:true,collapsed:true,defaults:{width:160},items:[sortByFields,hitsPerPageField]});
return options
},getSortByCombo:function(){var sortByField=new Ext.form.TextField({name:"E_sortBy",id:"E_sortBy",inputType:"hidden"});
var sortOrderField=new Ext.form.TextField({name:"E_sortOrder",id:"sortOrder",inputType:"hidden"});
var combo=new Ext.form.ComboBox({mode:"local",fieldLabel:OpenLayers.i18n("sortBy"),triggerAction:"all",value:"relevance",store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{change:function(cb,newValue,oldValue){var tokens=newValue.split("#");
sortByField.setValue(tokens[0]);
sortOrderField.setValue(tokens[1])
}}});
return[sortByField,sortOrderField,combo]
},getSortByStore:function(){return new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["relevance#",OpenLayers.i18n("relevance")],["title#reverse",OpenLayers.i18n("title")],["changeDate#",OpenLayers.i18n("changeDate")],["rating#",OpenLayers.i18n("rating")],["popularity#",OpenLayers.i18n("popularity")],["denominator#",OpenLayers.i18n("scaleDesc")],["denominator#revers",OpenLayers.i18n("scaleAsc")]]})
},getFullTextField:function(){return new Ext.form.TextField({name:"E_any",id:"E_any",fieldLabel:OpenLayers.i18n("fullTextSearch"),hideLabel:false})
},getTitleField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_title",OpenLayers.i18n("title"))
},getAbstractField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_abstract",OpenLayers.i18n("abstract"))
},getKeywordsField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_themekey",OpenLayers.i18n("keyword"))
},getOrgNameField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_orgName",OpenLayers.i18n("org"))
},getTextField:function(name,fieldLabel){return new Ext.form.TextField({name:name,fieldLabel:fieldLabel,hideLabel:false})
},getCatalogueField:function(url,logoUrl){var catStore=GeoNetwork.data.CatalogueSourceStore(url);
catStore.load();
return new Ext.form.ComboBox({name:"E_siteId",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("catalogue"),store:catStore,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item logo"><img src="'+logoUrl+'{id}.gif"/>{name}</div></tpl>'})
},getGroupField:function(url){var groupStore=GeoNetwork.data.GroupStore(url);
groupStore.load();
return new Ext.form.ComboBox({name:"E_group",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:groupStore,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>"})
},getMetadataTypeField:function(){return new Ext.form.ComboBox({name:"E_template",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("kind"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["n",OpenLayers.i18n("md")],["y",OpenLayers.i18n("tpl")]]}),valueField:"id",displayField:"name"})
},getCategoryField:function(url,imgUrl){var store=GeoNetwork.data.CategoryStore(url);
store.load();
return new Ext.form.ComboBox({name:"E_category",mode:"local",fieldLabel:OpenLayers.i18n("category"),triggerAction:"all",store:store,valueField:"name",displayField:"name",tpl:(imgUrl?'<tpl for="."><div class="x-combo-list-item"><img src="'+imgUrl+'{name}.png"/>{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>":'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>")})
},getAdvancedTextFields:function(){return{xtype:"fieldset",title:OpenLayers.i18n("advTextSearch"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"textfield",items:[{name:"E_or",fieldLabel:OpenLayers.i18n("eitherWords"),hideLabel:false},{name:"E_phrase",fieldLabel:OpenLayers.i18n("exactPhrase"),hideLabel:false},{name:"E_all",fieldLabel:OpenLayers.i18n("allWords"),hideLabel:false},{name:"E_without",fieldLabel:OpenLayers.i18n("withoutWords"),hideLabel:false}]}
},getSimilarityField:function(){return{xtype:"radiogroup",items:[{xtype:"label",text:OpenLayers.i18n("precise")},{name:"E_similarity",inputValue:1},{name:"E_similarity",inputValue:0.8,checked:true},{name:"E_similarity",inputValue:0.6},{name:"E_similarity",inputValue:0.4},{name:"E_similarity",inputValue:0.2},{xtype:"label",text:OpenLayers.i18n("imprecise")}]}
},getRelationField:function(){return new Ext.form.ComboBox({name:"E_relation",mode:"local",width:150,triggerAction:"all",fieldLabel:OpenLayers.i18n("relationType"),store:new Ext.data.ArrayStore({id:0,fields:["relation","label"],data:[["",""],["intersection",OpenLayers.i18n("intersection")],["overlaps",OpenLayers.i18n("overlaps")],["encloses",OpenLayers.i18n("encloses")],["fullyOutsideOf",OpenLayers.i18n("fullyOutsideOf")],["crosses",OpenLayers.i18n("crosses")],["touches",OpenLayers.i18n("touches")],["within",OpenLayers.i18n("within")]]}),valueField:"relation",displayField:"label"})
},getNearYouButton:function(geomFieldId){return new Ext.Button({text:OpenLayers.i18n("nearYou"),iconCls:"md-mn mn-user-location",iconAlign:"right",listeners:{click:function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){Ext.getCmp(geomFieldId).setValue("POINT("+position.coords.latitude+" "+position.coords.longitude+")")
})
}}}})
},registerDateVtype:function(){if(Ext.form.VTypes.daterange){return
}Ext.apply(Ext.form.VTypes,{daterange:function(val,field){var date=field.parseDate(val);
if(!date){return false
}if(field.startDateField&&(!this.dateRangeMax||(date.getTime()!==this.dateRangeMax.getTime()))){var start=Ext.getCmp(field.startDateField);
start.setMaxValue(date);
start.validate();
this.dateRangeMax=date
}else{if(field.endDateField&&(!this.dateRangeMin||(date.getTime()!==this.dateRangeMin.getTime()))){var end=Ext.getCmp(field.endDateField);
end.setMinValue(date);
end.validate();
this.dateRangeMin=date
}}return true
}})
},getWhen:function(){var anyTime=new Ext.form.Checkbox({name:"timeType",checked:true,fieldLabel:OpenLayers.i18n("anyTime"),handler:function(ck,checked){ck.ownerCt.items.each(function(item,index,length){if(checked&&item.getXType()==="datefield"){item.setValue("")
}})
}});
var items=[anyTime,{xtype:"label",text:OpenLayers.i18n("mdChangeDate")}];
items.push(GeoNetwork.util.SearchFormTools.getMetadataDateField(anyTime));
items.push({xtype:"label",text:OpenLayers.i18n("tempExtent")});
items.push(GeoNetwork.util.SearchFormTools.getTemporalExtentField(anyTime));
return items
},getMetadataDateField:function(anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_dateFrom","from","dateFrom","E_dateTo","to","dateTo",anyTime)
},getTemporalExtentField:function(anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_extFrom","from","extFrom","E_extTo","to","extTo",anyTime)
},getDateRangeFields:function(nameFrom,labelFrom,idFrom,nameTo,labelTo,idTo,anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
var changeCb=function(field,newValue,oldValue){if(this&&newValue!==""){this.setValue(false)
}};
return[{fieldLabel:OpenLayers.i18n(labelFrom),name:nameFrom,id:idFrom,width:120,vtype:"daterange",endDateField:idTo,format:"d/m/Y",listeners:{change:changeCb,scope:anyTime}},{fieldLabel:OpenLayers.i18n(labelTo),name:nameTo,id:idTo,width:120,vtype:"daterange",startDateField:idFrom,format:"d/m/Y",listeners:{change:changeCb,scope:anyTime}}]
},getScaleDenominatorField:function(disabled,min,max,increment,width){min=min||1000;
max=max||1000000;
increment=increment||1000;
width=width||230;
var tip=new Ext.slider.Tip({getText:function(thumb){return String.format("<b>"+OpenLayers.i18n("scaleNominator")+"{0}</b>",thumb.value)
}});
var denominatorFrom=new Ext.form.Field({name:"E_denominatorFrom",value:"",hidden:true});
var denominatorTo=new Ext.form.Field({name:"E_denominatorTo",value:"",hidden:true});
var slider=new Ext.slider.MultiSlider({disabled:disabled?true:false,width:width,minValue:min,maxValue:max,increment:increment,values:[min,max],formFields:[denominatorFrom,denominatorTo],plugins:tip,listeners:{change:function(sliders,newValue,thumb){sliders.formFields[thumb.index].setValue(newValue)
}}});
var scaleCk=new Ext.form.Checkbox({fieldLabel:OpenLayers.i18n("scale"),value:disabled?true:false,handler:function(ch,checked){slider.setDisabled(!checked);
if(!checked){denominatorFrom.setValue("");
denominatorTo.setValue("")
}}});
return[denominatorFrom,denominatorTo,scaleCk,slider]
},getMapTypesField:function(){var spatialTypes=GeoNetwork.util.SearchFormTools.getSpatialRepresentationTypeField();
return[{hideLabel:true,boxLabel:OpenLayers.i18n("digital"),name:"B_digital"},{hideLabel:true,boxLabel:OpenLayers.i18n("hardCopy"),name:"B_paper"},{hideLabel:true,boxLabel:OpenLayers.i18n("downloadable"),name:"B_download"},{hideLabel:true,boxLabel:OpenLayers.i18n("interactive"),name:"B_dynamic"},spatialTypes]
},getValidField:function(){var metadataType=new Ext.form.ComboBox({name:"E__valid",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("validationStatus"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["1",OpenLayers.i18n("valid")],["0",OpenLayers.i18n("notValid")],["-1",OpenLayers.i18n("notDetermined")]]}),valueField:"id",displayField:"name"});
return metadataType
},getTypesField:function(codeList){var defaultCodeList=[["dataset",OpenLayers.i18n("dataset")],["series",OpenLayers.i18n("series")],["service",OpenLayers.i18n("service")]];
var metadataType=new Ext.form.ComboBox({name:"E_type",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("resourceType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:codeList||defaultCodeList}),valueField:"id",displayField:"name"});
return metadataType
},getSpatialRepresentationTypeField:function(codeList){var defaultCodeList=[["grid",OpenLayers.i18n("grid")],["stereoModel",OpenLayers.i18n("stereoModel")],["tin",OpenLayers.i18n("tin")],["textTabled",OpenLayers.i18n("textTable")],["vector",OpenLayers.i18n("vector")],["video",OpenLayers.i18n("video")]];
var spatialRepresentationType=new Ext.form.ComboBox({name:"E_spatialRepresentationType",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("spatialRepType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:codeList||defaultCodeList}),valueField:"id",displayField:"name"});
return spatialRepresentationType
}};Ext.namespace("GeoNetwork.util");
GeoNetwork.util.CSWSearchTools={cswMethod:"POST",resultsMode:"results_with_summary",sortBy:"",maxRecords:"50",doCSWQueryFromForm:function(formId,cat,recordNum,onSuccess,onFailure,addFilters){var url=cat.services.csw;
var query=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm(GeoNetwork.util.CSWSearchTools.cswMethod,Ext.getCmp(formId),recordNum,GeoNetwork.util.CSWSearchTools.sortBy,addFilters);
if(GeoNetwork.util.CSWSearchTools.cswMethod==="POST"){var getQuery=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm("GET",Ext.getCmp(formId),recordNum,GeoNetwork.util.CSWSearchTools.sortBy,addFilters);
OpenLayers.Request.POST({url:url,data:query,success:function(result){var getRecordsFormat=new OpenLayers.Format.CSWGetRecords.v2_0_2();
cat.currentRecords=getRecordsFormat.read(result.responseText);
var values=cat.currentRecords.records;
if(values.length>0){cat.metadataCSWStore.loadData(cat.currentRecords)
}if(onSuccess){onSuccess(result,getQuery)
}},failure:onFailure})
}else{OpenLayers.Request.GET({url:url,params:query,success:function(result){onSuccess(result,query)
},failure:onFailure})
}},buildCSWQueryFromForm:function(method,form,startRecord,sortBy,addFilters){var values=GeoNetwork.util.CSWSearchTools.getFormValues(form);
var filters=[];
GeoNetwork.util.CSWSearchTools.addFiltersFromPropertyMap(values,filters);
addFilters(values,filters);
if(filters.length===0){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:"anyText",value:".*"}))
}var and=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:filters});
if(method==="POST"){return GeoNetwork.util.CSWSearchTools.buildCSWQueryPOST(and,startRecord,sortBy)
}else{return GeoNetwork.util.CSWSearchTools.buildCSWQueryGET(and,startRecord,sortBy)
}},addFiltersFromPropertyMap:function(values,filters){var defaultSimilarity=".8",similarity=values.E_similarity,key;
if(similarity!==null&&similarity!==undefined){defaultSimilarity=values.E_similarity;
GeoNetwork.util.CSWSearchTools.addFilter(filters,"E_similarity",defaultSimilarity,defaultSimilarity)
}for(key in values){if(values.hasOwnProperty(key)){var value=values[key];
if(value!==""&&key!=="E_similarity"){GeoNetwork.util.CSWSearchTools.addFilter(filters,key,value,defaultSimilarity)
}}}},addFilter:function(filters,key,value,defaultSimilarity){var field=key.match("^(\\[?)([^_]+)_(.*)$"),or=[],i;
if(field){if(field[1]==="["){var values=value.split(",");
for(i=0;
i<values.length;
++i){GeoNetwork.util.CSWSearchTools.addFilterImpl(values.length>1?or:filters,field[2],field[3],values[i],defaultSimilarity)
}if(values.length>1){filters.push(new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:or}))
}}else{GeoNetwork.util.CSWSearchTools.addFilterImpl(filters,field[2],field[3],value,defaultSimilarity)
}}},addFilterImpl:function(filters,type,name,value,defaultSimilarity){var i;
if(type==="S"){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:name,value:value+".*"}))
}else{if(type==="C"){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:name,value:".*"+value+".*"}))
}else{if(type.charAt(0)==="E"){if(type.length>1){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:type.substring(1)}))
}filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:name,value:value}));
if(type.length>1){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:defaultSimilarity}))
}}else{if(type===">="){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:name,value:value}))
}else{if(type==="<="){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:name,value:value}))
}else{if(type==="T"){var splitted=value.split(" ");
for(i=0;
i<splitted.length;
++i){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:name,value:splitted[i]}))
}}else{if(type==="B"){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:name,value:value?1:0}))
}else{if(type==="V"){var subField=value.match("^([^/]+)/(.*)$");
filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:"1.0"}));
filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:subField[1],value:subField[2]}));
filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:defaultSimilarity}))
}else{alert("Cannot parse "+type)
}}}}}}}}},sortByMappings:{relevance:{name:"relevance",order:"D"},rating:{name:"rating",order:"D"},popularity:{name:"popularity",order:"D"},date:{name:"date",order:"D"},title:{name:"title",order:"A"}},buildCSWQueryPOST:function(filter,startRecord,sortBy){var result='<?xml version="1.0" encoding="UTF-8"?>\n<csw:GetRecords xmlns:csw="http://www.opengis.net/cat/csw/2.0.2" service="CSW" version="2.0.2" resultType="'+this.resultsMode+'" startPosition="'+startRecord+'" maxRecords="'+this.maxRecords+'">\n  <csw:Query typeNames="csw:Record">\n    <csw:ElementSetName>full</csw:ElementSetName>\n';
if(sortBy){var searchInfo=GeoNetwork.util.CSWSearchTools.sortByMappings[sortBy];
result+='    <ogc:SortBy xmlns:ogc="http://www.opengis.net/ogc">\n      <ogc:SortProperty>\n        <ogc:PropertyName>'+searchInfo.name+"</ogc:PropertyName>\n        <ogc:SortOrder>"+searchInfo.order+"</ogc:SortOrder>\n      </ogc:SortProperty>\n    </ogc:SortBy>\n"
}if(filter){var filterXML=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(filter));
filterXML=filterXML.replace(/^<\?xml[^?]*\?>/,"");
result+='    <csw:Constraint version="1.0.0">\n';
result+=filterXML;
result+="    </csw:Constraint>\n"
}result+="  </csw:Query>\n</csw:GetRecords>";
return result
},buildCSWQueryGET:function(filter,startRecord,sortBy){var result={request:"GetRecords",service:"CSW",version:"2.0.2",resultType:this.resultsMode,namespace:"csw:http://www.opengis.net/cat/csw/2.0.2",typeNames:"csw:Record",constraintLanguage:"FILTER",constraint_language_version:"1.1.0",elementSetName:"full",startPosition:startRecord,maxRecords:this.maxRecords};
if(sortBy){var searchInfo=GeoNetwork.util.CSWSearchTools.sortByMappings[sortBy];
result.sortBy=searchInfo.name+":"+searchInfo.order
}if(filter){var filterXML=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(filter));
filterXML=filterXML.replace(/^<\?xml[^?]*\?>/,"");
result.constraint=filterXML
}return result
},getFormValues:function(form){var result=form.getForm().getValues()||{};
form.cascade(function(cur){if(cur.disabled!==true){if(cur.isXType("boxselect")){if(cur.getValue&&cur.getValue()){result[cur.getName()]=cur.getValue()
}}else{if(cur.isXType("combo")){if(cur.getValue&&cur.getValue()){result[cur.getName()]=cur.getValue()
}}else{if(cur.isXType("fieldset")){if(cur.checkbox){result[cur.checkboxName]=!cur.collapsed
}}else{if(cur.isXType("radiogroup")){var first=cur.items.get(0);
result[first.getName()]=first.getGroupValue()
}else{if(cur.isXType("checkbox")){result[cur.getName()]=cur.getValue()
}else{if(cur.isXType("datefield")){if(cur.getValue()!==""){result[cur.getName()]=cur.getValue().format("Y-m-d")+(cur.postfix?cur.postfix:"")
}}else{if(cur.getName){if(cur.getValue&&cur.getValue()!==""){result[cur.getName()]=cur.getValue()
}}}}}}}}}return true
});
return result
}};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.CatalogueSourceStore=function(url){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"source",idPath:"id",fields:[{name:"id",mapping:"uuid"},{name:"name"}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.CategoryStore=function(url){function getLabel(v,record){var labels={};
var label=record.getElementsByTagName("label");
var i;
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType===1){labels[child.nodeName]=child.firstChild.nodeValue
}}}return labels
}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"category",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"label",convert:getLabel}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.CodeListStore=function(config){var schema=config.schema||"iso19139";
var requestBody='<request><codelist schema="'+schema+'" name="'+config.codeListName+'" /></request>';
var model=[{name:"code"},{name:"label"},{name:"description"}];
var DataRecord=Ext.data.Record.create(model);
var store=new Ext.data.Store({fields:model});
OpenLayers.Request.POST({url:config.url,data:requestBody,success:function(response){var help=response.responseXML.getElementsByTagName("entry");
for(var i=0;
i<help.length;
i++){var record=new DataRecord({code:help[i].getElementsByTagName("code")[0].firstChild.nodeValue,label:help[i].getElementsByTagName("label")[0].firstChild.nodeValue,description:help[i].getElementsByTagName("description")[0].firstChild.nodeValue});
store.add(record)
}}});
return store
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.GroupStore=function(url){function getLabel(v,record){var labels={};
var i;
var label=record.getElementsByTagName("label");
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType===1){labels[child.nodeName]=child.firstChild.nodeValue
}}}return labels
}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"group",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"description"},{name:"email"},{name:"referrer"},{name:"label",convert:getLabel}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.HarvesterStore=function(url){function getCategories(v,record){var categories=[];
var i;
var catNode=record.getElementsByTagName("categories");
if(catNode.length===1){var cats=catNode[0].getElementsByTagName("category");
for(i=0;
i<cats.length;
i++){categories.push(cats[i].getAttribute("id"))
}}return categories
}function getOperation(v,record){var operation=[];
var i;
var ops=record.getElementsByTagName("operation");
for(i=0;
i<ops.length;
i++){var op=ops[i];
operation.push(op.getAttribute("name"))
}return operation
}function getPrivileges(v,record){var Privilege=Ext.data.Record.create([{name:"group_id",mapping:"@id"},{name:"operation",convert:getOperation}]);
var pReader=new Ext.data.XmlReader({record:"group"},Privilege);
var r=pReader.readRecords(record);
return r
}return new Ext.data.XmlStore({autoDestroy:true,url:url,record:"node",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"type",mapping:"@type"},{name:"site_name",mapping:"site/name"},{name:"site_uuid",mapping:"site/uuid"},{name:"site_host",mapping:"site/host"},{name:"site_servlet",mapping:"site/servlet"},{name:"site_port",mapping:"site/port"},{name:"site_url",mapping:"site/url"},{name:"site_icon",mapping:"site/icon"},{name:"site_ogctype",mapping:"site/ogctype"},{name:"options_lang",mapping:"options/lang"},{name:"options_topic",mapping:"options/topic"},{name:"options_createthumbnails",mapping:"options/createthumbnails"},{name:"options_uselayer",mapping:"options/uselayer"},{name:"options_uselayermd",mapping:"options/uselayermd"},{name:"options_datasetcategory",mapping:"options/datasetcategory"},{name:"privileges",convert:getPrivileges},{name:"categories",convert:getCategories},{name:"site_account_use",mapping:"site/account/use"},{name:"site_account_username",mapping:"site/account/username"},{name:"site_account_password",mapping:"site/account/password"},{name:"options_every",mapping:"options/every"},{name:"options_onerunonly",mapping:"options/onerunonly"},{name:"options_status",mapping:"options/status"},{name:"info_lastrun",mapping:"info/lastRun"},{name:"info_running",mapping:"info/running"},{name:"info_result_total",mapping:"info/result/total"},{name:"info_result_added",mapping:"info/result/added"},{name:"info_result_layer",mapping:"info/result/layer"},{name:"info_result_layerUuidExist",mapping:"info/result/layerUuidExist"},{name:"info_result_layerUsingMdUrl",mapping:"info/result/layerUsingMdUrl"},{name:"info_result_unknownSchema",mapping:"info/result/unknownSchema"},{name:"info_result_removed",mapping:"info/result/removed"},{name:"info_result_unretrievable",mapping:"info/result/unretrievable"},{name:"info_result_badFormat",mapping:"info/result/badFormat"},{name:"info_result_doesNotValidate",mapping:"info/result/doesNotValidate"},{name:"info_result_thumbnails",mapping:"info/result/thumbnails"},{name:"info_result_thumbnailsFailed",mapping:"info/result/thumbnailsFailed"},{name:"error_message",mapping:"error/message"},{name:"error_class",mapping:"error/class"},{name:"error_stack"}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataCSWResultsStore=function(){function getThumbnails(v,record){var i,uri;
if(record.URI){for(i=0;
i<record.URI.length;
i++){uri=record.URI[i];
if(uri.name==="thumbnail"){if(uri.value.indexOf("http")===-1){return GeoNetwork.Catalogue.URL+"/srv/en/"+uri.value
}else{return uri.value
}}}}return""
}function getCapabilitiesUrl(v,record){var i,uri;
if(record.URI){for(i=0;
i<record.URI.length;
i++){uri=record.URI[i];
if(uri.protocol&&uri.protocol.indexOf("http-get-capabilities")!==-1){return uri.value
}}}return""
}function getSource(v,record){if(record.geonet_info){return record.geonet_info.source[0]
}else{return""
}}function getPopularity(v,record){if(record.geonet_info){return record.geonet_info.popularity[0]
}else{return""
}}function getRating(v,record){if(record.geonet_info){return record.geonet_info.rating[0]
}else{return""
}}function getDownload(v,record){if(record.geonet_info){return record.geonet_info.download[0]
}else{return""
}}function getOwnerName(v,record){if(record.geonet_info){return record.geonet_info.ownername[0]
}else{return""
}}function getIsHarvested(v,record){if(record.geonet_info&&record.geonet_info.is_harvested){return record.geonet_info.is_harvested[0]
}else{return""
}}function getEdit(v,record){if(record.geonet_info&&record.geonet_info.edit){return record.geonet_info.edit
}else{return"false"
}}return new Ext.data.JsonStore({totalProperty:"SearchResults.numberOfRecordsMatched",root:"records",fields:[{name:"title",mapping:"title[0].value",defaultValue:""},{name:"abstract",mapping:"abstract",defaultValue:""},{name:"subject",mapping:"subject"},{name:"uuid",mapping:"identifier[0].value",defaultValue:""},{name:"thumbnail",convert:getThumbnails},{name:"uri",mapping:"uri",defaultValue:""},{name:"getCapabilitiesUrl",convert:getCapabilitiesUrl},{name:"isharvested",convert:getIsHarvested},{name:"source",convert:getSource},{name:"rating",convert:getRating},{name:"popularity",convert:getPopularity},{name:"download",convert:getDownload},{name:"ownername",convert:getOwnerName},{name:"edit",convert:getEdit},{name:"bbox",mapping:"BoundingBox",defaultValue:""}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataRelationStore=function(url,params,grouping){var fields=[{name:"id"},{name:"uuid"},{name:"title"},{name:"abstract"},{name:"keyword"},{name:"type",mapping:"@type"}];
if(grouping){var reader=new Ext.data.XmlReader({record:"relation",idProperty:"uuid"},fields);
return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:url,params:params,disableCaching:false}),reader:reader,groupField:"type",sortInfo:{field:"type",direction:"ASC"}})
}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"relation",idPath:"uuid",fields:fields})
}};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataResultsStore=function(){function getTitle(v,record){if(record.title&&record.title){return record.title[0].value
}else{return""
}}function getValidationInfo(v,record){var i,validity=[],validInfo;
if(record.geonet_info&&record.geonet_info.valid_details){validInfo=record.geonet_info.valid_details;
for(i=0;
i<validInfo.length;
i++){validity.push({valid:validInfo.status[i].value,type:validInfo.type[i].value,ratio:validInfo.ratio[i].value})
}}return validity
}function getThumbnails(v,record){var i;
var uri="";
var currentUri;
if(record.image){for(i=0;
i<record.image.length;
i++){currentUri=record.image[i].value;
if(currentUri.indexOf("http")!==-1||i===0){uri=currentUri
}}}return uri
}function getContact(v,record){var i,contact=[],el,name;
if(record.responsibleParty){for(i=0;
i<record.responsibleParty.length;
i++){el=record.responsibleParty[i];
name=(record.responsibleParty.organisationName&&record.responsibleParty.organisationName[i]?record.responsibleParty.organisationName[i].value:"");
contact.push({applies:el.appliesTo,logo:el.logo,role:el.role,name:name})
}}return contact
}function getLinks(v,record){if(record.link){return record.link
}return[]
}function getSource(v,record){if(record.geonet_info&&record.geonet_info.source){return record.geonet_info.source[0].value
}else{return""
}}function getPopularity(v,record){if(record.geonet_info&&record.geonet_info.popularity){return record.geonet_info.popularity[0].value
}else{return""
}}function getRating(v,record){if(record.geonet_info&&record.geonet_info.rating){return record.geonet_info.rating[0].value
}else{return""
}}function getDownload(v,record){if(record.geonet_info&&record.geonet_info.download){return record.geonet_info.download[0].value
}else{return""
}}function getOwnerName(v,record){if(record.geonet_info&&record.geonet_info.ownername){return record.geonet_info.ownername[0].value
}else{return""
}}function getIsHarvested(v,record){if(record.geonet_info&&record.geonet_info.isHarvested){return record.geonet_info.isHarvested[0].value
}else{return""
}}function getHarvesterType(v,record){if(record.geonet_info&&record.geonet_info.harvestInfo&&record.geonet_info.harvestInfo.type){return record.geonet_info.harvestInfo.type[0].value
}else{return""
}}function getCategory(v,record){if(record.geonet_info&&record.geonet_info.category){return record.geonet_info.category
}else{return""
}}function getChangeDate(v,record){if(record.geonet_info&&record.geonet_info.changeDate){return record.geonet_info.changeDate[0].value
}else{return""
}}function getCreateDate(v,record){if(record.geonet_info&&record.geonet_info.createDate){return record.geonet_info.createDate[0].value
}else{return""
}}function getSelected(v,record){if(record.geonet_info&&record.geonet_info.selected){return record.geonet_info.selected[0].value
}else{return""
}}function getAbstract(v,record){if(record["abstract"]){return record["abstract"][0].value
}else{return""
}}function getEdit(v,record){if(record.geonet_info&&record.geonet_info.edit){return record.geonet_info.edit[0].value
}else{return"false"
}}function getDisplayOrder(v,record){if(record.geonet_info&&record.geonet_info.displayOrder){return record.geonet_info.displayOrder[0].value
}else{return 0
}}return new Ext.data.JsonStore({totalProperty:"summary.count",root:"records",fast:"false",fields:[{name:"title",convert:getTitle},{name:"abstract",convert:getAbstract},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"contact",convert:getContact},{name:"thumbnail",convert:getThumbnails},{name:"links",convert:getLinks},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:getIsHarvested},{name:"harvestertype",convert:getHarvesterType},{name:"createdate",convert:getCreateDate},{name:"changedate",convert:getChangeDate},{name:"selected",convert:getSelected},{name:"source",convert:getSource},{name:"category",convert:getCategory},{name:"rating",convert:getRating},{name:"popularity",convert:getPopularity},{name:"download",convert:getDownload},{name:"ownername",convert:getOwnerName},{name:"edit",convert:getEdit},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:getDisplayOrder,sortType:"asInt"},{name:"valid",mapping:"geonet_info.valid[0].value",defaultValue:"-1"},{name:"valid_details",convert:getValidationInfo}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataResultsFastStore=function(){function getTitle(v,record){if(record._title&&record._title){return record._title[0].value
}else{return""
}}function getValidationInfo(v,record){var i,validity=[],validInfo;
if(record.geonet_info&&record.geonet_info.valid_details){validInfo=record.geonet_info.valid_details;
for(i=0;
i<validInfo.length;
i++){validity.push({valid:validInfo.status[i].value,type:validInfo.type[i].value,ratio:validInfo.ratio[i].value})
}}return validity
}function getThumbnails(v,record){var i;
var uri="";
var currentUri;
if(record.image){for(i=0;
i<record.image.length;
i++){currentUri=record.image[i].value;
if(currentUri.indexOf("http")!==-1||i===0){uri=currentUri
}}}return uri
}function getContact(v,record){var i,contact=[],el,name;
if(record.responsibleParty){for(i=0;
i<record.responsibleParty.length;
i++){el=record.responsibleParty[i];
name=(record.responsibleParty.organisationName&&record.responsibleParty.organisationName[i]?record.responsibleParty.organisationName[i].value:"");
contact.push({applies:el.appliesTo,logo:el.logo,role:el.role,name:name})
}}return contact
}function getLinks(v,record){if(record.link){return record.link
}return[]
}function getSource(v,record){if(record.geonet_info&&record.geonet_info.source){return record.geonet_info.source[0].value
}else{return""
}}function getPopularity(v,record){if(record.geonet_info&&record.geonet_info.popularity){return record.geonet_info.popularity[0].value
}else{return""
}}function getRating(v,record){if(record.geonet_info&&record.geonet_info.rating){return record.geonet_info.rating[0].value
}else{return""
}}function getDownload(v,record){if(record.geonet_info&&record.geonet_info.download){return record.geonet_info.download[0].value
}else{return""
}}function getOwnerName(v,record){if(record.geonet_info&&record.geonet_info.ownername){return record.geonet_info.ownername[0].value
}else{return""
}}function getIsHarvested(v,record){if(record.geonet_info&&record.geonet_info.isHarvested){return record.geonet_info.isHarvested[0].value
}else{return""
}}function getHarvesterType(v,record){if(record.geonet_info&&record.geonet_info.harvestInfo&&record.geonet_info.harvestInfo.type){return record.geonet_info.harvestInfo.type[0].value
}else{return""
}}function getCategory(v,record){if(record.geonet_info&&record.geonet_info.category){return record.geonet_info.category
}else{return""
}}function getChangeDate(v,record){if(record.geonet_info&&record.geonet_info.changeDate){return record.geonet_info.changeDate[0].value
}else{return""
}}function getCreateDate(v,record){if(record.geonet_info&&record.geonet_info.createDate){return record.geonet_info.createDate[0].value
}else{return""
}}function getSelected(v,record){if(record.geonet_info&&record.geonet_info.selected){return record.geonet_info.selected[0].value
}else{return""
}}function getAbstract(v,record){if(record["abstract"]){return record["abstract"][0].value
}else{return""
}}function getEdit(v,record){if(record.geonet_info&&record.geonet_info.edit){return record.geonet_info.edit[0].value
}else{return"false"
}}function getDisplayOrder(v,record){if(record.geonet_info&&record.geonet_info.displayOrder){return record.geonet_info.displayOrder[0].value
}else{return 0
}}return new Ext.data.JsonStore({totalProperty:"summary.count",root:"records",fast:"index",fields:[{name:"title",convert:getTitle},{name:"abstract",convert:getAbstract},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"contact",convert:getContact},{name:"thumbnail",convert:getThumbnails},{name:"links",convert:getLinks},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:getIsHarvested},{name:"harvestertype",convert:getHarvesterType},{name:"createdate",convert:getCreateDate},{name:"changedate",convert:getChangeDate},{name:"selected",convert:getSelected},{name:"source",convert:getSource},{name:"category",convert:getCategory},{name:"rating",convert:getRating},{name:"popularity",convert:getPopularity},{name:"download",convert:getDownload},{name:"ownername",convert:getOwnerName},{name:"edit",convert:getEdit},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:getDisplayOrder,sortType:"asInt"},{name:"valid",defaultValue:"-1"},{name:"valid_details"}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataSummaryStore=function(){return new Ext.data.JsonStore({totalProperty:"count",root:"keywords.keyword",listeners:{load:function(store,records,opt){var valueField="count";
var normalizedField="class";
var typeField="type";
var params={};
var maxBound=6;
store.each(function(v){v.set(typeField,store.root);
var type=v.get(typeField);
if(typeof params.type!=="object"){params.type={maxValue:0,minValue:1}
}params.type.maxValue=Math.max(v.get(valueField),params.type.maxValue);
params.type.minValue=Math.min(v.get(valueField),params.type.minValue)
});
store.each(function(v){var type=v.get(typeField);
var normalizedValue=0;
if(params.type.maxValue!==params.type.minValue){normalizedValue=(v.get(valueField)-params.type.minValue)/(params.type.maxValue-params.type.minValue)*maxBound
}v.set(normalizedField,Math.round(normalizedValue))
})
}},sortInfo:{field:"value",direction:"ASC"},fields:[{name:"type",defaultValue:null},{name:"value",mapping:"name",defaultValue:""},{name:"count",mapping:"count",defaultValue:""},{name:"class",defaultValue:"0"}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataThumbnailStore=function(url,params){var fields=[{name:"href"},{name:"desc"},{name:"type"},{name:"mimetype"}];
return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:url,params:params,disableCaching:false}),record:"thumbnail",idPath:"href",fields:fields})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.OpenSearchSuggestionReader=function(meta,recordType){meta=meta||{};
GeoNetwork.data.OpenSearchSuggestionReader.superclass.constructor.call(this,meta,recordType||meta.fields)
};
Ext.extend(GeoNetwork.data.OpenSearchSuggestionReader,Ext.data.JsonReader,{rootId:undefined,readRecords:function(o){this.arrayData=o;
var i,j;
var s=this.meta,sid=s?Ext.num(s.idIndex,s.id):null,recordType=this.recordType,fields=recordType.prototype.fields,records=[],success=true,v;
this.rootId=1;
var root=(!this.rootId?this.getRoot(o):o[this.rootId]);
for(i=0,len=root.length;
i<len;
i++){var n=root[i],values={},id=((sid||sid===0)&&n[sid]!==undefined&&n[sid]!==""?n[sid]:null);
for(j=0,jlen=fields.length;
j<jlen;
j++){var f=fields.items[j],k=f.mapping!==undefined&&f.mapping!==null?f.mapping:j;
v=n[k]!==undefined?n[k]:f.defaultValue;
v=f.convert(v,n);
values[f.name]=n
}var record=new recordType(values,id);
record.json=n;
records[records.length]=record
}var totalRecords=records.length;
if(s.totalProperty){v=parseInt(this.getTotal(o),10);
if(!isNaN(v)){totalRecords=v
}}if(s.successProperty){v=this.getSuccess(o);
if(v===false||v==="false"){success=false
}}return{success:true,records:records,totalRecords:records.length}
}});Ext.namespace("GeoNetwork.data");
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.OpenSearchSuggestionStore=function(c){c=c||{};
GeoNetwork.data.OpenSearchSuggestionStore.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new Ext.data.HttpProxy({url:c.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoNetwork.data.OpenSearchSuggestionReader(c,c.fields||["value"])}))
};
Ext.extend(GeoNetwork.data.OpenSearchSuggestionStore,Ext.data.Store);Ext.namespace("GeoNetwork.data");
GeoNetwork.data.RegionStore=function(url){function getLabel(v,record){var labels={};
var i;
var label=record.getElementsByTagName("label");
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType===1){labels[child.nodeName]=child.firstChild.nodeValue
}}}return labels
}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"region",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"north"},{name:"south"},{name:"east"},{name:"west"},{name:"label",convert:getLabel}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.SubTemplateTypeStore=function(url){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"record",idPath:"type",fields:[{name:"type"},{name:"schema"},{name:"label"},{name:"description"}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.SuggestionStore=function(url,params,grouping){function getStatusIcon(v,record){var status=record.getAttribute("type");
return'<span class="'+status+'">&#160;</span>'
}var fields=[{name:"id",mapping:"@id"},{name:"name",mapping:"@process"},{name:"target",mapping:"@target"},{name:"category",mapping:"@category"},{name:"desc",mapping:"name"},{name:"params",mapping:"params"},{name:"operational",mapping:"operational"}];
if(grouping){var reader=new Ext.data.XmlReader({record:"suggestion",idProperty:"@id"},fields);
return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:url,params:params,disableCaching:false}),reader:reader,groupField:"category",sortInfo:{field:"target",direction:"ASC"}})
}else{return new Ext.data.XmlStore({autoDestroy:true,baseParams:params,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"suggestion",idPath:"@id",fields:fields})
}};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.ThesaurusFeedStore=function(feed){var defaultFeed="http://geonetwork.svn.sourceforge.net/svnroot/geonetwork/utilities/repository/thesaurus.xml";
var store=new Ext.data.XmlStore({autoDestroy:true,autoLoad:true,proxy:new Ext.data.HttpProxy({method:"GET",url:feed||defaultFeed,disableCaching:false}),record:"entry",idPath:"id",fields:[{name:"id"},{name:"title"},{name:"link",mapping:"link/@href"},{name:"updated"},{name:"summary"},{name:"category"}]});
return store
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.ThesaurusStore=function(config){var DataRecord=Ext.data.Record.create([{name:"filename"},{name:"theme",mapping:"dname"},{name:"id",mapping:"key"},{name:"type"},{name:"activated"}]);
var store=new Ext.data.Store({url:config.url,reader:new Ext.data.XmlReader({record:"thesaurus"},DataRecord),sortInfo:{field:"id",direction:"ASC"},fields:["filename","theme","id","type","activated"]});
if(config.allOption){var record=new DataRecord({filename:OpenLayers.i18n("anyThesaurus"),activated:"y"});
record.set("id","");
store.add(record)
}if(config.activatedOnly){store.on("load",function(){var coll=this.query("activated","n");
coll.each(function(item,idx){this.removeAt(this.indexOf(item))
},store)
},store)
}store.load({add:true});
return store
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.UserStore=function(url){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"user",idPath:"id",fields:[{name:"id"},{name:"username"},{name:"surname"},{name:"name"},{name:"profile"},{name:"address"},{name:"email"},{name:"city"},{name:"state"},{name:"zip"},{name:"country"},{name:"organisation"},{name:"kind"}]})
};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.ValidationRuleStore=function(url,params,grouping){function getStatusIcon(v,record){var status=record.getAttribute("type");
return'<span class="'+status+'">&#160;</span>'
}var fields=[{name:"id",mapping:"@id"},{name:"group",mapping:"@group"},{name:"status",mapping:"@type"},{name:"statusIcon",convert:getStatusIcon},{name:"title"},{name:"details"},{name:"msg"}];
if(grouping){var reader=new Ext.data.XmlReader({record:"rule",idProperty:"id"},fields);
return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:url,params:params,disableCaching:false}),reader:reader,groupField:"group",sortInfo:{field:"status",direction:"ASC"}})
}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,params:params,disableCaching:false}),record:"rule",idPath:"@id",fields:fields})
}};Ext.namespace("GeoNetwork.data");
GeoNetwork.data.Z3950RepositoryStore=function(url){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"repository",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"code",mapping:"id/@code"},{name:"name",mapping:"label"}]})
};Ext.namespace("GeoNetwork.form");
GeoNetwork.form.GeometryMapField=Ext.extend(GeoExt.MapPanel,{layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),geometryFieldId:undefined,geometryField:undefined,mapOptions:undefined,extentBox:undefined,vectorLayer:undefined,nearYou:undefined,initStyle:function(){this.layer_style.fillOpacity=0;
this.layer_style.strokeOpacity=0.8;
this.layer_style.strokeDashstyle="dash";
this.layer_style.strokeWidth=4
},createExtentControl:function(){var action;
if(this.restrictToMapExtent){action=new Ext.form.Checkbox({boxLabel:OpenLayers.i18n("restrictSearchToMap"),checked:this.activated?true:false,listeners:{check:function(cb,checked){this.geometryField.setValue("");
this.nearYou.toggle(false);
if(checked){this.on("aftermapmove",this.setField,this);
this.fireEvent("aftermapmove")
}else{this.un("aftermapmove",this.setField,this)
}},scope:panel}});
this.getTopToolbar().add(action);
if(this.activated){this.on("aftermapmove",this.setField,this)
}}else{this.initStyle();
this.extentBox=new GeoNetwork.Control.ExtentBox({wktelement:this.geometryField,vectorLayerStyle:this.layer_style});
action=new GeoExt.Action({control:this.extentBox,toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?true:false,map:this.map,tooltip:{title:OpenLayers.i18n("selectExtentTooltipTitle"),text:OpenLayers.i18n("selectExtentTooltipText")},iconCls:"selextent"});
this.vectorLayer=this.extentBox.getOrCreateLayer();
var clearAction={iconCls:"clearPolygon",tooltip:{title:OpenLayers.i18n("clearExtentTooltipTitle"),text:OpenLayers.i18n("clearExtentTooltipText")},handler:function(){this.vectorLayer.destroyFeatures();
this.geometryField.setValue("")
},scope:this};
this.getTopToolbar().add(action,clearAction)
}if(this.nearYouControl){this.getTopToolbar().add(this.nearYou)
}return action
},createNavBar:function(){var items=[];
var panel=this;
this.nearYou=new Ext.Button({iconCls:"md-mn mn-user-location",iconAlign:"right",tooltip:OpenLayers.i18n("mapNearYou"),enableToggle:true,toggleGroup:this.map.id+"move",listeners:{toggle:function(bt,pressed){var o=this;
if(pressed){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){o.map.panTo(new OpenLayers.LonLat(position.coords.longitude,position.coords.latitude));
o.geometryField.setValue("POINT("+position.coords.latitude+" "+position.coords.longitude+")")
})
}}else{o.geometryField.setValue("")
}},scope:panel}});
var zoomAllAction=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:this.map,iconCls:"zoomfull",tooltip:{title:OpenLayers.i18n("zoomToMaxExtentTooltipTitle"),text:OpenLayers.i18n("zoomToMaxExtentTooltipText")}});
var zoomInAction=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,iconCls:"zoomin",tooltip:{title:OpenLayers.i18n("zoominTooltipTitle"),text:OpenLayers.i18n("zoominTooltipText")}});
var zoomOutAction=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,tooltip:{title:OpenLayers.i18n("zoomoutTooltipTitle"),text:OpenLayers.i18n("zoomoutTooltipText")},iconCls:"zoomout"});
var panAction=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?false:true,map:this.map,iconCls:"pan",tooltip:{title:OpenLayers.i18n("dragTooltipTitle"),text:OpenLayers.i18n("dragTooltipText")}});
items.push(zoomAllAction,zoomInAction,zoomOutAction,panAction,"->");
return items
},defaultConfig:{id:"geometryMap",width:270,height:270,border:false,activated:false,restrictToMapExtent:false,nearYouControl:true},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
var options=this.mapOptions||{projection:"EPSG:4326",units:"m",maxExtent:new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:new OpenLayers.Bounds(-180,-90,180,90),controls:[]};
if(!options.controls){options.controls=[]
}this.map=new OpenLayers.Map("search_map",options);
this.map.addControl(new GeoNetwork.Control.ZoomWheel());
this.map.addControl(new OpenLayers.Control.LoadingPanel());
this.map.addControl(new OpenLayers.Control.MousePosition());
this.tbar=this.createNavBar();
this.geometryField=Ext.getCmp(this.geometryFieldId);
GeoNetwork.form.GeometryMapField.superclass.initComponent.call(this);
this.createExtentControl()
},setExtent:function(bounds){if(bounds){this.extentBox.updateFields(bounds)
}else{this.extentBox.updateFields(this.map.getMaxExtent())
}},setField:function(){if(this.geometryField!==undefined){var bounds=this.map.getExtent().toArray();
var wkt="POLYGON(("+bounds[0]+" "+bounds[1]+","+bounds[0]+" "+bounds[3]+","+bounds[2]+" "+bounds[3]+","+bounds[2]+" "+bounds[1]+","+bounds[0]+" "+bounds[1]+"))";
this.geometryField.setValue(wkt)
}}});
Ext.reg("gn_geometrymapfield",GeoNetwork.form.GeometryMapField);Ext.namespace("GeoNetwork.form");
GeoNetwork.form.OpenSearchSuggestionTextField=Ext.extend(Ext.form.ComboBox,{defaultConfig:{hideLabel:true,width:400,minChars:2,loadingText:"...",hideTrigger:true,forceLowerCase:true},url:undefined,field:"any",fieldLabel:undefined,name:"E_any",displayField:"value",tpl:undefined,mode:"remote",store:undefined,queryParam:"q",itemSelector:"div.search-item",initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.id="E_"+this.field;
GeoNetwork.form.OpenSearchSuggestionTextField.superclass.initComponent.call(this);
if(!this.tpl){var tpl='<tpl for="."><div class="search-item"><h3>{[values.value.replace(Ext.getDom(\''+this.id+"').value, '<span>' + Ext.getDom('"+this.id+"').value + '</span>')]}</h3></div></tpl>";
this.tpl=new Ext.XTemplate(tpl)
}if(this.forceLowerCase){this.on("beforequery",function(q){q.query=q.query.toLowerCase()
})
}this.store=new GeoNetwork.data.OpenSearchSuggestionStore({url:this.url,rootId:1,baseParams:{field:this.field}})
}});
Ext.reg("gn_opensearchsuggestiontextfield",GeoNetwork.form.OpenSearchSuggestionTextField);Ext.namespace("GeoNetwork.form");
GeoNetwork.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){if(!this.store.baseParams){this.store.baseParams={}
}GeoNetwork.form.SearchField.superclass.initComponent.call(this);
this.on("specialkey",function(f,e){if(e.getKey()===e.ENTER){this.onTrigger2Click()
}},this)
},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.store.baseParams[this.paramName]="";
this.store.removeAll();
this.el.dom.value="";
this.triggers[0].hide();
this.hasSearch=false;
this.focus()
}},onTrigger2Click:function(){var v=this.getRawValue();
if(v.length<1){this.store.baseParams[this.paramName]="*"
}else{this.store.baseParams[this.paramName]=v
}if(this.triggerAction){this.triggerAction(this.scope,v)
}else{this.store.reload()
}this.hasSearch=true;
this.triggers[0].show();
this.focus()
}});
Ext.reg("gn_searchfield",GeoNetwork.form.SearchField);Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.de={featureInfoTooltipTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",zoomToMaxExtentTooltipTitle:"Full extent",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoomoutTooltipTitle:"Zoom out",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",dragTooltipTitle:"Pan map",dragTooltipText:"Press the left mouse button to drag the map.",previousTooltipTitle:"Previous map extent",previosTooltipText:"Click this button to go back to the previous map extent",nextTooltipTitle:"Next map extent",nextTooltipText:"Click this button to go to the next map extent",featureInfoTitle:"Feature info",layerManagerTabTitle:"Layer management",legendTabTitle:"Legend",scaleTitle:"Scale",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"There is no queryable map layer",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserAddButton:"Add",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",infoTitle:"Information","mf.print.mapTitle":"Title","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.scale":"Scale","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Print","mf.print.generatingPDF":"Generating PDF","mf.print.unableToPrint":"It was not posible to print, try later","mf.error":"Error",selectExtentTooltipTitle:"Select extent",selectExtentTooltipText:"Select extent for catalog searches",printTooltipTitle:"Print",printTooltipText:"Print the current map",savewmcTooltipTitle:"Save web map context",savewmcTooltipText:"Saves web map context for current map","saveWMCFile.windowTitle":"Save Web Map Context","saveWMCFile.errorSaveWMC":"Could not save Web Map Context",loadwmcTooltipTitle:"Load web map context",loadwmcTooltipText:"Loads web map context in current map","selectWMCFile.windowTitle":"Load Web Map Context",selectWMCFile:"Select Web Map Context file","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",metadataButtonText:"Metadata",removeButtonText:"Remove",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add WMS","layerInfoPanel.windowTitle":"Layer metadata","layerInfoPanel.titleField":"Title","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable",layerList:"Layer list",baseLayerList:"Base layers","metadataResults.buttonText":"Metadata results","metadataResults.tooltipTitle":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.alertTitle":"Metadata results","metadataResults.alertText":"No metadata results to show","mf.information":"Print","mf.print.pdfReady":"PDF ready","loadLayer.loadingMessage":"Loading layer","loadLayer.error.title":"Load layer","loadLayer.error.message":"The layer could not be loaded","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Loading...","disclaimer.buttonClose":"Close",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",searchOptionButton:"Zoek",GazetteerWindowTitle:"Zoek adres",searchResults:"Zoekresultaten",errorTitle:"Fout",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar. \n",gazetteerTooltipTitle:"Zoek op basis van een adres",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",SearchOptionNoResults:"No results found",zoomlayerTooltipTitle:"Zoom auf Layer",zoomlayerTooltipText:"Verwenden Sie diese Taste, um das ganze Ausma der ausgewhlten Layer.","zoomlayer.selectLayerTitle":"Zoom auf Layer","zoomlayer.selectLayerText":"No layer selected",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions"};
OpenLayers.Util.extend(OpenLayers.Lang.de,GeoNetwork.Lang.de);Ext.namespace("GeoNetwork","GeoNetwork.lang");
GeoNetwork.lang.en={connectIssue:"Catalogue connection issue",connectIssueMsg:"Error 404. Can't connect to catalogue at url ",featureInfoTooltipTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",zoomToMaxExtentTooltipTitle:"Full extent",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoomoutTooltipTitle:"Zoom out",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",dragTooltipTitle:"Pan map",dragTooltipText:"Press the left mouse button to drag the map.",previousTooltipTitle:"Previous map extent",previosTooltipText:"Click this button to go back to the previous map extent",nextTooltipTitle:"Next map extent",nextTooltipText:"Click this button to go to the next map extent",featureInfoTitle:"Feature info",layerManagerTabTitle:"Layer management",legendTabTitle:"Legend",scaleTitle:"Scale",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"There is no queryable map layer",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserAddButton:"Add",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",infoTitle:"Information","mf.print.mapTitle":"Title","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.scale":"Scale","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Print","mf.print.generatingPDF":"Generating PDF","mf.print.unableToPrint":"It was not possible to print, try later","mf.error":"Error",selectExtentTooltipTitle:"Select extent",selectExtentTooltipText:"Select extent for catalog searches",clearExtentTooltipTitle:"Remove extent",clearExtentTooltipText:"Remove extent (ie. no spatial criteria)",printTooltipTitle:"Print",printTooltipText:"Print the current map",savewmcTooltipTitle:"Save web map context",savewmcTooltipText:"Saves web map context for current map","saveWMCFile.windowTitle":"Save Web Map Context","saveWMCFile.errorSaveWMC":"Could not save Web Map Context",loadwmcTooltipTitle:"Load web map context",loadwmcTooltipText:"Loads web map context in current map","selectWMCFile.windowTitle":"Load Web Map Context",selectWMCFile:"Select Web Map Context file","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",metadataButtonText:"Metadata",removeButtonText:"Remove",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add layer from a WMS service","layerInfoPanel.windowTitle":"Layer metadata","layerInfoPanel.titleField":"Title","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable",layerList:"Layer list",baseLayerList:"Base layers","metadataResults.buttonText":"Metadata results","metadataResults.tooltipTitle":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.alertTitle":"Metadata results","metadataResults.alertText":"No metadata results to show","featureInfoWindow.windowTitle":"Feature info","mf.information":"Print","mf.print.pdfReady":"PDF ready","loadLayer.loadingMessage":"Loading layer","loadLayer.error.title":"Load layer","loadLayer.error.message":"The layer could not be loaded","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Loading...","disclaimer.buttonClose":"Close",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"'Gemeente'",gazetteerAddressField5Label:"House number",searchOptionButton:"Search",resetSearchForm:"Reset search form values.",GazetteerWindowTitle:"Search for address",searchResults:"Search results",errorTitle:"Error",SearchOptionLoadFailureMsg:"No results available. \n The service may be unavailable. \n",gazetteerTooltipTitle:"Search based on an address",gazetteerTooltipText:"Search for a location, based on postcode, street name, 'gemeente' or place.",SearchOptionNoResults:"No results found",zoomlayerTooltipTitle:"Zoom to layer",zoomlayerTooltipText:"Use this button to go to the full extent of the selected layer.","zoomlayer.selectLayerTitle":"Zoom to layer","zoomlayer.selectLayerText":"No layer selected",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Pick a time position",WMSTimeMovieTitle:"Play animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Full text search",keyword:"Keyword",org:"Organisation",mapTypes:"Map types",similarity:"Search accuracy",wkt:"WKT geometry",spatialSearch:"Spatial criteria",mdChangeDate:"Metadata change date",tempExtent:"Temporal extent",hitsPerPage:"Hits per page",sortBy:"Sort by",relevance:"Relevance",title:"Title",changeDate:"Change date",rating:"Rating",popularity:"Popularity",scaleDesc:"Scale (desc)",scaleAsc:"Scale (asc)","abstract":"Abstract",catalogue:"Catalogue",group:"Group",chooseGroup:"Select a group",md:"Metadata",tpl:"Template",category:"Category",advTextSearch:"Advanced text search options",eitherWords:"Either of the words",exactPhrase:"Exact phrase",allWords:"All of the words",withoutWords:"Without the words",precise:"Precise",imprecise:"Imprecise",relationType:"Relation type",within:"within",touches:"touches",crosses:"crosses",fullyOutsideOf:"fullyOutsideOf",encloses:"encloses",overlaps:"overlaps",intersection:"intersection",nearYou:"Near you",from:"From",to:"To",scaleNominator:"1:",scale:"Scale",digital:"Digital",hardCopy:"Hard copy",download:"Download",downloadable:"Download",interactive:"Interactive",resourceType:"Resource type",dataset:"Dataset",series:"Series",service:"Service",spatialRepType:"Spatial representation",video:"Video",vector:"Vector",textTable:"Text, table",tin:"Tin",stereoModel:"Stereo model",grid:"Grid",kind:"Kind",enterGetCapURL:"Enter a GetCapabilities URL to register a new service.",edit:"Edit",duplicate:"Duplicate","delete":"Delete",createChild:"Create child",privileges:"Privileges",categories:"Categories",otherActions:"Other actions",view:"View",zoomTo:"Zoom to",saveXml:"Save as XML",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Print",newOwner:"New owner",updateCategories:"Update categories",updatePrivileges:"Update privileges",noneSelected:"None selected",none:"none",all:"all",allInPage:"all in page",select:"Select ",username:"User name",password:"password",login:"Login",logout:"Logout",administration:"Administration",validationReport:"Validation report",status:"Status",items:"items",item:"item",thumbnails:"Thumbnails",noimages:"No images to display",add:"Add",small:"Small",large:"Large",selectImage:"Select an image",selectFile:"Select a file",image:"Image",uploading:"Uploading ...",upload:"Upload",success:"Success",failure:"Failure",error:"Error",save:"Save",reset:"Reset",fileProcessedMsg:"Processed file ${res} on the server",suggestion:"Suggestion",logoSelect:"Select a logo",relatedResources:"Related resources",createLink:"Create links ...",featureCat:"Feature catalogue",serviceMd:"Service metadata",datasetMd:"Dataset metadata",parentMd:"Parent metadata",updateChildren:"Update children",records:"records",record:"record",help:"Help",publishError:"Publication failed.",outOfMemoryError:"Out of memory error.",publishErrorCode:"Error code:",saveAndCheck:"Save and check",saveAndClose:"Save and close",cancel:"Cancel",layout:"Layout",collapseAll:"Collapse all",chooseAType:"Choose a type",chooseAView:"Choose a view",viewMode:"View mode",errorAndStatusMsg:"Error. Status: ${status}, text: ${text}. Try again.",mdEditor:"Metadata editor",editing:"Editing ${title} (${uuid})",GetCapabilitiesDocumentError:"Error loading service GetCapabilities document from URL: ",maxResults:"Number of results",mdTitle:"Metadata title",keywords:"Keywords",createRelation:"Create relation",createIfNotExistButton:"Create a new metadata record",getCapabilitiesLayer:"GetCapabilities layer",layerName:"Layer name",searching:"Searching ...",perThesaurus:" per thesaurus",anyThesaurus:"Any thesaurus",selectedKeywords:"Selected keywords",foundKeywords:"Available keywords",clear:"Clear",publish:"Publish",publishTooltip:"Publish current dataset to remote node. If dataset is already publish in that node, it will be updated.",publishSuccess:"Successful publication.",publishLayerAdded:" Layer added to map preview.",unpublish:"Unpublish",unpublishTooltip:"Remove current dataset from remote node.",unpublishSuccess:"Successful unpublication.",unpublishError:"Unpublication failed. ",check:"Check",errorDatasetNotFound:"Dataset not found.",datasetFound:"Dataset found and added to the map preview.",checkFailure:"Failed to check dataset in remote node.",addOnlineSourceTitle:"Link service to metadata",addOnlineSource:"Add links",addOnlineSourceTT:"Add an onlinesource section to the current metadata record pointing to the WMS/WFS/WCS services. If the service is a WMS, the layer could be displayed in the map viewer.",statusInformation:"Status information.",publishing:"Publishing ...",mapPreview:"Map preview",selectANode:"Select a node ...",geoPublisherWindowTitle:"Geo-publication: ",keywordSelectionWindowTitle:"Keywords selection",crsSelectionWindowTitle:"Coordinate reference system selection",linkedMetadataSelectionWindowTitle:"Related metadata selection",NotOwnerError:"You don't have privileges to update this related record.",ServiceUpdateError:"Error during service metadata update",associateService:"Link service metadata",associateDataset:"Link dataset metadata",logoSelectionWindow:"Choose a logo",fileUploadWindow:"Upload data or document",selectedCRS:"Selected coordinate systems",foundCRS:"Available coordinate systems",search:"Search",restrictSearchToMap:"Restrict search to map extent",selected:"selected",selectRegion:"Select a region ...",drawRectangle:"Draw rectangle",drawPolygon:"Draw polygon",drawCircle:"Draw circle",discovery:"Discovery",visualization:"Visualization",when:"When ?",anyTime:"Anytime",onSelection:"On selection",adminAction:"Other",newMetadata:"New metadata",chooseTemplate:"Select a template",process:"Process",suggestions:"Suggestions",applySelected:"Apply selected task",processParametersWindow:"Task parameters",noSuggestion:"No suggestion.",thumbnailUploadWindow:"Upload thumbnail",addThumbnail:"Add",createSmall:"Create small thumbnail",scalingFactor:"Scaling factor",smallScalingFactor:"Small scaling factor",type:"Record type",clickToClose:"Click to close",removeSelected:"Remove selected",ownerName:"Metadata record owner",setPrivileges:"Set privileges",setCategories:"Set categories",massiveOp:"Batch operation ",prepareDownload:"Download files",mdMenu:"Actions",deleteRecord:"Delete metadata record ?",deleteConfirm:"Are you sure to delete this metadata record?",deleteRecordSuccess:"Metadata deleted.",deleteRecordFailure:"Error when deleting metadata record.",advancedSearchOptions:"Advanced criteria",relatedservices:"Related service",relatedchildren:"Children",getMEF:"Export (ZIP)",metadataCategories:"Metadata categories",validityInfo:"Validation status: ",lastUpdate:"Last update: ",importMetadata:"Import metadata",validationStatus:"Validation status",valid:"Valid",notValid:"Not valid",notDetermined:"Not determined",addToMap:"Add to map: ",downloadLink:"Download: ",webLink:"Web link: ",viewKml:"Open in GoogleEarth: ",layerTree:"Layer manager",mdResultsLayer:"Search results",printLayer:"Print page",relatedservices:"Related services",relatedparent:"Parent",relateddatasets:"Related datasets",relatedchildren:"Children",relatedrelated:"Feature catalogue/dataset link",delete19110Relation:"Remove feature catalogue relation",newWindow:"New window",addAsXLink:"Add as linked element",contactSelectionWindowTitle:"Contact selection",selectedContacts:"Selected contacts",foundContacts:"Available",contactRole:"Contact role",mapNearYou:"Center map on your location",errorChangeProtocol:"Remove uploaded file before changing protocol of an online resource.",resultBy:" result(s) / ",subTemplateImport:"Directory entry import",xmlData:"XML",minorEdit:"Minor edit",minorEditTT:"",runASearch:"Run a search.",focusOnAny:"Move focus to the full text search field.",hideSearchForm:"Hide or display search form.",switchMode:"Switch visualization mode.",resetSearchForm:"Reset search form.",focusOnLogin:"Focus on the login form to access catalogue administration.",displayInfoPanel:"Display the information panel.",displayHelpPanel:"Display this help.",SelectionWindowTitle:"Select from directory",found:"Records found",selected:"Selected","add-extent-from-geokeywordsreplace":"Replace existing extent","add-info-from-wmssetExtent":"Set extent","add-info-from-wmssetAndReplaceExtent":"Replace existing extent","add-info-from-wmssetCRS":"Set coordinate reference system","add-info-from-wmssetDynamicGraphicOverview":"Set graphic overview (using GetMap request URL)","add-info-from-wmswmsServiceUrl":"Service URL","linked-data-checkerlinkUrl":"URL to remove","related-metadata-checkeruuidToRemove":"Identifier to remove","add-service-info-from-wxssetAndReplaceOperations":"Replace existing operations","add-service-info-from-wxswxsServiceUrl":"Service URL",manageDirectories:"Manage directories",directory:"Directory",thesaurusManager:"Thesaurus manager",Theme:"Theme",thesaurusFilePath:"Thesaurus file (.rdf)",ThesaurusName:"Thesaurus name",createThesaurusFromURL:"from URL",createThesaurusFromRepository:"from thesaurus repository",creationMode:"Create",thesaurusFromRepository:"Thesaurus",externalThesaurusURL:"URL",thesaurusCreation:"Add a thesaurus",Type:"Type",Activated:"Activated",emptyThesaurus:"New empty thesaurus",thesaurusFromFile:"From local file",thesaurusFromURL:"From remote file (URL)",id:"Identifier",label:"Label",definition:"Definition",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Label",newDefinition:"Definition",selDirectoryTT:"Select a type of directory. A directory group all elements having the same root element name (eg. gmd:CI_ResponsibleParty is a contact directory)",privTplElTT:"Manage privileges for the current selection.",addTplElTT:"Add an element from an XML fragment to a directory. The destination directory is based on the root element name (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Create a new entry in the directory from the current selection.",delTplElTT:"Remove selected entry from the directory."};
OpenLayers.Util.extend(OpenLayers.Lang.en,GeoNetwork.lang.en);Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.fr={connectIssue:"chec de connexion au catalogue",connectIssueMsg:"Erreur 404. Impossible de se connecter  l'URL ",featureInfoTooltipTitle:"caractristique",featureInfoTooltipText:"Cliquer sur la carte pour obtenir des informations sur les donnes affichees.",zoomToMaxExtentTooltipTitle:"Zoom optimal",zoomToMaxExtentTooltipText:"Utiliser ce bouton pour tout afficher.",zoominTooltipTitle:"Zoomer",zoominTooltipText:"Dessiner un rectangle sur la carte pour zoomer. En cliquant sur la carte, le facteur de zoom est 2.",zoomoutTooltipTitle:"Dzoomer",zoomoutTooltipText:"Cliquer sur la carte ou dessiner un rectangle pour dzoomer.",dragTooltipTitle:"Main",dragTooltipText:"Appuyer sur le bouton gauche de la souris pour dplacer la carte.",previousTooltipTitle:"Revenir au zoom prcdant",previosTooltipText:"Cliquer ici pour revenir au zoom prcdant",nextTooltipTitle:"Zoom suivant",nextTooltipText:"Cliquer ici pour avancer au zoom suivant",featureInfoTitle:"Caractristique",layerManagerTabTitle:"Grer les couches",legendTabTitle:"Lgende",scaleTitle:"Echelle",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"Il n'existe pas de carte correspondant  la requte",WMSBrowserTab1:"Slectionner",WMSBrowserTab3:"Externe",WMSBrowserPreviewTitle:"Aperu de la couche",WMSBrowserAddButton:"Ajouter",WMSBrowserDuplicateMsg:"La couche est dj affiche",WMSBrowserPreviewWaitMsg:"Rcuprer l'image precedente",WMSBrowserConnectButton:"Connexion",WMSBrowserConnectError:"Erreur de connexion au service Web, merci de vrifier l'URL.",infoTitle:"Information","mf.print.mapTitle":"Titre","mf.print.comment":"Commentaire","mf.print.dpi":"Rsolution","mf.print.scale":"chelle","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Imprimer","mf.print.generatingPDF":"Gnrer PDF","mf.print.unableToPrint":"Impression impossible, essayer plus tard","mf.error":"Erreur",selectExtentTooltipTitle:"Dfinir une emprise",selectExtentTooltipText:"Dessiner une emprise  utiliser comme critre gographique",clearExtentTooltipTitle:"Supprimer l'emprise",clearExtentTooltipText:"Supprimer l'emprise (ie. aucun critre gographique)",printTooltipTitle:"Imprimer",printTooltipText:"Imprimer la carte actuelle",savewmcTooltipTitle:"Sauvegarder environnement (vue, paramtres,etc.)",savewmcTooltipText:"Sauvegarder environnement pour la carte actuelle","saveWMCFile.windowTitle":"Sauvegarder l'environnement","saveWMCFile.errorSaveWMC":"Sauvegarde de l'environnement impossible",loadwmcTooltipTitle:"Restaurer l'environnement",loadwmcTooltipText:"Restaurer l'environnement dans la carte actuelle","selectWMCFile.windowTitle":"Restaurer l'environnement",selectWMCFile:"Ouvrir un environnement","selectWMCFile.waitLoadingWMC":"Restauration de l'environnement en cours...","selectWMCFile.loadButtonText":"Charger","selectWMCFile.mergeButtonText":"Fusionner","selectWMCFile.errorLoadingWMC":"Chargement de l'environnement impossible",opacityButtonText:"Transparence",opacityWindowTitle:"Transparence",metadataButtonText:"Metadata",removeButtonText:"Supprimer",addWMSButtonText:"Ajouter WMS",addWMSWindowTitle:"Ajouter WMS","layerInfoPanel.windowTitle":"Couche metadata","layerInfoPanel.titleField":"Titre","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Requte",layerList:"Liste des couches","metadataResults.buttonText":"Rsultats Metadata","metadataResults.tooltipTitle":"rsultats Metadata","metadataResults.tooltipText":"Aller a la page des rsultats Metadata","metadataResults.alertTitle":"Rsultats Metadata","metadataResults.alertText":"Pas de rsultats Metadata","mf.information":"Imprimer","mf.print.pdfReady":"PDF prt","loadLayer.loadingMessage":"Chargement de la couche","loadLayer.error.title":"Charger la couche","loadLayer.error.message":"La couche ne peut tre charge","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Chargement...","disclaimer.buttonClose":"Fermer",gazetteerAddressField1Label:"Code postal",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"Municipalit",gazetteerAddressField5Label:"Numro",searchOptionButton:"Recherche",GazetteerWindowTitle:"Rsultat pour l'adresse",searchResults:"Recherche les rsultats",resetSearchForm:"Rinitialiser le formulaire de recherche.",errorTitle:"Erreur",SearchOptionLoadFailureMsg:"Pas de rsultats trouvs. \n Le serveur peut tre indisponible. \n",gazetteerTooltipTitle:"Recherche base sur l'adresse",gazetteerTooltipText:"Recherche du lieu, bas sur le code postal, la rue, la municipalit ou place.",SearchOptionNoResults:"Pas de rsultats trouvs.",zoomlayerTooltipTitle:"Zoom sur une couche",zoomlayerTooltipText:"Utilisez ce bouton pour accder  la pleine mesure de le calque slectionn.","zoomlayer.selectLayerTitle":"Zoom sur une couche","zoomlayer.selectLayerText":"No de calque slectionn",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Rechercher ...",keyword:"Mots-cls",org:"Organisation",mapTypes:"Type de donnes",similarity:"Prcision",wkt:"Geomtrie WKT",spatialSearch:"Critres gographiques",mdChangeDate:"Date de mise  jour des mtadonnes",tempExtent:"tendue temporelle",hitsPerPage:"Nombre par page",sortBy:"Trier par",relevance:"Pertinence",title:"Titre",changeDate:"Date de mise  jour",rating:"Note",popularity:"Popularit",scaleDesc:"chelle (desc)",scaleAsc:"chelle (asc)","abstract":"Rsum",catalogue:"Catalogue",group:"Groupe",md:"Mtadonne",tpl:"Modle",category:"Catgorie",advTextSearch:"Options avances",eitherWords:"Tous - au moins un des mots suivants",exactPhrase:"Cette expression exacte",allWords:"Tous les mots suivants",withoutWords:"Aucun des mots suivants",precise:"Prcis",imprecise:"Flou",relationType:"Type de relation",within:" l'intrieur",touches:"Touche",crosses:"Travers",fullyOutsideOf:"En dehors",encloses:"Contient",overlaps:"Chevauche",intersection:"Intersecte",nearYou:" proximit",from:"du",to:"au",scaleNominator:"1/",scale:"chelle",digital:"Numrique",hardCopy:"Copie papier",download:"Tlcharger",downloadable:"Tlchargeable",interactive:"Interactive",resourceType:"Type de ressource",dataset:"Srie de donnes",series:"Ensemble de sries de donnes",service:"Service",spatialRepType:"Reprsentation spatiale",video:"Vido",vector:"Vecteur",textTable:"Tableau, Texte",tin:"Tin",stereoModel:"Vue 3D",grid:"Raster",kind:"Type",enterGetCapURL:"Saisir l'URL d'un GetCapabilities pour enregistrer un nouveau service",edit:"diter",duplicate:"Dupliquer","delete":"Supprimer",createChild:"Crer un enfant",privileges:"Privilges",categories:"Catgories",otherActions:"Autres actions",view:"Consulter",zoomTo:"Zoomer vers",saveXml:"Export (XML)",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Imprimer",newOwner:"Associer un autre auteur",updateCategories:"Mettre  jour les catgories",updatePrivileges:"Mettre  jour les privilges",noneSelected:"Slection vide",none:"aucun",all:"tous",allInPage:"tous dans la page",select:"Selectionner ",username:"Identifiant",password:"Mot de passe",login:"Connexion",logout:"Dconnexion",administration:"Administration",validationReport:"Rapport de validation",status:"Status",items:"lments",item:"lment",thumbnails:"Aperus",noimages:"Aucun aperu disponible",add:"Ajouter",small:"Petit",large:"Grand",selectImage:"Slectionner une image",selectFile:"Slectionner un fichier",image:"Image",uploading:"Transfert en cours ...",upload:"Transfrer",success:"Succs",failure:"chec",error:"Erreur",save:"Sauver",reset:"Rinitialiser",fileProcessedMsg:"Traitement du fichier ${res} ralis sur le serveur",suggestion:"Suggestion",logoSelect:"Slectionner un logo",relatedResources:"Ressources associes",createLink:"Associer ...",featureCat:"Catalogue d'attributs",serviceMd:"Mtadonnes de service",datasetMd:"Mtadonnes de donnes",parentMd:"Parent",updateChildren:"Mettre  jour les enfants",records:"enregistrements",record:"enregistrement",help:"Aide",publishError:"chec lors de la publication.",outOfMemoryError:"rreur de dpassement de mmoire.",publishErrorCode:"Code rreur :",saveAndCheck:"Sauver et valider",saveAndClose:"Sauver et fermer",cancel:"Annuler",layout:"Mise en page",Resolution:"Rsolution",collapseAll:"Fermet tout",chooseAType:"Choisir un type",chooseAView:"Choisir une vue",viewMode:"Affichage",errorAndStatusMsg:"rreur. Status : ${status}, description : ${text}. Essayer  nouveau.",mdEditor:"Editeur de mtadonne",editing:"${title} (${uuid}) en cours d'dition",GetCapabilitiesDocumentError:"Erreur lors de la tentative de rcupration des informations du service (ie. GetCapabilities) avec l'adresse: ",maxResults:"Nombre de rsultats",mdTitle:"Titre de la mtadonne",keywords:"Mots-cls",createRelation:"Crer la relation",createIfNotExistButton:"Crer une nouvelle mtadonne",getCapabilitiesLayer:"Couches du GetCapabilities",layerName:"Nom de la couche",searching:"Recherche en cours ...",perThesaurus:" par thesaurus",anyThesaurus:"Tous les thsaurus",selectedKeywords:"Mots cls selectionns",foundKeywords:"Mots cls trouvs",clear:"Effacer",publish:"Publier",publishTooltip:"Publier le jeu de donnes en cours dans le nud distant. Si le jeu de donnes est prsent, il est mis  jour.",publishSuccess:"Publication effectue.",publishLayerAdded:" Couche ajoute  la carte.",unpublish:"Dpublier",unpublishTooltip:"Supprimer le jeu de donnes en cours dans le nud distant.",unpublishSuccess:"Dpublication effectue.",unpublishError:"Echec de la dpublication. ",check:"Vrifier",errorDatasetNotFound:"Jeu de donnes non trouv.",datasetFound:"Jeu de donnes trouv et ajout  la carte.",checkFailure:"Echec de la vrification de la prsence du jeu de donnes dans le nud distant.",addOnlineSourceTitle:"Lier le service  la fiche",addOnlineSource:"Ajouter les liens",addOnlineSourceTT:"Ajouter les informations pour faire la liaison avec la couche dans le service WMS/WFS/WCS.",statusInformation:"Status.",publishing:"Publication en cours ...",mapPreview:"Carte",selectANode:"Choisir un nud ...",geoPublisherWindowTitle:"Go-publication : ",keywordSelectionWindowTitle:"Slection de mots cls",crsSelectionWindowTitle:"Slection des systmes de coordonnes",linkedMetadataSelectionWindowTitle:"Slection des mtadonnes associes",NotOwnerError:"Vous n'avez pas les privilges pour mettre  jour la mtadonne associe.",ServiceUpdateError:"Erreur lors de la mise  jour de la mtadonne.",associateService:"Associer une mtadonne de service",associateDataset:"Associer une mtadonne de donnes",logoSelectionWindow:"Slectionner un logo",fileUploadWindow:"Ajouter des donnes ou des documents",selectedCRS:"Systmes slectionns",foundCRS:"Systmes disponibles",search:"Rechercher",restrictSearchToMap:"Restreindre la recherche  la carte",selected:"slectionn(s)",selectRegion:"Choisir une rgion ...",drawRectangle:"Crer un rectangle",drawPolygon:"Crer un polygone",drawCircle:"Crer un cercle",discovery:"Dcouverte",visualization:"Visualisation",when:"Critres temporels",anyTime:"N'importe quand",onSelection:"Sur la slection",adminAction:"Autres",newMetadata:"Nouvelle mtadonne",chooseGroup:"Selectionner un groupe",chooseTemplate:"Slectionner un modle",process:"Traiter",suggestions:"Suggestions",applySelected:"Appliquer le traitement slectionn",processParametersWindow:"Paramtres du traitement",noSuggestion:"Aucune suggestion.",thumbnailUploadWindow:"Ajouter un aperu",addThumbnail:"Ajouter",createSmall:"Crer un petit aperu",scalingFactor:"Facteur d'chelle",smallScalingFactor:"Facteur d'chelle",type:"Type de fiche",clickToClose:"Cliquer pour fermer",removeSelected:"Supprimer la slection","metadata.update.new":"Chargement en cours ...","metadata.update.forget.new":"R-initialisation en cours ...",ownerName:"Rdacteur de la mtadonne",setPrivileges:"Dfinir les privilges",setCategories:"Choisir les catgories",massiveOp:"Opration sur la slection",prepareDownload:"Tlcharger les fichiers",mdMenu:"Actions",deleteRecord:"Supprimer la mtadonne ?",deleteConfirm:"Confirmez-vous la suppression de la mtadonne ?",deleteRecordSuccess:"Metadonne supprime",deleteRecordFailure:"chec lors de la suppression de la mtadonne",advancedSearchOptions:"Critres avancs",getMEF:"Export (ZIP)",metadataCategories:"Catgories",validityInfo:"Information sur la validation",lastUpdate:"Dernire mise  jour : ",importMetadata:"Import de mtadonnes",validationStatus:"Validation ",valid:"Valide",notValid:"Non valide",notDetermined:"Non dtermin",addToMap:"Ajouter  la carte : ",downloadLink:"Tlcharger : ",webLink:"Site web : ",viewKml:"Visualiser avec GoogleEarth : ",layerTree:"Gestion des couches",mdResultsLayer:"Rsultats de la recherche",printLayer:"Page de l'impression",relatedservices:"Services associs",relatedparent:"Mtadonne parent",relateddatasets:"Mtadonnes associes",relatedchildren:"Enfants",relatedrelated:"Relation catalogue d'attributs/donnes",delete19110Relation:"Supprimer le lien cat. d'attributs",newWindow:"Nouvelle fentre",addAsXLink:"Ajout d'un lment li",contactSelectionWindowTitle:"Slection des contacts",selectedContacts:"Contacts slectionns",foundContacts:"Contacts disponibles",contactRole:"Rle du contact",mapNearYou:"Centrer la carte sur votre position",create:"Crer",errorChangeProtocol:"Impossible de changer le protocol lorsqu'un fichier est attach. Supprimer le fichier.",resultBy:" resultat(s) / ",subTemplateImport:"Importer un lment dans un annuaire",xmlData:"XML",minorEdit:"Modif. mineure",minorEditTT:"Lorsque cette option est active, la date de mise  jour des mtadonnes n'est pas change. Lors de l'utilisation des suggestions, ou de la mise  jour d'une imagette, cette option est sans effet, la date est mise  jour.",runSearch:"Lancer la recherche.",focusOnAny:"Dplacer le curseur sur le critre plein texte.",hideSearchForm:"Afficher ou cacher le formulaire de recherche.",switchMode:"Basculer de mode de visualisation.",resetSearchForm:"Rinitialiser le formulaire de recherche.",focusOnLogin:"Dplacer le curseur sur le formulaire de connexion.",displayInfoPanel:"Afficher la page d'information.",displayHelpPanel:"Afficher cette page d'aide.",SelectionWindowTitle:"Rechercher dans l'annuaire",found:"Enregistrements trouvs","add-extent-from-geokeywordsreplace":"Remplacer les tendues gographiques existantes","add-info-from-wmssetExtent":"Dfinir l'tendue","add-info-from-wmssetAndReplaceExtent":"Remplacer les tendues existantes","add-info-from-wmssetCRS":"Ajouter les systmes de coordonnes","add-info-from-wmssetDynamicGraphicOverview":"Dfinir l'aperu (en ajoutant une URL vers une requte GetMap)","add-info-from-wmswmsServiceUrl":"URL du service","linked-data-checkerlinkUrl":"Lien  supprimer","related-metadata-checkeruuidToRemove":"Identifiant  supprimer","add-service-info-from-wxssetAndReplaceOperations":"Remplacer les oprations existantes","add-service-info-from-wxswxsServiceUrl":"URL du service",manageDirectories:"Gestion des annuaires",directory:"Annuaire",thesaurusManager:"Gestion des thsaurus",Theme:"Thme",thesaurusFilePath:"Fichier (.rdf)",ThesaurusName:"Nom du thsaurus",createThesaurusFromURL:"A partir d'une URL",createThesaurusFromRepository:"A partir du dpt partag",creationMode:"Crer",thesaurusFromRepository:"Thsaurus",externalThesaurusURL:"URL",thesaurusCreation:"Ajout d'un thsaurus",Type:"Type",Activated:"Activ",emptyThesaurus:"Nouveau thsaurus vide",thesaurusFromFile:"A partir d'un fichier local",thesaurusFromURL:"A partir d'un fichier distant (URL)",id:"Identifiant",label:"Libell",definition:"Dfinition",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Libell",newDefinition:"Dfinition",selDirectoryTT:"Choisir un type d'annuaire. Un annuaire est constitu d'lments ayant la mme balise racine (eg. les lments gmd:CI_ResponsibleParty font partie de l'annuaire de contact)",privTplElTT:"Grer les privilges sur la slection.",addTplElTT:"Ajouter un lment  partir d'un fragment d'XML. L'annuaire cible est bas sur le nom de la balise racine (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Crer un nouvel lment dans l'annuaire  partir de l'lment slectionn.",delTplElTT:"Supprimer la slection."};
OpenLayers.Util.extend(OpenLayers.Lang.fr,GeoNetwork.Lang.fr);Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.nl={featureInfoTooltipTitle:"Attribuut-informatie",featureInfoTooltipText:"Klik in de kaart om attribuut-informatie op te vragen van alle zichtbare lagen.",zoomToMaxExtentTooltipTitle:"Volledig kaartbeeld",zoomToMaxExtentTooltipText:"Klik op deze button om naar het volledig kaartbeeld te zoomen.",zoominTooltipTitle:"Zoom in",zoominTooltipText:"Trek een kader in kaart om in te zoomen. Ook kan er geklikt worden in de kaart waarna er met een factor 2 ingezoomd wordt.",zoomoutTooltipTitle:"Zoom uit",zoomoutTooltipText:"Klik in de kaart om gecentreerd op dit punt met een factor 2 uit te zoomen. Ook kan er een kader in de kaart getrokken worden, hoe kleiner dit kader hoe verder er uitgezoomd zal worden.",dragTooltipTitle:"Verschuif kaart",dragTooltipText:"Houd de linker muisknop ingedrukt en versleep de kaart.",previousTooltipTitle:"Vorige kaart extent",previosTooltipText:"Klik op deze button om terug te gaan naar de vorige kaart extent",nextTooltipTitle:"Volgende kaart extent",nextTooltipText:"Klik op deze button om verder te gaan naar de volgende kaart extent",featureInfoTitle:"Attribuut-informatie",layerManagerTabTitle:"Kaartlagenbeheer",legendTabTitle:"Legenda",scaleTitle:"Schaal",xTitle:"X",yTitle:"Y",projectionTitle:"Projectie",FeatureInfoNotQueryable:"Er is geen bevraagbare kaartlaag",WMSBrowserTab1:"Selecteren",WMSBrowserTab3:"Extern",WMSBrowserPreviewTitle:"Preview kaartlaag",WMSBrowserAddButton:"Voeg toe",WMSBrowserDuplicateMsg:"Kaartlaag is reeds aanwezig.",WMSBrowserPreviewWaitMsg:"Preview image ophalen",WMSBrowserConnectButton:"Maak verbinding",WMSBrowserConnectError:"Er is een fout opgetreden bij het maken van de verbinding, controleer de URL.",infoTitle:"Informatie","mf.print.mapTitle":"Titel","mf.print.comment":"Opmerkingen","mf.print.dpi":"Resolutie","mf.print.scale":"Schaal","mf.print.rotation":"Rotatie","mf.print.resetPos":"Terug naar begininstellingen","mf.print.print":"Print","mf.print.generatingPDF":"Aanmaken PDF","mf.print.unableToPrint":"Het was helaas niet mogelijk om te printen, probeert u het svp later nogmaals","mf.error":"Fout",selectExtentTooltipTitle:"Begrens zoekgebied",selectExtentTooltipText:"Begrens het zoekgebied door in de kaart een kader te trekken.",printTooltipTitle:"Print",printTooltipText:"Print de huidige kaart",savewmcTooltipTitle:"Opslaan WMC",savewmcTooltipText:"Sla een Web Map Context document op.","saveWMCFile.windowTitle":"Opslaan Web Map Context","saveWMCFile.errorSaveWMC":"Kon het WMC bestand niet opslaan",loadwmcTooltipTitle:"Open WMC",loadwmcTooltipText:"Opent een bestaand Web Map Context document in de kaart viewer","selectWMCFile.windowTitle":"Openen Web Map Context",selectWMCFile:"Select WMC bestand","selectWMCFile.waitLoadingWMC":"Laden Web Map Context","selectWMCFile.loadButtonText":"Openen","selectWMCFile.mergeButtonText":"Samenvoegen","selectWMCFile.errorLoadingWMC":"Kon het Web Map Context bestand niet openen",opacityButtonText:"Opaciteit",opacityWindowTitle:"Opaciteit",metadataButtonText:"Metadata",removeButtonText:"Verwijderen",addWMSButtonText:"Voeg WMS toe",addWMSWindowTitle:"Voeg WMS toe","layerInfoPanel.windowTitle":"Metadata van de kaartlaag","layerInfoPanel.titleField":"Titel","layerInfoPanel.descriptionField":"Samenvatting","layerInfoPanel.queryableField":"Bevraagbaar",layerList:"Kaartlagen",baseLayerList:"Ondergrond","metadataResults.buttonText":"Metadata resultaten","metadataResults.tooltipTitle":"Metadata resultaten","metadataResults.tooltipText":"Ga naar de metadata resultaatpagina","metadataResults.alertTitle":"Metadata resultaten","metadataResults.alertText":"Geen metadata resultaten om te tonen","featureInfoWindow.windowTitle":"Attribuut-informatie","mf.information":"Print","mf.print.pdfReady":"PDF gereed","loadLayer.loadingMessage":"Ophalen kaartlaag","loadLayer.error.title":"Ophalen kaartlaag","loadLayer.error.message":"De kaartlaag kon niet worden geladen","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Laden...","disclaimer.buttonClose":"Sluiten",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",searchOptionButton:"Zoek",GazetteerWindowTitle:"Zoek adres",searchResults:"Zoekresultaten",errorTitle:"Fout",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar. \n",gazetteerTooltipTitle:"Zoek op basis van een adres",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",SearchOptionNoResults:"Geen resultaten gevonden",zoomlayerTooltipTitle:"Zoom naar laag",zoomlayerTooltipText:"Gebruik deze knop om naar de volledige omvang van de geselecteerde laag.","zoomlayer.selectLayerTitle":"Zoom naar laag","zoomlayer.selectLayerText":"Geen laag geselecteerd",layerStylesWindowTitle:"Kaartlaag stijlen",layerStylesPreviewTitle:"Maak een voorvertoning van de legenda",selectStyleButton:"Selecteer kaartstijl",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Kies een tijdstip",WMSTimeMovieTitle:"Speel een animatie af",wmsTimeUpdateButtonText:"Doorvoeren",WMSTimeAnimationCheckbox:"Speel laatste ${steps} tijdstippen af"};
OpenLayers.Util.extend(OpenLayers.Lang.nl,GeoNetwork.Lang.nl);Ext.namespace("GeoNetwork");
GeoNetwork.LoginForm=Ext.extend(Ext.FormPanel,{url:"",id:"loginForm",width:340,border:false,layout:"hbox",catalogue:undefined,defaults:{},defaultType:"textfield",username:undefined,password:undefined,userInfo:undefined,loginBt:undefined,adminBt:undefined,logoutBt:undefined,initComponent:function(){var form=this;
this.username=new Ext.form.TextField({name:"username",width:70,hideLabel:true,allowBlank:false,emptyText:OpenLayers.i18n("username")});
this.password=new Ext.form.TextField({name:"password",width:70,hideLabel:true,allowBlank:false,emptyText:OpenLayers.i18n("password"),inputType:"password"});
this.userInfo=new Ext.form.Label({width:170,text:"",cls:"loginInfo"});
this.loginBt=new Ext.Button({width:50,text:OpenLayers.i18n("login"),iconCls:"md-mn mn-login",listeners:{click:function(){this.catalogue.login(this.username.getValue(),this.password.getValue())
},scope:form}});
this.adminBt=new Ext.Button({width:80,text:OpenLayers.i18n("administration"),listeners:{click:function(){catalogue.admin()
},scope:this}});
this.logoutBt=new Ext.Button({width:80,text:OpenLayers.i18n("logout"),iconCls:"md-mn mn-logout",listeners:{click:function(){catalogue.logout()
},scope:this}});
this.items=[this.username,this.password,this.userInfo,this.loginBt,this.adminBt,this.logoutBt];
GeoNetwork.LoginForm.superclass.initComponent.call(this);
var loggedIn=this.catalogue.isLoggedIn();
this.login(this.catalogue,loggedIn);
this.catalogue.on("afterLogin",this.login,this);
this.catalogue.on("afterLogout",this.login,this)
},login:function(cat,user){var status=user?true:false;
this.username.setVisible(!status);
this.password.setVisible(!status);
if(cat.identifiedUser&&cat.identifiedUser.username){this.userInfo.setText(cat.identifiedUser.name+" "+cat.identifiedUser.surname+" <br/>("+cat.identifiedUser.role+")",false)
}else{this.userInfo.setText("")
}this.userInfo.setVisible(status);
this.loginBt.setVisible(!status);
this.logoutBt.setVisible(status);
if(this.catalogue.adminAppUrl!==""){this.adminBt.setVisible(status)
}this.doLayout(false,true)
}});
Ext.reg("gn_loginform",GeoNetwork.LoginForm);Ext.namespace("GeoNetwork");
GeoNetwork.MetadataMenu=Ext.extend(Ext.menu.Menu,{record:undefined,setRecord:function(record){this.record=record
},resultsView:undefined,catalogue:undefined,editAction:undefined,deleteAction:undefined,zoomToAction:undefined,otherActions:undefined,adminMenuSeparator:undefined,duplicateAction:undefined,createChildAction:undefined,adminAction:undefined,categoryAction:undefined,viewAction:undefined,printAction:undefined,viewXMLAction:undefined,getMEFAction:undefined,ratingWidget:undefined,defaultConfig:{},create:function(){this.editAction=new Ext.Action({text:OpenLayers.i18n("edit"),iconCls:"md-mn-edit",handler:function(){var id=this.record.get("id");
this.catalogue.metadataEdit(id)
},scope:this});
this.add(this.editAction);
this.deleteAction=new Ext.Action({text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var id=this.record.get("uuid");
this.catalogue.metadataDelete(id)
},scope:this});
this.add(this.deleteAction);
this.duplicateAction=new Ext.Action({text:OpenLayers.i18n("duplicate"),iconCls:"md-mn-copy",handler:function(){var id=this.record.get("id");
GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,id,OpenLayers.i18n("duplicate"),false)
},scope:this});
this.createChildAction=new Ext.Action({text:OpenLayers.i18n("createChild"),iconCls:"md-mn-copy",handler:function(){var id=this.record.get("id");
GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,id,OpenLayers.i18n("createChild"),true)
},scope:this});
this.adminAction=new Ext.Action({text:OpenLayers.i18n("privileges"),iconCls:"privIcon",handler:function(){var id=this.record.get("id");
this.catalogue.metadataAdmin(id)
},scope:this});
this.categoryAction=new Ext.Action({text:OpenLayers.i18n("categories"),handler:function(){var id=this.record.get("id");
this.catalogue.metadataCategory(id)
},scope:this});
this.otherActions=new Ext.menu.Item({text:OpenLayers.i18n("otherActions"),menu:{items:[this.duplicateAction,this.createChildAction,this.adminAction,this.categoryAction]}});
this.add(this.otherActions);
this.adminMenuSeparator=new Ext.menu.Separator();
this.add(this.adminMenuSeparator);
this.viewAction=new Ext.Action({text:OpenLayers.i18n("view"),iconCls:"md-mn-view",handler:function(){var id=this.record.get("uuid");
this.catalogue.metadataShow(id)
},scope:this});
this.add(this.viewAction);
this.zoomToAction=new Ext.Action({text:OpenLayers.i18n("zoomTo"),iconCls:"zoomlayer",handler:function(){var uuid=this.record.get("uuid");
this.resultsView.zoomTo(uuid)
},scope:this});
this.add(this.zoomToAction);
this.viewXMLAction=new Ext.Action({text:OpenLayers.i18n("saveXml"),iconCls:"xmlIcon",handler:function(){var id=this.record.get("uuid");
var schema=this.record.get("schema");
this.catalogue.metadataXMLShow(id,schema)
},scope:this});
this.add(this.viewXMLAction);
this.printAction=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.metadataPrint(this.record.get("uuid"))
},scope:this});
this.add(this.printAction);
this.getMEFAction=new Ext.Action({text:OpenLayers.i18n("getMEF"),iconCls:"md-mn-zip",handler:function(){this.catalogue.metadataMEF(this.record.get("uuid"))
},scope:this});
this.add(this.getMEFAction);
if(Ext.ux.RatingItem){this.ratingWidget=new Ext.ux.RatingItem(null,{canReset:false,name:"rating",disabled:true,nbStars:5,cls:"ux-menu-rating-item",listeners:{change:function(e,value,star){if(value){var uuid=this.record.get("uuid");
this.catalogue.metadataRate(uuid,value,this.hide());
this.ratingWidget.reset()
}},scope:this}});
this.add(this.ratingWidget)
}this.updateMenu()
},updateMenu:function(){if(!this.record){return
}var isEditable=this.record.get("edit")==="true"?true:false,isHarvested=this.record.get("isharvested")==="y"?true:false,harvesterType=this.record.get("harvestertype"),identified=this.catalogue.isIdentified();
if(!identified){this.editAction.hide();
this.deleteAction.hide()
}else{this.editAction.show();
this.deleteAction.show()
}this.otherActions.setVisible(identified);
this.adminMenuSeparator.setVisible(identified);
this.editAction.setDisabled(!isEditable);
this.adminAction.setDisabled(!isEditable);
this.categoryAction.setDisabled(!isEditable);
this.deleteAction.setDisabled(!isEditable);
if(this.ratingWidget){this.ratingWidget.reset();
if(isHarvested&&harvesterType!=="geonetwork"){this.ratingWidget.disable()
}else{this.ratingWidget.enable()
}}},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
GeoNetwork.MetadataMenu.superclass.initComponent.call(this);
this.create()
}});
Ext.reg("gn_metadatamenu",GeoNetwork.MetadataMenu);Ext.namespace("GeoNetwork");
GeoNetwork.MetadataResultsView=Ext.extend(Ext.DataView,{catalogue:undefined,templates:null,overClass:"md-over",itemSelector:"li.md",emptyText:"",autoWidth:true,maps:[],mapsProjection:"EPSG:4326",projectionFrom:undefined,projectionTo:undefined,mdSelectionUuids:[],layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),layer_style_hover:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),layer_style_selected:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),features:[],hover_feature:[],contextMenu:undefined,contextMenuNodeId:undefined,acMenu:undefined,newMetadataWindow:undefined,plugins:[],listeners:{dblclick:{fn:function(dv,idx,node,e){if(this.maps){var record=this.getStore().getAt(idx);
var uuid=record.get("uuid");
this.zoomTo(uuid)
}}},mouseenter:{fn:function(dv,idx,node,e){var i,j;
if(this.maps){var record=this.getStore().getAt(idx);
var uuid=record.get("uuid");
for(j=0;
j<this.maps.length;
j++){var l=this.maps[j].layer;
if(l.features){for(i=0;
i<l.features.length;
i++){if(uuid===l.features[i].attributes.id){l.drawFeature(l.features[i],this.layer_style_hover);
this.hover_feature[j]=l.features[i];
continue
}}}}}this.actionMenuInit(idx,node)
}},mouseleave:{fn:function(dv,idx,node,e){var i;
if(this.acMenu){this.acMenu.hide()
}this.acMenu=undefined;
if(this.maps){for(i=0;
i<this.maps.length;
i++){if(this.hover_feature[i]){var l=this.maps[i].layer;
l.drawFeature(this.hover_feature[i],this.layer_style);
this.hover_feature[i]=null;
continue
}}}}},contextmenu:{fn:function(dv,idx,node,e){this.contextMenuNodeId=idx;
this.createMenu(idx,dv);
this.contextMenu.showAt(e.getXY());
e.stopEvent()
}}},actionMenuInit:function(idx,node){this.acMenu=Ext.get(Ext.DomQuery.selectNode("span.md-action-menu",node));
this.acMenu.on("click",function(){this.createMenu(idx,this);
this.contextMenu.showAt([this.acMenu.getX(),this.acMenu.getY()+this.acMenu.getHeight()])
}.bind(this));
this.acMenu.show()
},createMenu:function(id,dv){var record=this.getStore().getAt(id);
if(!this.contextMenu){this.contextMenu=new GeoNetwork.MetadataMenu({floating:true,catalogue:catalogue,record:record,resultsView:dv})
}else{this.contextMenu.setRecord(record)
}},zoomTo:function(uuid){var i,j;
for(j=0;
j<this.maps.length;
j++){var l=this.maps[j].layer;
if(l.features){for(i=0;
i<l.features.length;
i++){if(uuid===l.features[i].attributes.id){var bounds=l.features[i].geometry.getBounds();
if(bounds){this.maps[j].map.zoomToExtent(bounds)
}break
}}}}},initComponent:function(config){var i;
this.templates={SIMPLE:GeoNetwork.Templates.SIMPLE,THUMBNAIL:GeoNetwork.Templates.THUMBNAIL,FULL:GeoNetwork.Templates.FULL};
GeoNetwork.MetadataResultsView.superclass.initComponent.call(this);
this.store=this.catalogue.metadataStore;
this.initStyle();
if(this.maps){if(this.maps instanceof OpenLayers.Map){var map=this.maps;
this.maps=[];
this.addMap(map)
}else{for(i=0;
i<this.maps.length;
i++){var m=this.maps[i];
this.initMap(m)
}}}else{this.maps=[]
}this.getStore().on({load:this.resultsLoaded,clear:this.destroyMetadataBbox,scope:this});
this.on("selectionchange",this.selectionChange)
},addMap:function(map,zoomToExtentOnSearch){var found=false,i;
for(i=0;
i<this.maps.length;
i++){if(this.maps[i].map.id===map.id){found=true;
break
}}if(!found){var m={map:map,zoomToExtentOnSearch:zoomToExtentOnSearch||false};
this.mapsProjection=map.projection;
this.projectionFrom=new OpenLayers.Projection("EPSG:4326");
this.projectionTo=new OpenLayers.Projection(this.mapsProjection);
this.maps.push(m);
this.initMap(m)
}},initMap:function(map){var l=new OpenLayers.Layer.Vector(OpenLayers.i18n("mdResultsLayer"),{style:this.layer_style});
this.addCurrentFeatures(l);
map.layer=l;
map.map.addLayer(l)
},removeMap:function(mapId){this.maps.splice(mapId,1)
},getTemplates:function(){return this.templates
},removeTemplate:function(name){delete this.templates[name]
},addTemplate:function(name,template){this.templates[name]=template
},applyTemplate:function(name){this.tpl=this.templates[name];
this.refresh()
},initStyle:function(){this.layer_style.fillOpacity=0;
this.layer_style.graphicOpacity=1;
this.layer_style_selected.fillOpacity=0.1;
this.layer_style_hover.fillOpacity=0.3;
this.layer_style_hover.strokeWidth=3
},destroyMetadataBbox:function(){var i;
for(i=0;
i<this.maps.length;
i++){var l=this.maps[i].layer;
if(l.features){if(l.features.length>0){this.features=[];
l.destroyFeatures()
}}}},resultsLoaded:function(view,records,options){this.drawMetadataBbox(view,records,options);
this.contextMenu=undefined;
this.initRatingWidget();
this.initSelector()
},drawMetadataBbox:function(view,records,options){var i,j;
Ext.each(records,function(r){var bboxes=r.get("bbox");
if(bboxes){var polygons=[];
for(j=0;
j<bboxes.length;
j++){var bbox=bboxes[j].value;
var p1=new OpenLayers.Geometry.Point(bbox[2],bbox[1]);
var p2=new OpenLayers.Geometry.Point(bbox[2],bbox[3]);
var p3=new OpenLayers.Geometry.Point(bbox[0],bbox[3]);
var p4=new OpenLayers.Geometry.Point(bbox[0],bbox[1]);
if(this.mapsProjection!=="EPSG:4326"){p1.transform(this.projectionFrom,this.projectionTo);
p2.transform(this.projectionFrom,this.projectionTo);
p3.transform(this.projectionFrom,this.projectionTo);
p4.transform(this.projectionFrom,this.projectionTo)
}var pointList=[p1,p2,p3,p4,p1];
var linearRing=new OpenLayers.Geometry.LinearRing(pointList);
var polygon=new OpenLayers.Geometry.Polygon([linearRing]);
polygons.push(polygon.clone())
}var multipolygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(polygons),{id:r.get("uuid")});
this.features.push(multipolygon.clone())
}},this);
for(i=0;
i<this.maps.length;
i++){this.addCurrentFeatures(this.maps[i].layer)
}if(this.features.length>0){for(i=0;
i<this.maps.length;
i++){var m=this.maps[i];
if(m.zoomToExtentOnSearch){m.map.zoomToExtent(m.layer.getDataExtent())
}}}},initRatingWidget:function(){var ratingWidgets=Ext.DomQuery.select("div.rating"),idx;
for(idx=0;
idx<ratingWidgets.length;
++idx){if(Ext.ux.RatingItem){var ri=new Ext.ux.RatingItem(ratingWidgets[idx],{disabled:true,name:"rating"+idx})
}else{ratingWidgets[idx].style.display="none"
}}},initSelector:function(){},selectAll:function(){var checkboxes=Ext.DomQuery.select("input.selector"),idx;
for(idx=0;
idx<checkboxes.length;
++idx){checkboxes[idx].checked=true
}},selectAllInPage:function(){var checkboxes=Ext.DomQuery.select("input.selector"),idx;
for(idx=0;
idx<checkboxes.length;
++idx){checkboxes[idx].checked=true;
Ext.each(this.getRecords(this.getNodes()),function(r){var uuid=r.get("uuid");
this.catalogue.metadataSelect("add",[uuid])
},this)
}},selectNone:function(){var checkboxes=Ext.DomQuery.select("input.selector"),idx;
for(idx=0;
idx<checkboxes.length;
++idx){checkboxes[idx].checked=false
}},initSelection:function(records){var selection=[];
Ext.each(records,function(r){var isSelected=r.get("selected");
if(isSelected==="true"){selection.push(r)
}});
this.select(selection);
this.on("selectionchange",this.selectionChange)
},selectionChange:function(dv,nodes){if(this.catalogue){var records=this.getRecords(nodes);
var selected={};
var toAdd=[];
var toRemove=[];
var i;
var uuid;
for(i=0;
i<records.length;
i++){uuid=records[i].get("uuid");
selected[uuid]=true
}for(i=0;
i<this.mdSelectionUuids.length;
i++){uuid=this.mdSelectionUuids[i];
if(selected[uuid]){toAdd.push(uuid)
}else{toRemove.push(uuid)
}}for(uuid in selected){if(selected.hasOwnProperty(uuid)&&!this.mdSelectionUuids[uuid]){toAdd.push(uuid)
}}this.catalogue.metadataSelect("add",toAdd);
this.catalogue.metadataSelect("remove",toRemove);
this.mdSelectionUuids=toAdd
}},addCurrentFeatures:function(layer){var len=this.features.length,j;
if(len>0){var clones=[];
clones=[];
var orig,clone;
for(j=0;
j<len;
j++){orig=this.features[j];
clone=orig.clone();
clones[j]=clone
}layer.addFeatures(clones)
}},onDestroy:function(){GeoNetwork.MetadataResultsView.superclass.onDestroy.apply(this,arguments)
}});
Ext.reg("gn_metadataresultsview",GeoNetwork.MetadataResultsView);Ext.namespace("GeoNetwork");
GeoNetwork.MetadataResultsToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,metadataResultsView:undefined,mdSelectionInfoCmp:undefined,searchBtCmp:undefined,sortByCmp:undefined,sortByCombo:undefined,mdSelectionInfo:"md-selection-info",selectionActions:[],deleteAction:undefined,otherItem:undefined,ownerAction:undefined,updateCategoriesAction:undefined,updatePrivilegesAction:undefined,createMetadataAction:undefined,newMetadataWindow:undefined,mdImportAction:undefined,adminAction:undefined,actionMenu:undefined,item:null,actionOnSelectionMenu:undefined,admin:false,initComponent:function(){var cmp=[];
cmp.push(this.createSelectionToolBar());
cmp.push(["->"]);
var sortOption=this.getSortByCombo();
cmp.push(OpenLayers.i18n("sortBy"),sortOption,"|");
cmp.push(this.createTemplateMenu());
cmp.push(this.createOtherActionMenu());
GeoNetwork.MetadataResultsToolbar.superclass.initComponent.call(this);
this.add(cmp);
this.catalogue.on("selectionchange",this.updateSelectionInfo,this);
this.catalogue.on("afterLogin",this.updatePrivileges,this);
this.catalogue.on("afterLogout",this.updatePrivileges,this);
this.updateSelectionInfo(this.catalogue,0)
},getSortByCombo:function(){var tb=this;
this.sortByCombo=new Ext.form.ComboBox({mode:"local",id:"sortByToolBar",triggerAction:"all",value:"relevance",width:130,store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{select:function(cb,record,idx){if(this.sortByCmp){this.sortByCmp.setValue(cb.getValue());
var tokens=cb.getValue().split("#");
Ext.getCmp("E_sortBy").setValue(tokens[0]);
Ext.getCmp("sortOrder").setValue(tokens[1])
}if(this.searchBtCmp){this.searchBtCmp.fireEvent("click")
}},scope:tb}});
return this.sortByCombo
},clickTemplateMenu:function(item,pressed){if(pressed){this.applyTemplate(item.getId())
}this.initRatingWidget()
},createMassiveActionMenu:function(hide){this.deleteAction=new Ext.menu.Item({text:OpenLayers.i18n("delete"),iconCls:"cancel",id:"deleteAction",handler:function(){this.catalogue.massiveOp("Delete")
},scope:this,hidden:hide});
this.ownerAction=new Ext.menu.Item({text:OpenLayers.i18n("newOwner"),id:"ownerAction",handler:function(){this.catalogue.massiveOp("NewOwner")
},scope:this,hidden:hide});
this.updateCategoriesAction=new Ext.menu.Item({text:OpenLayers.i18n("updateCategories"),id:"updateCategoriesAction",handler:function(){this.catalogue.massiveOp("Categories")
},scope:this,hidden:hide});
this.updatePrivilegesAction=new Ext.menu.Item({text:OpenLayers.i18n("updatePrivileges"),id:"updatePrivilegesAction",iconCls:"privIcon",handler:function(){this.catalogue.massiveOp("Privileges")
},scope:this,hidden:hide});
this.selectionActions.push(this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction);
this.actionMenu.addItem(this.deleteAction);
this.actionMenu.addItem(this.ownerAction);
this.actionMenu.addItem(this.updateCategoriesAction);
this.actionMenu.addItem(this.updatePrivilegesAction)
},createAdminMenu:function(hide){this.actionMenu.addItem("-");
this.otherItem=new Ext.menu.TextItem({html:'<b class="menu-title">'+OpenLayers.i18n("adminAction")+"</b>",hidden:true});
this.actionMenu.addItem(this.otherItem);
this.createMetadataAction=new Ext.menu.Item({text:OpenLayers.i18n("newMetadata"),iconCls:"addIcon",handler:function(){if(this.newMetadataWindow){this.newMetadataWindow.close();
this.newMetadataWindow=undefined
}if(!this.newMetadataWindow){var newMetadataPanel=new GeoNetwork.editor.NewMetadataPanel({getGroupUrl:this.catalogue.services.getGroups,catalogue:this.catalogue});
this.newMetadataWindow=new Ext.Window({title:OpenLayers.i18n("newMetadata"),width:600,height:420,layout:"fit",modal:true,items:newMetadataPanel,closeAction:"hide",constrain:true,iconCls:"addIcon"})
}this.newMetadataWindow.show()
},scope:this,hidden:hide});
this.actionMenu.addItem(this.createMetadataAction);
this.mdImportAction=new Ext.menu.Item({text:OpenLayers.i18n("importMetadata"),handler:function(){this.catalogue.metadataImport()
},scope:this,hidden:hide});
this.actionMenu.addItem(this.mdImportAction);
this.adminAction=new Ext.menu.Item({text:OpenLayers.i18n("administration"),handler:function(){this.catalogue.admin()
},scope:this,hidden:hide});
this.actionMenu.addItem(this.adminAction)
},createTemplateMenu:function(){var tpls=this.metadataResultsView.getTemplates();
var data=[];
var t;
for(t in tpls){if(tpls.hasOwnProperty(t)){var tg=new Ext.Button({text:"",enableToggle:true,toggleGroup:"tpl",id:t,iconCls:"mn-view-"+t.toLowerCase(),toggleHandler:this.clickTemplateMenu,scope:this.metadataResultsView,pressed:(t==="FULL"?true:false)});
data.push(tg)
}}return[data,"|"]
},createOtherActionMenu:function(){this.actionMenu=new Ext.menu.Menu();
var csvExportAction=new Ext.Action({text:OpenLayers.i18n("exportCsv"),handler:function(){this.catalogue.csvExport()
},scope:this});
var mefExportAction=new Ext.Action({text:OpenLayers.i18n("exportZip"),iconCls:"md-mn-zip",handler:function(){this.catalogue.mefExport()
},scope:this});
var printAction=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.pdfExport()
},scope:this});
this.selectionActions.push(mefExportAction,csvExportAction,printAction);
this.actionMenu.add('<b class="menu-title">'+OpenLayers.i18n("onSelection")+"</b>",mefExportAction,csvExportAction,printAction);
this.createMassiveActionMenu(!this.catalogue.isIdentified());
this.createAdminMenu(!this.catalogue.isIdentified());
this.actionOnSelectionMenu=new Ext.Button({text:OpenLayers.i18n("otherActions"),menu:this.actionMenu});
return this.actionOnSelectionMenu
},createSelectionToolBar:function(){var selectAllInPageAction=new Ext.Action({text:OpenLayers.i18n("allInPage"),handler:function(){this.metadataResultsView.selectAllInPage()
},scope:this});
var selectAllAction=new Ext.Action({text:OpenLayers.i18n("all"),handler:function(){this.catalogue.metadataSelectAll();
this.metadataResultsView.selectAll()
},scope:this});
var selectNoneAction=new Ext.Action({text:OpenLayers.i18n("none"),handler:function(){this.catalogue.metadataSelectNone();
this.metadataResultsView.selectNone()
},scope:this});
var mdSelectionInfoCmp={id:"md-selection-info",xtype:"tbtext",text:OpenLayers.i18n("noneSelected")};
this.catalogue.on("selectionchange",this.updateSelectionInfo,this);
return[mdSelectionInfoCmp,"|",{xtype:"tbtext",text:OpenLayers.i18n("select")},selectAllInPageAction,{xtype:"tbtext",text:", "},selectAllAction,{xtype:"tbtext",text:", "},selectNoneAction]
},updateSelectionInfo:function(catalogue,nb){if(!this.mdSelectionInfoCmp){this.mdSelectionInfoCmp=Ext.getCmp(this.mdSelectionInfo)
}Ext.each(this.selectionActions,function(e){if(nb===0){e.disable()
}else{e.enable()
}});
this.mdSelectionInfoCmp.setText(nb+" "+OpenLayers.i18n("selected"))
},updatePrivileges:function(catalogue,user){var actions=[this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction,this.createMetadataAction,this.mdImportAction,this.mdImportAction,this.adminAction,this.otherItem];
Ext.each(actions,function(){this.setVisible(user)
})
},onDestroy:function(){GeoNetwork.MetadataResultsToolbar.superclass.onDestroy.apply(this,arguments)
}});
Ext.reg("gn_metadataresultstoolbar",GeoNetwork.MetadataResultsToolbar);Ext.namespace("GeoNetwork");
GeoNetwork.TagCloudView=Ext.extend(Ext.DataView,{catalogue:undefined,multiSelect:true,root:"keywords.keyword",qurey:undefined,searchField:"themekey",onSuccess:null,onFailure:null,overClass:"tag-cloud-hover",itemSelector:"li.tag-cloud",emptyText:"",autoWidth:true,listeners:{selectionchange:{fn:function(dv,nodes){}},dblclick:{fn:function(dv,idx,node,e){}}},initComponent:function(){GeoNetwork.TagCloudView.superclass.initComponent.call(this);
this.tpl=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="tag-cloud tag-cloud-{class}">','<a href="#" onclick="javascript:catalogue.kvpSearch(\'fast=false&summaryOnly=0&from=1&to=20&hitsPerPage=20&'+this.searchField+"={value}', "+this.onSuccess+","+this.onFailure+', null);" alt="{value}" title="{count} records">{value}</a>',"</li>","</tpl>","</ul>");
this.store=this.catalogue.summaryStore;
if(this.query){this.catalogue.kvpSearch(this.query,null,null,null,true)
}}});
Ext.reg("gn_tagcloudview",GeoNetwork.TagCloudView);Ext.namespace("GeoNetwork");
GeoNetwork.Templates=Ext.extend(Ext.XTemplate,{compiled:false,disableFormats:false,catalogue:null,sortOrder:0,abstractMaxSize:50,xmlTplMarkup:['<?xml version="1.0" encoding="UTF-8"?>','<node id="{id}" type="{type}">',"<site>","<name>{site_name}</name>",'<tpl if="values.site_ogctype">',"<ogctype>{site_ogctype}</ogctype>","</tpl>",'<tpl if="values.site_url">',"<url>{site_url}</url>","</tpl>",'<tpl if="values.site_icon">',"<icon>{site_icon}</icon>","</tpl>",'<tpl if="values.site_account_use">',"<account>","<use>{site_account_use}</use>","<username>{site_account_username}</username>","<password>{site_account_password}</password>","</account>","</tpl>","</site>","<options>",'<tpl if="values.options_every">',"<every>{options_every}</every>","</tpl>",'<tpl if="values.options_onerunonly">',"<oneRunOnly>{options_onerunonly}</oneRunOnly>","</tpl>",'<tpl if="values.options_lang">',"<lang>{options_lang}</lang>","</tpl>",'<tpl if="values.options_topic">',"<topic>{options_topic}</topic>","</tpl>",'<tpl if="values.options_createthumbnails">',"<createThumbnails>{options_createthumbnails}</createThumbnails>","</tpl>",'<tpl if="values.options_uselayer">',"<useLayer>{options_uselayer}</useLayer>","</tpl>",'<tpl if="values.options_uselayermd">',"<useLayerMd>{options_uselayermd}</useLayerMd>","</tpl>",'<tpl if="values.options_datasetcategory">',"<datasetcategory>{options_datasetcategory}</datasetcategory>","</tpl>","</options>","<content>","</content>","<privileges>","</privileges>",'<group id="1">','<operation name="view" />','<operation name="dynamic" />',"</group>","<categories>","</categories>",'<tpl if="values.info_result_total">',"</tpl>","</node>"],initComponent:function(){GeoNetwork.Templates.superclass.initComponent.call(this)
},getHarvesterTemplate:function(){return new Ext.XTemplate(this.xmlTplMarkup)
}});
GeoNetwork.Templates.TITLE='<h1><input type="checkbox" <tpl if="selected==\'true\'">checked="true"</tpl> class="selector" onclick="javascript:catalogue.metadataSelect((this.checked?\'add\':\'remove\'), [\'{uuid}\']);"/><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');">{title}</a><span class="md-action-menu"> - <a rel="mdMenu">'+OpenLayers.i18n("mdMenu")+"</a></span></h1>";
GeoNetwork.Templates.RATING_TPL='<tpl if="isharvested==\'n\' || harvestertype==\'geonetwork\'"><div class="rating"><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'1\'">checked="true"</tpl> value="1"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'2\'">checked="true"</tpl> value="2"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'3\'">checked="true"</tpl> value="3"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'4\'">checked="true"</tpl> value="4"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'5\'">checked="true"</tpl> value="5"/></div></tpl>';
GeoNetwork.Templates.LOGO='<div class="md-logo"><img src="{[catalogue.URL]}/images/logos/{source}.gif"/></div>';
GeoNetwork.Templates.SIMPLE=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-simple" title="{abstract}">','<table><tr><td style="width:30px;">',GeoNetwork.Templates.LOGO,'</td><td id="{uuid}">',GeoNetwork.Templates.TITLE,'<span class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></span>","</td></tr></table>","</li>","</tpl>","</ul>");
GeoNetwork.Templates.THUMBNAIL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-thumbnail">','<div class="md-wrap" id="{uuid}" title="{abstract}">',GeoNetwork.Templates.TITLE,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml'\">","<a href=\"#\" class=\"md-mn addLayer\" title=\"{title}\" alt=\"{title}\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{title}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","</tpl>","</div>","</li>","</tpl>","</ul>");
GeoNetwork.Templates.FULL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-full">',"<table><tr>",'<td class="left">',GeoNetwork.Templates.LOGO,"</td>",'<td id="{uuid}">',GeoNetwork.Templates.TITLE,'<p class="abstract">{[values.abstract.substring(0, 350)]} ...</p>','<p class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></p>",'<div class="md-links">','<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml' || values.type == 'OGC:WMS'\">",'<a href="#" class="md-mn addLayer" title="'+OpenLayers.i18n("addToMap")+" {title}\" alt=\"Add layer to map\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{[escape(values.title)]}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","<tpl if=\"values.type == 'application/vnd.google-earth.kml+xml'\">",'<a href="{href}" class="md-mn md-mn-kml" title="'+OpenLayers.i18n("viewKml")+' {title}" alt="Open kml">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'application/zip' || values.type == 'application/x-compressed'\">",'<a href="{href}" class="md-mn md-mn-zip" title="'+OpenLayers.i18n("downloadLink")+' {title}" alt="Download">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'text/html'\">",'<a href="{href}" class="md-mn md-mn-www" title="'+OpenLayers.i18n("webLink")+' {title}" alt="Web link" target="_blank">&nbsp;</a>',"</tpl>","</tpl>",'<tpl if="this.hasDownloadLinks(values.links)">','<a href="#" onclick="catalogue.metadataPrepareDownload({id});" class="md-mn downloadAllIcon" title="'+OpenLayers.i18n("prepareDownload")+'" alt="download">&nbsp;</a>',"</tpl>","</div>",'</td><td class="thumb">',GeoNetwork.Templates.RATING_TPL,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'</td><td class="icon">','<div class="md-mn valid-{valid}" title="'+OpenLayers.i18n("validityInfo"),'<tpl for="valid_details">',"{values.type}: ","<tpl if=\"values.valid == '1'\">"+OpenLayers.i18n("valid")+"</tpl>","<tpl if=\"values.valid == '0'\">"+OpenLayers.i18n("notValid")+"</tpl>","<tpl if=\"values.valid == '-1'\">"+OpenLayers.i18n("notDetermined")+"</tpl>","<tpl if=\"values.ratio != ''\"> ({values.ratio}) </tpl> - ","</tpl>",'">&nbsp;</div>','</td><td class="icon" title="'+OpenLayers.i18n("metadataCategories")+'">','<tpl for="category">','<div class="md-mn cat-{value}" title="{value}">&nbsp;</div>',"</tpl>","</td></tr></table>",'<div class="md-contact">','<tpl for="contact">',"<tpl if=\"applies=='resource'\">",'<span title="{role} - {applies}"><tpl if="values.logo !== undefined ">','<img src="{logo}" class="orgLogo"/>',"</tpl>","{name}</span>","</tpl>","</tpl>","<tpl if=\"edit=='true' && isharvested!='y'\">",'<br/><span class="md-mn md-mn-user" title="'+OpenLayers.i18n("ownerName")+'">{ownername} ('+OpenLayers.i18n("lastUpdate")+"{[values.changedate.split('T')[0]]})</span>","</tpl>","</div>","</li>","</tpl>","</ul>",{hasDownloadLinks:function(values){var i;
for(i=0;
i<values.length;
i++){if(values[i].type==="application/x-compressed"){return true
}}return false
}});Ext.namespace("GeoNetwork.view");
GeoNetwork.view.ViewWindow=Ext.extend(Ext.Window,{defaultConfig:{layout:"fit",width:700,height:740,border:false,autoScroll:true,closeAction:"destroy",currTab:"simple"},maximizable:true,maximized:false,collapsible:true,collapsed:false,serviceUrl:undefined,catalogue:undefined,metadataUuid:undefined,record:undefined,resultsView:undefined,actionMenu:undefined,getLinkedData:function(){var store=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?fast=false&uuid="+this.metadataUuid,null,true),view=this;
store.load();
store.on("load",function(){this.each(view.displayLinkedData,view)
})
},displayLinkedData:function(record){var table=Ext.query("table.related",this.body.dom),type=record.get("type");
var el=Ext.get(table[0]);
var exist=el.child("tr td[class*="+type+"]");
var link='<li><a href="#" onclick="javascript:catalogue.metadataShow(\''+record.get("uuid")+'\');" title="'+record.get("abstract")+'">'+record.get("title")+"</a></li>";
if(exist!==null){exist.next().child("li").insertHtml("afterEnd",link)
}else{el.child("tr").insertHtml("beforeBegin",'<tr><td class="main '+type+'"><span class="cat-'+type+' icon">'+OpenLayers.i18n("related"+type)+"</span></td><td><ul>"+link+"</ul></td></tr>")
}},createActionMenu:function(){if(!this.actionMenu){this.actionMenu=new GeoNetwork.MetadataMenu({catalogue:this.catalogue,record:this.record,resultsView:this.resultsView})
}var actionButton={text:OpenLayers.i18n("mdMenu"),menu:this.actionMenu};
return actionButton
},createViewMenu:function(modes){var items=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];
this.viewMenu=new Ext.menu.Menu({items:items});
var viewButton={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};
return viewButton
},updateViewMenu:function(){var modes=Ext.query("span.mode",this.body.dom),menu=[],i,j,e,cmpId=this.getId();
Ext.ux.Lightbox.register("a[rel^=lightbox-viewset]",true);
for(i=0;
i<modes.length;
i++){if(modes[i].firstChild){var id=modes[i].getAttribute("id");
var label=modes[i].innerHTML;
var next=Ext.get(modes[i]).next();
var tabs=next.query("LI");
var current=next.query("LI[id="+this.currTab+"]");
var activeMode=current.length===1;
if(!activeMode){Ext.get(modes[i]).parent().remove()
}else{if(next&&tabs.length===1){next.remove()
}else{for(j=0;
j<tabs.length;
j++){e=Ext.get(tabs[j]);
e.on("click",function(){Ext.getCmp(cmpId).switchToTab(this)
},e.getAttribute("id"))
}}}menu.push([label,id,activeMode])
}}this.updateToolbar(menu)
},updateToolbar:function(modes){var i,m;
this.viewMenu.removeAll();
for(i=0;
i<modes.length;
i++){m=modes[i];
this.viewMenu.add({text:m[0],checked:false,disabled:m[2],group:"mode",value:m[1],listeners:{checkchange:this.onViewCheck,scope:this}})
}this.viewMenu.doLayout()
},switchToTab:function(tab){this.currTab=tab;
this.onViewCheck({value:this.currTab},true)
},onViewCheck:function(item,checked){if(checked){this.currTab=item.value;
this.load({url:this.serviceUrl+"&currTab="+this.currTab,callback:this.afterMetadataLoad,scope:this})
}},afterMetadataLoad:function(){this.updateViewMenu();
this.catalogue.extentMap.initMapDiv();
if(this.currTab==="view-simple"){this.getLinkedData()
}},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.tools=[{id:"newwindow",qtip:OpenLayers.i18n("newWindow"),handler:function(e,toolEl,panel,tc){window.open(GeoNetwork.Util.getBaseUrl(location.href)+"#uuid="+this.metadataUuid);
this.hide()
},scope:this}];
this.tbar=[this.createViewMenu(),this.createActionMenu()];
GeoNetwork.view.ViewWindow.superclass.initComponent.call(this);
this.setTitle(this.record?this.record.get("title"):"");
this.add(new Ext.Panel({autoLoad:{url:this.serviceUrl+"&currTab="+this.currTab,callback:this.afterMetadataLoad,scope:this},border:false,frame:false,autoScroll:true}));
this.on("beforeshow",function(el){el.setSize(el.getWidth()>Ext.getBody().getWidth()?Ext.getBody().getWidth():el.getWidth(),el.getHeight()>Ext.getBody().getHeight()?Ext.getBody().getHeight():el.getHeight())
})
}});
Ext.reg("gn_view_viewwindow",GeoNetwork.view.ViewWindow);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.SubTemplateSelectionPanel=Ext.extend(Ext.FormPanel,{border:false,catalogue:undefined,namespaces:{xlink:"http://www.w3.org/1999/xlink",gmd:"http://www.isotc211.org/2005/gmd",gmx:"http://www.isotc211.org/2005/gmx",gco:"http://www.isotc211.org/2005/gco",gts:"http://www.isotc211.org/2005/gts",gml:"http://www.opengis.net/gml"},id:"subTemplateSearchForm",contact:Ext.data.Record.create([{name:"xlink"},{name:"name"}]),subTemplateStore:undefined,codeListStore:undefined,subTplTypeField:undefined,addAsXLink:false,itemSelector:null,loadingMask:null,subTemplateCount:null,ref:null,name:null,elementName:null,codeListConfig:{"gmd:CI_ResponsibleParty":{xpath:"gmd:role/gmd:CI_RoleCode/@codeListValue",url:"",label:OpenLayers.i18n("contactRole"),code:"gmd:CI_RoleCode"}},codeListCombo:null,role:"",defaultRole:"pointOfContact",SubTemplateSelected:[],initComponent:function(){this.subTemplateStore=GeoNetwork.data.MetadataResultsStore();
this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getSearchField()],items:[this.getSubTemplateItemSelector()]}];
this.subTemplateStore.on({loadexception:function(){},beforeload:function(store,options){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show()
},load:function(){this.loadingMask.hide()
},scope:this});
this.addEvents("subTemplateSelected");
this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(c,checked){this.addAsXLink=checked
},scope:this}},this.getCodeListCombo()," ",{id:"SubTemplateSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildSubTemplateXmlList()
},scope:this}];
GeoNetwork.editor.SubTemplateSelectionPanel.superclass.initComponent.call(this)
},getSearchField:function(){this.subTplTypeField=new Ext.form.TextField({name:"E__root",hidden:true,value:""});
return[new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(scope){scope.doSearch()
},scope:this}),this.subTplTypeField,{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"}]
},setRef:function(ref){this.ref=ref
},setName:function(name){this.name=name
},setElementName:function(name){this.elementName=name;
this.subTplTypeField.setValue(name);
if(this.codeListConfig[name]){this.codeListCombo.setVisible(true)
}else{this.codeListCombo.setVisible(false)
}},setAddAsXLink:function(xlink){this.addAsXLink=xlink||false;
Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink)
},getCodeListCombo:function(){this.codeListStore=GeoNetwork.data.CodeListStore({url:this.catalogue.services.schemaInfo,codeListName:"gmd:CI_RoleCode"});
this.codeListCombo=new Ext.form.ComboBox({id:"codeList",store:this.codeListStore,triggerAction:"all",mode:"local",fieldLabel:"",displayField:"label",valueField:"code"});
this.codeListStore.on({load:function(){Ext.getCmp("codeList").setValue(this.defaultRole)
},scope:this});
return this.codeListCombo
},getSubTemplateItemSelector:function(){var tpl='<tpl for="."><div class="ux-mselect-item';
if(Ext.isIE||Ext.isIE7){tpl+='" unselectable=on'
}else{tpl+=' x-unselectable"'
}tpl+=">{title}</div></tpl>";
this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["uuid","title"],toData:[],msWidth:320,msHeight:230,valueField:"uuid",fromTpl:tpl,toTpl:tpl,toLegend:OpenLayers.i18n("selected"),fromLegend:OpenLayers.i18n("found"),fromStore:this.subTemplateStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var i=this.getForm().findField("itemselector");
i.reset.call(i)
},scope:this}]});
this.itemSelector.on({change:function(component){Ext.getCmp("SubTemplateSearchValidateButton").setDisabled(component.toStore.getCount()<1)
}});
return this.itemSelector
},buildSubTemplateXmlList:function(){if(!this.elementName){alert("Error: sub template root element name is not defined!");
return
}var processParameter="";
var processParameterSeparator="~";
var store=this.itemSelector.toMultiselect.store;
this.SubTemplateSelected=[];
this.codeListValue="";
this.subTemplateCount=0;
if(this.codeListConfig[this.elementName]&&this.codeListConfig[this.elementName].xpath){processParameter="&process="+this.codeListConfig[this.elementName].xpath+processParameterSeparator+Ext.getCmp("codeList").getValue()
}var self=this;
xlinkCollection=store.collect("uuid");
Ext.each(xlinkCollection,function(uuid,index,xlinks){var inputValue=self.catalogue.services.subTemplate+"?uuid="+uuid+processParameter;
++self.subTemplateCount;
if(self.addAsXLink){var tpl="<"+self.name+self.generateNamespaceDeclaration()+" xlink:href='"+inputValue+"'/>";
self.SubTemplateSelected.push(tpl)
}else{self.retrieveSubTemplate(inputValue)
}});
if(this.addAsXLink){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);
this.ownerCt.hide()
}store.clearFilter()
},retrieveSubTemplate:function(url){Ext.getCmp("SubTemplateSearchValidateButton").disable();
Ext.Ajax.request({url:url,method:"GET",scope:this,success:function(response){var st=response.responseText;
if(st.indexOf(this.elementName)!==-1){this.SubTemplateSelected.push("<"+this.name+this.generateNamespaceDeclaration()+">"+response.responseText+"</"+this.name+">")
}Ext.getCmp("SubTemplateSearchValidateButton").enable();
this.subTemplateCount-=1;
if(this.subTemplateCount===0){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);
this.ownerCt.hide()
}}})
},generateNamespaceDeclaration:function(onlyThoseNamespaces){var ns="";
for(var n in this.namespaces){if((onlyThoseNamespaces&&onlyThoseNamespaces[n])||!onlyThoseNamespaces){ns+=" xmlns:"+n+'="'+this.namespaces[n]+'"'
}}return ns
},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show();
GeoNetwork.util.SearchTools.doQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,false,this.subTemplateStore)
},showResults:function(response){var getRecordsFormat=new OpenLayers.Format.GeoNetworkRecords();
var r=getRecordsFormat.read(response.responseText);
var values=r.records;
if(values.length>0){this.subTemplateStore.loadData(r)
}}});
Ext.reg("gn_editor_subtemplateselectionpanel",GeoNetwork.editor.SubTemplateSelectionPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.CRSSelectionPanel=Ext.extend(Ext.FormPanel,{CRS:Ext.data.Record.create([{name:"authority"},{name:"code"},{name:"version"},{name:"codeSpace"},{name:"description"}]),crsStore:undefined,catalogue:undefined,border:false,first:null,itemSelector:null,loadingMask:null,crsCount:null,ref:null,crsSelected:"",initComponent:function(){this.crsStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchCRS,method:"GET"}),baseParams:{name:"",type:"",maxResults:50},reader:new Ext.data.XmlReader({record:"crs",id:"code"},this.CRS),fields:["code","codeSpace","authority","description","version"],sortInfo:{field:"description"}});
this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getCRSTypeCombo()," ",this.getCRS(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()],items:[this.getCRSItemSelector()]}];
this.crsStore.on({loadexception:function(){},beforeload:function(store,options){if(Ext.getCmp("maxResults")){store.baseParams.maxResults=Ext.getCmp("maxResults").getValue()
}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show()
},load:function(){this.loadingMask.hide()
},scope:this});
this.addEvents("crsSelected");
this.bbar=["->",{id:"crsSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildCRSXmlList()
},scope:this}];
GeoNetwork.editor.CRSSelectionPanel.superclass.initComponent.call(this)
},getCRS:function(){return new GeoNetwork.form.SearchField({id:"crsSearchField",width:240,store:this.crsStore,paramName:"name"})
},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40}
},getCRSTypeCombo:function(){var CRSType=Ext.data.Record.create([{name:"id"}]);
var crsTypeStore=new Ext.data.Store({url:this.catalogue.services.getCRSTypes,reader:new Ext.data.XmlReader({record:"type"},CRSType),fields:["id"]});
var record=new CRSType({filename:OpenLayers.i18n("any")});
record.set("id","");
crsTypeStore.add(record);
crsTypeStore.load({add:true});
return{xtype:"combo",width:150,id:"search-crs",value:0,store:crsTypeStore,triggerAction:"all",mode:"local",displayField:"id",valueField:"id",listWidth:250,listeners:{select:function(combo,record,index){this.crsStore.removeAll();
this.crsStore.baseParams.type=combo.getValue();
var value=Ext.getCmp("crsSearchField").getValue();
if(value.length<1){this.crsStore.baseParams.name=""
}else{this.crsStore.baseParams.name=value
}this.crsStore.reload()
},clear:function(combo){this.crsStore.load()
},scope:this}}
},getCRSItemSelector:function(){var tpl='<tpl for="."><div class="ux-mselect-item';
if(Ext.isIE||Ext.isIE7){tpl+='" unselectable=on'
}else{tpl+=' x-unselectable"'
}tpl+=">{description}</div></tpl>";
this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["code","codeSpace","authority","description","version"],toData:[],msWidth:320,msHeight:230,valueField:"code",fromTpl:tpl,toTpl:tpl,toLegend:OpenLayers.i18n("selectedCRS"),fromLegend:OpenLayers.i18n("foundCRS"),fromStore:this.crsStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var i=this.getForm().findField("itemselector");
i.reset.call(i)
},scope:this}]});
this.itemSelector.on({change:function(component){Ext.getCmp("crsSearchValidateButton").setDisabled(component.toStore.getCount()<1)
}});
return this.itemSelector
},setRef:function(ref){this.ref=ref
},buildCRSXmlList:function(){this.crsSelected="";
var store=this.itemSelector.toMultiselect.store;
this.first=true;
store.each(function(record){var tpl="<gmd:referenceSystemInfo xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco'><gmd:MD_ReferenceSystem><gmd:referenceSystemIdentifier><gmd:RS_Identifier><gmd:code><gco:CharacterString>"+record.data.description+"</gco:CharacterString></gmd:code><gmd:codeSpace><gco:CharacterString>"+record.data.codeSpace+"</gco:CharacterString></gmd:codeSpace><gmd:version><gco:CharacterString>"+record.data.version+"</gco:CharacterString></gmd:version></gmd:RS_Identifier></gmd:referenceSystemIdentifier></gmd:MD_ReferenceSystem></gmd:referenceSystemInfo>";
this.crsSelected+=(this.first?"":"&amp;&amp;&amp;")+tpl;
this.first=false
},this);
if(this.crsSelected!==""){this.fireEvent("crsSelected",this.crsSelected);
this.ownerCt.hide()
}}});
Ext.reg("gn_editor_crsselectionpanel",GeoNetwork.editor.CRSSelectionPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.EditorPanel=Ext.extend(Ext.Panel,{border:false,editUrl:undefined,updateUrl:undefined,frame:false,editorToolBar:undefined,tbarConfig:undefined,layout:"border",id:"editorPanel",height:800,defaultConfig:{defaultViewMode:"simple",utilityPanelCollapsed:false,utilityPanelConfig:{thumbnailPanel:{collapsed:false},relationPanel:{collapsed:true},validationPanel:{collapsed:true},suggestionPanel:{collapsed:true},helpPanel:{collapsed:false}}},catalogue:undefined,toolbar:undefined,validationPanel:undefined,relationPanel:undefined,helpPanel:undefined,suggestionPanel:undefined,thumbnailPanel:undefined,editorMainPanel:undefined,metadataId:undefined,versionId:undefined,metadataMode:undefined,metadataSchema:undefined,metadataType:undefined,position:undefined,relatedMetadataStore:undefined,keywordSelectionWindow:undefined,contactSelectionWindow:undefined,subTemplateSelectionWindow:undefined,crsSelectionWindow:undefined,logoSelectionWindow:undefined,linkedMetadataSelectionWindow:undefined,geoPublisherWindow:undefined,lang:undefined,fileUploadWindow:undefined,mask:undefined,xlinkOptions:{},managerInitialized:false,container:undefined,setContainer:function(el){if(!this.container){this.container=el
}},showLogoSelectionPanel:function(ref){if(!this.logoSelectionWindow){var logoSelectionPanel=new GeoNetwork.editor.LogoSelectionPanel({ref:ref,serviceUrl:this.catalogue.services.getIcons,logoAddUrl:this.catalogue.services.logoAdd,logoUrl:this.catalogue.services.harvesterLogoUrl,listeners:{logoselected:function(panel,idx){var record=panel.store.getAt(idx);
Ext.getDom(panel.ref).value=panel.logoUrl+record.get("name")
}}});
this.logoSelectionWindow=new Ext.Window({title:OpenLayers.i18n("logoSelectionWindow"),width:300,height:300,layout:"fit",modal:true,items:logoSelectionPanel,closeAction:"hide",constrain:true,iconCls:"attached"})
}this.logoSelectionWindow.items.get(0).setRef(ref);
this.logoSelectionWindow.show()
},showFileUploadPanel:function(id,ref){var panel=this;
if(this.fileUploadWindow){this.fileUploadWindow.close();
this.fileUploadWindow=undefined
}if(!this.fileUploadWindow){var fileUploadPanel=new Ext.form.FormPanel({fileUpload:true,defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"access",allowBlank:false,hidden:true,value:"private"},{name:"ref",allowBlank:false,hidden:true,value:ref},{name:"proto",hidden:true,value:""},{name:"overwrite",fieldLabel:"Overwrite",checked:true,xtype:"checkbox"},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectFile"),fieldLabel:"File",allowBlank:false,name:"f_"+ref,buttonText:"",buttonCfg:{iconCls:"uploadIconAdd"}}],buttons:[{text:OpenLayers.i18n("upload"),iconCls:"attachedAdd",handler:function(){if(fileUploadPanel.getForm().isValid()){fileUploadPanel.getForm().submit({url:panel.catalogue.services.upload,waitMsg:OpenLayers.i18n("uploading"),success:function(fileUploadPanel,o){var fname=o.result.fname;
var name=Ext.getDom("_"+ref);
if(name){name.value=fname
}panel.save();
panel.fileUploadWindow.hide()
}})
}}},{text:OpenLayers.i18n("reset"),handler:function(){fileUploadPanel.getForm().reset()
}}]});
this.fileUploadWindow=new Ext.Window({title:OpenLayers.i18n("fileUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:fileUploadPanel,closeAction:"hide",constrain:true,iconCls:"attached"})
}this.fileUploadWindow.show()
},showGeoPublisherPanel:function(id,name,accessStatus,nodeName,insertNodeRef,extent){var editorPanel=this;
if(this.geoPublisherWindow){this.geoPublisherWindow.close();
this.geoPublisherWindow=undefined
}if(!this.geoPublisherWindow){var geoPublisherPanel=new GeoNetwork.editor.GeoPublisherPanel({width:650,height:300,layers:GeoNetwork.map.BACKGROUND_LAYERS,extent:extent,serviceUrl:this.catalogue.services.geopublisher,listeners:{addOnLineSource:function(panel,node,protocols){var p;
var xml="";
var layerName=node.get("namespacePrefix")+":"+this.layerName;
var id="_X"+insertNodeRef+"_"+nodeName.replace(":","COLON");
var wxsOnlineSource="<gmd:onLine xmlns:gmd=&quot;http://www.isotc211.org/2005/gmd&quot; xmlns:gco=&quot;http://www.isotc211.org/2005/gco&quot;><gmd:CI_OnlineResource><gmd:linkage><gmd:URL>http://geonetwork-opensource.org/geonetwork-client</gmd:URL></gmd:linkage><gmd:protocol><gco:CharacterString>${protocol}</gco:CharacterString></gmd:protocol><gmd:name><gco:CharacterString>${layerName}</gco:CharacterString></gmd:name><gmd:description><gco:CharacterString>${layerName}</gco:CharacterString></gmd:description></gmd:CI_OnlineResource></gmd:onLine>";
for(p in protocols){if(protocols.hasOwnProperty(p)){xml+=OpenLayers.String.format(wxsOnlineSource,{url:node.get(p+"Url"),protocol:protocols[p].label,layerName:layerName})+"&&&"
}}GeoNetwork.editor.EditorTools.addHiddenFormField(id,xml);
editorPanel.save();
editorPanel.geoPublisherWindow.hide()
}}});
this.geoPublisherWindow=new Ext.Window({title:OpenLayers.i18n("geoPublisherWindowTitle"),layout:"fit",modal:true,items:geoPublisherPanel,closeAction:"hide",constrain:true,iconCls:"repository"})
}this.geoPublisherWindow.items.get(0).setRef(id,name,accessStatus);
this.geoPublisherWindow.setTitle(OpenLayers.i18n("geoPublisherWindowTitle")+" "+name);
this.geoPublisherWindow.show()
},showSubTemplateSelectionPanel:function(ref,name,elementName){var editorPanel=this;
if(this.subTemplateSelectionWindow){this.subTemplateSelectionWindow.close();
this.subTemplateSelectionWindow=undefined
}if(!this.subTemplateSelectionWindow){var selectionPanel=new GeoNetwork.editor.SubTemplateSelectionPanel({width:620,height:300,catalogue:this.catalogue,listeners:{subTemplateSelected:function(panel,subtemplates){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(panel,subtemplates,editorPanel)
}}});
this.subTemplateSelectionWindow=new Ext.Window({title:OpenLayers.i18n("SelectionWindowTitle"),layout:"fit",items:selectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"})
}this.subTemplateSelectionWindow.items.get(0).setRef(ref);
this.subTemplateSelectionWindow.items.get(0).setName(name);
this.subTemplateSelectionWindow.items.get(0).setElementName(elementName);
this.subTemplateSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.CONTACT);
this.subTemplateSelectionWindow.show()
},showKeywordSelectionPanel:function(ref,name){var editorPanel=this;
if(this.keywordSelectionWindow){this.keywordSelectionWindow.close();
this.keywordSelectionWindow=undefined
}if(!this.keywordSelectionWindow){this.keywordSelectionPanel=new GeoNetwork.editor.KeywordSelectionPanel({catalogue:this.catalogue,listeners:{keywordselected:function(panel,keywords){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(panel,keywords,editorPanel)
}}});
this.keywordSelectionWindow=new Ext.Window({title:OpenLayers.i18n("keywordSelectionWindowTitle"),width:620,height:300,layout:"fit",modal:true,items:this.keywordSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"})
}this.keywordSelectionWindow.items.get(0).setRef(ref);
this.keywordSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.KEYWORD);
this.keywordSelectionWindow.show()
},showCRSSelectionPanel:function(ref,name){var editorPanel=this;
if(!this.crsSelectionWindow){this.crsSelectionPanel=new GeoNetwork.editor.CRSSelectionPanel({catalogue:this.catalogue,listeners:{crsSelected:function(xml){var id="_X"+ref+"_"+name.replace(":","COLON");
GeoNetwork.editor.EditorTools.addHiddenFormField(id,xml);
editorPanel.save()
}}});
this.crsSelectionWindow=new Ext.Window({title:OpenLayers.i18n("crsSelectionWindowTitle"),layout:"fit",width:620,height:300,modal:true,items:this.crsSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"})
}this.crsSelectionWindow.items.get(0).setRef(ref);
this.crsSelectionWindow.show()
},showLinkedMetadataSelectionPanel:function(ref,name){var single=((name==="uuidref"||name==="iso19110"||name==="")?true:false);
var editorPanel=this;
this.linkedMetadataSelectionPanel=new GeoNetwork.editor.LinkedMetadataSelectionPanel({ref:ref,catalogue:this.catalogue,singleSelect:single,mode:name,listeners:{linkedmetadataselected:function(panel,metadata){if(single){if(this.ref!==null){$("_"+this.ref+(name!==""?"_"+name:"")).value=metadata[0].data.uuid
}else{if(this.mode==="iso19110"){var url=panel.catalogue.services.mdRelationInsert+"?parentId="+document.mainForm.id.value+"&childUuid="+metadata[0].data.uuid;
var request=Ext.Ajax.request({url:url,method:"GET",success:function(result,request){editorPanel.relationPanel.reload()
},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.String.format(OpenLayers.i18n("errorAndStatusMsg"),{status:result.status,text:result.statusText}));
setBunload(true)
}})
}}}else{var inputs=[];
var multi=metadata.length>1?true:false;
Ext.each(metadata,function(md,index){if(multi){name=name+"_"+index
}inputs.push({tag:"input",type:"hidden",id:name,name:name,value:md.data.uuid})
});
var dh=Ext.DomHelper;
dh.append(Ext.get("hiddenFormElements"),inputs)
}}}});
this.linkedMetadataSelectionWindow=new Ext.Window({title:OpenLayers.i18n("linkedMetadataSelectionWindowTitle"),width:620,height:300,layout:"fit",items:this.linkedMetadataSelectionPanel,closeAction:"hide",constrain:true,iconCls:"linkIcon",modal:true});
this.linkedMetadataSelectionWindow.show()
},showLinkedServiceMetadataSelectionPanel:function(name,serviceUrl,uuid){var editorPanel=this;
serviceUrl=Ext.getDom("serviceUrl")&&Ext.getDom("serviceUrl").value;
var linkedMetadataSelectionPanel=new GeoNetwork.editor.LinkedMetadataSelectionPanel({mode:name,autoWidth:true,ref:null,serviceUrl:serviceUrl,catalogue:this.catalogue,region:"north",uuid:uuid,singleSelect:true,listeners:{linkedmetadataselected:function(panel,metadata){var layerName=Ext.getCmp("getCapabilitiesLayerName").getValue();
if(name==="attachService"){var serviceUpdateUrl=editorPanel.catalogue.services.mdProcessingXml+"?uuid="+metadata[0].data.uuid+"&process=update-srv-attachDataset&uuidref="+document.mainForm.uuid.value+"&scopedName="+layerName;
Ext.Ajax.request({url:serviceUpdateUrl,method:"GET",success:function(result,request){var response=result.responseText;
if(response.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"))
}else{if(response.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+response)
}}var datasetUpdateUrl=editorPanel.catalogue.services.mdProcessing+"?id="+editorPanel.metadataId+"&process=update-onlineSrc&desc="+layerName+"&url="+escape(metadata[0].data.uri)+"&scopedName="+layerName;
Ext.Ajax.request({url:datasetUpdateUrl,method:"GET",success:function(result,request){editorPanel.updateEditor(result)
},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.i18n("datasetUpdateError"));
setBunload(true)
}})
},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));
setBunload(true)
}})
}else{var datasetUpdateUrl=editorPanel.catalogue.services.mdProcessingXml+"?uuid="+metadata[0].data.uuid+"&process=update-onlineSrc&desc="+layerName+"&url="+serviceUrl+"&scopedName="+layerName;
Ext.Ajax.request({url:datasetUpdateUrl,method:"GET",success:function(result,request){var response=result.responseText;
if(response.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"))
}else{if(response.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+response)
}}editorPanel.process(editorPanel.catalogue.services.mdProcessing+"?uuid="+document.mainForm.uuid.value+"&process=update-srv-attachDataset&uuidref="+metadata[0].data.uuid+"&scopedName="+layerName)
},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));
setBunload(true)
}})
}},scope:this}});
this.linkedMetadataSelectionWindow=new Ext.Window({title:(name==="attachService"?OpenLayers.i18n("associateService"):OpenLayers.i18n("associateDataset")),layout:"fit",width:620,height:400,items:linkedMetadataSelectionPanel,closeAction:"hide",constrain:true,iconCls:"linkIcon",modal:true});
this.linkedMetadataSelectionWindow.show()
},switchToTab:function(tab){Ext.getDom("currTab").value=tab;
this.save()
},finish:function(){this.loadUrl("metadata.update.finish",undefined,this.closeCallback)
},save:function(){this.loadUrl("metadata.update.new",undefined,this.loadCallback)
},callAction:function(action){this.loadUrl(action,undefined,this.loadCallback)
},validate:function(cb){this.loadUrl("metadata.update.new","validate",this.loadCallback);
this.validationPanel.expand(true)
},reset:function(){this.loadUrl("metadata.update.forget.new",undefined,this.loadCallback)
},cancel:function(){this.loadUrl("metadata.update.forgetandfinish",undefined,this.closeCallback)
},process:function(action){this.loadUrl(action,undefined,this.loadCallback,true)
},init:function(metadataId,create,group,child,isTemplate){var url;
this.metadataId=metadataId;
if(create){url=this.createUrl+"?id="+this.metadataId+"&group="+group;
if(child){url+="&child=y"
}if(isTemplate){url+="&isTemplate="+isTemplate
}}else{url=this.editUrl+"?id="+this.metadataId
}url+="&currTab="+(document.mainForm?document.mainForm.currTab.value:this.defaultViewMode);
this.loadUrl(url,undefined,this.loadCallback);
if(this.disabled){this.setDisabled(false)
}this.container.show();
this.ownerCt.show()
},loadUrl:function(action,validate,cb,noPostParams){if(document.mainForm){if(typeof validate!=="undefined"){document.mainForm.showvalidationerrors.value="true"
}else{document.mainForm.showvalidationerrors.value="false"
}}var mgr=this.editorMainPanel.getUpdater();
mgr.update({url:(action.indexOf("/")!==-1?action:this.catalogue.services.rootUrl+action),params:!noPostParams&&document.mainForm&&Ext.fly("editForm")!==null?Ext.Ajax.serializeForm("editForm"):undefined,callback:cb,scope:this,loadScripts:true,text:OpenLayers.i18n(action)+" ("+action+")"})
},closeCallback:function(){this.onEditorClosed();
this.ownerCt.hide()
},loadCallback:function(el,success,response,options){if(!this.managerInitialized){this.initManager()
}if(success){this.metadataLoaded()
}else{this.getError(response)
}},getError:function(response){if(response&&response.responseText){var errorPage=response.responseText,errorTitle1,errorTitle,errorMsg,errorMsg1,errorMsg2;
errorTitle=errorPage.match(/<h2 class=\"error\"\>(.*)<\/h2\>/);
errorTitle1=errorTitle||errorPage.match(/<div id=\"error\"\>\n[ ]*<h2>(.*)<\/h2\>/);
errorMsg=errorPage.match(/<\/h2\>\n[ ]*<p\><\/p\>(.*)/);
if(!errorMsg){errorMsg1=errorPage.match(/<p id=\"error\">(.*)<\/p\>/);
errorMsg2=errorPage.match(/<p id=\"stacktrace\">(.*)<\/p\>/);
errorMsg=errorMsg1[1]+errorMsg2[1]
}else{errorMsg=errorMsg[1]
}if(errorTitle1){Ext.Msg.alert(errorTitle1[1],(errorMsg?errorMsg:""),function(){this.ownerCt.hide()
},this)
}}},updateEditor:function(html){this.editorMainPanel.update(html,false,this.metadataLoaded.bind(this))
},metadataLoaded:function(){this.metadataSchema=document.mainForm.schema.value;
this.metadataType=Ext.getDom("template");
this.metadataId=document.mainForm.id.value;
this.versionId=document.mainForm.version.value;
this.toolbar.setIsMinor(document.mainForm.minor.value);
this.toolbar.setIsTemplate(this.metadataType.value);
if(this.disabled){this.setDisabled(false)
}this.onMetadataUpdated();
this.initCalendar();
this.validateMetadataFields();
this.catalogue.extentMap.initMapDiv();
var formElements=Ext.query("th[id]",this.body.dom);
formElements=formElements.concat(Ext.query("legend[id]",this.body.dom));
Ext.each(formElements,function(item,index,allItems){var e=Ext.get(item);
var id=e.getAttribute("id");
if(e.is("TH")){var section=e.up("FIELDSET");
e.parent().on("mouseover",function(){this.helpPanel.updateHelp(id,section)
},this)
}else{e.on("mouseover",function(){this.helpPanel.updateHelp(id)
},this)
}},this);
this.updateViewMenu()
},validateMetadataField:function(input){var ch=input.getAttribute("onchange");
var ku=input.getAttribute("onkeyup");
if(typeof ch==="function"){ch=ch.toString()
}if(typeof ku==="function"){ku=ku.toString()
}if(!input||(ch!==null&&ch.indexOf("validate")===-1)||(ku!==null&&ku.indexOf("validate")===-1)){return
}if(input.onkeyup){input.onkeyup()
}if(input.onchange){input.onchange()
}},validateMetadataFields:function(){var items=Ext.DomQuery.select("select.lang_selector");
Ext.each(items,function(input){for(i=0;
i<input.options.length;
i+=1){if(input.options[i].getAttribute("code").toLowerCase()===this.lang){input.options[i].selected=true
}}});
items=Ext.DomQuery.select("input,textarea,select");
Ext.each(items,function(input){this.validateMetadataField(input)
},this)
},initCalendar:function(){var calendars=Ext.DomQuery.select("div.cal"),i;
for(i=0;
i<calendars.length;
i++){var cal=calendars[i];
var id=cal.id;
cal.id=id+"Id";
if(cal.firstChild===null||cal.childNodes.length===1){var format="Y-m-d";
var formatEl=Ext.getDom(id+"_format",this.editorMainPanel.dom);
if(formatEl){format=formatEl.value
}var valueEl=Ext.getDom(id+"_cal",this.editorMainPanel.dom);
var value=(valueEl?valueEl.value:"");
var showTime=format.indexOf("T")===-1?false:true;
if(showTime){var dtCal=new Ext.ux.form.DateTime({renderTo:cal.id,name:id,id:id,value:value,dateFormat:"Y-m-d",timeFormat:"H:i",hiddenFormat:"Y-m-d\\TH:i:s",dtSeparator:"T"})
}else{var dCal=new Ext.form.DateField({renderTo:cal,name:id,id:id,width:160,value:value,format:"Y-m-d"})
}}}},updateViewMenu:function(){var modes=Ext.query("span.mode",this.body.dom),menu=[],i,j,e;
for(i=0;
i<modes.length;
i++){if(modes[i].firstChild){var id=modes[i].getAttribute("id");
var next=Ext.get(modes[i]).next();
var label=modes[i].innerHTML;
var tabs=next.query("LI");
var current=next.query("LI[id="+document.mainForm.currTab.value+"]");
var activeMode=current.length===1;
if(!activeMode){Ext.get(modes[i]).parent().remove()
}else{if(next&&tabs.length===1){next.remove()
}else{for(j=0;
j<tabs.length;
j++){e=Ext.get(tabs[j]);
e.on("click",function(){Ext.getCmp("editorPanel").switchToTab(this)
},e.getAttribute("id"))
}}}menu.push([label,id,activeMode])
}}this.toolbar.updateViewMenu(menu)
},onMetadataUpdated:function(){this.fireEvent("metadataUpdated",this,this.metadataId,this.metadataSchema,this.versionId)
},onEditorClosed:function(){this.fireEvent("editorClosed",this)
},initManager:function(){var mgr=this.editorMainPanel.getUpdater();
mgr.on("beforeupdate",function(el,url,params){this.position=this.editorMainPanel.getEl().parent().dom.scrollTop
},this);
mgr.on("update",function(el,response){this.editorMainPanel.getEl().parent().dom.scrollTop=this.position
},this);
this.managerInitialized=true
},initPanelLayout:function(){if(this.container){if(this.container.setIconClass){this.container.setIconClass("editing")
}if(this.container.setTitle){if(this.metadataId){this.container.setTitle(OpenLayers.String.format(OpenLayers.i18n("editing"),{title:"",uuid:this.metadataId}))
}else{}}}},initComponent:function(config){var optionsPanel;
Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.disabled=(this.metadataId?false:true);
this.lang=(this.lang?this.lang:"en");
this.editUrl=this.catalogue.services.mdEdit;
this.createUrl=this.catalogue.services.mdCreate;
this.updateUrl=this.catalogue.services.mdUpdate;
GeoNetwork.editor.EditorPanel.superclass.initComponent.call(this);
panel=this;
this.editorMainPanel=new Ext.Panel({border:false,frame:false,id:"editorMainPanel"});
var tbarConfig={editor:panel};
Ext.apply(tbarConfig,this.tbarConfig);
this.toolbar=new GeoNetwork.editor.EditorToolbar(tbarConfig);
var editorPanel={region:"center",split:true,autoScroll:true,tbar:this.toolbar,minHeigth:400,items:[this.editorMainPanel]};
this.add(editorPanel);
this.validationPanel=new GeoNetwork.editor.ValidationPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,serviceUrl:this.catalogue.services.mdValidate},this.utilityPanelConfig.validationPanel));
this.helpPanel=new GeoNetwork.editor.HelpPanel(Ext.applyIf({editor:this,html:""},this.utilityPanelConfig.helpPanel));
this.relationPanel=new GeoNetwork.editor.LinkedMetadataPanel(Ext.applyIf({editor:this,metadataId:this.metadataId,metadataSchema:this.metadataSchema,serviceUrl:this.catalogue.services.mdRelation},this.utilityPanelConfig.relationPanel));
this.thumbnailPanel=new GeoNetwork.editor.ThumbnailPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,getThumbnail:this.catalogue.services.mdGetThumbnail,setThumbnail:this.catalogue.services.mdSetThumbnail,unsetThumbnail:this.catalogue.services.mdUnsetThumbnail},this.utilityPanelConfig.thumbnailPanel));
this.suggestionPanel=new GeoNetwork.editor.SuggestionsPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,catalogue:this.catalogue},this.utilityPanelConfig.suggestionPanel));
optionsPanel={region:"east",split:true,collapsible:true,collapsed:this.utilityPanelCollapsed,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:280,width:280,items:[this.thumbnailPanel,this.relationPanel,this.suggestionPanel,this.validationPanel,this.helpPanel]};
this.add(optionsPanel);
this.addEvents("metadataUpdated","editorClosed");
this.on("added",function(el,container,index){if(container){this.setContainer(container)
}this.initPanelLayout()
},this)
}});
Ext.reg("gn_editor_editorpanel",GeoNetwork.editor.EditorPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.EditorToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,editor:undefined,defaultConfig:{isTemplate:false,hideTypeMenu:false},mapOptions:undefined,layers:undefined,typeMenu:undefined,viewMenu:undefined,saveAction:undefined,saveAndCloseAction:undefined,checkAction:undefined,resetAction:undefined,cancelAction:undefined,minorCheckbox:undefined,minorEdit:false,initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
var cmp=[];
if(!this.hideTypeMenu){cmp.push(this.createTypeMenu());
cmp.push(["-"])
}this.saveAction=new Ext.Action({text:OpenLayers.i18n("save"),iconCls:"saveMetadata",handler:function(){this.save()
},scope:this.editor});
this.checkAction=new Ext.Action({text:OpenLayers.i18n("saveAndCheck"),iconCls:"validateMetadata",handler:function(){this.validationPanel.validate()
},scope:this.editor});
this.saveAndCloseAction=new Ext.Action({text:OpenLayers.i18n("saveAndClose"),iconCls:"quitMetadata",handler:function(){this.finish()
},scope:this.editor});
this.minorCheckbox=new Ext.Button({enableToggle:true,text:OpenLayers.i18n("minorEdit"),tooltip:OpenLayers.i18n("minorEditTT"),listeners:{toggle:function(c,pressed){document.mainForm.minor.value=this.minorEdit=pressed
},scope:this}});
this.resetAction=new Ext.Action({text:OpenLayers.i18n("reset"),iconCls:"refreshMetadata",handler:function(){this.reset()
},scope:this.editor});
this.cancelAction=new Ext.Action({text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.cancel()
},scope:this.editor});
cmp.push(this.createViewMenu(),["-"],this.saveAction,this.checkAction,this.saveAndCloseAction,this.minorCheckbox,["->"],this.resetAction,this.cancelAction);
GeoNetwork.editor.EditorToolbar.superclass.initComponent.call(this);
this.add(cmp)
},setIsTemplate:function(is){if(!this.hideTypeMenu){var isTemplate=is==="y";
Ext.getCmp("type_y").setChecked(isTemplate);
Ext.getCmp("type_n").setChecked(!isTemplate)
}},setIsMinor:function(minor){var state=true;
if(minor===""||minor==="false"){state=false
}this.minorCheckbox.toggle(state)
},createLayoutMenu:function(){var menu={text:OpenLayers.i18n("layout"),menu:{items:[{text:OpenLayers.i18n("collapseAll"),checked:false,checkHandler:this.collapseAll}]}};
return menu
},createTypeMenu:function(){this.typeMenu={text:OpenLayers.i18n("type"),menu:{items:['<b class="menu-title">'+OpenLayers.i18n("chooseAType")+"</b>",{text:OpenLayers.i18n("md"),checked:true,value:"n",id:"type_n",group:"type",checkHandler:this.onTypeCheck},{text:OpenLayers.i18n("tpl"),checked:true,id:"type_y",group:"type",value:"y",checkHandler:this.onTypeCheck}]}};
return this.typeMenu
},createViewMenu:function(modes){var items=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];
this.viewMenu=new Ext.menu.Menu({items:items});
var viewButton={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};
return viewButton
},updateViewMenu:function(modes){var i,m;
this.viewMenu.removeAll();
for(i=0;
i<modes.length;
i++){m=modes[i];
this.viewMenu.add({text:m[0],checked:false,disabled:m[2],group:"mode",value:m[1],listeners:{checkchange:this.onViewCheck,scope:this}})
}this.viewMenu.doLayout()
},onViewCheck:function(item,checked){if(checked){this.editor.editorMainPanel.getEl().parent().scrollTo("top",0);
document.mainForm.currTab.value=item.value;
this.saveAction.execute()
}},onTypeCheck:function(item,checked){if(checked){Ext.get("template").dom.value=item.value
}},collapseAll:function(item,checked){var mainTitles=Ext.DomQuery.select("div.toggle"),idx;
for(idx=0;
idx<mainTitles.length;
++idx){var elem=mainTitles[idx];
elem.checked=checked;
if(elem.onclick){elem.onclick()
}}},onDestroy:function(){GeoNetwork.EditorToolbar.superclass.onDestroy.apply(this,arguments)
}});
Ext.reg("gn_editor_editortoolbar",GeoNetwork.editor.EditorToolbar);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.EditorTools={addHiddenFormFieldForFragment:function(panel,xmlFragments,editorPanel){var id="_X"+panel.ref+"_"+panel.name.replace(":","COLON");
var xml;
var first=true;
Ext.each(xmlFragments,function(item,index){xmlFragments[index]=item.replace('<?xml version="1.0" encoding="UTF-8"?>',"").replace(/\&/g,"&amp;amp;").replace(/\"/g,"&quot;").replace(/\r\n/g,"");
if(first){xml=xmlFragments[index];
first=false
}else{xml+="&amp;&amp;&amp;"+xmlFragments[index]
}});
GeoNetwork.editor.EditorTools.addHiddenFormField(id,xml);
if(editorPanel){editorPanel.save()
}},addHiddenFormField:function(fieldId,fieldValue){var input={tag:"input",type:"hidden",id:fieldId,name:fieldId,value:fieldValue};
var dh=Ext.DomHelper;
dh.append(Ext.get("hiddenFormElements"),input)
},showNewMetadataWindow:function(scope,id,title,isChild,filter){if(scope.newMetadataWindow){scope.newMetadataWindow.close();
scope.newMetadataWindow=undefined
}if(!scope.newMetadataWindow){var newMetadataPanel=new GeoNetwork.editor.NewMetadataPanel({selectedTpl:id,isChild:isChild,filter:filter,getGroupUrl:scope.catalogue.services.getGroups,catalogue:scope.catalogue});
scope.newMetadataWindow=new Ext.Window({title:title===undefined?OpenLayers.i18n("newMetadata"):title,width:300,height:100,layout:"fit",modal:true,items:newMetadataPanel,closeAction:"destroy",constrain:true,iconCls:"addIcon"})
}scope.newMetadataWindow.show()
}};
lastclick=0;
Checks={message:translate("loseYourChange"),_setMessage:function(str){this.message=str
},_onbeforeunload:function(e){}};
function unloadMess(){mess=translate("loseYourChange");
return mess
}function doEditorAlert(divId,imgId){$(divId).style.display="block"
}function setBunload(on){if(on){Checks._setMessage(unloadMess())
}else{Checks._setMessage(null)
}}function noDoubleClick(){var now=(new Date()).valueOf();
if((now-lastclick)>500){setBunload(false);
lastclick=now;
return true
}else{return false
}}function doNewElementAction(action,ref,name,id,what,max){var child=null;
var orElement=false;
doNewElementAjax(action,ref,name,child,id,what,max,orElement)
}function doNewORElementAction(action,ref,name,child,id,what,max){var orElement=true;
doNewElementAjax(action,ref,name,child,id,what,max,orElement)
}function doNewAttributeAction(action,ref,name,id,what){var child="geonet:attribute";
var max=null;
var orElement=false;
doNewElementAjax(action,ref,name,child,id,what,max,orElement)
}function doNewElementAjax(action,ref,name,child,id,what,max,orElement){var metadataId=document.mainForm.id.value;
var pars="&id="+metadataId+"&ref="+ref+"&name="+name;
if(child!=null){pars+="&child="+child
}var thisElement=Ext.get(id);
Ext.Ajax.request({url:catalogue.services.rootUrl+action,method:"GET",params:pars,success:function(result,request){var html=result.responseText;
if(child=="geonet:attribute"){Ext.getCmp("editorPanel").save();
return
}if(what=="replace"){Ext.DomHelper.insertHtml("afterEnd",thisElement.dom,html);
thisElement.remove()
}else{if(what=="add"||what=="after"){var el=thisElement.insertHtml("afterEnd",html,true);
setAddControls(el,orElement)
}else{if(what=="before"){var el=thisElement.insertHtml("beforeBegin",html,true);
setAddControls(el,orElement)
}else{Ext.MessageBox.alert("doNewElementAjax: invalid what: "+what+" should be one of replace, after or before.")
}}}Ext.getCmp("editorPanel").metadataLoaded();
setBunload(true)
},onFailure:function(req){Ext.MessageBox.alert(translate("errorAddElement")+name+translate("errorFromDoc")+" / status "+req.status+" text: "+req.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function doRemoveElementAction(action,ref,parentref,id,min){var metadataId=document.mainForm.id.value;
var thisElement=Ext.get(id);
var nextElement=thisElement.next();
var prevElement=thisElement.prev();
Ext.Ajax.request({url:catalogue.services.rootUrl+action,method:"GET",params:{id:metadataId,ref:ref,parent:parentref},success:function(result,request){var html=result.responseText;
if(html==""){if(bottomElement(thisElement)&&document.mainForm.currTab.value!="simple"){swapControls(thisElement,prevElement);
thisElement.remove();
thisElement=prevElement
}else{thisElement.remove();
thisElement=nextElement
}if(topElement(thisElement)){topControls(thisElement,min)
}}else{if(orElement(thisElement)){thisElement.remove()
}else{Ext.DomHelper.insertHtml("afterEnd",thisElement.dom,html);
thisElement.remove()
}}setBunload(true)
},failure:function(result,request){Ext.MessageBox.alert(translate("errorDeleteElement")+name+" "+translate("errorFromDoc")+" / status "+result.status+" text: "+result.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function updateEditorContent(result,request){var editor=Ext.getCmp("editorPanel");
editor.updateEditor(result.responseText);
setBunload(true)
}function doProcessing(config,cb){config.id=document.mainForm.id.value;
config.remote="true";
Ext.Ajax.request({url:catalogue.services.rootUrl+"metadata.processing",method:"POST",params:config,success:function(result,request){updateEditorContent(result,request);
if(cb){cb()
}},failure:function(req){Ext.MessageBox.alert(translate("errorSaveFailed")+"/ status "+req.status+" text: "+req.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function doMoveElementAction(action,ref,id){var thisElement=Ext.get(id);
var config={id:document.mainForm.id.value,ref:ref};
Ext.Ajax.request({url:catalogue.services.rootUrl+action,method:"POST",params:config,success:function(req){if(action.indexOf("elem.up")!=-1){var upElement=thisElement.prev();
thisElement.insertSibling(upElement,"after");
swapControls(thisElement,upElement)
}else{var downElement=thisElement.next();
thisElement.insertSibling(downElement,"before");
swapControls(thisElement,downElement)
}setBunload(true)
},failure:function(req){Ext.MessageBox.alert(translate("errorMoveElement")+ref+" / status "+req.status+" text: "+req.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function doFileRemoveAction(action,ref,access,id){setBunload(false);
document.mainForm.access.value=access;
document.mainForm.ref.value=ref;
document.mainForm.action=action;
Ext.getCmp("editorPanel").callAction(action)
}function checkForFileUpload(fref,pref,protocolBeforeEdit){var fileName=$("_"+fref);
var protoSelect=$("s_"+pref);
var protoIn=$("_"+pref);
var fileUploaded=protocolBeforeEdit.startsWith("WWW:DOWNLOAD");
var protocol=protoSelect.value;
var protocolDownload=(protocol.startsWith("WWW:DOWNLOAD")&&protocol.indexOf("http")>0);
if(fileUploaded){if(!protocolDownload){alert(OpenLayers.i18n("errorChangeProtocol"));
protoSelect.value=protoIn.value
}else{protoIn.value=protoSelect.value
}return
}var finput=Ext.get("di_"+fref);
var fbuttn=Ext.get("db_"+fref);
protoIn.value=protoSelect.value;
if(protocolDownload){if(finput!==null){finput.hide()
}if(fbuttn!==null){fbuttn.show()
}Ext.getCmp("editorPanel").callAction("metadata.update.new")
}else{if(finput!==null){finput.show()
}if(fbuttn!==null){fbuttn.hide()
}}}function handleCheckboxAsBoolean(input,ref){if(input.checked){Ext.getDom(ref).value="true"
}else{Ext.getDom(ref).value="false"
}}function swapControls(el1,el2){var el1Descs=getControlsFromElement(el1);
var el2Descs=getControlsFromElement(el2);
for(var index=0;
index<el1Descs.length;
++index){var visible1=el1Descs[index].isVisible();
var visible2=el2Descs[index]?el2Descs[index].isVisible():false;
if(el2Descs[index]){if(visible1){el2Descs[index].show()
}else{el2Descs[index].hide()
}}if(visible2){el1Descs[index].show()
}else{el1Descs[index].hide()
}}}function getControlsFromElement(el){if(el===null){return[]
}var id=el.getAttribute("id");
var controls=Ext.get("buttons_"+id).query("a");
for(var i=0;
i<controls.length;
i++){controls[i]=Ext.get(controls[i]).setVisibilityMode(Ext.Element.DISPLAY)
}return controls
}function topElement(el){if(el.prev()==undefined){return true
}else{return(!isSameElement(el.prev(),el))
}}function bottomElement(el){if(el.next()==undefined){return true
}else{return(!isSameElement(el.next(),el))
}}function getIdSplit(el){var id=el.getAttribute("id");
if(id==null){return null
}return id.split("_")
}function orElement(el){if(el.next()==undefined){return false
}else{var nextEl=getIdSplit(el.next());
var thisEl=getIdSplit(el);
if(nextEl==null||thisEl==null){return false
}if(nextEl[0]=="child"&&nextEl[1]==thisEl[0]){return true
}else{return false
}}}function isSameElement(el1,el2){var i1=getIdSplit(el1);
var i2=getIdSplit(el2);
if(i1==null||i2==null){return false
}if(i1[0]==i2[0]){return true
}else{return false
}}function topControls(el,min){var elDescs=getControlsFromElement(el);
var index=0;
if(elDescs.length==5){index=1
}if(bottomElement(el)&&!orElement(el)){elDescs[0].show()
}else{elDescs[0].hide()
}if(index==1){if(bottomElement(el)&&!orElement(el)){elDescs[index].show()
}else{elDescs[index].hide()
}}if(bottomElement(el)){if(min==0){elDescs[1+index].show()
}else{elDescs[1+index].hide()
}}else{elDescs[1+index].show()
}elDescs[2+index].hide();
if(bottomElement(el)){elDescs[3+index].hide()
}else{elDescs[3+index].show()
}}function setAddControls(el,orElement){elDescs=getControlsFromElement(el);
var index=0;
if(elDescs.length==5){index=1
}if(orElement){elDescs[0].hide()
}else{elDescs[0].show()
}if(index==1){if(orElement){elDescs[index].hide()
}else{elDescs[index].show()
}}elDescs[1+index].show();
elDescs[2+index].show();
if(elDescs[3+index]){elDescs[3+index].hide()
}if(topElement(el)){elDescs[2+index].hide()
}else{var prevEl=el.prev();
var prevDescs=getControlsFromElement(prevEl);
var prevIndex=0;
if(prevDescs.length==5){prevIndex=1
}prevDescs[0].hide();
if(prevIndex==1){prevDescs[prevIndex].hide()
}prevDescs[1+prevIndex].show();
if(topElement(prevEl)){prevDescs[2+prevIndex].hide()
}else{prevDescs[2+prevIndex].show()
}prevDescs[3+prevIndex].show()
}}function validateNumber(input,nullValue,decimals){var text=input.value;
var validChars="0123456789";
if(!nullValue){if(!validateNonEmpty(input)){return false
}}if(decimals){validChars+="."
}var isNumber=true;
var c;
for(i=0;
i<text.length&&isNumber;
i++){c=text.charAt(i);
if(c=="-"||c=="+"){if(i<0){isNumber=false
}}else{if(validChars.indexOf(c)==-1){isNumber=false
}}}if(!isNumber){Ext.get(input).addClass("error");
return false
}else{Ext.get(input).removeClass("error");
return true
}}function validateNonEmpty(input){if(input.value.length<1){Ext.get(input).addClass("error");
return false
}else{Ext.get(input).removeClass("error");
return true
}}function validateEmail(input){if(!Ext.form.VTypes.email(input.value)){Ext.get(input).addClass("error");
return false
}else{Ext.get(input).removeClass("error");
return true
}}function toggleFieldset(btn,elem){var b=Ext.get(btn);
if(b.hasClass("tgDown")){b.removeClass("tgDown");
elem.style.display="none";
b.addClass("tgRight")
}else{b.removeClass("tgRight");
elem.style.display="block";
b.addClass("tgDown")
}}function enableLocalInput(node,focus){var ref=node.value;
var parent=node.parentNode.parentNode;
var nodes=parent.getElementsByTagName("input");
var textarea=parent.getElementsByTagName("textarea");
showLocalInput(nodes,ref,focus);
showLocalInput(textarea,ref,focus)
}function showLocalInput(nodes,ref,focus){for(index in nodes){var input=nodes[index];
if(input.style!=null&&input.style.display!="none"){input.style.display="none"
}}for(index in nodes){var input=nodes[index];
if(input.name==ref){input.style.display="block";
if(focus){input.focus()
}}}}function clearSuggestion(divSuggestion){if($(divSuggestion)!=null){$(divSuggestion).innerHTML=""
}}function googleTranslate(ref,divSuggestion,target,fromLang,toLang){var map={GE:"de",SP:"es",CH:"zh"};
if(map[fromLang]){fromLang=map[fromLang]
}if(map[toLang]){toLang=map[toLang]
}if($(ref).value==""){Ext.Msg.alert(translate("translateWithGoogle.emptyInput"));
return
}if($(ref).value.length>5000){Ext.Msg.alert(translate("translateWithGoogle.maxSize"));
return
}if($(divSuggestion)!=null){$(divSuggestion).innerHTML=""
}try{google.language.translate($(ref).value,fromLang,toLang,function(result){if(!result.error){var suggestion=result.translation.replace(/&#39;/g,"'").replace(/&quot;/g,'"');
if($(target)!=null){$(target).value=suggestion
}if($(divSuggestion)!=null){$(divSuggestion).innerHTML=suggestion;
$(divSuggestion).style.display="block"
}}else{Ext.Msg.alert(result.error.message+" ("+result.error.code+")")
}validateMetadataField($(target))
})
}catch(err){Ext.Msg.alert("Translation service error","Check google translation API is loaded: "+err)
}}function updateChildren(div,url,onFailureMsg){var pars="&id="+document.mainForm.id.value+"&parentUuid="+Ext.getDom("parentUuid").value+"&schema="+Ext.getDom("schema").value+"&childrenIds="+Ext.getDom("childrenIds").value;
var boxes=Ext.get(div).select('input[type="checkbox"]');
boxes.each(function(s){var e=Ext.getDom(s);
if(e.checked){pars+="&"+e.name+"=true"
}});
var radios=Ext.get(div).select('input[type="radio"]');
radios.each(function(radio){var e=Ext.getDom(radio);
if(radio.checked){pars+="&"+e.name+"="+e.value
}});
Ext.Ajax.request({url:catalogue.services.rootUrl+url,method:"GET",params:pars,success:function(result,request){var xmlNode=result.responseXML;
if(xmlNode.childNodes.length!==0&&xmlNode.childNodes[0].localName=="response"){var response=xmlNode.childNodes[0].childNodes[0].nodeValue;
Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),response);
Ext.get(div).hide()
}else{Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),onFailureMsg)
}},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),onFailureMsg)
}})
};Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.HelpPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"book",title:undefined,collapsible:true,collapsed:false},editor:undefined,cache:{},loadHelp:function(id,sectionId,updateMessage,cb){var info=id.split("|");
var panel=this;
var schema=this.editor.metadataSchema;
var requestBody='<request><element schema="'+schema+'" name="'+info[1]+'" context="'+info[2]+'" fullContext="'+info[3]+'" isoType="'+info[4]+'" /></request>';
OpenLayers.Request.POST({url:this.editor.catalogue.services.schemaInfo,data:requestBody,success:function(response){var help=response.responseXML.getElementsByTagName("element")[0];
var title=help.getElementsByTagName("label")[0];
var desc=help.getElementsByTagName("description")[0];
var cond=help.getElementsByTagName("conditional")[0];
var msg="<div class='help'><span class='title'>"+(title?title.firstChild.nodeValue:"")+"</span><br/> "+(desc&&desc.firstChild?desc.firstChild.nodeValue:"")+(cond&&cond.firstChild?"<br/> "+cond.firstChild.nodeValue:"")+"<br/>["+schema+":"+info[1]+"]</div>";
panel.cache[id]=msg;
if(sectionId&&panel.cache[sectionId]){msg+=panel.cache[sectionId]
}if(cb){panel.cb()
}if(updateMessage){panel.update(panel.cache[id]+(panel.cache[sectionId]?panel.cache[sectionId]:""))
}},failure:function(response){}})
},updateHelp:function(id,section){if(this.collapsed){return
}var key=id;
var msg="";
var sectionId;
var panel=this;
if(section){sectionId=section.first().getAttribute("id")
}if(this.cache[id]&&this.cache[sectionId]){this.update(this.cache[id]+this.cache[sectionId])
}else{if(sectionId){this.loadHelp(sectionId,null,false,panel.loadHelp(id,sectionId,true))
}else{this.loadHelp(id,null,true)
}}},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("help");
GeoNetwork.editor.HelpPanel.superclass.initComponent.call(this);
panel=this
}});
Ext.reg("gn_editor_helppanel",GeoNetwork.editor.HelpPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.keyword={};
GeoNetwork.editor.KeywordSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,Keyword:Ext.data.Record.create([{name:"value"},{name:"thesaurus"},{name:"uri"}]),keywordStore:undefined,border:false,addAsXLink:false,itemSelector:null,loadingMask:null,ThesaurusCount:null,ref:null,name:"gmd:descriptiveKeywords",keywordsSelected:[],initComponent:function(){this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox"},reader:new Ext.data.XmlReader({record:"keyword",id:"uri"},this.Keyword),fields:["value","thesaurus","uri"],sortInfo:{field:"thesaurus"}});
this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:[this.getThesaurusCombo()," ",this.getKeyword(),"->",OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()],items:[this.getKeywordsItemSelector()]}];
this.keywordStore.on({loadexception:function(){},beforeload:function(store,options){if(Ext.getCmp("maxResults")){store.baseParams.maxResults=Ext.getCmp("maxResults").getValue()
}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show()
},load:function(){this.loadingMask.hide()
},scope:this});
this.addEvents("keywordselected");
this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(c,checked){this.addAsXLink=checked
},scope:this}},{id:"keywordSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildKeywordXmlList()
},scope:this}];
GeoNetwork.editor.KeywordSelectionPanel.superclass.initComponent.call(this)
},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"})
},setRef:function(ref){this.ref=ref
},setAddAsXLink:function(xlink){this.addAsXLink=xlink||false;
Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink)
},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40}
},getThesaurusCombo:function(){GeoNetwork.editor.keyword.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus,allOption:true,activatedOnly:true});
return{xtype:"combo",width:150,id:"search-thesauri",value:0,store:GeoNetwork.editor.keyword.thesaurusStore,triggerAction:"all",mode:"local",displayField:"filename",valueField:"id",listWidth:250,listeners:{select:function(combo,record,index){this.keywordStore.removeAll();
this.keywordStore.baseParams.pThesauri=combo.getValue();
var value=Ext.getCmp("keywordSearchField").getValue();
if(value.length<1){this.keywordStore.baseParams.pKeyword="*"
}else{this.keywordStore.baseParams.pKeyword=value
}this.keywordStore.reload()
},clear:function(combo){this.keywordStore.load()
},scope:this}}
},getKeywordsItemSelector:function(){var tpl='<tpl for="."><div class="ux-mselect-item';
if(Ext.isIE||Ext.isIE7){tpl+='" unselectable=on'
}else{tpl+=' x-unselectable"'
}tpl+='>{id} {value} <span class="ux-mselect-item-thesaurus">({thesaurus})</span></div></tpl>';
this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["value","thesaurus"],toData:[],msWidth:320,msHeight:230,valueField:"value",toSortField:undefined,fromTpl:tpl,toTpl:tpl,toLegend:OpenLayers.i18n("selectedKeywords"),fromLegend:OpenLayers.i18n("foundKeywords"),fromStore:this.keywordStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/MultiselectItemSelector-3.0/icons",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var i=this.getForm().findField("itemselector");
i.reset.call(i)
},scope:this}]});
this.itemSelector.on({change:function(component){Ext.getCmp("keywordSearchValidateButton").setDisabled(component.toStore.getCount()<1)
}});
return this.itemSelector
},buildKeywordXmlList:function(){this.keywordsSelected=[];
var self=this;
this.ThesaurusCount=0;
var thesaurusCollection=[];
var store=this.itemSelector.toMultiselect.store;
thesaurusCollection=store.collect("thesaurus");
Ext.each(thesaurusCollection,function(thesaurus,index,thesauri){store.filter("thesaurus",thesaurus);
var values=store.collect("uri");
Ext.each(values,function(item,index){values[index]=item.replace("#","%23")
});
var serviceUrl=self.catalogue.services.getKeyword;
var multiple=values.length>1?true:false;
var inputValue=serviceUrl+"?thesaurus="+thesaurus+"&id="+values.join(",")+"&multiple="+multiple;
++self.ThesaurusCount;
if(self.addAsXLink){var tpl="<gmd:descriptiveKeywords xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco' xlink:href='"+inputValue+"'/>";
self.keywordsSelected.push(tpl)
}else{self.retrieveKeywordData(inputValue)
}});
if(this.addAsXLink){this.fireEvent("keywordselected",this,this.keywordsSelected);
this.ownerCt.hide()
}store.clearFilter()
},retrieveKeywordData:function(url){Ext.getCmp("keywordSearchValidateButton").disable();
Ext.Ajax.request({url:url,method:"GET",scope:this,success:function(response){var keyword=response.responseText;
if(keyword.indexOf("<gmd:MD_Keywords")!==-1){this.keywordsSelected.push("<gmd:descriptiveKeywords xmlns:gmd='http://www.isotc211.org/2005/gmd'>"+response.responseText+"</gmd:descriptiveKeywords>")
}Ext.getCmp("keywordSearchValidateButton").enable();
this.ThesaurusCount-=1;
if(this.ThesaurusCount===0){this.fireEvent("keywordselected",this,this.keywordsSelected);
this.ownerCt.hide()
}}})
}});
Ext.reg("gn_editor_keywordselectionpanel",GeoNetwork.editor.KeywordSelectionPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.LinkedMetadataPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,selectedUuid:undefined,selectedType:undefined,metadataSchema:undefined,serviceUrl:undefined,store:undefined,parentAction:undefined,datasetAction:undefined,serviceAction:undefined,featureCatAction:undefined,delFeatureCatAction:undefined,updateChildrenAction:undefined,colModel:undefined,expander:undefined,defaultConfig:{border:false,frame:false,iconCls:"linkIcon",collapsible:true,collapsed:false},createColumnDef:function(){this.expander=new Ext.grid.RowExpander({tpl:new Ext.XTemplate('<div title=""><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');">{title}</a></div>{msg}')});
return[this.expander,{id:"type",header:OpenLayers.i18n("type"),width:60,sortable:true,hidden:true,dataIndex:"type"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}]
},createColumnModel:function(){this.colModel=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:this.createColumnDef()});
return this.colModel
},updatePanel:function(){this.reload()
},clear:function(){this.store.removeAll()
},reload:function(e,id,schema){this.metadataId=id||this.metadataId;
this.metadataSchema=schema||this.metadataSchema;
if(this.collapsed){return
}this.colModel.setConfig(this.createColumnDef());
var isIso=this.metadataSchema.indexOf("iso19139")!==-1;
var isIso19110=this.metadataSchema==="iso19110";
this.parentAction.setDisabled(!isIso);
this.serviceAction.setDisabled(!isIso);
this.datasetAction.setDisabled(!isIso);
this.featureCatAction.setDisabled(isIso19110);
this.store.reload({params:{id:this.metadataId,fast:"false"}})
},updateStatus:function(store,records,options){var children=store.find("type","children");
this.updateChildrenAction.setDisabled(children===-1);
var iso19110=store.find("type","related");
this.delFeatureCatAction.setDisabled(iso19110===-1)
},selectionChangeEvent:function(g,idx,e){var record=g.getStore().getAt(idx);
this.selectedUuid=record.get("uuid");
this.selectedType=record.get("type");
this.delFeatureCatAction.setDisabled(this.selectedType!=="related")
},getChildrenIds:function(){var uuidList=[];
this.store.each(function(record){if(record.get("type")==="children"){this.push(record.get("id"))
}},uuidList);
return uuidList
},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("relatedResources");
this.tools=[{id:"refresh",handler:function(e,toolEl,panel,tc){panel.reload(panel,panel.metadataId)
}}];
this.parentAction=new Ext.Action({text:OpenLayers.i18n("parentMd"),handler:function(){this.switchToTab("metadata")
},scope:this.editor});
this.datasetAction=new Ext.Action({text:OpenLayers.i18n("datasetMd"),iconCls:"cat-dataset",handler:function(){this.showLinkedServiceMetadataSelectionPanel("coupledResource","","")
},scope:this.editor});
this.serviceAction=new Ext.Action({text:OpenLayers.i18n("serviceMd"),iconCls:"cat-service",handler:function(){this.showLinkedServiceMetadataSelectionPanel("attachService","","")
},scope:this.editor});
this.featureCatAction=new Ext.Action({text:OpenLayers.i18n("featureCat"),iconCls:"cat-featureCatalogue",handler:function(){this.showLinkedMetadataSelectionPanel(null,"iso19110")
},scope:this.editor});
this.delFeatureCatAction=new Ext.Action({text:OpenLayers.i18n("delete19110Relation"),handler:function(){this.editor.catalogue.doAction(this.editor.catalogue.services.mdRelationDelete,{childUuid:this.selectedUuid,parentId:this.metadataId},null,null,this.reload.bind(this),null)
},scope:this,disabled:true});
this.updateChildrenAction=new Ext.Action({text:OpenLayers.i18n("updateChildren"),handler:function(){this.editor.catalogue.modalAction(OpenLayers.i18n("updateChildren"),this.editor.catalogue.services.mdMassiveChildrenForm+"?parentUuid="+document.mainForm.uuid.value+"&schema="+document.mainForm.schema.value+"&childrenIds="+this.getChildrenIds().join(","))
},scope:this,disabled:true});
this.bbar=new Ext.Toolbar({items:[{text:OpenLayers.i18n("createLink"),iconCls:"relatedAddIcon",menu:new Ext.menu.Menu({items:[this.parentAction,this.datasetAction,this.serviceAction,this.featureCatAction]})},{text:OpenLayers.i18n("otherActions"),menu:new Ext.menu.Menu({items:[this.updateChildrenAction,this.delFeatureCatAction]})}]});
GeoNetwork.editor.LinkedMetadataPanel.superclass.initComponent.call(this);
this.store=new GeoNetwork.data.MetadataRelationStore(this.serviceUrl,{fast:false,id:this.metadataId},true);
var panel=this;
var grid=new Ext.grid.GridPanel({store:this.store,colModel:this.createColumnModel(),loadMask:true,plugins:this.expander,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("records")+'" : "'+OpenLayers.i18n("record")+'"]})'}),frame:false,height:150,autoWidth:true,listeners:{rowclick:this.selectionChangeEvent,scope:panel}});
this.add(grid);
if(this.metadataId){this.reload()
}this.editor.on("editorClosed",this.clear,this);
this.editor.on("metadataUpdated",this.reload,this);
this.on("expand",this.reload);
this.store.on("load",this.updateStatus,this)
}});
Ext.reg("gn_editor_linkedmetadatapanel",GeoNetwork.editor.LinkedMetadataPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.Filter={SERVICE:[{name:"E_type",value:"service"}],DATASET:[{name:"E_type",value:"dataset"}],FEATURE_CATALOGUE:[{name:"E__schema",value:"iso19110"}]};
GeoNetwork.editor.linkedMetadata={};
GeoNetwork.editor.LinkedMetadataSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,border:false,layout:"fit",createIfNotExistURL:null,hiddenParameters:GeoNetwork.editor.Filter.DATASET,singleSelect:true,loadingMask:null,mdStore:null,ref:null,proxy:null,mode:null,serviceUrl:null,capabilitiesStore:null,linkedMetadataStore:undefined,initComponent:function(){this.addEvents("linkedmetadataselected");
this.mdStore=GeoNetwork.data.MetadataResultsStore();
this.linkedMetadataStore=GeoNetwork.data.MetadataCSWResultsStore();
if(this.mode==="attachService"||this.mode==="coupledResource"){this.capabilitiesStore=new GeoExt.data.WMSCapabilitiesStore({url:this.serviceUrl,id:"capabilitiesStore",listeners:{exception:function(proxy,type,action,options,res,arg){Ext.MessageBox.alert(OpenLayers.i18n("error"))
},beforeload:function(){if(this.mode==="attachService"){var selected=Ext.getCmp("linkedMetadataGrid").getSelectionModel().getSelections();
if(selected===undefined||selected[0].data.uri===""){Ext.MessageBox.alert(OpenLayers.i18n("noServiceURLError"))
}this.capabilitiesStore.baseParams.url=selected[0].data.uri+"?&SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1"
}else{if(this.mode==="coupledResource"){this.capabilitiesStore.baseParams.url=this.serviceUrl
}}},loadexception:function(){Ext.MessageBox.alert(OpenLayers.i18n("GetCapabilitiesDocumentError")+this.capabilitiesStore.baseParams.url)
},scope:this}})
}if(this.mode==="attachService"){this.hiddenParameters=GeoNetwork.editor.Filter.SERVICE
}else{if(this.mode==="iso19110"){this.hiddenParameters=GeoNetwork.editor.Filter.FEATURE_CATALOGUE
}}var checkboxSM=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:"",listeners:{selectionchange:function(){Ext.getCmp("linkedMetadataValidateButton").setDisabled(this.getSelections().length<1)
}}});
var tbarItems=[this.getSearchInput(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()];
this.addHiddenFormInput(tbarItems);
var grid=new Ext.grid.GridPanel({id:"linkedMetadataGrid",xtype:"grid",layout:"fit",height:280,bodyStyle:"padding: 0px;",border:true,loadMask:true,tbar:tbarItems,store:this.linkedMetadataStore,columns:[checkboxSM,{id:"title",header:OpenLayers.i18n("mdTitle"),dataIndex:"title"},{id:"subject",header:OpenLayers.i18n("keywords"),dataIndex:"subject",hidden:true},{id:"uri",header:OpenLayers.i18n("uri"),dataIndex:"getCapabilitiesUrl"}],sm:checkboxSM,autoExpandColumn:"title",listeners:{rowclick:function(grid,rowIndex,e){if(this.capabilitiesStore!==null&&this.mode!=="coupledResource"){this.serviceUrl=grid.getStore().getAt(rowIndex).data.uri;
if(this.serviceUrl===""){this.capabilitiesStore.removeAll()
}else{this.capabilitiesStore.baseParams.url=this.serviceUrl;
this.capabilitiesStore.reload()
}}},scope:this}});
if(this.mode==="attachService"||this.mode==="coupledResource"){this.items=this.getScopedNamePanel(grid)
}else{this.items=grid
}var panel=this;
this.bbar=["->",{id:"linkedMetadataValidateButton",iconCls:"relatedAddIcon",text:OpenLayers.i18n("createRelation"),disabled:true,handler:function(){var selected=grid.getSelectionModel().getSelections();
this.fireEvent("linkedmetadataselected",this,selected);
this.ownerCt.close()
},scope:panel}];
this.linkedMetadataStore.on({load:function(){if(this.loadingMask!==null){this.loadingMask.hide()
}},scope:this});
GeoNetwork.editor.LinkedMetadataSelectionPanel.superclass.initComponent.call(this)
},getCreateIfNotExistButton:function(){if(!this.createIfNotExistURL){return""
}return{id:"createIfNotExistButton",iconCls:"addIcon",text:OpenLayers.i18n("createIfNotExistButton"),handler:function(){window.location.replace(this.createIfNotExistURL)
},scope:this}
},setRef:function(ref){this.ref=ref
},addHiddenFormInput:function(items){var i;
for(i=0;
i<this.hiddenParameters.length;
i++){items.push({xtype:"textfield",fieldLabel:this.hiddenParameters[i].name,name:this.hiddenParameters[i].name,value:this.hiddenParameters[i].value,hidden:true})
}return items
},getSearchInput:function(){return new GeoNetwork.form.SearchField({name:"E.8_AnyText",width:240,store:this.linkedMetadataStore,triggerAction:function(scope){scope.doSearch()
},scope:this})
},getLimitInput:function(){return{xtype:"textfield",name:"nbResultPerPage",id:"nbResultPerPage",value:20,width:40}
},getScopedNamePanel:function(grid){var combo={xtype:"combo",id:"getCapabilitiesLayerNameCombo",fieldLabel:OpenLayers.i18n("getCapabilitiesLayer"),store:this.capabilitiesStore,valueField:"name",displayField:"title",triggerAction:"all",listeners:{select:function(combo,record,index){Ext.getCmp("getCapabilitiesLayerName").setValue(combo.getValue())
}}};
var layerName={xtype:"textfield",id:"getCapabilitiesLayerName",fieldLabel:OpenLayers.i18n("layerName"),valueField:"name",displayField:"title"};
var panel={xtype:"panel",layout:"form",bodyStyle:"padding: 2px;",border:true,items:[grid,combo,layerName]};
return panel
},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show();
GeoNetwork.editor.nbResultPerPage=20;
if(Ext.getCmp("nbResultPerPage")){GeoNetwork.editor.nbResultPerPage=Ext.getCmp("nbResultPerPage").getValue()
}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,Ext.emptyFn)
},showResults:function(response){var getRecordsFormat=new OpenLayers.Format.CSWGetRecords.v2_0_2();
var r=getRecordsFormat.read(response.responseText);
var values=r.records;
if(values.length>0){this.linkedMetadataStore.loadData(r)
}}});
Ext.reg("gn_editor_linkedmetadataselectionpanel",GeoNetwork.editor.LinkedMetadataSelectionPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.LogoSelectionPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,logoAddUrl:undefined,ref:undefined,setRef:function(ref){this.ref=ref
},getUploadForm:function(){this.uploadForm=new Ext.form.FormPanel({fileUpload:true,region:"south",height:80,split:true,items:{xtype:"fileuploadfield",allowBlank:false,emptyText:OpenLayers.i18n("logoSelect"),hideLabel:true,name:"fname",buttonCfg:{iconCls:"thumbnailAddIcon"}},buttons:[{text:OpenLayers.i18n("upload"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:this.logoAddUrl,scope:this,success:function(fp,action){this.store.reload()
},failure:function(response){Ext.Msg.alert(OpenLayers.i18n("failure"),response.responseText)
}})
}}}]});
return this.uploadForm
},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
var tpl=new Ext.XTemplate('<tpl for="."><div class="logo-wrap"><div id="{name}" class="logo">','<img src="'+this.logoUrl+'{name}" title="{name}"/><span>{name}</span></div></div>',"</tpl>");
var logo=Ext.data.Record.create([{name:"name",mapping:""}]);
this.store=new Ext.data.Store({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:this.serviceUrl,disableCaching:false}),reader:new Ext.data.XmlReader({record:"icon",id:"icon"},logo),fields:["name"]});
this.view=new Ext.DataView({store:this.store,tpl:tpl,singleSelect:true,selectedClass:"logo-selected",overClass:"logo-over",itemSelector:"div.logo-wrap",autoScroll:true,listeners:{selectionchange:function(dv,selections){var idx=this.view.getSelectedIndexes();
if(selections){this.fireEvent("logoselected",this,idx);
this.ownerCt.hide()
}},scope:this}});
this.items=[new Ext.Panel({region:"center",split:true,border:true,autoScroll:true,items:[this.view]}),this.getUploadForm()];
GeoNetwork.editor.LogoSelectionPanel.superclass.initComponent.call(this);
this.addEvents("logoselected");
this.store.load()
}});
Ext.reg("gn_editor_logoselectionpanel",GeoNetwork.editor.LogoSelectionPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.NewMetadataPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,isTemplate:"n"},editor:undefined,getGroupUrl:undefined,groupStore:undefined,catalogue:undefined,tplStore:undefined,selectedGroup:undefined,selectedTpl:undefined,isChild:undefined,filter:undefined,createBt:undefined,validate:function(){if(this.selectedGroup!==undefined&&this.selectedTpl!==undefined){this.createBt.setDisabled(false)
}else{this.createBt.setDisabled(true)
}},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
var checkboxSM,colModel;
this.createBt=new Ext.Button({text:OpenLayers.i18n("create"),iconCls:"addIcon",disabled:true,handler:function(){this.catalogue.metadataEdit(this.selectedTpl,true,this.selectedGroup,this.isChild,this.isTemplate);
this.ownerCt.hide()
},scope:this});
this.buttons=[this.createBt,{text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.ownerCt.hide()
},scope:this}];
GeoNetwork.editor.NewMetadataPanel.superclass.initComponent.call(this);
this.groupStore=GeoNetwork.data.GroupStore(this.getGroupUrl);
this.groupStore.load();
if(!this.selectedTpl){this.tplStore=GeoNetwork.data.MetadataResultsStore();
this.tplStore.setDefaultSort("displayOrder");
checkboxSM=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});
colModel=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[checkboxSM,{header:"Schema",dataIndex:"schema"},{id:"title",header:"Title",dataIndex:"title"},{header:"Order",hidden:true,dataIndex:"displayOrder"}]});
this.add(new Ext.grid.GridPanel({layout:"fit",title:OpenLayers.i18n("chooseTemplate"),border:false,autoScroll:true,height:330,store:this.tplStore,colModel:colModel,sm:checkboxSM,autoExpandColumn:"title",listeners:{rowclick:function(grid,rowIndex,e){var data=grid.getStore().getAt(rowIndex).data;
if(grid.getSelectionModel().getCount()!==0){this.selectedTpl=data.id
}else{this.selectedTpl=undefined
}this.validate()
},scope:this}}));
this.catalogue.search({E_template:"y"},null,null,1,true,this.tplStore,null)
}this.add(new Ext.form.ComboBox({name:"E_group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:this.groupStore,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>",listeners:{select:function(field,record,idx){this.selectedGroup=record.get("id");
this.validate()
},scope:this}}));
this.add({xtype:"textfield",name:"isTemplate",hidden:true,value:this.isTemplate})
}});
Ext.reg("gn_editor_newmetadatapanel",GeoNetwork.editor.NewMetadataPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.GeoPublisherPanel=Ext.extend(Ext.form.FormPanel,{border:false,serviceUrl:undefined,itemSelector:null,geoserverStore:undefined,loadingMask:null,metadataId:null,fileName:null,layerName:null,accessStatus:null,nodeId:null,geoPublicationMap:null,geoPublicationMapPanel:null,geoPublicationTb:null,layers:null,extent:null,stylerBt:null,publishBt:null,unpublishBt:null,checkBt:null,protocols:{wms:{checked:true,label:"OGC:WMS",},wfs:{checked:false,label:"OGC:WFS"},wcs:{checked:false,label:"OGC:WCS"},},addOnLineSourceBt:null,addOnLineSourceMenu:null,enableStyler:false,statusBar:null,layerPreviewName:"DatasetPreview",initComponent:function(){var panel=this;
var record=Ext.data.Record.create([{name:"id"},{name:"name"},{name:"adminUrl"},{name:"wmsUrl"},{name:"wfsUrl"},{name:"wcsUrl"},{name:"stylerUrl"},{name:"namespacePrefix"}]);
this.geoserverStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:panel.serviceUrl+"?action=LIST",method:"GET"}),baseParams:{action:"LIST"},reader:new Ext.data.XmlReader({record:"node",id:"id"},record),sortInfo:{field:"name"}});
this.publishBt=new Ext.Button({text:OpenLayers.i18n("publish"),tooltip:OpenLayers.i18n("publishTooltip"),iconCls:"addVector",handler:function(){this.statusBar.setText("");
this.loadingMask.show();
Ext.Ajax.request({url:panel.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"CREATE"},method:"GET",success:function(result,request){if(result.responseText.indexOf("OutOfMemoryError")!==-1){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("outOfMemoryError"));
this.loadingMask.hide();
return
}var root=result.responseXML.getElementsByTagName("Exception").item(0);
if(root!==null){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("publishErrorCode")+root.getAttribute("status"));
this.loadingMask.hide();
return
}this.statusBar.setText(OpenLayers.i18n("publishSuccess"));
this.updatePrivileges(1);
this.addLayer(this.layerPreviewName,this.layerName);
this.statusBar.setText(this.statusBar.text+OpenLayers.i18n("publishLayerAdded"));
this.loadingMask.hide()
},failure:function(result,request){this.statusBar.setText(OpenLayers.i18n("publishError"));
this.loadingMask.hide()
},scope:this})
},scope:this});
this.unpublishBt=new Ext.Button({text:OpenLayers.i18n("unpublish"),tooltip:OpenLayers.i18n("unpublishTooltip"),iconCls:"delVector",handler:function(){this.statusBar.setText("");
this.cleanLayerPreview();
Ext.Ajax.request({url:panel.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"DELETE"},method:"GET",success:function(result,request){this.statusBar.setText(OpenLayers.i18n("unpublishSuccess"));
this.updatePrivileges(0)
},failure:function(result,request){this.statusBar.setText(OpenLayers.i18n("unpublishError"))
},scope:this})
},scope:this});
this.checkBt=new Ext.Button({text:OpenLayers.i18n("check"),iconCls:"connect",listeners:{click:function(){this.statusBar.setText("");
Ext.Ajax.request({url:panel.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"GET"},method:"GET",success:function(result,request){var root=result.responseXML.getElementsByTagName("Exception").item(0);
if(root!==null){var status=root.getAttribute("status");
this.statusBar.setText(OpenLayers.i18n("errorDatasetNotFound")+status);
if(status.indexOf("No vector layer")!==-1||status.indexOf("404")!==-1){this.updatePrivileges(0)
}else{this.updatePrivileges()
}return
}this.statusBar.setText(OpenLayers.i18n("datasetFound"));
this.updatePrivileges(1);
this.addLayer(this.layerPreviewName,this.layerName)
},failure:function(result,request){this.statusBar.setText(OpenLayers.i18n("checkFailure"));
this.updatePrivileges()
},scope:this})
},scope:this}});
this.addOnLineSourceBt={text:OpenLayers.i18n("addOnlineSource"),tooltip:"",iconCls:"processMetadata",handler:function(){var node=this.geoserverStore.getById(this.nodeId);
this.fireEvent("addOnLineSource",this,node,this.protocols)
},scope:this};
var items=[];
for(p in this.protocols){if(this.protocols.hasOwnProperty(p)){var item=this.protocols[p];
items.push({text:item.label,canActivate:false,hideOnClick:false,checked:item.checked,checkHandler:this.protocolChecked,scope:item})
}}items.push("-",this.addOnLineSourceBt);
this.addOnLineSourceMenu=new Ext.Button({iconCls:"processMetadata",text:OpenLayers.i18n("addOnlineSourceTitle"),tooltip:OpenLayers.i18n("addOnlineSourceTT"),menu:new Ext.menu.Menu({items:items})});
this.stylerBt=new Ext.Button({text:OpenLayers.i18n("Style"),iconCls:"styler",id:"stylerBt",tooltip:"",handler:function(){var node=this.geoserverStore.getById(this.nodeId);
var url=node.get("stylerUrl")+"?namespace="+node.get("namespacePrefix")+"&layer="+node.get("namespacePrefix")+":"+this.layerName;
window.open(url,"","toolbar=no,menubar=no,width=600,height=500")
},scope:this});
this.geoPublicationTb=new Ext.Toolbar({items:[this.getGeoserverCombo(),this.checkBt,this.publishBt,this.unpublishBt,this.addOnLineSourceMenu,this.stylerBt]});
this.statusBar=new Ext.form.Label({id:"statusBar",html:OpenLayers.i18n("statusInformation")});
var tb=new Ext.Toolbar({items:[this.statusBar]});
this.geoserverStore.load({add:false});
this.tbar=this.geoPublicationTb;
this.bbar=tb;
this.items=this.getGeoPublicationMapPanel();
this.addEvents("addOnLineSource");
GeoNetwork.editor.GeoPublisherPanel.superclass.initComponent.call(this);
this.on("resize",function(el,w,h){el.geoPublicationMapPanel.setSize(w,h)
});
if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(Ext.getBody(),{msg:OpenLayers.i18n("publishing")})
}},getGeoPublicationMapPanel:function(){var map=new OpenLayers.Map(),i;
this.geoPublicationMapPanel=new GeoExt.MapPanel({id:"mapPanel",extent:this.extent,layers:GeoNetwork.map.BACKGROUND_LAYERS||[],map:map,width:this.width,height:this.height});
return this.geoPublicationMapPanel
},addLayer:function(title,name){var map=Ext.getCmp("mapPanel").map;
this.cleanLayerPreview();
var layer=new OpenLayers.Layer.WMS(title,this.geoserverStore.getById(this.nodeId).get("wmsUrl"),{transparent:"true",layers:name});
map.addLayer(layer)
},cleanLayerPreview:function(){var map=Ext.getCmp("mapPanel").map;
var currentLayers=map.getLayersByName(this.layerPreviewName);
if(currentLayers.length>0){currentLayers[0].destroy()
}},getGeoserverCombo:function(){return{xtype:"combo",tpl:'<tpl for="."><div ext:qtip="{name}. {adminUrl}" class="x-combo-list-item">{name}</div></tpl>',store:this.geoserverStore,displayField:"name",autoSelect:true,forceSelection:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectANode"),id:"geoserverNode",listeners:{select:function(combo,record,index){this.nodeId=record.get("id");
this.cleanLayerPreview();
this.enableStyler=(record.get("stylerUrl")===""?false:true);
this.checkBt.fireEvent("click")
},scope:this}}
},setRef:function(id,fileName,accessStatus){this.metadataId=id;
this.fileName=fileName;
this.accessStatus=accessStatus;
if(this.fileName.indexOf("jdbc")!==-1){this.layerName=this.fileName.substr(this.fileName.indexOf("#")+1,this.fileName.length)
}else{if(this.accessStatus==="fileOrUrl"){var from=this.fileName.lastIndexOf("/")+1;
var to=this.fileName.lastIndexOf(".");
this.layerName=this.fileName.substr(from,to-from)
}else{this.layerName=this.fileName.substr(0,this.fileName.indexOf("."))
}}this.cleanLayerPreview();
this.updatePrivileges();
if(this.nodeId!==null){this.checkBt.fireEvent("click")
}},protocolChecked:function(item,checked){this.checked=checked
},updatePrivileges:function(step){if(this.nodeId===null){this.checkBt.disable()
}else{this.checkBt.enable()
}this.publishBt.disable();
this.unpublishBt.disable();
this.addOnLineSourceMenu.disable();
this.stylerBt.disable();
switch(step){case 0:this.publishBt.enable();
break;
case 1:this.publishBt.enable();
this.unpublishBt.enable();
this.addOnLineSourceMenu.enable();
if(this.fileName.indexOf("tif")!==-1||!this.enableStyler){this.stylerBt.disable()
}else{this.stylerBt.enable()
}break
}}});
Ext.reg("gn_editor_geopublisherpanel",GeoNetwork.editor.GeoPublisherPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.SuggestionsPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"suggestionIcon",title:undefined,collapsible:true,collapsed:true},metadataId:undefined,processName:undefined,processParams:undefined,processParametersWindow:undefined,catalogue:undefined,editor:undefined,store:undefined,clear:function(){this.store.removeAll()
},reload:function(e,id){this.metadataId=id||this.metadataId;
if(this.collapsed){return
}this.store.reload({params:{id:this.metadataId}})
},runSuggestedProcess:function(){if(this.processName){if(this.processParams){this.generateForm()
}else{var action=this.catalogue.services.mdProcessing+"?id="+this.metadataId+"&process="+this.processName;
this.run(action)
}}},run:function(action){this.editor.process(action);
if(this.processParametersWindow){this.processParametersWindow.hide();
this.processParametersWindow.destroy();
this.processParametersWindow=undefined
}},selectionChangeEvent:function(dv,selections){var records=dv.getRecords(selections);
if(records[0]){this.getBottomToolbar().setDisabled(false);
this.processName=records[0].get("name");
this.processParams=records[0].get("params")
}else{this.getBottomToolbar().setDisabled(true);
this.processName=undefined;
this.processParams=undefined
}},generateForm:function(){this.processParametersWindow=undefined;
if(!this.processParametersWindow){var processParametersPanel=new Ext.form.FormPanel({defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"process",allowBlank:false,hidden:true,value:this.processName}],buttons:[{text:OpenLayers.i18n("process"),iconCls:"suggestionRunIcon",handler:function(){if(processParametersPanel.getForm().isValid()){var action=this.catalogue.services.mdProcessing+"?"+processParametersPanel.getForm().getValues(true);
this.run(action)
}},scope:this},{text:OpenLayers.i18n("reset"),iconCls:"cancel",handler:function(){processParametersPanel.getForm().reset()
}}]});
var config=Ext.util.JSON.decode(this.processParams),xtype,defaultValue="",hide=false,c;
for(c in config){if(config.hasOwnProperty(c)){if(config[c].type==="boolean"){xtype="checkbox"
}else{xtype="textfield"
}if(c==="gurl"&&this.catalogue.URL){defaultValue=this.catalogue.URL;
hide=true
}else{if(c==="lang"&&this.catalogue.LANG){defaultValue=this.catalogue.LANG;
hide=true
}else{hide=false;
defaultValue=config[c].defaultValue
}}processParametersPanel.add({xtype:xtype,name:c,fieldLabel:OpenLayers.i18n(this.processName+c),hidden:hide,value:defaultValue})
}}this.processParametersWindow=new Ext.Window({title:OpenLayers.i18n("processParametersWindow"),width:300,height:300,layout:"fit",modal:true,items:processParametersPanel,closeAction:"destroy",constrain:true,iconCls:"suggestionIcon"})
}this.processParametersWindow.show()
},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("suggestions");
this.tools=[{id:"refresh",handler:function(e,toolEl,panel,tc){panel.reload(panel,panel.metadataId)
}}];
this.bbar=new Ext.Toolbar({disabled:true,items:[{text:OpenLayers.i18n("applySelected"),iconCls:"suggestionRunIcon",handler:this.runSuggestedProcess,scope:this}]});
var tpl=new Ext.XTemplate('<ul><tpl for=".">','<li class="suggestion" title="{name}">{desc}','<span class="suggestion-{operational}"></span></li>',"</tpl></ul>");
this.store=new GeoNetwork.data.SuggestionStore(this.catalogue.services.mdSuggestion,{action:"analyze",id:this.metadataId},false);
var grid=new Ext.DataView({store:this.store,tpl:tpl,singleSelect:true,autoHeight:true,loadingText:"...",selectedClass:"suggestion-selected",overClass:"suggestion-over",itemSelector:"li.suggestion",emptyText:OpenLayers.i18n("noSuggestion"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});
GeoNetwork.editor.SuggestionsPanel.superclass.initComponent.call(this);
this.add(grid);
this.editor.on("editorClosed",this.clear,this);
this.editor.on("metadataUpdated",this.reload,this);
this.on("expand",this.reload)
}});
Ext.reg("gn_editor_suggestionspanel",GeoNetwork.editor.SuggestionsPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.ThumbnailPanel=Ext.extend(Ext.Panel,{title:undefined,metadataId:undefined,versionId:undefined,setThumbnail:undefined,unsetThumbnail:undefined,getThumbnail:undefined,uploadForm:undefined,idField:undefined,versionField:undefined,thumbnail:undefined,editor:undefined,dataView:undefined,store:undefined,thumbnailUploadWindow:undefined,addButton:undefined,delButton:undefined,defaultConfig:{border:false,frame:false,iconCls:"thumbnailIcon",collapsible:true,collapsed:false,autoScroll:true},clear:function(){this.store.removeAll()
},reload:function(e,id,schema,version){this.metadataId=id||this.metadataId;
this.versionId=version||this.metadataId;
if(this.collapsed){return
}this.idField.setValue(this.metadataId);
this.versionField.setValue(this.versionId);
this.store.reload({params:{id:this.metadataId}})
},uploadThumbnail:function(){if(!this.thumbnailUploadWindow){this.thumbnailUploadWindow=new Ext.Window({title:OpenLayers.i18n("thumbnailUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:this.uploadForm,closeAction:"hide",constrain:true,iconCls:"thumbnailAddIcon"})
}this.thumbnailUploadWindow.show()
},removeThumbnail:function(){var panel=this,url=this.unsetThumbnail+"?id="+this.metadataId+"&version="+this.versionId+"&type="+(this.thumbnail==="thumbnail"?"small":"large");
OpenLayers.Request.GET({url:url,success:function(response){panel.editor.init(panel.metadataId)
},failure:function(response){}})
},selectionChangeEvent:function(dv,selections){var records=selections?dv.getRecords(selections):[],allInternal=this.dataView.getStore().query("desc",/thumbnail|large_thumbnail/).length==2;
if(records[0]){this.thumbnail=records[0].get("desc");
if(this.thumbnail==="thumbnail"||this.thumbnail==="large_thumbnail"){this.delButton.setDisabled(false)
}else{this.delButton.setDisabled(true)
}}else{this.delButton.setDisabled(true);
this.thumbnail=undefined
}this.addButton.setDisabled(allInternal)
},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("thumbnails");
this.tools=[{id:"refresh",handler:function(e,toolEl,panel,tc){panel.reload(panel,panel.metadataId)
}}];
var tpl=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="thumbnail">','<img class="thumb-small" src="{href}" title="{desc}"><br/>','<a rel="lightbox-set" class="md-mn lightBox" href="{href}"></a>',"<span>{desc}</span>","</li>","</tpl>","</ul>");
this.addButton=new Ext.Button({text:OpenLayers.i18n("addThumbnail"),iconCls:"thumbnailAddIcon",handler:this.uploadThumbnail,scope:this});
this.delButton=new Ext.Button({text:OpenLayers.i18n("removeSelected"),iconCls:"thumbnailDelIcon",disabled:true,handler:this.removeThumbnail,scope:this});
this.bbar=new Ext.Toolbar({items:[this.addButton,this.delButton]});
this.store=new GeoNetwork.data.MetadataThumbnailStore(this.getThumbnail,{id:this.metadataId},true);
this.store.on("load",function(){this.dataView.fireEvent("selectionchange",this);
Ext.ux.Lightbox.register("a[rel^=lightbox-set]",true)
},this);
this.idField=new Ext.form.TextField({xtype:"textfield",name:"id",value:this.metadataId,hidden:true});
this.versionField=new Ext.form.TextField({name:"version",value:this.versionId,hidden:true});
var tip=new Ext.slider.Tip({getText:function(thumb){return String.format("<b>{0} px</b>",thumb.value)
}});
this.uploadForm=new Ext.form.FormPanel({fileUpload:true,items:[this.idField,this.versionField,{xtype:"textfield",name:"scalingDir",value:"width",hidden:true},{xtype:"textfield",name:"smallScalingDir",value:"width",hidden:true},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectImage"),fieldLabel:OpenLayers.i18n("image"),name:"fname",allowBlank:false,buttonText:"",buttonCfg:{iconCls:"thumbnailAddIcon"}},{xtype:"radio",checked:true,fieldLabel:"Type",boxLabel:OpenLayers.i18n("large"),name:"type",value:"large"},{xtype:"radio",fieldLabel:"",boxLabel:OpenLayers.i18n("small"),name:"type",value:"small"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("scalingFactor"),name:"scalingFactor",value:1000,minValue:400,maxValue:1800,increment:200},{xtype:"checkbox",checked:true,hideLabel:true,fieldLabel:"",labelSeparator:"",boxLabel:OpenLayers.i18n("createSmall"),name:"createSmall",value:"true"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("smallScalingFactor"),name:"smallScalingFactor",value:180,minValue:100,maxValue:220,increment:20}],buttons:[{text:OpenLayers.i18n("upload"),formBind:true,iconCls:"thumbnailGoIcon",scope:this,handler:function(){if(this.uploadForm.getForm().isValid()){var panel=this;
this.uploadForm.getForm().submit({url:this.setThumbnail,waitMsg:OpenLayers.i18n("uploading"),success:function(fp,o){panel.editor.init(panel.metadataId);
panel.thumbnailUploadWindow.hide()
}})
}}},{text:OpenLayers.i18n("reset"),iconCls:"cancel",scope:this,handler:function(){this.uploadForm.getForm().reset()
}}]});
GeoNetwork.editor.ThumbnailPanel.superclass.initComponent.call(this);
this.dataView=new Ext.DataView({autoHeight:true,autoWidth:true,store:this.store,tpl:tpl,singleSelect:true,selectedClass:"thumbnail-selected",overClass:"thumbnail-over",itemSelector:"li.thumbnail",emptyText:OpenLayers.i18n("noimages"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});
this.add(this.dataView);
if(this.metadataId){this.reload(this,this.metadataId)
}this.editor.on("editorClosed",this.clear,this);
this.editor.on("metadataUpdated",this.reload,this);
this.on("expand",this.reload)
}});
Ext.reg("gn_editor_thumbnailpanel",GeoNetwork.editor.ThumbnailPanel);Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.ValidationPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,serviceUrl:undefined,store:undefined,defaultConfig:{border:false,frame:false,collapsible:true,collapsed:true,iconCls:"validateMetadata"},validate:function(){this.editor.validate(function(){this.updateValidationReport()
}.bind(this))
},updateValidationReport:function(){if(this.collapsed){this.toggleCollapse()
}this.reload(this)
},clear:function(){this.store.removeAll()
},reload:function(e,id){this.metadataId=id||this.metadataId;
if(this.collapsed){return
}this.store.reload({params:{id:this.metadataId}})
},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("validationReport");
this.tools=[{id:"refresh",handler:function(e,toolEl,panel,tc){panel.reload(panel,panel.metadataId)
}}];
GeoNetwork.editor.ValidationPanel.superclass.initComponent.call(this);
this.store=new GeoNetwork.data.ValidationRuleStore(this.serviceUrl,{id:this.metadataId},true);
var xg=Ext.grid;
var expander=new xg.RowExpander({tpl:new Ext.XTemplate('<div title="{details}"><b>{title}</b></div>{msg}')});
var colModel=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:[expander,{id:"group",header:OpenLayers.i18n("group"),width:60,sortable:true,hidden:true,dataIndex:"group"},{header:OpenLayers.i18n("status"),width:10,resizable:false,sortable:true,dataIndex:"statusIcon"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}]});
var grid=new xg.GridPanel({store:this.store,colModel:colModel,loadMask:true,plugins:expander,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("items")+'" : "'+OpenLayers.i18n("item")+'"]})'}),frame:false,height:300,autoWidth:true});
this.add(grid);
this.editor.on("editorClosed",this.clear,this);
this.editor.on("metadataUpdated",this.reload,this);
this.on("expand",this.reload)
}});
Ext.reg("gn_editor_validationpanel",GeoNetwork.editor.ValidationPanel);Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.AdminTools={showImportMetadataWindow:function(metadataType,windowTitle){var metadataPanel=new GeoNetwork.admin.MetadataInsertPanel({metadataType:metadataType});
var newMetadataWindow=new Ext.Window({title:windowTitle||OpenLayers.i18n("importMetadata"),width:450,height:450,layout:"fit",modal:true,items:metadataPanel,closeAction:"destroy",constrain:true,iconCls:"addIcon"});
newMetadataWindow.show()
}};Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.HarvesterPanel=Ext.extend(Ext.Panel,{border:false,frame:false,layout:"border",height:800,catalogue:undefined,harvesterStore:undefined,harvesterTplMarkup:["Information: {site_name}<br/>","Last run: {info_lastrun}<br/>",'<tpl if="info_result_total">',"Total: {info_result_total}<br/>","Added: {info_result_added}<br/>","Removed: {info_result_removed}<br/>","Schema unknwon: {info_result_unknowSchema}<br/>","</tpl>"],harvesterTpl:undefined,xmlTpl:undefined,harvesterGrid:undefined,currentHarvester:undefined,initComponent:function(){GeoNetwork.admin.HarvesterPanel.superclass.initComponent.call(this);
panel=this;
this.createGrid();
this.harvesterTpl=new Ext.XTemplate(this.harvesterTplMarkup);
this.xmlTpl=new GeoNetwork.Templates().getHarvesterTemplate();
this.harvesterGrid.getSelectionModel().on("rowselect",function(sm,rowIdx,r){var detailPanel=Ext.getCmp("harvesterDetailPanel");
this.harvesterTpl.overwrite(detailPanel.body,r.data)
},this);
var infoPanel={id:"harvesterDetailPanel",region:"east",split:true,minWidth:200,width:200,collapsible:true,hideCollapseTool:true,collapseMode:"mini",bodyStyle:{background:"#ffffff",padding:"7px"},html:"Please select a harvester to see additional details."};
this.add(infoPanel);
var editorPanel={id:"harvesterEditorPanel",region:"south",title:"Harvester configuration",split:true,autoScroll:true,minHeigth:400,items:[new Ext.FormPanel({border:false,frame:false,maxHeight:600,id:"harvesterEditorForm",items:[this.getHarvesterTypeField(),this.getSiteFields("geonetwork"),this.getOptionsFields("geonetwork")],buttons:[{text:"Save",listeners:{click:function(){var form=Ext.getCmp("harvesterEditorForm").getForm();
if(form.isValid()){form.updateRecord(this.currentHarvester);
var xml=this.xmlTpl.apply(this.currentHarvester.data);
this.addHarvester(this.catalogue.services.harvestingAdd,xml)
}},scope:panel}}]})]};
this.add(editorPanel)
},harvesterType:[["geonetwork","GeoNetwork"],["geonetwork20","GeoNetwork 2.0"],["webdav","webdav"],["csw","csw"],["ogcwxs","OGC WxS"],["thredds","thredds"],["z3950","z3950"],["oaipmh","oaipmh"],["metadatafragments","metadatafragments"],["arcsde","arcsde"],["filesystem","filesystem"]],switchMode:function(type){this.switchElement("site_servlet",false);
this.switchElement("site_port",false);
this.switchElement("site_host",false);
this.switchElement("site_url",false);
if(type=="geonetwork"||type=="geonetwork20"){this.switchElement("site_servlet",true);
this.switchElement("site_port",true);
this.switchElement("site_host",true)
}else{this.switchElement("site_url",true)
}if(type=="ogcwxs"){}},switchElement:function(el,on){var e=Ext.getCmp(el);
var form=Ext.getCmp("harvesterEditorForm");
var f=form.getForm().findField(el);
if(on){f.container.up("div.x-form-item").show();
e.enable()
}else{f.container.up("div.x-form-item").hide();
e.disable()
}form.doLayout(false,true)
},getHarvesterTypeField:function(){return new Ext.form.ComboBox({id:"type",name:"type",mode:"local",triggerAction:"all",fieldLabel:"Harvester type",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.harvesterType}),valueField:"id",displayField:"name",listeners:{change:function(field,newValue,oldValue){this.switchMode(newValue)
},scope:this}})
},ogcwxsType:[["WMS1.0.0","WMS 1.0.0"],["WMS1.1.1","WMS 1.1.1"],["WFS1.0.0","WFS 1.0.0"],["WFS1.1.0","WFS 1.1.0"],["WCS1.0.0","WCS 1.0.0"],["WPS0.4.0","WPS 0.4.0"],["WPS1.0.0","WPS 1.0.0"]],getSiteFields:function(type){var items=[];
var id=new Ext.form.TextField({id:"id",name:"id",mode:"local",hidden:true});
var name=new Ext.form.TextField({name:"site_name",mode:"local",fieldLabel:"Name"});
items.push(id,name);
var url=new Ext.form.TextField({id:"site_url",name:"site_url",mode:"local",fieldLabel:"URL"});
var ogctype=new Ext.form.ComboBox({id:"site_ogctype",name:"site_ogctype",mode:"local",fieldLabel:"Type of service",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.ogcwxsType}),valueField:"id",displayField:"name"});
items.push(url,ogctype);
var servlet=new Ext.form.TextField({id:"site_servlet",name:"site_servlet",mode:"local",fieldLabel:"Servlet"});
var host=new Ext.form.TextField({id:"site_host",name:"site_host",mode:"local",fieldLabel:"Host"});
var port=new Ext.form.TextField({id:"site_port",name:"site_port",mode:"local",fieldLabel:"Port"});
items.push(host,port,servlet);
var site_account_use=new Ext.form.Checkbox({id:"site_account_use",name:"site_account_use",mode:"local",fieldLabel:"Use account"});
var site_account_username=new Ext.form.TextField({id:"site_account_username",name:"site_account_username",mode:"local",fieldLabel:"Username"});
var site_account_password=new Ext.form.TextField({id:"site_account_password",name:"site_account_password",mode:"local",fieldLabel:"Password"});
items.push(site_account_use,site_account_username,site_account_password);
return{xtype:"fieldset",title:"Harvester main information",collapsible:true,items:items}
},getOptionsFields:function(){var items=[];
var options_createThumbnails=new Ext.form.Checkbox({id:"options_createthumbnails",name:"options_createthumbnails",mode:"local",fieldLabel:"Create thumbnail for WMS layers"});
var options_useLayer=new Ext.form.Checkbox({id:"options_uselayer",name:"options_uselayer",mode:"local",fieldLabel:"Create metadata for layer elements using GetCapabilities information"});
var options_uselayermd=new Ext.form.Checkbox({id:"options_uselayermd",name:"options_uselayermd",mode:"local",fieldLabel:"Create metadata for layer elements using MetadataURL attributes (if existing, if not use GetCapabilities)"});
var options_lang=new Ext.form.TextField({id:"options_lang",name:"options_lang",mode:"local",defaultValue:"eng",fieldLabel:"Language"});
var options_topic=new Ext.form.TextField({id:"options_topic",name:"options_topic",mode:"local",defaultValue:"",fieldLabel:"Topic category"});
items.push(options_createThumbnails,options_useLayer,options_uselayermd,options_lang,options_topic);
var options_oneRunOnly=new Ext.form.Checkbox({id:"options_onerunonly",name:"options_onerunonly",mode:"local",fieldLabel:"One run only"});
var options_every=new Ext.form.TextField({id:"options_every",name:"options_every",mode:"local",defaultValue:"90",fieldLabel:"Every"});
items.push(options_oneRunOnly,options_every);
return{xtype:"fieldset",title:"Harvester options",collapsible:true,items:items}
},getPrivilegesFields:function(){return
},getCategoriesFields:function(){return
},createEditor:function(){var Harvester=Ext.data.Record.create([{name:"id",mapping:"node/@id"},{name:"occupation"}])
},createGrid:function(){var sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true,header:"",listeners:{selectionchange:function(){Ext.getCmp("harvestEditBt").setDisabled(this.getSelections().length<1);
Ext.getCmp("harvestRemoveBt").setDisabled(this.getSelections().length<1);
Ext.getCmp("harvestActivateBt").setDisabled(this.getSelections().length<1);
Ext.getCmp("harvestDesactivateBt").setDisabled(this.getSelections().length<1);
Ext.getCmp("harvestRunBt").setDisabled(this.getSelections().length<1)
}}});
this.harvesterGrid=new Ext.grid.GridPanel({store:this.harvesterStore,split:true,id:"harvesterGrid",region:"center",sm:sm,columns:[sm,{id:"id",header:"id",width:60,sortable:true,dataIndex:"id",hidden:true},{header:"Name",width:125,sortable:true,dataIndex:"site_name"},{header:"Type",width:75,sortable:true,dataIndex:"type"},{header:"Status",width:80,sortable:true,dataIndex:"site_status"},{header:"Running",width:80,sortable:true,dataIndex:"info_running"},{header:"Every",width:80,sortable:true,dataIndex:"options_every"},{header:"Last run",width:160,sortable:true,dataIndex:"info_lastrun"}],stripeRows:true,maxHeight:250,height:250,stateful:true,stateId:"grid",listeners:{rowclick:function(grid,rowIndex,e){var h=this.harvesterGrid.getStore().getAt(rowIndex);
this.currentHarvester=h;
console.log(h);
var form=Ext.getCmp("harvesterEditorForm").getForm();
form.loadRecord(h)
},scope:this},buttons:[{text:"Add",listeners:{click:function(){}}},{text:"Activate",id:"harvestActivateBt",disabled:true,listeners:{click:function(){var sel=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();
var params={id:sel.data.id};
this.doAction(this.catalogue.services.harvestingStart,params,this.refreshHarvester,null,null,"Failed to activate the harvester")
},scope:this}},{text:"Desactivate",id:"harvestDesactivateBt",disabled:true,listeners:{click:function(){var sel=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();
var params={id:sel.data.id};
this.doAction(this.catalogue.services.harvestingStop,params,this.refreshHarvester,null,null,"Failed to desactivate the harvester")
},scope:this}},{id:"harvestEditBt",text:"Edit",disabled:true,listeners:{click:function(){},scope:this}},{text:"Run",id:"harvestRunBt",disabled:true,listeners:{click:function(){var sel=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();
var params={id:sel.data.id};
this.doAction(this.catalogue.services.harvestingRun,params,this.refreshHarvester,null,null,"Failed to start the harvester")
},scope:this}},{id:"harvestRemoveBt",text:"Remove",icon:"../images/default/cross.png",disabled:true,listeners:{click:function(){var sel=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();
Ext.Msg.confirm("Delete ?","Are you sure to delete selected harvester and all its records?",this.removeHarvester,sel.data.id)
},scope:this}},{text:"Refresh",id:"harvestRefreshBt",listeners:{click:function(){this.harvesterGrid.getStore().reload()
},scope:this}}]});
this.add(this.harvesterGrid)
},addHarvester:function(url,xml){var opts={url:url,data:xml};
OpenLayers.Util.applyDefaults(opts,{success:function(response){Ext.Msg.alert("ok",response.responseText)
},failure:function(response){Ext.Msg.alert("Failed",response.responseText)
}});
OpenLayers.Request.POST(opts)
},doAction:function(url,params,onSuccess,onFailure,msgSuccess,msgFailure){OpenLayers.Request.GET({url:url,params:params,success:function(result){if(msgSuccess){Ext.Msg.alert(msgSuccess,result.responseText)
}if(onSuccess){onSuccess(result)
}},failure:function(response){if(msgFailure){Ext.Msg.alert(msgFailure,response.responseText)
}if(onSuccess){onSuccess(response)
}}})
},removeHarvester:function(btn){if(btn=="yes"){var params={id:this};
this.doAction(this.catalogue.services.harvestingRemove,params,this.refreshHarvester,null,null,"Failed to delete the harvester")
}},refreshHarvester:function(){Ext.getCmp("harvestRefreshBt").fireEvent("click")
}});
Ext.reg("gn_admin_harvesterpanel",GeoNetwork.admin.HarvesterPanel);Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.MetadataInsertPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,ref:undefined,setRef:function(ref){this.ref=ref
},getForm:function(){var groupStore=GeoNetwork.data.GroupStore(catalogue.services.getGroups);
groupStore.load();
this.uploadForm=new Ext.form.FormPanel({region:"center",split:true,errorReader:new Ext.data.XmlReader({record:"response"},["id"]),items:[{xtype:"textfield",hidden:true,name:"insert_mode",value:"0"},{xtype:"textfield",hidden:true,name:"template",value:"s"},{xtype:"textarea",name:"data",fieldLabel:OpenLayers.i18n("xmlData"),allowBlank:false,width:300,height:200},new Ext.form.ComboBox({name:"group",hiddenName:"group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:groupStore,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+OpenLayers.Lang.getCode()+"]}</div></tpl>"})],buttons:[{text:OpenLayers.i18n("add"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:catalogue.services.mdXMLInsert,scope:this,success:function(fp,action){if(this.ownerCt){this.ownerCt.close()
}},failure:function(response){Ext.Msg.alert(OpenLayers.i18n("failure"),response.responseText)
}})
}}}]});
return this.uploadForm
},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.items=[this.getForm()];
GeoNetwork.admin.MetadataInsertPanel.superclass.initComponent.call(this)
}});
Ext.reg("gn_admin_metadatainsertpanel",GeoNetwork.admin.MetadataInsertPanel);Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.SubTemplateManagerPanel=Ext.extend(Ext.Panel,{border:false,frame:false,record:undefined,layout:"border",catalogue:undefined,toolbar:undefined,searchPanel:undefined,searchForm:undefined,searchField:undefined,newMetadataWindow:undefined,searchResultGrid:undefined,subTemplateEditor:undefined,subTemplateToolbar:undefined,subTemplateType:undefined,subTemplateTypeStore:undefined,defaultConfig:{defaultViewMode:"simple",height:800,autoWidth:true,layout:"border",iconCls:"subtemplateIcon"},getSubTemplateTypeField:function(){return{xtype:"combo",name:"E__root",mode:"local",title:OpenLayers.i18n("selDirectoryTT"),triggerAction:"all",store:this.subTemplateTypeStore,valueField:"type",tpl:'<tpl for="."><div class="x-combo-list-item" title="{description}">{label} ({type})</div></tpl>',displayField:"label"}
},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.subTemplateTypeStore=new GeoNetwork.data.SubTemplateTypeStore(this.catalogue.services.subTemplateType);
this.catalogue.metadataStore=GeoNetwork.data.MetadataResultsStore();
this.catalogue.editMode=2;
this.catalogue.metadataEditFn=function(metadataId,create,group,child){this.editorPanel.init(metadataId,create,group,child,"s")
}.bind(this);
GeoNetwork.admin.SubTemplateManagerPanel.superclass.initComponent.call(this);
this.initSearch();
this.initEditor();
var searchView={region:"west",split:true,collapsible:true,collapsed:false,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:240,width:280,items:[this.searchForm,this.searchResultGrid]};
var editorView={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.editorPanel]};
this.add(searchView);
this.add(editorView);
this.searchField.focus(true)
},search:function(){this.editorPanel.cancel();
this.catalogue.search("searchForm",null,null)
},initSearch:function(){var panel=this;
this.searchField=new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(scope){scope.record=undefined;
scope.disableToolbar(true);
scope.search()
},scope:panel});
this.searchForm=new Ext.FormPanel({id:"searchForm",border:false,defaults:{width:240,hideLabel:true},items:[this.getSubTemplateTypeField(),{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"},this.searchField]});
var events=["afterDelete"];
Ext.each(events,function(e){this.catalogue.on(e,function(){this.search()
},this)
},this);
this.searchResultGrid=new Ext.grid.GridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.catalogue.metadataStore,columns:[{id:"title",header:OpenLayers.i18n("title"),dataIndex:"title"},{id:"uuid",header:"Uuid",dataIndex:"uuid",hidden:true}],autoExpandColumn:"title",listeners:{rowclick:function(grid,rowIndex,e){this.record=grid.getStore().getAt(rowIndex).data;
this.editorPanel.init(this.record.id,false);
this.disableToolbar(false)
},scope:panel},bbar:{items:[{xtype:"button",text:OpenLayers.i18n("add"),tooltip:OpenLayers.i18n("addTplElTT"),iconCls:"addIcon",handler:function(){var metadataType="s";
GeoNetwork.admin.AdminTools.showImportMetadataWindow(metadataType,OpenLayers.i18n("subTemplateImport"))
},scope:this},{text:OpenLayers.i18n("duplicate"),tooltip:OpenLayers.i18n("copyTplElTT"),iconCls:"md-mn-copy",disabled:true,handler:function(){var id=this.record.id;
GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,id,OpenLayers.i18n("duplicate"),false)
},scope:this},{text:OpenLayers.i18n("delete"),tooltip:OpenLayers.i18n("delTplElTT"),iconCls:"md-mn-del",disabled:true,handler:function(){var id=this.record.uuid;
this.catalogue.metadataDelete(id)
},scope:this},{text:OpenLayers.i18n("privileges"),tooltip:OpenLayers.i18n("privTplElTT"),iconCls:"privIcon",disabled:true,handler:function(){var id=this.record.id;
this.catalogue.metadataAdmin(id)
},scope:this}]}})
},disableToolbar:function(disabled){var bbar=this.searchResultGrid.getBottomToolbar();
Ext.each(bbar.items,function(item,idx){if(idx!==0){bbar.get(idx).setDisabled(disabled)
}},bbar)
},initEditor:function(){var disableConfig={collapsed:true,hidden:true};
this.editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:this.defaultViewMode,tbarConfig:{hideTypeMenu:true},utilityPanelConfig:{thumbnailPanel:disableConfig,relationPanel:disableConfig,validationPanel:{collapsed:true},suggestionPanel:disableConfig,helpPanel:{collapsed:false}},catalogue:this.catalogue,utilityPanelCollapsed:true})
},refresh:function(){this.subTemplateTypeStore.load()
}});
Ext.reg("gn_admin_subtemplatemanagerpanel",GeoNetwork.admin.SubTemplateManagerPanel);Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.ThesaurusManagerPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoWidth:true,layout:"border",maxResults:50,defaultThesaurusType:"theme"},border:false,frame:false,selectedThesaurus:undefined,layout:"border",catalogue:undefined,toolbar:undefined,thesaurusGrid:undefined,thesaurusStore:undefined,keywordGrid:undefined,createEmptyThesaurusWindow:undefined,createThesaurusFromLocalFileWindow:undefined,createThesaurusFromRemoteFileWindow:undefined,createEmptyThesaurusForm:undefined,createThesaurusFromLocalFileForm:undefined,createThesaurusFromRemoteFileForm:undefined,initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus});
var Keyword=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"thesaurus"},{name:"definition"},{name:"uri"},{name:"east"},{name:"west"},{name:"south"},{name:"north"}]);
this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox",maxResults:this.maxResults},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},Keyword),fields:["id","value","definition","thesaurus","uri","east","west","south","north"],sortInfo:{field:"value"}});
GeoNetwork.admin.ThesaurusManagerPanel.superclass.initComponent.call(this);
this.initThesaurusView();
this.initKeywordView();
var thesaurusView={region:"west",split:true,autoScroll:true,minWidth:280,width:400,items:[this.thesaurusGrid]};
var keywordView={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.keywordGrid]};
this.add(thesaurusView);
this.add(keywordView)
},initThesaurusView:function(){var panel=this;
var ynValues=[["y"],["n"]];
var thColumnModel=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"filename",header:OpenLayers.i18n("ThesaurusName"),dataIndex:"filename",editable:false},{id:"theme",header:OpenLayers.i18n("Theme"),dataIndex:"theme",editable:false},{id:"type",header:OpenLayers.i18n("Type"),dataIndex:"type",editable:false},{id:"activated",header:OpenLayers.i18n("Activated"),dataIndex:"activated",width:50,editor:new Ext.form.ComboBox({mode:"local",editable:false,typeAhead:true,triggerAction:"all",lazyRender:true,allowBlank:false,listClass:"x-combo-list-small",store:new Ext.data.ArrayStore({id:0,fields:["id"],data:ynValues}),valueField:"id",displayField:"id"})}]});
this.thesaurusGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,border:false,store:this.thesaurusStore,cm:thColumnModel,autoExpandColumn:"filename",clicksToEdit:1,listeners:{scope:this,afteredit:function(e){Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusActivate+"?ref="+e.record.data.id+"&activated="+e.record.data.activated,failure:function(){Ext.Msg.alert("Fail")
}})
},dblclick:function(e){this.keywordStore.setBaseParam("pKeyword","*");
this.keywordStore.reload()
}},sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,selectionchange:function(smObj){this.updateKeywordGridAndToolbar();
this.updateThesaurusToolbar();
this.updateKeywordToolbar()
}}}),tbar:{disabled:false,items:[{text:OpenLayers.i18n("add"),iconCls:"addIcon",menu:{xtype:"menu",plain:true,items:[{text:OpenLayers.i18n("emptyThesaurus"),scope:this,handler:function(){if(!this.createEmptyThesaurusWindow){this.createEmptyThesaurusWindow=this.getCreateEmptyThesaurusWindow()
}this.createEmptyThesaurusWindow.show(this)
}},{text:OpenLayers.i18n("thesaurusFromFile"),scope:this,handler:function(){if(!this.createThesaurusFromLocalFileWindow){this.createThesaurusFromLocalFileWindow=this.getCreateThesaurusFromLocalFileWindow()
}this.createThesaurusFromLocalFileWindow.show(this)
}},{text:OpenLayers.i18n("thesaurusFromURL"),scope:this,handler:function(){if(!this.createThesaurusFromRemoteFileWindow){this.createThesaurusFromRemoteFileWindow=this.getCreateThesaurusFromRemoteFileWindow()
}this.createThesaurusFromRemoteFileWindow.show(this)
}}]}},{id:"delete_thesaurus_button",disabled:true,text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){OpenLayers.Request.GET({scope:this,url:this.catalogue.services.thesaurusDelete+"?ref="+this.keywordStore.baseParams.pThesauri,success:function(response){this.thesaurusStore.removeAll();
this.thesaurusStore.reload()
},failure:function(response){}})
},scope:this},{id:"download_thesaurus_button",disabled:true,text:OpenLayers.i18n("download"),iconCls:"xmlIcon",handler:function(){location.replace(this.catalogue.services.thesaurusDownload+"?ref="+this.keywordStore.baseParams.pThesauri)
},scope:this}]}})
},initKeywordView:function(){var kwColumnModel=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"id",header:OpenLayers.i18n("id"),dataIndex:"uri",editor:new Ext.form.TextField({allowBlank:false})},{id:"hidden_id",header:OpenLayers.i18n("uri"),dataIndex:"id",hidden:true,editor:new Ext.form.TextField({allowBlank:false})},{id:"value",header:OpenLayers.i18n("label"),dataIndex:"value",editor:new Ext.form.TextField({allowBlank:false})},{id:"definition",header:OpenLayers.i18n("definition"),dataIndex:"definition",editor:new Ext.form.TextField({allowBlank:false})},{id:"west",header:OpenLayers.i18n("xmin"),dataIndex:"west",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"east",header:OpenLayers.i18n("xmax"),dataIndex:"east",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"south",header:OpenLayers.i18n("ymin"),dataIndex:"south",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"north",header:OpenLayers.i18n("ymax"),dataIndex:"north",hidden:true,editor:new Ext.form.TextField({allowBlank:true})}]});
this.keywordGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.keywordStore,cm:kwColumnModel,autoExpandColumn:"value",sm:new Ext.grid.CellSelectionModel({listeners:{scope:this,selectionchange:function(smObj){this.updateKeywordToolbar()
}}}),listeners:{scope:this,afteredit:function(e){var ref=this.keywordStore.baseParams.pThesauri;
var refType=ref.split(".")[1];
var tokens=e.record.data.uri.split("#");
var namespace=tokens[0];
var newId=tokens[1];
var oldId=newId;
var lang=this.catalogue.lang;
var prefLab=e.record.data.value;
var definition=e.record.data.definition;
var requestPayLoad;
if(e.field==="uri"){oldId=e.originalValue.split("#")[1]
}if(refType==="place"){var south=e.record.data.south;
var north=e.record.data.north;
var west=e.record.data.west;
var east=e.record.data.east;
requestPayLoad="<request><oldid>"+oldId+"</oldid><newid>"+newId+"</newid><lang>"+lang+"</lang><ref>"+ref+"</ref><definition>"+definition+"</definition><namespace>"+namespace+"#</namespace><north>"+north+"</north><south>"+south+"</south><east>"+east+"</east><prefLab>"+prefLab+"</prefLab><west>"+west+"</west><refType>"+refType+"</refType></request>";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail")
},xmlData:requestPayLoad})
}else{requestPayLoad="<request><newid>"+newId+"</newid><refType>"+refType+"</refType><definition>"+definition+"</definition><namespace>"+namespace+"#</namespace><ref>"+ref+"</ref><oldid>"+oldId+"</oldid><lang>"+lang+"</lang><prefLab>"+prefLab+"</prefLab></request>";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail")
},xmlData:requestPayLoad})
}e.record.commit()
}},tbar:{disabled:true,items:[{id:"add_keyword_button",text:OpenLayers.i18n("add"),iconCls:"addIcon",handler:function(){var RecType=this.keywordGrid.store.recordType;
var newUri="#"+new Date().getTime();
var ref=this.keywordStore.baseParams.pThesauri;
var refType=ref.split(".")[1];
var newId=newUri.split("#")[1];
var lang=this.catalogue.lang;
var prefLab=OpenLayers.i18n("newLabel");
var definition=OpenLayers.i18n("newDefinition");
var requestPayLoad;
if(refType==="place"){var south=-90;
var north=90;
var west=-180;
var east=180;
requestPayLoad="<request><oldid/><newid>"+newId+"</newid><lang>"+lang+"</lang><ref>"+ref+"</ref><definition>"+definition+"</definition><namespace>#</namespace><north>"+north+"</north><south>"+south+"</south><east>"+east+"</east><prefLab>"+prefLab+"</prefLab><west>"+west+"</west><refType>"+refType+"</refType></request>";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail")
},xmlData:requestPayLoad})
}else{requestPayLoad="<request><newid>"+newId+"</newid><refType>"+refType+"</refType><definition>"+definition+"</definition><namespace>#</namespace><ref>"+ref+"</ref><oldid/><lang>"+lang+"</lang><prefLab>"+prefLab+"</prefLab></request>";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail")
},xmlData:requestPayLoad})
}var newRec=new RecType({uri:newUri,value:prefLab,definition:definition,west:-180,east:180,south:-90,north:90});
this.keywordGrid.stopEditing();
this.keywordGrid.store.insert(0,newRec);
this.keywordGrid.startEditing(0,0)
},scope:this},{id:"delete_keyword_button",text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var selectedCells=this.keywordGrid.getSelectionModel().getSelectedCell();
var rec=this.keywordGrid.store.getAt(selectedCells[0]);
var thesaurus=this.keywordStore.baseParams.pThesauri;
var tokens=rec.data.uri.split("#");
var namespace=tokens[0];
var id=tokens[1];
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptDelete+"?pThesaurus="+thesaurus+"&namespace="+namespace+"%23&id="+id,failure:function(){Ext.Msg.alert("Fail")
}});
this.keywordGrid.store.removeAt(selectedCells[0])
},scope:this},"->",this.getKeyword(),OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()]}})
},updateThesaurusToolbar:function(){var record=this.thesaurusGrid.getSelectionModel().getSelected();
Ext.getCmp("delete_thesaurus_button").setDisabled(!record);
Ext.getCmp("download_thesaurus_button").setDisabled(!record)
},updateKeywordToolbar:function(){var record=this.thesaurusGrid.getSelectionModel().getSelected();
if(record){var thesaurusType=record.data.type;
var isLocal=thesaurusType==="local";
if(isLocal){var selectedCells=this.keywordGrid.getSelectionModel().getSelectedCell();
Ext.getCmp("delete_keyword_button").setDisabled(!selectedCells)
}}},updateKeywordGridAndToolbar:function(){var record=this.thesaurusGrid.getSelectionModel().getSelected();
if(record){this.keywordGrid.getTopToolbar().enable();
var thesaurusTheme=record.data.theme;
var thesaurusType=record.data.type;
var isLocal=thesaurusType==="local";
var thesaurusId=record.data.id;
this.keywordStore.removeAll();
this.keywordStore.baseParams.pThesauri=thesaurusId;
var hidden=(thesaurusTheme!=="place");
this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("east"),hidden);
this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("west"),hidden);
this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("south"),hidden);
this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("north"),hidden);
for(var i=0;
i<this.keywordGrid.getColumnModel().getColumnCount();
i++){this.keywordGrid.getColumnModel().setEditable(i,isLocal)
}Ext.getCmp("delete_keyword_button").setDisabled(!isLocal);
Ext.getCmp("add_keyword_button").setDisabled(!isLocal)
}else{this.keywordGrid.getTopToolbar().disable()
}},getCreateEmptyThesaurusWindow:function(){var win=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateEmptyThesaurusForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createEmptyThesaurusForm.getForm().isValid()){this.createEmptyThesaurusForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";
this.createEmptyThesaurusForm.bodyCfg.enctype="application/x-www-form-urlencoded";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusAdd,success:function(){this.thesaurusStore.removeAll();
this.thesaurusStore.reload()
},failure:function(){Ext.Msg.alert("Fail")
},xmlData:"<request><fname>"+Ext.getCmp("empty_thesaurusName").getValue()+"</fname><dname>"+Ext.getCmp("empty_themeCmb").getValue()+"</dname><type>"+Ext.getCmp("empty_thesaurusType").getValue()+"</type></request>"});
win.hide()
}}}]});
return win
},getCreateThesaurusFromLocalFileWindow:function(){var win=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromLocalFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){console.log(this.createThesaurusFromLocalFileForm);
if(this.createThesaurusFromLocalFileForm.getForm().isValid()){this.createThesaurusFromLocalFileForm.getForm().getEl().dom.enctype="multipart/form-data";
this.createThesaurusFromLocalFileForm.bodyCfg.enctype="multipart/form-data";
this.createThesaurusFromLocalFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(fp,action){this.thesaurusStore.removeAll();
this.thesaurusStore.reload()
},failure:function(response){Ext.Msg.alert(OpenLayers.i18n("failure"),response.responseText)
}});
win.hide()
}}}]});
return win
},getCreateThesaurusFromRemoteFileWindow:function(){var win=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromRemoteFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createThesaurusFromRemoteFileForm.getForm().isValid()){this.createThesaurusFromRemoteFileForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";
this.createThesaurusFromRemoteFileForm.bodyCfg.enctype="application/x-www-form-urlencoded";
this.createThesaurusFromRemoteFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(response){this.thesaurusStore.removeAll();
this.thesaurusStore.reload()
},failure:function(response){Ext.Msg.alert(OpenLayers.i18n("failure"),response.responseText)
}});
win.hide()
}}}]});
return win
},getCreateEmptyThesaurusForm:function(){this.createEmptyThesaurusForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,items:[{xtype:"textfield",fieldLabel:OpenLayers.i18n("ThesaurusName"),id:"empty_thesaurusName",name:"fname",anchor:"-15"},this.createTypeCombo("empty_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"empty_thesaurusType",name:"type",value:"local",hidden:true,anchor:"-15"}]});
return this.createEmptyThesaurusForm
},getCreateThesaurusFromLocalFileForm:function(){this.createThesaurusFromLocalFileForm=new Ext.form.FormPanel({fileUpload:true,region:"center",autoHeight:true,baseCls:"x-plain",errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),labelWidth:170,split:true,items:[{xtype:"fileuploadfield",allowBlank:true,fieldLabel:OpenLayers.i18n("thesaurusFilePath"),id:"local_fname",name:"fname",buttonCfg:{text:OpenLayers.i18n("selectFile")}},this.createTypeCombo("local_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"local_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"},{xtype:"textfield",hidden:true,name:"mode",value:"file"}]});
return this.createThesaurusFromLocalFileForm
},getCreateThesaurusFromRemoteFileForm:function(){this.createThesaurusFromRemoteFileForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),listeners:{scope:this,afterrender:function(cmp){Ext.getCmp("remote_thesaurusURL").setVisible(true);
Ext.getCmp("remote_thesaurusCmb").setVisible(false);
Ext.getCmp("remote_themeCmb").setVisible(true)
}},items:[{xtype:"radiogroup",id:"creationModeRadioGroup",columns:1,submitValue:false,fieldLabel:OpenLayers.i18n("creationMode"),items:[{boxLabel:OpenLayers.i18n("createThesaurusFromURL"),name:"rb-auto",inputValue:1,checked:true},{boxLabel:OpenLayers.i18n("createThesaurusFromRepository"),name:"rb-auto",inputValue:2}],listeners:{scope:this,change:function(rg,radio){Ext.getCmp("remote_thesaurusURL").setVisible(radio.inputValue===1);
Ext.getCmp("remote_thesaurusCmb").setVisible(radio.inputValue===2);
Ext.getCmp("remote_themeCmb").setVisible(radio.inputValue!==2)
}}},{xtype:"textfield",fieldLabel:OpenLayers.i18n("externalThesaurusURL"),id:"remote_thesaurusURL",name:"url",anchor:"-15"},{fieldLabel:OpenLayers.i18n("thesaurusFromRepository"),id:"remote_thesaurusCmb",anchor:"-15",xtype:"combo",mode:"local",triggerAction:"all",forceSelection:true,editable:false,displayField:"title",valueField:"link",submitValue:false,store:new GeoNetwork.data.ThesaurusFeedStore(),listeners:{scope:this,select:function(cmb,record,index){Ext.getCmp("remote_thesaurusURL").setValue(record.data.link);
Ext.getCmp("remote_themeCmb").setValue(record.data.category)
}}},this.createTypeCombo("remote_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"remote_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"}]});
return this.createThesaurusFromRemoteFileForm
},createTypeCombo:function(id){return new Ext.form.ComboBox({fieldLabel:OpenLayers.i18n("Theme"),id:id,name:"themeCmb",anchor:"-15",mode:"local",value:this.defaultThesaurusType,triggerAction:"all",forceSelection:true,editable:false,displayField:"name",valueField:"value",hiddenName:"dir",store:new Ext.data.JsonStore({fields:["name","value"],data:[{name:"Discipline",value:"discipline"},{name:"Place",value:"place"},{name:"Stratum",value:"stratum"},{name:"Temporal",value:"temporal"},{name:"Theme",value:"theme"}]})})
},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"})
},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:this.maxResults,width:40,listeners:{scope:this,change:function(field,newValue,oldValue){this.keywordStore.baseParams.maxResults=newValue
}}}
}});
Ext.reg("gn_admin_thesaurusmanagerpanel",GeoNetwork.admin.ThesaurusManagerPanel);Ext.namespace("GeoNetwork");
GeoNetwork.OGCServiceQuickRegister=Ext.extend(Ext.menu.Menu,{catalogue:undefined,harvesterStore:undefined,textInfo:undefined,textExample:"eg. http://services.sandre.eaufrance.fr/geo/ouvrage?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities",textValidButton:"Check & Add",urlFieldWidth:250,urlField:undefined,initComponent:function(){this.textInfo=OpenLayers.i18n("enterGetCapURL");
var cmp=[];
cmp.push({text:this.textInfo,canActivate:false});
this.urlField={xtype:"textfield",width:this.urlFieldWidth,margins:"0 0 0 30",id:"OGCServiceQuickRegisterUrl",value:"",iconCls:"no-icon"};
cmp.push(this.urlField);
cmp.push({text:this.textExample,canActivate:false});
cmp.push({xtype:"buttongroup",autoWidth:true,border:false,frame:false,columns:2,iconCls:"no-icon",defaults:{xtype:"button",iconAlign:"right"},items:[{text:this.textValidButton,iconCls:"md-mn md-mn-badd",handler:this.getCapabilities}]});
Ext.apply(this,{defaultType:"menuitem",items:cmp});
GeoNetwork.OGCServiceQuickRegister.superclass.initComponent.call(this)
},getCapabilities:function(){var url=Ext.getCmp("OGCServiceQuickRegisterUrl").getValue();
var menu=this.ownerCt.ownerCt;
OpenLayers.Request.GET({url:url,success:function(response){if(response.responseText.indexOf("Some unexpected")!==-1){Ext.Msg.alert("Failed to check service url.",response.responseText);
return
}var xml=response.responseXML;
if(!xml){Ext.Msg.alert("GetCapabilities failed","Null response returned - check proxy or service configuration.");
return
}var format=new OpenLayers.Format.WMSCapabilities();
var obj=format.read(xml);
menu.addHarvester(obj.service.title,url,obj.version)
},failure:function(response){Ext.Msg.alert("Failed to check service url.",response.responseText)
}})
},addHarvester:function(title,url,version){var data=new Ext.data.Record({id:"",type:"ogcwxs",site_name:title,site_url:url.replace(/&/g,"&amp;"),site_ogctype:"WMS"+version,site_icon:"default.gif",site_account_use:"false",options_every:"90",options_topic:"",options_onerunonly:"true",options_lang:"en",options_createthumbnails:"true",options_uselayer:"true",options_uselayermd:"false"});
var xmlTpl=new GeoNetwork.Templates().getHarvesterTemplate();
var xml=xmlTpl.apply(data.data);
this.saveHarvester(xml)
},saveHarvester:function(xml){var menu=this;
var opts={url:this.catalogue.services.harvestingAdd,data:xml};
OpenLayers.Util.applyDefaults(opts,{success:function(response){var xml=response.responseXML;
var id=xml.firstChild.getAttribute("id");
menu.runHarvester(this.catalogue.services.harvestingRun,id)
},failure:function(response){Ext.Msg.alert("Failed",response.responseText)
}});
OpenLayers.Request.POST(opts)
},runHarvester:function(url,id){var menu=this;
OpenLayers.Request.GET({url:url+"?id="+id,success:function(response){if(response.responseText.indexOf("nexpected")!==-1){Ext.Msg.alert("Activation or start failed.",response.responseText);
return
}Ext.Msg.alert("Successfull registration","Wait a few minutes before having all layers and services registered in the catalogue.");
if(menu.harvesterStore){menu.harvesterStore.reload()
}},failure:function(response){Ext.Msg.alert("Registration failed",response.responseText)
}})
}});
Ext.reg("gn_ogcservicequickregister",GeoNetwork.OGCServiceQuickRegister);Ext.namespace("GeoNetwork.map");
GeoNetwork.map.ExtentMap=function(){var maps=[];
var vectorLayers=[];
var vectorLayerStyle=OpenLayers.Feature.Vector.style["default"];
var targetPolygon=null;
var watchedBbox=null;
var mode=null;
var edit=null;
var eltRef=null;
var digits=5;
var MultiPolygonReference=OpenLayers.Class(OpenLayers.Geometry,{id:null,initialize:function(id){this.id=id
},CLASS_NAME:"GeoNetwork.map.ExtentMap.MultiPolygonReference"});
var mainProjCode=GeoNetwork.map.PROJECTION||"EPSG:4326";
var wgsProj=new OpenLayers.Projection("EPSG:4326");
var mainProj=null;
var units="m";
var alternateProj=null;
function convertToGml(feature,proj){var mainProj=new OpenLayers.Projection(proj);
var writer=(mainProj===wgsProj?new OpenLayers.Format.GML.v3():new OpenLayers.Format.GML.v3({externalProjection:wgsProj,internalProjection:mainProj}));
var child=writer.writeNode("feature:_geometry",feature.geometry);
return OpenLayers.Format.XML.prototype.write.call(writer,child.firstChild)
}function createMap(){var i,options={units:units,projection:mainProjCode,theme:null},map=new OpenLayers.Map(options);
if(!edit){var navigationControl=map.getControlsByClass("OpenLayers.Control.Navigation")[0];
navigationControl.disableZoomWheel();
map.removeControl(map.getControlsByClass("OpenLayers.Control.PanZoom")[0])
}map.addControl(new OpenLayers.Control.MousePosition());
for(i=0;
i<GeoNetwork.map.BACKGROUND_LAYERS.length;
i++){map.addLayer(GeoNetwork.map.BACKGROUND_LAYERS[i].clone())
}var vectorLayer=new OpenLayers.Layer.Vector("VectorLayer",{});
map.addLayer(vectorLayer);
vectorLayer.events.on({sketchstarted:function(){this.destroyFeatures()
},scope:vectorLayer});
maps[eltRef]=map;
vectorLayers[eltRef]=vectorLayer;
return map
}function watchBbox(vectorLayer,watchedBbox,eltRef,map){var wsen=watchedBbox.split(","),i;
for(i=0;
i<wsen.length;
++i){Ext.get(wsen[i]).on("change",function(){updateBbox(map,watchedBbox,eltRef,false)
});
Ext.get("_"+wsen[i]).on("change",function(){updateBbox(map,watchedBbox,eltRef,true)
})
}}function updateBbox(map,targetBbox,eltRef,mainProj){var vectorLayer=map.getLayersByName("VectorLayer")[0];
var bounds,values;
var wsen=targetBbox.split(",");
if(mainProj){values=[];
values[0]=Ext.get("_"+wsen[0]).getValue();
values[1]=Ext.get("_"+wsen[1]).getValue();
values[2]=Ext.get("_"+wsen[2]).getValue();
values[3]=Ext.get("_"+wsen[3]).getValue();
bounds=OpenLayers.Bounds.fromArray(values);
if(mainProj!==wgsProj){bounds=bounds.clone().transform(mainProj,wgsProj)
}}else{values=[];
values[0]=Ext.get(wsen[0]).getValue();
values[1]=Ext.get(wsen[1]).getValue();
values[2]=Ext.get(wsen[2]).getValue();
values[3]=Ext.get(wsen[3]).getValue();
bounds=OpenLayers.Bounds.fromArray(values);
var toProj=null;
var radio=document.getElementsByName("proj_"+eltRef);
for(i=0;
i<radio.length;
i++){if(radio[i].checked===true){toProj=radio[i].value
}}if(toProj!==mainProjCode){bounds.transform(new OpenLayers.Projection(toProj),new OpenLayers.Projection(mainProjCode))
}else{var b=bounds.clone();
b.transform(mainProj,alternateProj);
values[0]=b.left;
values[1]=b.bottom;
values[2]=b.right;
values[3]=b.top
}Ext.get("_"+wsen[0]).dom.value=bounds.left;
Ext.get("_"+wsen[1]).dom.value=bounds.bottom;
Ext.get("_"+wsen[2]).dom.value=bounds.right;
Ext.get("_"+wsen[3]).dom.value=bounds.top
}Ext.get(wsen[0]).dom.onkeyup();
Ext.get(wsen[1]).dom.onkeyup();
Ext.get(wsen[2]).dom.onkeyup();
Ext.get(wsen[3]).dom.onkeyup();
var feature=new OpenLayers.Feature.Vector(bounds.toGeometry());
vectorLayer.destroyFeatures();
vectorLayer.addFeatures(feature);
zoomToFeatures(maps[eltRef],vectorLayers[eltRef]);
watchRadios(targetBbox,eltRef)
}function watchRadios(watchedBbox,eltRef){function updateInputTextFields(watchedBbox,toProj,digits){var wsen=watchedBbox.split(",");
var w=Ext.get("_"+wsen[0]).getValue();
var s=Ext.get("_"+wsen[1]).getValue();
var e=Ext.get("_"+wsen[2]).getValue();
var n=Ext.get("_"+wsen[3]).getValue();
var l=w!==""?w:"0";
var b=s!==""?s:"0";
var r=e!==""?e:"0";
var t=n!==""?n:"0";
var bounds=OpenLayers.Bounds.fromString(l+","+b+","+r+","+t);
if(!toProj.equals(wgsProj)){bounds.transform(wgsProj,toProj)
}if(w!==""){w=bounds.left.toFixed(digits)+""
}Ext.get(wsen[0]).dom.value=w;
if(s!==""){s=bounds.bottom.toFixed(digits)+""
}Ext.get(wsen[1]).dom.value=s;
if(e!==""){e=bounds.right.toFixed(digits)+""
}Ext.get(wsen[2]).dom.value=e;
if(n!==""){n=bounds.top.toFixed(digits)+""
}Ext.get(wsen[3]).dom.value=n
}var inputs=Ext.DomQuery.select("input.proj"),idx;
for(idx=0;
idx<inputs.length;
++idx){var input=inputs[idx];
if(input.id.indexOf(eltRef)!==-1){if(input.checked){updateInputTextFields(watchedBbox,new OpenLayers.Projection(input.value),digits)
}var e=Ext.get(input.id);
e.on("click",function(){updateInputTextFields(watchedBbox,new OpenLayers.Projection(this.value),digits)
},e.dom)
}}}function writeFeature(options){var format="WKT";
var from,to;
if(options!==null){format=options.format||"WKT";
from=options.from;
to=options.to
}var writer=new OpenLayers.Format[format]();
if(from!==null&&to!==null){writer.internalProjection=from;
writer.externalProjection=to
}if(!this.vectorLayer.features.length){return null
}var feature=this.vectorLayer.features[this.vectorLayer.features.length-1];
return writer.write(feature)
}function readFeature(string,options,vectorLayer,map){if(string===""){return false
}var format="WKT";
var from,to;
if(options!==null){format=options.format||"WKT";
from=options.from;
to=options.to
}var reader=new OpenLayers.Format[format]();
if(from!==null&&to!==null){reader.externalProjection=from;
reader.internalProjection=to
}string=string.replace(/\n/g,"");
var feature=reader.read(string);
if(!feature){return false
}if(feature.length){feature=feature[0]
}vectorLayer.addFeatures(feature);
if(options.zoomToFeatures){zoomToFeatures(map,vectorLayer)
}return true
}function updateBboxForRegion(map,targetBbox,eltRef){var vectorLayer=map.getLayersByName("VectorLayer")[0];
var bounds;
var wsen=targetBbox.split(",");
var values=[];
values[0]=Ext.get("_"+wsen[0]).getValue();
values[1]=Ext.get("_"+wsen[1]).getValue();
values[2]=Ext.get("_"+wsen[2]).getValue();
values[3]=Ext.get("_"+wsen[3]).getValue();
bounds=OpenLayers.Bounds.fromArray(values);
bounds.transform(wgsProj,mainProj);
Ext.get(wsen[0]).dom.onkeyup();
Ext.get(wsen[1]).dom.onkeyup();
Ext.get(wsen[2]).dom.onkeyup();
Ext.get(wsen[3]).dom.onkeyup();
var feature=new OpenLayers.Feature.Vector(bounds.toGeometry());
vectorLayer.destroyFeatures();
vectorLayer.addFeatures(feature);
zoomToFeatures(map,vectorLayer);
watchRadios(targetBbox,eltRef)
}function createRegionMenu(cb){var store=GeoNetwork.data.RegionStore(catalogue.services.getRegions);
var combo=new Ext.form.ComboBox({store:store,tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label[\''+OpenLayers.Lang.getCode()+"']]}</div></tpl>",typeAhead:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectRegion"),selectOnFocus:true,width:135,listeners:{focus:{fn:function(el){el.getStore().load()
}},select:{fn:cb}},iconCls:"no-icon"});
return combo
}function zoomToFeatures(map,vectorLayer){var extent=vectorLayer.getDataExtent();
if(extent&&!isNaN(extent.left)){var width=extent.getWidth()/2;
var height=extent.getHeight()/2;
extent.left-=width;
extent.right+=width;
extent.bottom-=height;
extent.top+=height;
map.zoomToExtent(extent)
}else{map.zoomToMaxExtent()
}}return{init:function(){},initMapDiv:function(){var viewers,idFunc,idx,descRef,i;
mainProj=new OpenLayers.Projection(mainProjCode);
alternateProj=mainProj;
viewers=Ext.DomQuery.select(".extentViewer");
idFunc=Ext.id;
for(idx=0;
idx<viewers.length;
++idx){var viewer=viewers[idx];
targetPolygon=viewer.getAttribute("target_polygon");
watchedBbox=viewer.getAttribute("watched_bbox");
edit=viewer.getAttribute("edit")==="true";
eltRef=viewer.getAttribute("elt_ref");
descRef=viewer.getAttribute("desc_ref");
mode=viewer.getAttribute("mode");
var children=viewer.childNodes;
var tmp=[];
for(i=0;
i<children.length;
i++){if(children[i].nodeType===1){tmp.push(children[i])
}}children=tmp;
if(children.length>1){continue
}var id;
id=Ext.id(viewer);
var map=createMap();
if(edit){var control,tbarItems=[];
if(mode==="bbox"){control=new OpenLayers.Control.DrawFeature(vectorLayers[eltRef],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:4},featureAdded:function(feature){var bounds=feature.geometry.getBounds(),boundsReproj;
if(mainProj!==wgsProj){boundsReproj=bounds.clone().transform(mainProj,wgsProj)
}else{boundsReproj=bounds
}var wsen=this.watchedBbox.split(",");
Ext.get("_"+wsen[0]).dom.value=boundsReproj.left;
Ext.get("_"+wsen[1]).dom.value=boundsReproj.bottom;
Ext.get("_"+wsen[2]).dom.value=boundsReproj.right;
Ext.get("_"+wsen[3]).dom.value=boundsReproj.top;
watchRadios(this.watchedBbox,this.eltRef)
}.bind({watchedBbox:watchedBbox,eltRef:eltRef})});
tbarItems.push(new GeoExt.Action({map:maps[eltRef],control:control,text:OpenLayers.i18n("drawRectangle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawRectangle"}));
tbarItems.push(createRegionMenu(function(c,r,idx){var wsen=this.watchedBbox.split(",");
Ext.get("_"+wsen[0]).dom.value=r.data.west;
Ext.get("_"+wsen[1]).dom.value=r.data.south;
Ext.get("_"+wsen[2]).dom.value=r.data.east;
Ext.get("_"+wsen[3]).dom.value=r.data.north;
updateBboxForRegion(maps[eltRef],watchedBbox,eltRef,true);
if(Ext.get("_"+this.descRef)!==null){Ext.get("_"+this.descRef).dom.value=r.data.label[OpenLayers.Lang.getCode()]
}}.bind({extentMap:this,map:maps[eltRef],watchedBbox:watchedBbox,eltRef:eltRef,descRef:descRef})))
}else{if(mode==="polygon"){control=new OpenLayers.Control.DrawFeature(vectorLayers[eltRef],OpenLayers.Handler.Polygon,{featureAdded:function(feature){document.getElementById("_X"+this).value=convertToGml(feature,mainProjCode)
}.bind(targetPolygon)});
tbarItems.push(new GeoExt.Action({map:maps[eltRef],control:control,text:OpenLayers.i18n("drawPolygon"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawPolygon"}));
control=new OpenLayers.Control.DrawFeature(vectorLayers[eltRef],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:60},featureAdded:function(feature){document.getElementById("_X"+this).value=convertToGml(feature,mainProjCode)
}.bind(targetPolygon)});
tbarItems.push(new GeoExt.Action({map:maps[eltRef],control:control,text:OpenLayers.i18n("drawCircle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawCircle"}))
}}tbarItems.push({text:OpenLayers.i18n("clear"),iconCls:"clearPolygon",handler:function(){this.vectorLayer.destroyFeatures();
var targetPolygonInput=document.getElementById("_X"+this.targetPolygon);
if(targetPolygonInput!==null){targetPolygonInput.value=""
}if(this.targetBbox!==""){var wsen=this.targetBbox.split(",");
Ext.get(wsen[0]).dom.value="";
Ext.get(wsen[1]).dom.value="";
Ext.get(wsen[2]).dom.value="";
Ext.get(wsen[3]).dom.value="";
Ext.get("_"+wsen[0]).dom.value="";
Ext.get("_"+wsen[1]).dom.value="";
Ext.get("_"+wsen[2]).dom.value="";
Ext.get("_"+wsen[3]).dom.value="";
$(wsen[0]).onkeyup();
$(wsen[1]).onkeyup();
$(wsen[2]).onkeyup();
$(wsen[3]).onkeyup()
}},scope:{vectorLayer:vectorLayers[eltRef],targetPolygon:targetPolygon,targetBbox:watchedBbox,eltRef:eltRef}})
}var mapPanel=new GeoExt.MapPanel({renderTo:id,height:300,width:400,map:maps[eltRef],tbar:(edit?tbarItems:null)});
if(children.length>0){readFeature(children[0].innerHTML,{format:"WKT",zoomToFeatures:true,from:wgsProj,to:mainProj},vectorLayers[eltRef],maps[eltRef])
}if(watchedBbox!==""){watchRadios(watchedBbox,eltRef);
watchBbox(vectorLayers[eltRef],watchedBbox,eltRef,maps[eltRef])
}}}}
};
GeoNetwork.map.ExtentMap.prev_geometry=OpenLayers.Format.GML.Base.prototype.writers.feature._geometry;
OpenLayers.Format.GML.Base.prototype.writers.feature._geometry=function(geometry){if(geometry.CLASS_NAME==="GeoNetwork.map.ExtentMap.MultiPolygonReference"){var gml=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");
var gmlNode=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");
gmlNode.setAttribute("gml:id",geometry.id);
gml.appendChild(gmlNode);
return gml
}else{return GeoNetwork.map.ExtentMap.prev_geometry.apply(this,arguments)
}};Ext.namespace("GeoNetwork","GeoNetwork.OGCUtil");
GeoNetwork.OGCUtil.getProtocolVersion=function(){return"1.3.0"
};
GeoNetwork.OGCUtil.getLanguage=function(){return GeoNetwork.Util.getISO3LangCode(catalogue.lang)
};
GeoNetwork.OGCUtil.ensureProperUrlEnd=function(url){if(url.indexOf("?")==-1){url+="?"
}else{var lastChar=url.substring(url.length-1);
if(lastChar!="&"&&lastChar!="?"){url+="&"
}}return url
};
GeoNetwork.OGCUtil.reprojectMap=function(map,newProjection,noZoom){if(map.projection!=newProjection.projCode){map.baseLayer.options.scales=map.scales;
var oldProjection=map.getProjectionObject();
map.projection=newProjection.projCode;
if(newProjection.getUnits()===null){map.units="degrees"
}else{map.units=newProjection.getUnits()
}var cursorPos=null;
if(map.getControlsByClass("GeoNetwork.Control.CursorPos").length>0){cursorPos=map.getControlsByClass("GeoNetwork.Control.CursorPos")[0]
}if(map.units=="m"&&cursorPos!==null){cursorPos.numdigits=0
}else{if(map.units=="degrees"&&cursorPos!==null){cursorPos.numdigits=4
}}map.maxExtent=map.maxExtent.transform(oldProjection,newProjection);
map.baseLayer.extent=map.maxExtent;
var bounds=map.getExtent().transform(oldProjection,newProjection);
for(var i=0;
i<map.layers.length;
i++){var layer=map.layers[i];
layer.units=map.units;
layer.projection=newProjection;
layer.maxExtent=map.maxExtent;
if(layer.isBaseLayer){layer.initResolutions()
}else{layer.resolutions=map.baseLayer.resolutions;
layer.minResolution=map.baseLayer.minResolution;
layer.maxResolution=map.baseLayer.maxResolution
}if(layer instanceof OpenLayers.Layer.Vector){for(var j=0;
j<layer.features.length;
j++){var feature=layer.features[j];
if(feature.geometry.projection!=map.projection){feature.geometry.transform(new OpenLayers.Projection(feature.geometry.projection),map.getProjectionObject());
feature.geometry.projection=map.projection
}}}}if(!noZoom){map.zoomToExtent(bounds)
}}};
GeoNetwork.OGCUtil.layerExistsInMap=function(layer,map){var layerExists=false;
for(var i=0,len=map.layers.length;
i<len;
i++){if(map.layers){var lr=map.layers[i];
if(lr.params){try{var layers=lr.params.LAYERS.split(",");
if((layers.indexOf(layer.params.LAYERS)!=-1)&&lr.params.SERVICE==layer.params.SERVICE&&lr.url==layer.url){layerExists=lr;
break
}}catch(e){}}}}return layerExists
};Ext.namespace("GeoNetwork","GeoNetwork.CatalogueInterface");
GeoNetwork.CatalogueInterface=function(){var map;
var layerLoadingMask;
var layers;
var setMap=function(mapC){map=mapC
};
var getLayer=function(caps,caplayers,layer){var findedLayer=null;
for(var i=0,len=caplayers.length;
i<len;
++i){var lr=caplayers[i];
try{var layerName=lr.name.split(",");
if(layerName.indexOf(layer.params.LAYERS)!=-1){findedLayer=lr;
break
}}catch(e){}if(typeof(lr.nestedLayers)!="undefined"){findedLayer=getLayer(caps,lr.nestedLayers,layer);
if(findedLayer!==null){break
}}}return findedLayer
};
var processLayersSuccess=function(response){layerLoadingMask.hide();
var parser=new OpenLayers.Format.WMSCapabilities();
var caps=parser.read(response.responseXML||response.responseText);
if(caps.capability){var accessContraints=caps.service.accessContraints;
if((accessContraints)&&(accessContraints.toLowerCase()!="none")&&(accessContraints!="-")){var disclaimerWindow=new GeoNetwork.DisclaimerWindow({disclaimer:accessContraints});
disclaimerWindow.show();
disclaimerWindow=null
}if(map){for(var i=0,len=layers.length;
i<len;
i++){var name=layers[i][0];
var url=layers[i][1];
var layer=layers[i][2];
var metadata_id=layers[i][3];
var ol_layer=new OpenLayers.Layer.WMS(name,url,{layers:layer,format:"image/png",transparent:"TRUE",version:caps.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:metadata_id});
if(!GeoNetwork.OGCUtil.layerExistsInMap(ol_layer,map)){ol_layer.events.on({loadstart:function(){this.isLoading=true
}});
ol_layer.events.on({loadend:function(){this.isLoading=false
}});
var layerCap=getLayer(caps,caps.capability.layers,ol_layer);
if(layerCap){ol_layer.queryable=layerCap.queryable;
ol_layer.name=layerCap.title||ol_layer.name;
ol_layer.llbbox=layerCap.llbbox;
ol_layer.styles=layerCap.styles;
ol_layer.dimensions=layerCap.dimensions
}map.addLayer(ol_layer)
}}}}};
var processLayersFailure=function(response){layerLoadingMask.hide();
Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"))
};
return{init:function(map){setMap(map)
},addLayers:function(layerList){if(layerList.length===0){return
}var onlineResource=layerList[0][1];
if(layerList[0][2]===""){GeoNetwork.WindowManager.showWindow("addwms");
var panel=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);
panel.setURL(onlineResource);
return
}layerLoadingMask=new Ext.LoadMask(map.div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});
layerLoadingMask.show();
layers=layerList;
var params={service:"WMS",request:"GetCapabilities",version:GeoNetwork.OGCUtil.getProtocolVersion(),language:GeoNetwork.OGCUtil.getLanguage()};
var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
var req=Ext.Ajax.request({url:onlineResource,method:"GET",success:processLayersSuccess,failure:processLayersFailure,timeout:10000})
}}
};
GeoNetwork.CatalogueInterface=new GeoNetwork.CatalogueInterface();Ext.namespace("GeoNetwork","GeoNetwork.WMC");
GeoNetwork.WMC=function(){return{loadWmc:function(map,xml){try{var layers=map.layers;
for(var i=layers.length-1;
i>0;
i--){if(!layers[i].isBaseLayer){map.removeLayer(layers[i])
}}Ext.getCmp("toctree").getSelectionModel().clearSelections();
var format=new OpenLayers.Format.WMC({layerOptions:{buffer:0}});
map=format.read(xml,{map:map})
}catch(err){Ext.MessageBox.alert(OpenLayers.i18n("selectWMCFile.errorLoadingWMC"))
}},mergeWmc:function(map,xml){try{var format=new OpenLayers.Format.WMC({layerOptions:{buffer:0}});
map=format.read(xml,{map:map})
}catch(err){Ext.MessageBox.alert(OpenLayers.i18n("selectWMCFile.errorLoadingWMC"))
}},saveContext:function(map){var wmc=new OpenLayers.Format.WMC();
OpenLayers.Request.POST({url:"../../wmc/create.wmc",data:wmc.write(map),success:this.onSaveContextSuccess,failure:this.onSaveContextFailure})
},onSaveContextSuccess:function(response){var json=response.responseText;
var o=Ext.decode(json);
if(o.success){window.location=o.url
}else{this.onSaveContextFailure()
}},onSaveContextFailure:function(form,action){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:OpenLayers.i18n("saveWMCFile.windowTitle"),msg:OpenLayers.i18n("saveWMCFile.errorSaveWMC"),buttons:Ext.MessageBox.OK})
}}
};
GeoNetwork.WMCManager=new GeoNetwork.WMC();if(!window.GeoNetwork){window.GeoNetwork={}
}if(!GeoNetwork.Control){GeoNetwork.Control={}
}GeoNetwork.Control.ExtentBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,wktelement:null,minxelement:null,minyelement:null,maxxelement:null,maxyelement:null,EVENT_TYPES:["finishBox"],initialize:function(options){this.EVENT_TYPES=GeoNetwork.Control.ExtentBox.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);
OpenLayers.Control.prototype.initialize.apply(this,arguments);
this.handler=new OpenLayers.Handler.RegularPolygon(this,{create:this.startBox,done:this.endBox},{irregular:true})
},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments)
},startBox:function(){this.getOrCreateLayer();
this.vectorLayer.destroyFeatures()
},endBox:function(){var bounds=this.handler.feature.geometry.getBounds();
this.updateFields(bounds);
this.events.triggerEvent("finishBox",null)
},updateFields:function(bounds){var polFeature=new OpenLayers.Feature.Vector(bounds.toGeometry(),null,this.vectorLayerStyle);
this.vectorLayer.addFeatures([polFeature]);
this.vectorLayer.refresh();
var mapProj=this.map.getProjectionObject();
var wgs84=new OpenLayers.Projection("WGS84");
var minxy=new OpenLayers.LonLat(bounds.left,bounds.bottom).transform(mapProj,wgs84);
var maxxy=new OpenLayers.LonLat(bounds.right,bounds.top).transform(mapProj,wgs84);
var minx=minxy.lon.toFixed(4),miny=minxy.lat.toFixed(4),maxx=maxxy.lon.toFixed(4),maxy=maxxy.lat.toFixed(4);
if(this.wktelement){this.wktelement.setValue("POLYGON(("+minx+" "+miny+","+minx+" "+maxy+","+maxx+" "+maxy+","+maxx+" "+miny+","+minx+" "+miny+"))")
}else{if(this.minxelement){this.minxelement.dom.value=minx
}if(this.maxxelement){this.maxxelement.dom.value=maxx
}if(this.minyelement){this.minyelement.dom.value=miny
}if(this.maxyelement){this.maxyelement.dom.value=maxy
}}},updateMap:function(){if((!this.minxelement)||(!this.maxxelement)||(!this.minyelement)||(!this.maxyelement)){return
}this.getOrCreateLayer();
var mapProj=this.map.getProjectionObject();
var wgs84=new OpenLayers.Projection("WGS84");
var minMapxy=new OpenLayers.LonLat(this.map.getExtent().left,this.map.getExtent().bottom).transform(mapProj,wgs84);
var maxMapxy=new OpenLayers.LonLat(this.map.getExtent().right,this.map.getExtent().top).transform(mapProj,wgs84);
var aux=parseFloat(this.minxelement.dom.value);
if(isNaN(aux)){this.minxelement.dom.value=minMapxy.lon
}aux=parseFloat(this.maxxelement.dom.value);
if(isNaN(aux)){this.maxxelement.dom.value=maxMapxy.lon
}aux=parseFloat(this.minyelement.dom.value);
if(isNaN(aux)){this.minyelement.dom.value=minMapxy.lat
}aux=parseFloat(this.maxyelement.dom.value);
if(isNaN(aux)){this.maxyelement.dom.value=maxMapxy.lat
}this.minxelement.dom.value=parseFloat(this.minxelement.dom.value).toFixed(4);
this.maxxelement.dom.value=parseFloat(this.maxxelement.dom.value).toFixed(4);
this.minyelement.dom.value=parseFloat(this.minyelement.dom.value).toFixed(4);
this.maxyelement.dom.value=parseFloat(this.maxyelement.dom.value).toFixed(4);
this.vectorLayer.destroyFeatures();
var minxy=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(wgs84,mapProj);
var maxxy=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(wgs84,mapProj);
var bounds=new OpenLayers.Bounds();
bounds.extend(minxy);
bounds.extend(maxxy);
var polFeature=new OpenLayers.Feature.Vector(bounds.toGeometry(),null,this.vectorLayerStyle);
this.vectorLayer.addFeatures([polFeature]);
this.vectorLayer.refresh()
},getOrCreateLayer:function(){if(!this.vectorLayer){this.vectorLayer=this.vectorLayer||new OpenLayers.Layer.Vector("ExtentBox",{style:this.vectorLayerStyle});
this.map.addLayer(this.vectorLayer)
}this.map.setLayerIndex(this.vectorLayer,this.map.getNumLayers());
return this.vectorLayer
},clear:function(){if(this.vectorLayer){this.vectorLayer.destroyFeatures()
}},zoomTo:function(){var mapProj=this.map.getProjectionObject();
var wgs84=new OpenLayers.Projection("WGS84");
var minxy=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(wgs84,mapProj);
var maxxy=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(wgs84,mapProj);
var bounds=new OpenLayers.Bounds();
bounds.extend(minxy);
bounds.extend(maxxy);
this.map.zoomToExtent(bounds)
},CLASS_NAME:"GeoNetwork.Control.ExtentBox"});if(!window.GeoNetwork){window.GeoNetwork={}
}if(!GeoNetwork.Control){GeoNetwork.Control={}
}GeoNetwork.Control.ZoomWheel=OpenLayers.Class(OpenLayers.Control,{wheelChange:OpenLayers.Control.Navigation.prototype.wheelChange,draw:function(){this.handler=new OpenLayers.Handler.MouseWheel(this,{up:OpenLayers.Control.Navigation.prototype.wheelUp,down:OpenLayers.Control.Navigation.prototype.wheelDown});
this.activate()
},CLASS_NAME:"GeoNetwork.Control.ZoomWheel"});Ext.namespace("GeoNetwork","GeoNetwork.tree");
GeoNetwork.tree.WMSListGenerator=function(config){Ext.apply(this,config);
if(this.node&&this.wmsStore){this.createWMSList()
}};
GeoNetwork.tree.WMSListGenerator.prototype={node:null,wmsStore:null,click:null,scope:null,createWMSList:function(){this.wmsStore.each(this.appendRecord,this)
},appendRecord:function(record){var wmsNode=new Ext.tree.TreeNode({url:record.get("url"),text:record.get("title"),cls:"folder",leaf:false});
wmsNode.appendChild(new Ext.tree.TreeNode({text:"",dummy:true}));
wmsNode.addListener("beforeexpand",this.addNodesFromWMS,this);
this.node.appendChild(wmsNode)
},replaceNode:function(node){this.currentNode.parentNode.replaceChild(node,this.currentNode);
node.ui.afterLoad();
node.expand()
},addNodesFromWMS:function(node){if(node.firstChild&&node.firstChild.attributes.dummy){node.removeChild(node.firstChild);
node.ui.beforeLoad();
this.scope.currentNode=node;
var treeGenerator=new GeoNetwork.tree.WMSTreeGenerator({click:this.click,callback:this.replaceNode,scope:this.scope});
treeGenerator.loadWMS(node.attributes.url)
}}};Ext.namespace("GeoNetwork","GeoNetwork.tree");
GeoNetwork.tree.WMSTreeGenerator=function(config){Ext.apply(this,config)
};
GeoNetwork.tree.WMSTreeGenerator.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},click:null,callback:null,scope:null,loadWMS:function(onlineResource){var params={service:"WMS",request:"GetCapabilities",version:GeoNetwork.OGCUtil.getProtocolVersion(),language:GeoNetwork.OGCUtil.getLanguage()};
var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
var req=OpenLayers.Request.GET({url:onlineResource,failure:this.processFailure,success:this.processSuccess,disableCaching:false,scope:this})
},processSuccess:function(response){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities()
}var caps=this.parser.read(response.responseXML||response.responseText);
this.layerParams.VERSION=caps.version;
var node;
if(caps.capability){for(var i=0,len=caps.capability.nestedLayers.length;
i<len;
++i){var layer=caps.capability.nestedLayers[i];
node=this.addLayer(layer,caps.capability.request.getmap.href,null);
this.processLayer(layer,caps.capability.request.getmap.href,node)
}}Ext.callback(this.callback,this.scope,[node,caps])
},processFailure:function(response){Ext.callback(this.callback,this.scope,null)
},createWMSLayer:function(layer,url){return new OpenLayers.Layer.WMS(layer.title,url,OpenLayers.Util.extend({layers:layer.name,language:GeoNetwork.OGCUtil.getLanguage()},this.layerParams),OpenLayers.Util.extend({minScale:layer.minScale,queryable:layer.queryable,maxScale:layer.maxScale,metadataURL:layer.metadataURL,dimensions:layer.dimensions,styles:layer.styles,llbbox:layer.llbbox},this.layerOptions))
},addLayer:function(layer,url,parentNode){var wmsLayer=null;
if(layer.name){wmsLayer=this.createWMSLayer(layer,url);
if(layer.styles&&layer.styles.length>0){var style=layer.styles[0];
if(style.legend&&style.legend.href){wmsLayer.legendURL=style.legend.href
}}}var node=new Ext.tree.TreeNode({wmsLayer:wmsLayer,text:layer.title});
node.addListener("click",this.click,this.scope);
if(parentNode){parentNode.appendChild(node)
}return node
},processLayer:function(layer,url,node){Ext.each(layer.nestedLayers,function(el){var node2=this.addLayer(el,url,node);
if(el.nestedLayers){this.processLayer(el,url,node2)
}},this)
}};Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.BrowserPanel=function(config){Ext.apply(this,config);
GeoNetwork.wms.BrowserPanel.superclass.constructor.call(this)
};
GeoNetwork.wms.BrowserPanel.ADDWMS=0;
GeoNetwork.wms.BrowserPanel.WMSLIST=1;
Ext.extend(GeoNetwork.wms.BrowserPanel,Ext.Panel,{previewPanel:null,treePanel:null,map:null,previewCenterPoint:null,mode:GeoNetwork.wms.BrowserPanel.WMSLIST,wmsStore:null,urlField:null,searchResultsGrid:null,searchField:null,parseBt:null,typeRadio:null,defaultConfig:{border:false,frame:false,layout:"border"},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
GeoNetwork.wms.BrowserPanel.superclass.initComponent.call(this);
this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});
var root;
this.treePanel=new Ext.tree.TreePanel({rootVisible:false,autoScroll:true,autoHeight:true});
root=new Ext.tree.TreeNode({text:"",draggable:false,cls:"folder"});
this.treePanel.setRootNode(root);
var centerItems=[];
if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){this.createForm();
centerItems.push(this.form)
}centerItems.push(this.treePanel);
var center={autoScroll:true,region:"center",items:centerItems,split:true,width:300,minWidth:300,border:false};
var east={region:"east",border:false,items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};
this.add(center);
this.add(east);
if(this.mode==GeoNetwork.wms.BrowserPanel.WMSLIST){this.treeGen=new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore})
}else{if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore});
this.treeGen=new GeoNetwork.tree.WMSTreeGenerator({click:this.nodeClick,callback:this.showTree,scope:this})
}}this.addButton({text:OpenLayers.i18n("WMSBrowserAddButton"),iconCls:"addLayerIcon",width:150},this.addLayerToMap,this);
this.doLayout()
},createForm:function(){this.form=new Ext.form.FormPanel({labelWidth:15,id:"serviceSearchForm"});
this.typeRadio=new Ext.form.RadioGroup({items:[{name:"addWmsType",fieldLabel:"Search WMS",labelSeparator:"",inputValue:0,checked:true},{name:"addWmsType",labelSeparator:"",fieldLabel:" or add by URL",inputValue:1}],listeners:{change:function(rg,checked){var search=(checked.getGroupValue()=="0");
this.urlField.setVisible(!search);
this.searchField.setVisible(search);
this.searchResultsGrid.setVisible(search)
},scope:this}});
this.form.add(this.typeRadio);
this.urlField=new Ext.form.TextField({name:"wmsurl",hideLabel:true,hidden:true,emptyText:"WMS server URL ...",width:250,autoHeight:true});
this.form.add(this.urlField);
var mdStore=GeoNetwork.data.MetadataResultsStore();
var sStore=GeoNetwork.data.MetadataSummaryStore();
this.searchField=new GeoNetwork.form.SearchField({name:"E_any",hideLabel:true,width:250,minWidth:250,store:mdStore,triggerAction:function(scope){scope.search("serviceSearchForm",null,null,1,true,mdStore,sStore)
},scope:catalogue});
var checkboxSM=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});
this.searchResultsGrid=new Ext.grid.GridPanel({layout:"fit",height:80,border:false,store:mdStore,columns:[checkboxSM,{id:"title",header:"Title",dataIndex:"title"}],sm:checkboxSM,autoExpandColumn:"title",listeners:{rowclick:function(grid,rowIndex,e){var data=grid.getStore().getAt(rowIndex).data;
this.setValue(data.links[0].href)
},scope:this.urlField}});
var wmsServiceField=new Ext.form.TextField({inputType:"hidden",name:"E_serviceType",value:"OGC:WMS"});
this.form.add(this.searchField,wmsServiceField,this.searchResultsGrid);
this.parseBt=new Ext.Button({id:"parse",text:OpenLayers.i18n("WMSBrowserConnectButton"),iconCls:"connectIcon",width:150});
this.form.addButton(this.parseBt,this.getWMSCaps,this)
},showTree:function(node,capability){if(!node){Ext.MessageBox.alert(OpenLayers.i18n("errorTitle"),OpenLayers.i18n("WMSBrowserConnectError"));
this.body.dom.style.cursor="default"
}var accessContraints=capability.service.accessContraints;
if((accessContraints)&&(accessContraints.toLowerCase()!="none")&&(accessContraints!="-")){var disclaimerWindow=new GeoNetwork.DisclaimerWindow({disclaimer:accessContraints});
disclaimerWindow.show();
disclaimerWindow=null
}var root=this.treePanel.getRootNode();
if(node){this.treePanel.getRootNode().appendChild(node)
}this.treePanel.show();
this.body.dom.style.cursor="default"
},getWMSCaps:function(btn){var url=this.urlField.getValue();
url=url.replace(/^\s+|\s+$/g,"");
if(url!=""){this.body.dom.style.cursor="wait";
this.treeGen.loadWMS(url)
}},setURL:function(url){var url=this.urlField.setValue(url);
this.typeRadio.setValue(1);
this.getWMSCaps(this.parseBt)
},nodeClick:function(node){this.previewPanel.showPreview(node.attributes.wmsLayer)
},addLayerToMap:function(){if(this.previewPanel.currentLayer){var layerExists=GeoNetwork.OGCUtil.layerExistsInMap(this.previewPanel.currentLayer,this.map);
if(!layerExists){this.previewPanel.currentLayer.events.on({loadstart:function(){this.isLoading=true
}});
this.previewPanel.currentLayer.events.on({loadend:function(){this.isLoading=false
}});
this.map.addLayers([this.previewPanel.currentLayer])
}else{Ext.MessageBox.alert(OpenLayers.i18n("infoTitle"),OpenLayers.i18n("WMSBrowserDuplicateMsg"))
}}}});
Ext.reg("gn_wmsbrowserpanel",GeoNetwork.wms.BrowserPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.LayerInfoPanel=function(config){Ext.apply(this,config);
GeoNetwork.wms.LayerInfoPanel.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.wms.LayerInfoPanel,Ext.Panel,{previewPanel:null,map:null,previewCenterPoint:null,onlineresource:null,layer:null,initComponent:function(){GeoNetwork.wms.LayerInfoPanel.superclass.initComponent.call(this);
this.layout="border";
this.border=false;
this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});
this.store=new Ext.data.SimpleStore({reader:new Ext.data.ArrayReader({},[{name:"title",type:"string"},{name:"field",type:"string"}]),fields:["title","field"]});
this.gridPanel=new Ext.grid.GridPanel({title:"",store:this.store,autoScroll:true,hideHeaders:false,columns:[]});
this.layerInfo=new GeoNetwork.wms.WMSLayerInfo({callback:this._showLayerInfo,scope:this});
var center={region:"center",layout:"fit",items:[this.gridPanel],split:true,width:300,minWidth:300};
var east={region:"east",items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};
this.add(center);
this.add(east);
this.doLayout()
},showLayerInfo:function(){this.previewPanel.showPreview(this.layer);
this.layerInfo.loadWMS(this.onlineresource,this.layer)
},_showLayerInfo:function(layer){if(!layer){Ext.MessageBox.alert(OpenLayers.i18n("errorTitle"),OpenLayers.i18n("WMSBrowserConnectError"));
this.body.dom.style.cursor="default"
}else{var info=[[OpenLayers.i18n("layerInfoPanel.titleField"),layer.title||layer.name],[OpenLayers.i18n("layerInfoPanel.descriptionField"),layer.description],[OpenLayers.i18n("layerInfoPanel.queryableField"),layer.queryable]];
this.gridPanel.reconfigure(this.store,new Ext.grid.ColumnModel([{header:"Field",dataIndex:"title",sortable:true},{id:"value",header:"Value",dataIndex:"field",sortable:true}]));
this.gridPanel.autoExpandColumn="value";
this.gridPanel.getStore().loadData(info)
}this.body.dom.style.cursor="default"
}});
Ext.reg("gn_infolayerpanel",GeoNetwork.wms.LayerInfoPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.LayerStylesPanel=function(config){Ext.apply(this,config);
GeoNetwork.wms.LayerStylesPanel.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.wms.LayerStylesPanel,Ext.Panel,{previewPanel:null,map:null,layer:null,selectedStyle:null,initComponent:function(){GeoNetwork.wms.LayerStylesPanel.superclass.initComponent.call(this);
this.layout="border";
this.border=false;
this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,title:OpenLayers.i18n("layerStylesPreviewTitle")});
this.store=new Ext.data.SimpleStore({reader:new Ext.data.ArrayReader({},[{name:"name",type:"string"},{name:"title",type:"string"},{name:"legendUrl",type:"string"}]),fields:["name","title","legendUrl"]});
this.gridPanel=new Ext.grid.GridPanel({title:"",border:false,autoScroll:true,store:this.store,hideHeaders:false,columns:[{header:"Style",width:120,dataIndex:"name",sortable:false},{id:"description",header:"Description",width:180,dataIndex:"title",sortable:false}],autoExpandColumn:"description"});
this.gridPanel.on("rowclick",this._selectStyle,this);
var center={region:"center",layout:"fit",items:[this.gridPanel],split:true,width:300,minWidth:300};
var east={region:"east",items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};
this.add(center);
this.add(east);
this.doLayout()
},showLayerStyles:function(layer){var info=[];
for(var i=0;
i<layer.styles.length;
i++){var legendUrl="";
if(layer.styles[i].legend){legendUrl=layer.styles[i].legend.href
}var style=[layer.styles[i].name,layer.styles[i].title,legendUrl];
info.push(style)
}this.gridPanel.getStore().loadData(info)
},_selectStyle:function(grid,rowIndex,e){var rec=grid.store.getAt(rowIndex);
this.selectedStyle=rec.get("name");
grid.getView().focusEl.focus();
var legendUrl=rec.get("legendUrl");
if(legendUrl==""){return
}legendUrl=unescape(legendUrl);
this.selectedStyleLegendUrl=legendUrl;
var legendUrlStyle=rec.get("legendUrl")+"&style="+this.selectedStyle;
this.previewPanel.showPreviewLegend(unescape(legendUrlStyle))
}});
Ext.reg("gn_layerstylespanel",GeoNetwork.wms.LayerStylesPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.PreviewPanel=function(config){Ext.apply(this,config);
GeoNetwork.wms.PreviewPanel.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.wms.PreviewPanel,Ext.Panel,{title:OpenLayers.i18n("WMSBrowserPreviewTitle"),baseCls:"x-plain",cls:"x-panel-title-variant1",imgCls:"preview-image",width:250,height:250,currentLayer:null,initComponent:function(){GeoNetwork.wms.PreviewPanel.superclass.initComponent.call(this);
this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:Ext.BLANK_IMAGE_URL,width:this.width,height:this.height}});
this.add(this.image)
},hideMask:function(){if(this.mask){this.mask.hide()
}},showMask:function(){if(!this.mask){this.mask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("WMSBrowserPreviewWaitMsg")});
Ext.EventManager.addListener(this.image.getEl(),"load",this.hideMask,this);
Ext.EventManager.addListener(this.image.getEl(),"error",this.hideMask,this)
}this.mask.show()
},calculateBBOX:function(layer){var bbox;
if(layer.llbbox){if(this.map.getProjection()!=="EPSG:4326"){var llbounds=OpenLayers.Bounds.fromArray(layer.llbbox);
llbounds=llbounds.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());
bbox=llbounds.toArray()
}else{bbox=layer.llbbox
}}else{bbox=this.map.maxExtent.toArray()
}var center=OpenLayers.Bounds.fromArray(bbox).getCenterLonLat();
if(layer.minScale>0){var midScale;
if(layer.maxScale>0){midScale=(layer.maxScale+layer.minScale)/2
}else{midScale=0.9*layer.minScale
}var res=OpenLayers.Util.getResolutionFromScale(midScale,this.map.units);
var dX=Math.round(res*this.width);
var dY=Math.round(res*this.height);
var cX=center.lon;
var cY=center.lat;
if(dX!==0&&dY!==0){bbox=[cX-0.5*dX,cY-0.5*dY,cX+0.5*dX,cY+0.5*dY]
}}return bbox.join(",")
},showPreview:function(layer){if(!layer){return
}this.showMask();
var previousMap=layer.map;
if(previousMap===null){layer.map=this.map
}var url=layer.getFullRequestString({BBOX:this.calculateBBOX(layer),WIDTH:this.width,HEIGHT:this.height});
if(previousMap===null){layer.map=previousMap
}this.currentLayer=layer;
this.image.getEl().dom.src=url
},showPreviewLegend:function(urlLegend){this.remove(this.image);
this.image=null;
this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:urlLegend}});
this.add(this.image);
this.doLayout()
}});
Ext.reg("gn_wmspreview",GeoNetwork.wms.PreviewPanel);Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.WMSLayerInfo=function(config){Ext.apply(this,config)
};
GeoNetwork.wms.WMSLayerInfo.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},callback:null,scope:null,layer:null,loadWMS:function(onlineResource,layer){this.layer=layer;
var params={service:"WMS",request:"GetCapabilities",version:GeoNetwork.OGCUtil.getProtocolVersion(),language:GeoNetwork.OGCUtil.getLanguage()};
var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
var req=OpenLayers.Request.GET({url:onlineResource,failure:this.processFailure,success:this.processSuccess,timeout:10000,scope:this})
},processSuccess:function(response){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities()
}var caps=this.parser.read(response.responseXML||response.responseText);
var node;
if(caps.capability){node=this.processLayers(caps,caps.capability.nestedLayers)
}Ext.callback(this.callback,this.scope,[node,this.layer])
},processFailure:function(response){Ext.callback(this.callback,this.scope,[null,this.layer])
},createWMSLayer:function(layer,url){return new OpenLayers.Layer.WMS(layer.title,url,OpenLayers.Util.extend({layers:layer.name},this.layerParams),OpenLayers.Util.extend({minScale:layer.minScale,queryable:layer.queryable,maxScale:layer.maxScale,description:layer.abstrack,metadataURL:layer.metadataURL,llbbox:layer.llbbox},this.layerOptions))
},processLayers:function(caps,layers){var findedLayer=null;
for(var i=0,len=layers.length;
i<len;
++i){var lr=layers[i];
try{var layerName=lr.name.split(",");
if(layerName.indexOf(this.layer.params.LAYERS)!=-1){findedLayer=this.createWMSLayer(lr,caps.service.href);
break
}}catch(e){}if(typeof(lr.nestedLayers)!="undefined"){findedLayer=this.processLayers(caps,lr.nestedLayers);
if(findedLayer!=null){break
}}}return findedLayer
}};Ext.namespace("GeoNetwork");
GeoNetwork.FeatureInfoPanel=function(config){Ext.apply(this,config);
GeoNetwork.FeatureInfoPanel.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.FeatureInfoPanel,Ext.Panel,{features:null,treePanel:null,infoPanel:null,initComponent:function(){GeoNetwork.FeatureInfoPanel.superclass.initComponent.call(this);
this.layout="border";
this.treePanel=new Ext.tree.TreePanel({rootVisible:true,autoScroll:true});
var root=new Ext.tree.TreeNode({text:OpenLayers.i18n("featureInfoTitle"),draggable:false,expanded:true,cls:"folder"});
this.treePanel.setRootNode(root);
var center={region:"center",items:[this.treePanel],split:true,minWidth:100};
this.infoPanel=new Ext.Panel();
this.infoPanel.on("render",function(){if(this.features){this.showFeatures(this.features)
}},this);
var east={region:"east",items:[this.infoPanel],split:true,plain:true,cls:"popup-variant1",width:400,autoScroll:true};
this.add(center);
this.add(east);
this.doLayout()
},setMap:function(map){this.map=map
},featureToHTML:function(feature){var tplstring='<table class="olFeatureInfoTable" cellspacing="1" cellpadding="1"><tbody>';
for(var attr in feature.attributes){if(attr){tplstring+='<tr class="olFeatureInfoRow"><td width="50%" class="olFeatureInfoColumn">'+attr+'</td><td width="50%" class="olFeatureInfoValue">'+feature.attributes[attr]+"</td></tr>"
}}tplstring+="</tbody></table>";
var tpl=new Ext.XTemplate(tplstring);
tpl.overwrite(this.infoPanel.body,feature)
},click:function(node){if(node.attributes.features.length===0){var html='<table class="olFeatureInfoTable" cellpadding="1" cellspacing="1"><tbody>';
html+='<tr class="olFeatureInfoRow"><td colspan="2" class="olFeatureInfoValue">'+OpenLayers.i18n("FeatureInfoNoInfo")+"</td></tr>";
html+="</tbody></table>";
Ext.DomHelper.overwrite(this.infoPanel.body,html)
}for(var i=0,len=node.attributes.features.length;
i<len;
i++){var feature=node.attributes.features[i];
this.featureToHTML(feature)
}},clearInfoPanel:function(){if(this.infoPanel.body){Ext.DomHelper.overwrite(this.infoPanel.body,"")
}},getLayerTitle:function(featureType){if(featureType==null){return"&nbsp"
}var layers=this.map.getLayersByClass("OpenLayers.Layer.WMS");
for(var i=0,len=layers.length;
i<len;
i++){if(layers[i].params.LAYERS instanceof Array){if(OpenLayers.Util.indexOf(layers[i].params.LAYERS,featureType)!==-1){return layers[i].name
}}else{if(layers[i].params.LAYERS.indexOf(featureType)!==-1){return layers[i].name
}}}},showFeatures:function(features){this.clearInfoPanel();
var root=this.treePanel.getRootNode();
while(root.firstChild){root.removeChild(root.firstChild)
}var i,len,featureList=[];
for(i=0,len=features.length;
i<len;
i++){var found=false;
for(var j=0;
j<featureList.length;
j++){if(featureList[j].title===features[i].type){featureList[j].features.push(features[i]);
found=true
}}if(found===false){featureList.push({title:this.getLayerTitle(features[i].type),features:[features[i]]})
}}for(i=0,len=featureList.length;
i<len;
i++){var node=new Ext.tree.TreeNode({text:featureList[i].title,features:featureList[i].features});
node.addListener("click",this.click,this);
root.appendChild(node);
if(i===0){root.expand();
this.click(node);
this.treePanel.getSelectionModel().select(node)
}}root.expand()
}});
Ext.reg("gn_featureinfo",GeoNetwork.FeatureInfoPanel);Ext.namespace("GeoNetwork");
GeoNetwork.LegendPanel=Ext.extend(GeoExt.LegendPanel,{initComponent:function(){GeoNetwork.LegendPanel.superclass.initComponent.call(this)
},onStoreAdd:function(store,records,index){GeoNetwork.LegendPanel.superclass.onStoreAdd.apply(this,arguments);
for(var i=0,len=records.length;
i<len;
i++){var record=records[i];
if(record.get("layer").legendURL!==undefined){record.set("legendURL",record.get("layer").legendURL)
}}}});
Ext.reg("gn_legendpanel",GeoNetwork.LegendPanel);Ext.namespace("GeoNetwork");
GeoNetwork.ProjectionSelector=function(config){Ext.apply(this,config);
GeoNetwork.ProjectionSelector.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.ProjectionSelector,Ext.form.ComboBox,{projections:null,initComponent:function(){GeoNetwork.ProjectionSelector.superclass.initComponent.call(this);
this.on("select",this.reproject,this);
this.valueField="value";
this.autoWidth=true;
this.autoHeight=true;
this.displayField="text";
this.triggerAction="all";
this.mode="local";
this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({},[{name:"value"},{name:"text"}]),data:this.projections});
this.value=this.map.getProjection()
},reproject:function(combo,record){GeoNetwork.OGCUtil.reprojectMap(this.map,new OpenLayers.Projection(record.get("value")),false)
}});
Ext.reg("gn_projectionselector",GeoNetwork.ProjectionSelector);Ext.namespace("GeoNetwork");
GeoNetwork.TimeSelector=function(config){Ext.apply(this,config);
GeoNetwork.TimeSelector.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.TimeSelector,Ext.form.FormPanel,{layer:null,numberOfSteps:12,border:false,originalFormat:null,initComponent:function(){this.buttons=[new Ext.Button({text:OpenLayers.i18n("wmsTimeUpdateButtonText"),handler:this.updateValue,scope:this})];
GeoNetwork.TimeSelector.superclass.initComponent.call(this)
},beforeDestroy:function(){this.updateValue();
GeoNetwork.TimeSelector.superclass.beforeDestroy.call(this)
},setLayer:function(layer){this.layer=layer;
this.originalFormat=this.layer.params.FORMAT||this.layer.params.format;
if(this.layer.dimensions&&this.layer.dimensions.time){this.add(new Ext.form.Label({text:OpenLayers.i18n("WMSTimePositionTitle")}));
this.add(new Ext.BoxComponent({height:10}));
this.add(this.createDateTimeField());
if(this.layer.dimensions.time.multipleVal){this.add(new Ext.BoxComponent({height:25}));
this.add(new Ext.form.Label({text:OpenLayers.i18n("WMSTimeMovieTitle")}));
this.add(new Ext.BoxComponent({height:10}));
this.add({xtype:"checkbox",listeners:{check:{fn:this.playMovie,scope:this}},hideLabel:true,boxLabel:OpenLayers.i18n("WMSTimeAnimationCheckbox",{steps:this.numberOfSteps})})
}this.doLayout()
}},getInterval:function(interval){return parseInt(interval.substring(interval.indexOf("PT")+2,interval.indexOf("M")))
},playMovie:function(a,checked){if(checked){var max,interval,timeRange;
if(this.layer.dimensions.time.values&&this.layer.dimensions.time.values.length>0){var values=this.layer.dimensions.time.values[0].split("/");
max=values[1];
interval=this.getInterval(values[2]);
var start=Date.parseDate(max,"c");
start=start-(1000*60*interval*this.numberOfSteps);
start=new Date(start);
timeRange=this.formatTimeAsUTC(start)+"/"+max
}this.layer.mergeNewParams({TIME:timeRange,FORMAT:"image/gif"})
}else{this.updateValue()
}},formatTimeAsUTC:function(dateObj){var dt=dateObj.dateFormat("c");
var utcHours=""+dateObj.getUTCHours();
if(utcHours.length<2){utcHours="0"+utcHours
}dt=dt.replace(dt.substring(dt.indexOf("T"),dt.indexOf("T")+3),"T"+utcHours);
dt=dt.replace(dt.substring(dt.indexOf("+"),dt.indexOf("+")+6),"Z");
return dt
},updateValue:function(){this.layer.mergeNewParams({TIME:this.formatTimeAsUTC(this.getForm().findField("current").getValue()),FORMAT:this.originalFormat})
},createDateTimeField:function(){var min,max,interval;
if(this.layer.dimensions.time.values&&this.layer.dimensions.time.values.length>0){var values=this.layer.dimensions.time.values[0].split("/");
min=values[0];
max=values[1];
interval=this.getInterval(values[2])
}return new Ext.ux.form.DateTime({hiddenFormat:"c",dateFormat:null,hideLabel:true,name:"current",dateConfig:{minValue:Date.parseDate(min,"c"),maxValue:Date.parseDate(max,"c")},timeConfig:{increment:interval},value:(this.layer.params.TIME)?this.layer.params.TIME:this.layer.dimensions.time["default"],width:340})
}});
Ext.reg("gn_timeselector",GeoNetwork.TimeSelector);Ext.namespace("GeoNetwork");
GeoNetwork.BaseWindow=function(config){Ext.apply(this,config);
GeoNetwork.BaseWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.BaseWindow,Ext.Window,{map:null,initComponent:function(){GeoNetwork.BaseWindow.superclass.initComponent.call(this);
this.constrainHeader=true;
this.collapsible=true;
this.layout="fit";
this.plain=true;
this.stateful=false
}});Ext.namespace("GeoNetwork");
GeoNetwork.SingletonWindowManager=function(){var windowsList=new Object();
var hiddenWindows=new Array();
return{registerWindow:function(id,classz,configz){var window1=new classz(configz);
windowsList[id]={windowz:window1,classz:classz,configz:configz}
},getWindow:function(id){if(windowsList[id]){return windowsList[id].windowz
}else{return null
}},showWindow:function(id){if(windowsList[id]){if(Ext.isEmpty(Ext.getCmp(id))){var w=windowsList[id];
var ww=new w.classz(w.configz);
windowsList[id]={windowz:ww,classz:w.classz,configz:w.configz}
}windowsList[id].windowz.show();
return true
}else{return false
}},hideAllWindows:function(){for(key in windowsList){if(windowsList[key].windowz.isVisible()){windowsList[key].windowz.setVisible(false);
hiddenWindows[hiddenWindows.length]=key
}}},restoreHiddenWindows:function(){for(var index=0,len=hiddenWindows.length;
index<len;
++index){windowsList[hiddenWindows[index]].windowz.setVisible(true)
}hiddenWindows=new Array()
}}
};
GeoNetwork.WindowManager=new GeoNetwork.SingletonWindowManager();Ext.namespace("GeoNetwork");
GeoNetwork.AddWmsLayerWindow=function(config){Ext.apply(this,config);
GeoNetwork.AddWmsLayerWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.AddWmsLayerWindow,GeoNetwork.BaseWindow,{iconCls:"addLayerIcon",browserPanel:null,initComponent:function(){GeoNetwork.AddWmsLayerWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("addWMSWindowTitle");
this.width=600;
this.height=500;
var ds=new Ext.data.Store({data:GeoNetwork.WMSList,reader:new Ext.data.ArrayReader({},[{name:"title"},{name:"url"}])});
this.browserPanel={id:this.id+"wmsbrowserpanel",xtype:"gn_wmsbrowserpanel",mode:GeoNetwork.wms.BrowserPanel.ADDWMS,wmsStore:ds,map:this.map};
var tabs=new Ext.Panel({border:false,deferredRender:false,layout:"fit",items:[this.browserPanel]});
this.add(tabs);
this.doLayout()
}});Ext.namespace("GeoNetwork");
GeoNetwork.FeatureInfoWindow=function(config){Ext.apply(this,config);
GeoNetwork.FeatureInfoWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.FeatureInfoWindow,GeoNetwork.BaseWindow,{control:null,initComponent:function(){GeoNetwork.FeatureInfoWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("featureInfoWindow.windowTitle");
this.width=600;
this.height=250;
this.cls="popup-variant1";
var fp=new GeoNetwork.FeatureInfoPanel();
this.add(fp);
this.doLayout()
},setFeatures:function(featureList){this.items.items[0].showFeatures(featureList)
},setMap:function(map){this.items.items[0].setMap(map)
}});Ext.namespace("GeoNetwork");
GeoNetwork.LoadWmcWindow=function(config){Ext.apply(this,config);
GeoNetwork.LoadWmcWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.LoadWmcWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.LoadWmcWindow.superclass.initComponent.call(this);
this.width=480;
this.title=this.title||OpenLayers.i18n("selectWMCFile.windowTitle");
this.resizable=false;
this.charset="UTF-8";
var fp=new Ext.FormPanel({fileUpload:true,height:100,bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:0,plain:true,frame:true,border:false,defaults:{anchor:"90%",msgTarget:"side",allowBlank:false},items:[{xtype:"fileuploadfield",id:"form-file",width:120,emptyText:OpenLayers.i18n("selectWMCFile"),hideLabel:true,buttonText:"",name:"Fileconten",buttonCfg:{text:"",iconCls:"selectfile"}}],buttons:[{text:OpenLayers.i18n("selectWMCFile.loadButtonText"),scope:this,handler:function(){if(fp.getForm().isValid()){fp.getForm().submit({url:"../../wmc/load.wmc",success:this.onSuccessLoad,failure:this.onFailure,scope:this})
}}},{text:OpenLayers.i18n("selectWMCFile.mergeButtonText"),scope:this,handler:function(){if(fp.getForm().isValid()){fp.getForm().submit({url:"../../wmc/load.wmc",success:this.onSuccessMerge,failure:this.onFailure,scope:this})
}}}]});
this.add(fp);
this.doLayout()
},onSuccessLoad:function(form,action){var json=action.response.responseText;
var o=Ext.decode(json);
if(o.success){var cb=OpenLayers.Function.bind(this.parseWMCLoad,this);
OpenLayers.loadURL(o.url,null,null,cb)
}else{this.onAjaxFailure()
}},onSuccessMerge:function(form,action){var json=action.response.responseText;
var o=Ext.decode(json);
if(o.success){var cb=OpenLayers.Function.bind(this.parseWMCMerge,this);
OpenLayers.loadURL(o.url,null,null,cb)
}else{this.onAjaxFailure()
}},onFailure:function(form,action){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:OpenLayers.i18n("errorTitle"),msg:OpenLayers.i18n("InvalidWMC"),buttons:Ext.MessageBox.OK})
},parseWMCLoad:function(response){GeoNetwork.WMCManager.loadWmc(this.map,response.responseText);
Ext.WindowMgr.getActive().close()
},parseWMCMerge:function(response){GeoNetwork.WMCManager.mergeWmc(this.map,response.responseText);
Ext.WindowMgr.getActive().close()
}});Ext.namespace("GeoNetwork");
GeoNetwork.DisclaimerWindow=function(config){Ext.apply(this,config);
GeoNetwork.DisclaimerWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.DisclaimerWindow,Ext.Window,{disclaimer:null,initComponent:function(){GeoNetwork.BaseWindow.superclass.initComponent.call(this);
this.id="disclaimerwindow";
this.constrainHeader=true;
this.layout="fit";
this.plain=true;
this.stateful=false;
this.title=OpenLayers.i18n("disclaimer.windowTitle");
this.minWidth=440;
this.minHeight=280;
this.width=440;
this.height=280;
this.autoScroll=true;
this.modal=true;
this.addButton(OpenLayers.i18n("disclaimer.buttonClose"),function(){this.close()
},this);
if(this.disclaimer.startsWith("http://")){this.on("show",this.showDisclaimerUrl)
}else{var textArea=new Ext.form.TextArea({hideLabel:true,name:"msg",value:this.disclaimer,anchor:"100% -53",enableKeyEvents:true,listeners:{keydown:function(field,event){if(!(event.getKey()==67&&event.ctrlKey)){event.stopEvent()
}}}});
this.add(textArea)
}this.doLayout()
},showDisclaimerUrl:function(){this.load({url:OpenLayers.ProxyHost+this.disclaimer,text:OpenLayers.i18n("disclaimer.loading"),timeout:30,scripts:false})
}});Ext.namespace("GeoNetwork");
GeoNetwork.LayerStylesWindow=function(config){Ext.apply(this,config);
GeoNetwork.LayerStylesWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.LayerStylesWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.LayerStylesWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("layerStylesWindowTitle");
this.width=575;
this.height=300;
this.layerStylesPanel=new GeoNetwork.wms.LayerStylesPanel({map:this.map});
this.add(this.layerStylesPanel);
this.addButton(OpenLayers.i18n("selectStyleButton"),this._selectStyle,this);
this.doLayout()
},showLayerStyles:function(layer){this.layer=layer;
this.layerStylesPanel.showLayerStyles(layer)
},_selectStyle:function(){this.layer.mergeNewParams({styles:this.layerStylesPanel.selectedStyle});
this.layer.legendURL=this.layerStylesPanel.selectedStyleLegendUrl
}});Ext.namespace("GeoNetwork");
GeoNetwork.WmsLayerMetadataWindow=function(config){Ext.apply(this,config);
GeoNetwork.WmsLayerMetadataWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.WmsLayerMetadataWindow,GeoNetwork.BaseWindow,{layer:null,initComponent:function(){GeoNetwork.WmsLayerMetadataWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("layerInfoPanel.windowTitle");
this.width=575;
this.height=300;
this.infoLayerPanel=new GeoNetwork.wms.LayerInfoPanel({map:this.map});
this.add(this.infoLayerPanel);
this.doLayout()
},showLayerInfo:function(layer){this.infoLayerPanel.layer=layer;
this.infoLayerPanel.onlineresource=layer.url;
this.infoLayerPanel.showLayerInfo()
}});Ext.namespace("GeoNetwork");
GeoNetwork.WMSTimeWindow=function(config){Ext.apply(this,config);
GeoNetwork.WMSTimeWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.WMSTimeWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.WMSTimeWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("WMSTimeWindowTitle");
this.width=450;
this.height=300;
this.timeSelector=new GeoNetwork.TimeSelector({bodyStyle:"padding: 10px 10px 0 10px;"});
this.add(this.timeSelector);
this.doLayout()
},setLayer:function(layer){this.timeSelector.setLayer(layer)
}});GeoNetwork.Settings={};
OpenLayers.ProxyHostURL="../../proxy?url=";
OpenLayers.ProxyHost=function(url){if(url&&url.indexOf(window.location.host)!=-1){return url
}else{return OpenLayers.ProxyHostURL+encodeURIComponent(url)
}};
GeoNetwork.Util.defaultLocale="en";
GeoNetwork.searchDefault={activeMapControlExtent:false};
GeoNetwork.advancedFormButton=true;
GeoNetwork.Settings.editor={defaultViewMode:"simple"};
GeoNetwork.Settings.mdStore=GeoNetwork.data.MetadataResultsStore();
GeoNetwork.Settings.searchService="xml.search";
GeoNetwork.MapModule=true;
GeoNetwork.ProjectionList=[["EPSG:4326","WGS84 (lat/lon)"]];
GeoNetwork.WMSList=[["Geoserver","http://localhost/geoserver/wms?"]];
GeoNetwork.defaultViewMode="view-simple";
Ext.BLANK_IMAGE_URL="../js/ext/resources/images/default/s.gif";OpenLayers.DOTS_PER_INCH=90.71;
OpenLayers.ImgPath="../js/OpenLayers/img/";
OpenLayers.IMAGE_RELOAD_ATTEMPTS=3;
OpenLayers.Util.onImageLoadErrorColor="transparent";
OpenLayers.Lang.setCode(GeoNetwork.defaultLocale);
OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;
if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){this.src=this.src
}else{this.style.backgroundColor=OpenLayers.Util.onImageLoadErrorColor;
this.style.display="none"
}};
Proj4js.defs["EPSG:2154"]="+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";
GeoNetwork.map.printCapabilities="../../pdf";
GeoNetwork.map.PROJECTION="EPSG:4326";
GeoNetwork.map.EXTENT=new OpenLayers.Bounds(-180,-90,180,90);
GeoNetwork.map.BACKGROUND_LAYERS=[new OpenLayers.Layer.WMS("Background layer","/geoserver/wms",{layers:"gn:world,gn:gboundaries",format:"image/jpeg"},{isBaseLayer:true})];
GeoNetwork.map.MAP_OPTIONS={projection:GeoNetwork.map.PROJECTION,maxExtent:GeoNetwork.map.EXTENT,restrictedExtent:GeoNetwork.map.EXTENT,controls:[]};
GeoNetwork.map.MAIN_MAP_OPTIONS={projection:GeoNetwork.map.PROJECTION,maxExtent:GeoNetwork.map.EXTENT,restrictedExtent:GeoNetwork.map.EXTENT,controls:[]};Ext.namespace("GeoNetwork");
var mapInit=false;
var activeIndex=0;
GeoNetwork.mapApp=function(){var toolbar,toctoolbar,tocbbar,viewport;
var tree,legendPanel,mapLateralPanel,printPanel,printProvider,printPage,pageLayer;
var featureinfo;
var activeNode;
var map;
var fixedScales;
var featureinfolayer;
var layerLoadingMask;
var layers;
var setMap=function(mapC){map=mapC
};
var createMap=function(mapOptions,scales){var options=mapOptions||{projection:"EPSG:4326",units:"degrees",maxExtent:new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:new OpenLayers.Bounds(-180,-90,180,90),controls:[]};
map=new OpenLayers.Map("ol_map",options);
fixedScales=scales
};
var createWmsLayer=function(name,url,params,options){map.addLayer(new OpenLayers.Layer.WMS(name,url,params,options))
};
var createLayer=function(olLayer){map.addLayer(olLayer)
};
var createDummyBaseLayer=function(){var graphic=new OpenLayers.Layer.Image("Dummy","../../../js/OpenLayers/img/blank.gif",new OpenLayers.Bounds(0,300000,300000,625000),map.getSize(),{isBaseLayer:true,displayInLayerSwitcher:false});
map.addLayer(graphic)
};
var addMapControls=function(){map.addControl(new GeoNetwork.Control.ZoomWheel());
map.addControl(new OpenLayers.Control.LoadingPanel())
};
var removeLayerHandler=function(node){if(node){var layer;
layer=node.attributes.layer;
if(layer){if(!layer.isBaseLayer){if((typeof(layer.isLoading)=="undefined")||(layer.isLoading==false)){map.removeLayer(layer);
if(activeNode==node){activeNode=null
}refreshTocToolbar(activeNode);
Ext.getCmp("toctree").getSelectionModel().clearSelections()
}}}}};
var removeLayerHandlerContextMenu=function(){var node=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();
removeLayerHandler(node)
};
var wmsTimeHandler=function(node){if(node){var layer;
layer=node.attributes.layer;
if(layer&&layer.dimensions&&layer.dimensions.time){GeoNetwork.WindowManager.showWindow("wmstime");
GeoNetwork.WindowManager.getWindow("wmstime").setLayer(layer)
}}};
var wmsTimeHandlerContextMenu=function(){var node=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();
wmsTimeHandler(node)
};
var stylesLayerHandler=function(node){if(node){var layer;
layer=node.attributes.layer;
if((layer)&&(layer.styles)&&(layer.styles.length>1)){GeoNetwork.WindowManager.showWindow("layerstyles");
GeoNetwork.WindowManager.getWindow("layerstyles").showLayerStyles(layer)
}}};
var stylesLayerHandlerContextMenu=function(){var node=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();
stylesLayerHandler(node)
};
var metadataLayerHandler=function(node){if(node){var layer;
layer=node.attributes.layer;
if(layer){GeoNetwork.WindowManager.showWindow("wmsinfo");
GeoNetwork.WindowManager.getWindow("wmsinfo").showLayerInfo(layer)
}}};
var metadataLayerHandlerContextMenu=function(){var node=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();
metadataLayerHandler(node)
};
var refreshTocToolbar=function(node){if((node)&&(node.attributes.layer)){if(node.parentNode.attributes.nodeType=="gx_baselayercontainer"){Ext.getCmp("tbRemoveButton").disable()
}else{Ext.getCmp("tbRemoveButton").enable()
}Ext.getCmp("tbMetadataButton").enable();
Ext.getCmp("btnZoomToExtent").enable()
}else{Ext.getCmp("tbRemoveButton").disable();
Ext.getCmp("tbMetadataButton").disable();
Ext.getCmp("btnZoomToExtent").disable()
}};
var createPrintPanel=function(){printProvider=new GeoExt.data.PrintProvider({method:"GET",url:GeoNetwork.map.printCapabilities,autoLoad:true});
printPage=new GeoExt.data.PrintPage({printProvider:printProvider});
pageLayer=new OpenLayers.Layer.Vector(OpenLayers.i18n("printLayer"),{visibility:false});
pageLayer.addFeatures(printPage.feature);
map.addLayer(pageLayer);
map.events.register("moveend",map,function(){printPage.fit(this,{mode:"screen"})
});
printPanel=new Ext.form.FormPanel({title:OpenLayers.i18n("mf.print.print"),bodyStyle:"padding:5px",labelAlign:"top",defaults:{anchor:"100%"},items:[{xtype:"textarea",name:"comment",value:"",fieldLabel:OpenLayers.i18n("mf.print.comment"),plugins:new GeoExt.plugins.PrintPageField({printPage:printPage})},{xtype:"combo",store:printProvider.layouts,displayField:"name",fieldLabel:OpenLayers.i18n("layout"),typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintProviderField({printProvider:printProvider})},{xtype:"combo",store:printProvider.dpis,displayField:"name",fieldLabel:OpenLayers.i18n("mf.print.dpi"),tpl:'<tpl for="."><div class="x-combo-list-item">{name} dpi</div></tpl>',typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintProviderField({printProvider:printProvider}),setValue:function(v){v=parseInt(v,10)+" dpi";
Ext.form.ComboBox.prototype.setValue.apply(this,arguments)
}},{xtype:"combo",store:printProvider.scales,displayField:"name",fieldLabel:OpenLayers.i18n("mf.print.scale"),typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintPageField({printPage:printPage})},{xtype:"textfield",name:"rotation",fieldLabel:OpenLayers.i18n("mf.print.rotation"),plugins:new GeoExt.plugins.PrintPageField({printPage:printPage})}],buttons:[{text:OpenLayers.i18n("mf.print.generatingPDF"),handler:function(){printProvider.print(Ext.getCmp("mappanel"),printPage)
}}],listeners:{beforeexpand:function(){this.setVisibility(true)
},beforecollapse:function(){this.setVisibility(false)
},scope:pageLayer}})
};
var createToolbars=function(){toctoolbar=[];
var action=new GeoExt.Action({handler:function(){GeoNetwork.WindowManager.showWindow("addwms")
},iconCls:"addLayer",tooltip:"Add layer"});
toctoolbar.push(action);
action=new GeoExt.Action({id:"tbRemoveButton",handler:function(){removeLayerHandler(activeNode)
},iconCls:"deleteLayer",tooltip:"Remove layer"});
toctoolbar.push(action);
toctoolbar.push("-");
action=new GeoExt.Action({id:"tbMetadataButton",handler:function(){metadataLayerHandler(activeNode)
},iconCls:"wmsInfo",tooltip:"WMS Information"});
toctoolbar.push(action);
toolbar=[];
action=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:map,iconCls:"zoomfull"});
toolbar.push(action);
toolbar.push("-");
action=new GeoExt.Action({iconCls:"zoomlayer",id:"btnZoomToExtent",handler:function(){var node=activeNode;
var layer;
if(node){layer=node.attributes.layer;
if(layer){if(layer.llbbox){var mapProj=map.getProjectionObject();
var wgs84=new OpenLayers.Projection("WGS84");
var minMapxy=new OpenLayers.LonLat(layer.llbbox[0],layer.llbbox[1]).transform(wgs84,mapProj);
var maxMapxy=new OpenLayers.LonLat(layer.llbbox[2],layer.llbbox[3]).transform(wgs84,mapProj);
var extent=new OpenLayers.Bounds();
extent.left=minMapxy.lon;
extent.right=maxMapxy.lon;
extent.top=maxMapxy.lat;
extent.bottom=minMapxy.lat;
map.zoomToExtent(extent)
}else{map.zoomToMaxExtent()
}}else{Ext.MessageBox.alert(OpenLayers.i18n("zoomlayer.selectLayerTitle"),OpenLayers.i18n("zoomlayer.selectLayerText"))
}}else{Ext.MessageBox.alert(OpenLayers.i18n("zoomlayer.selectLayerTitle"),OpenLayers.i18n("zoomlayer.selectLayerText"))
}}});
toolbar.push(action);
toolbar.push("-");
action=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:map,toggleGroup:"move",allowDepress:false,iconCls:"zoomin"});
toolbar.push(action);
action=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),toggleGroup:"move",allowDepress:false,map:map,iconCls:"zoomout"});
toolbar.push(action);
action=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:"move",allowDepress:false,pressed:true,map:map,iconCls:"pan"});
toolbar.push(action);
toolbar.push("-");
featureinfo=new OpenLayers.Control.WMSGetFeatureInfo({drillDown:true,infoFormat:"application/vnd.ogc.gml"});
var moveLayerToTop=function(layertomove){var idx=-1;
for(var i=0,len=map.layers.length;
i<len;
i++){var layer=map.layers[i];
if(layer!=layertomove){idx=Math.max(map.getLayerIndex(map.layers[i]),idx)
}}if(map.getLayerIndex(layertomove)<idx){map.setLayerIndex(layertomove,idx+1)
}};
featureinfolayer=new OpenLayers.Layer.Vector("Feature info",{displayInLayerSwitcher:false,styleMap:new OpenLayers.StyleMap({externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",pointRadius:12})});
featureinfo.events.on({getfeatureinfo:function(evt){var lonlat=map.getLonLatFromViewPortPx(evt.xy);
var point=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);
featureinfolayer.destroyFeatures();
featureinfolayer.addFeatures(new OpenLayers.Feature.Vector(point));
moveLayerToTop(featureinfolayer);
GeoNetwork.WindowManager.showWindow("featureinfo");
GeoNetwork.WindowManager.getWindow("featureinfo").setMap(map);
GeoNetwork.WindowManager.getWindow("featureinfo").setFeatures(evt.features)
},deactivate:function(){featureinfolayer.destroyFeatures()
}});
action=new GeoExt.Action({control:featureinfo,toggleGroup:"move",allowDepress:false,pressed:false,map:map,iconCls:"query"});
toolbar.push(action);
toolbar.push("-");
ctrl=new OpenLayers.Control.NavigationHistory();
map.addControl(ctrl);
action=new GeoExt.Action({control:ctrl.previous,disabled:true,map:map,iconCls:"back"});
toolbar.push(action);
action=new GeoExt.Action({control:ctrl.next,disabled:true,map:map,iconCls:"next"});
toolbar.push(action);
toolbar.push("-");
action=new GeoExt.Action({iconCls:"savewmc",handler:function(){GeoNetwork.WMCManager.saveContext(map)
}});
toolbar.push(action);
action=new GeoExt.Action({iconCls:"loadwmc",handler:function(){GeoNetwork.WindowManager.showWindow("loadwmc")
}});
toolbar.push(action);
toolbar.push("->");
toolbar.push({xtype:"gn_projectionselector",projections:GeoNetwork.ProjectionList,fieldLabel:OpenLayers.i18n("projectionTitle"),map:map})
};
var createMapOverlay=function(){var scaleLinePanel=new Ext.Panel({cls:"olControlScaleLine overlay-element overlay-scaleline",border:false});
scaleLinePanel.on("render",function(){var scaleLine=new OpenLayers.Control.ScaleLine({div:scaleLinePanel.body.dom});
map.addControl(scaleLine);
scaleLine.activate()
},this);
var zoomStore;
if(fixedScales&&fixedScales.length>0){var zooms=[];
var scales=fixedScales;
var units=map.baseLayer.units;
for(var i=scales.length-1;
i>=0;
i--){var scale=scales[i];
zooms.push({level:i,resolution:OpenLayers.Util.getResolutionFromScale(scale,units),scale:scale})
}zoomStore=new GeoExt.data.ScaleStore({});
zoomStore.loadData(zooms)
}else{zoomStore=new GeoExt.data.ScaleStore({map:map})
}var zoomSelector=new Ext.form.ComboBox({emptyText:"Zoom level",tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',editable:false,triggerAction:"all",mode:"local",store:zoomStore,width:110});
zoomSelector.on("click",function(evt){evt.stopEvent()
});
zoomSelector.on("mousedown",function(evt){evt.stopEvent()
});
zoomSelector.on("select",function(combo,record,index){map.zoomTo(record.data.level)
},this);
var zoomSelectorWrapper=new Ext.Panel({items:[zoomSelector],cls:"overlay-element overlay-scalechooser",border:false});
map.events.register("zoomend",this,function(){var scale=zoomStore.queryBy(function(record){return map.getZoom()==record.data.level
});
if(scale.length>0){scale=scale.items[0];
zoomSelector.setValue("1 : "+parseInt(scale.data.scale,10))
}else{if(!zoomSelector.rendered){return
}zoomSelector.clearValue()
}});
var mapOverlay=new Ext.Panel({cls:"map-overlay",items:[scaleLinePanel,zoomSelectorWrapper]});
mapOverlay.on("afterlayout",function(){scaleLinePanel.body.dom.style.position="relative";
scaleLinePanel.body.dom.style.display="inline";
mapOverlay.getEl().on("click",function(x){x.stopEvent()
});
mapOverlay.getEl().on("mousedown",function(x){x.stopEvent()
})
},this);
return mapOverlay
};
var createMeasureControl=function(handlerType,title){var styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:0.3}}})]})});
var cleanup=function(){if(measureToolTip){measureToolTip.destroy()
}};
var makeString=function(metricData){var metric=metricData.measure;
var metricUnit=metricData.units;
measureControl.displaySystem="english";
var englishData=metricData.geometry.CLASS_NAME.indexOf("LineString")>-1?measureControl.getBestLength(metricData.geometry):measureControl.getBestArea(metricData.geometry);
var english=englishData[0];
var englishUnit=englishData[1];
measureControl.displaySystem="metric";
var dim=metricData.order==2?"<sup>2</sup>":"";
return metric.toFixed(2)+" "+metricUnit+dim+"<br>"+english.toFixed(2)+" "+englishUnit+dim
};
var measureToolTip;
var measureControl=new OpenLayers.Control.Measure(handlerType,{persist:true,handlerOptions:{layerOptions:{styleMap:styleMap}},eventListeners:{measurepartial:function(event){cleanup();
measureToolTip=new Ext.ToolTip({html:makeString(event),title:title,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:cleanup}});
if(event.measure>0){var px=measureControl.handler.lastUp;
var p0=Ext.getCmp("mappanel").getPosition();
measureToolTip.targetXY=[p0[0]+px.x,p0[1]+px.y];
measureToolTip.show()
}},measure:function(event){cleanup();
measureToolTip=new Ext.ToolTip({target:Ext.getBody(),html:makeString(event),title:title,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:function(){measureControl.cancel();
cleanup()
}}})
},deactivate:cleanup,scope:this}});
return measureControl
};
var createTree=function(){var treeConfig=new OpenLayers.Format.JSON().write([{nodeType:"gx_baselayercontainer"},{nodeType:"gx_overlaylayercontainer",expanded:true,loader:{baseAttrs:{radioGroup:"foo",slider:"layeropacityslider",uiProvider:"layernodeui"}}}],true);
var LayerNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin());
tree=new Ext.tree.TreePanel({title:OpenLayers.i18n("layerTree"),id:"toctree",enableDD:true,loader:new Ext.tree.TreeLoader({applyLoader:false,uiProviders:{layernodeui:LayerNodeUI}}),plugins:[new GeoExt.plugins.TreeNodeRadioButton({listeners:{radiochange:function(node){activeNode=node
}}}),new GeoExt.tree.LayerOpacitySliderPlugin({listeners:{opacityslide:function(node,value){}}})],root:{nodeType:"async",children:Ext.decode(treeConfig)},listeners:{contextmenu:function(node,e){if((node.attributes.nodeType!="gx_overlaylayercontainer")&&(node.attributes.nodeType!="gx_baselayercontainer")){node.select();
var c=node.getOwnerTree().contextMenu;
if(node.parentNode.attributes.nodeType=="gx_baselayercontainer"){c.items.get("removeMenu").disable()
}else{c.items.get("removeMenu").enable()
}c.items.get("addMenu").hide();
c.contextNode=node;
c.showAt(e.getXY())
}else{if(node.attributes.nodeType=="gx_overlaylayercontainer"){node.select();
c=node.getOwnerTree().contextMenu;
c.items.get("addMenu").show();
c.items.get("removeMenu").hide();
c.items.get("metadataMenu").hide();
c.contextNode=node;
c.showAt(e.getXY())
}}},scope:this},contextMenu:new Ext.menu.Menu({items:[{text:"Add layer",id:"addMenu",handler:function(){GeoNetwork.WindowManager.showWindow("addwms")
}},{text:OpenLayers.i18n("removeButtonText"),id:"removeMenu",handler:removeLayerHandlerContextMenu},{text:"WMS information",id:"metadataMenu",handler:metadataLayerHandlerContextMenu}]}),tbar:toctoolbar,rootVisible:false,lines:false,border:false,region:"center"})
};
var createLegendPanel=function(){legendPanel=new GeoExt.LegendPanel({defaults:{labelCls:"mylabel",style:"padding:5px"},title:"Legend",height:200,autoScroll:true,split:true,collapsible:true,collapsed:true,border:false,region:"south"})
};
var createViewport=function(){createToolbars();
createTree();
createLegendPanel();
createPrintPanel();
var mapOverlay=createMapOverlay();
var accordion=new Ext.Panel({region:"center",border:false,layout:"accordion",deferredRender:false,items:[tree,printPanel]});
viewport=new Ext.Panel({layout:"border",border:false,items:[{region:"east",xtype:"panel",collapsible:true,collapsed:true,collapseMode:"mini",split:true,border:false,width:170,minSize:170,maxSize:300,layout:"border",items:[accordion,legendPanel]},{region:"center",layout:"fit",frame:false,border:false,margins:"0 0 0 0",items:[{id:"mappanel",xtype:"gx_mappanel",map:map,tbar:toolbar,border:false,center:[155000,463000],zoom:2,items:[mapOverlay]}]}]});
Ext.getCmp("toctree").on({click:function(node){if(node.ui.radio){node.ui.radio.checked=true;
node.ui.fireEvent("radiochange",node)
}refreshTocToolbar(node)
},scope:this});
Ext.getCmp("toctree").on("nodedragover",function(evt){if((evt.dropNode.parentNode.attributes.nodeType=="gx_baselayercontainer")||(evt.target.attributes.nodeType=="gx_baselayercontainer")||(evt.target.parentNode.attributes.nodeType=="gx_baselayercontainer")||(evt.target.parentNode==evt.tree.root)){evt.cancel=true
}});
refreshTocToolbar(activeNode)
};
var processLayersSuccess=function(response){layerLoadingMask.hide();
var parser=new OpenLayers.Format.WMSCapabilities();
var caps=parser.read(response.responseXML||response.responseText);
if(caps.capability){var accessContraints=caps.service.accessContraints;
if((accessContraints)&&(accessContraints.toLowerCase()!="none")&&(accessContraints!="-")){var disclaimerWindow=new GeoNetwork.DisclaimerWindow({disclaimer:accessContraints});
disclaimerWindow.show();
disclaimerWindow=null
}if(map){for(var i=0,len=layers.length;
i<len;
i++){var name=layers[i][0];
var url=layers[i][1];
var layer=layers[i][2];
var metadata_id=layers[i][3];
var ol_layer=new OpenLayers.Layer.WMS(name,url,{layers:layer,format:"image/png",transparent:"TRUE",version:caps.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:metadata_id});
if(!GeoNetwork.OGCUtil.layerExistsInMap(ol_layer,map)){ol_layer.events.on({loadstart:function(){this.isLoading=true
}});
ol_layer.events.on({loadend:function(){this.isLoading=false
}});
var layerCap=getLayer(caps,caps.capability.layers,ol_layer);
if(layerCap){ol_layer.queryable=layerCap.queryable;
ol_layer.name=layerCap.title||ol_layer.name;
ol_layer.llbbox=layerCap.llbbox;
ol_layer.styles=layerCap.styles;
ol_layer.dimensions=layerCap.dimensions
}map.addLayer(ol_layer)
}}}}};
var processLayersFailure=function(response){layerLoadingMask.hide();
Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"))
};
var getLayer=function(caps,caplayers,layer){var findedLayer=null;
for(var i=0,len=caplayers.length;
i<len;
++i){var lr=caplayers[i];
try{var layerName=lr.name.split(",");
if(layerName.indexOf(layer.params.LAYERS)!=-1){findedLayer=lr;
break
}}catch(e){}if(typeof(lr.childLayers)!="undefined"){findedLayer=getLayer(caps,lr.childLayers,layer);
if(findedLayer!==null){break
}}}return findedLayer
};
return{init:function(layers,mapOptions,fixedScales){createMap(mapOptions,fixedScales);
for(var i=0;
i<layers.length;
i++){createLayer(layers[i].clone())
}GeoExt.MapPanel.guess=function(){return Ext.getCmp("mappanel")
};
createViewport();
addMapControls();
GeoNetwork.WindowManager.registerWindow("addwms",GeoNetwork.AddWmsLayerWindow,{map:map,id:"addwms"});
GeoNetwork.WindowManager.registerWindow("wmsinfo",GeoNetwork.WmsLayerMetadataWindow,{map:map,id:"wmsinfo"});
GeoNetwork.WindowManager.registerWindow("loadwmc",GeoNetwork.LoadWmcWindow,{map:map,id:"loadwmc"});
GeoNetwork.WindowManager.registerWindow("featureinfo",GeoNetwork.FeatureInfoWindow,{map:map,id:"featureinfo",control:featureinfo});
map.addLayer(featureinfolayer)
},addWMSLayer:function(layerList){if(layerList.length===0){return
}var onlineResource=layerList[0][1];
if(layerList[0][2]==""){GeoNetwork.WindowManager.showWindow("addwms");
var panel=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);
panel.setURL(onlineResource);
return
}layerLoadingMask=new Ext.LoadMask(map.div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});
layerLoadingMask.show();
layers=layerList;
var params={service:"WMS",request:"GetCapabilities",version:"1.1.1"};
var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
var req=OpenLayers.Request.GET({url:onlineResource,success:processLayersSuccess,failure:processLayersFailure,timeout:10000})
},getViewport:function(){return viewport
},refreshViewport:function(){Ext.get("west_panel").setWidth(westPanelWidth);
viewport.doLayout()
},getMap:function(){return map
}}
};function initShortcut(){var searchConfig=[{key:"s",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("runSearch"),fn:function(){Ext.getCmp("searchBt").fireEvent("click")
}},{key:"f",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("focusOnAny"),fn:function(){Ext.getCmp("E_any").focus(true)
}},{key:"d",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("hideSearchForm"),fn:function(){var r=Ext.getCmp("west");
r.toggleCollapse()
}},{key:"v",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("switchMode"),fn:function(){app.switchMode(null,true)
}},{key:"r",ctrl:true,shift:true,label:OpenLayers.i18n("resetSearchForm"),fn:function(){Ext.getCmp("resetBt").fireEvent("click")
}},{key:"l",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("focusOnLogin"),fn:function(){Ext.getCmp("username").focus(true)
}},{key:"i",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("displayInfoPanel"),fn:function(){var infoPanel=Ext.getCmp("infoPanel");
var resultsPanel=Ext.getCmp("resultsPanel");
if(resultsPanel.isVisible()){resultsPanel.hide()
}if(!infoPanel.isVisible()){infoPanel.show()
}}},{key:"h",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("displayHelpPanel"),fn:function(){var ss=Ext.getDom("shortcut").style;
if(ss.display=="block"){Ext.getDom("shortcut").style.display="none"
}else{Ext.getDom("shortcut").style.display="block"
}}}];
var map=new Ext.KeyMap(document,searchConfig);
map.enable();
var help="";
for(var i=0;
i<searchConfig.length;
i++){var c=searchConfig[i];
help+="<tr><td>"+(c.ctrl===true?'<span class="label">&lt;Ctrl&gt;</span> + ':"")+(c.shift===true?'<span class="label">&lt;Shift&gt;</span> + ':"")+'<span class="label">'+c.key+"</span>:</td><td>"+c.label+"</td></tr>"
}var html="<table><tbody><tr><td>"+help+"</td></tr></tbody></table>";
Ext.DomHelper.insertHtml("afterEnd",Ext.getDom("shortcutHelp"),html);
var formMap=new Ext.KeyMap("searchForm",[{key:[10,13],fn:function(){Ext.getCmp("searchBt").fireEvent("click")
}}]);
formMap.enable()
};Ext.namespace("GeoNetwork");
var catalogue;
var app;
GeoNetwork.app=function(){var geonetworkUrl;
var searching=false;
var editorWindow;
var editorPanel;
var urlParameters={};
var catalogue;
var iMap;
var searchForm;
var resultsPanel;
var metadataResultsView;
var tBar,bBar;
var mainTagCloudViewPanel,tagCloudViewPanel,infoPanel;
var visualizationModeInitialized=false;
function createModeSwitcher(){var ms={xtype:"radiogroup",id:"ms",hidden:!GeoNetwork.MapModule,items:[{name:"mode",ctCls:"mn-main",boxLabel:OpenLayers.i18n("discovery"),id:"discoveryMode",width:110,inputValue:0,checked:true},{name:"mode",ctCls:"mn-main",width:140,boxLabel:OpenLayers.i18n("visualization"),id:"visualizationMode",inputValue:1}],listeners:{change:function(rg,checked){app.switchMode(checked.getGroupValue(),false)
}}};
return new Ext.form.FormPanel({renderTo:"mode-form",border:false,layout:"hbox",items:ms})
}function initMap(){iMap=new GeoNetwork.mapApp();
iMap.init(GeoNetwork.map.BACKGROUND_LAYERS,GeoNetwork.map.MAIN_MAP_OPTIONS);
metadataResultsView.addMap(iMap.getMap());
visualizationModeInitialized=true
}function createLanguageSwitcher(lang){return new Ext.form.FormPanel({renderTo:"lang-form",width:80,border:false,layout:"hbox",hidden:GeoNetwork.Util.locales.length===1?true:false,items:[new Ext.form.ComboBox({mode:"local",triggerAction:"all",width:80,store:new Ext.data.ArrayStore({idIndex:0,fields:["id","name"],data:GeoNetwork.Util.locales}),valueField:"id",displayField:"name",value:lang,listeners:{select:function(cb,record,idx){window.location.replace("?hl="+cb.getValue())
}}})]})
}function createLoginForm(){var loginForm=new GeoNetwork.LoginForm({renderTo:"login-form",catalogue:catalogue});
catalogue.on("afterBadLogin",loginAlert,this)
}function loginAlert(cat,user){Ext.Msg.show({title:"Login",msg:"Login failed. Check your username and password.",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})
}function createSearchForm(){var advancedCriteria=[];
var services=catalogue.services;
var orgNameField=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:services.opensearchSuggest,field:"orgName",name:"E_orgName",fieldLabel:OpenLayers.i18n("org")});
var themekeyField=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:services.opensearchSuggest,field:"keyword",name:"E_themekey",fieldLabel:OpenLayers.i18n("keyword")});
var when=new Ext.form.FieldSet({title:OpenLayers.i18n("when"),autoWidth:true,defaultType:"datefield",collapsible:true,collapsed:true,items:GeoNetwork.util.SearchFormTools.getWhen()});
var catalogueField=GeoNetwork.util.SearchFormTools.getCatalogueField(services.getSources,services.logoUrl);
var groupField=GeoNetwork.util.SearchFormTools.getGroupField(services.getGroups);
var metadataTypeField=GeoNetwork.util.SearchFormTools.getMetadataTypeField();
var categoryField=GeoNetwork.util.SearchFormTools.getCategoryField(services.getCategories,"../images/default/category/");
var validField=GeoNetwork.util.SearchFormTools.getValidField();
var spatialTypes=GeoNetwork.util.SearchFormTools.getSpatialRepresentationTypeField();
var denominatorField=GeoNetwork.util.SearchFormTools.getScaleDenominatorField(true);
advancedCriteria.push(themekeyField,orgNameField,categoryField,when,spatialTypes,denominatorField,catalogueField,groupField,metadataTypeField,validField);
var adv={xtype:"fieldset",title:OpenLayers.i18n("advancedSearchOptions"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:(urlParameters.advanced?false:true),defaultType:"checkbox",defaults:{width:160},items:advancedCriteria};
var formItems=[];
formItems.push(GeoNetwork.util.SearchFormTools.getSimpleFormFields(catalogue.services,GeoNetwork.map.BACKGROUND_LAYERS,GeoNetwork.map.MAP_OPTIONS,true,GeoNetwork.searchDefault.activeMapControlExtent),adv);
var adminFields=[groupField,metadataTypeField,validField];
Ext.each(adminFields,function(item){item.setVisible(false)
});
catalogue.on("afterLogin",function(){Ext.each(adminFields,function(item){item.setVisible(true)
})
});
catalogue.on("afterLogout",function(){Ext.each(adminFields,function(item){item.setVisible(false)
})
});
return new Ext.FormPanel({id:"searchForm",border:false,padding:5,defaults:{width:180},listeners:{afterrender:function(){}},items:formItems,buttons:[{tooltip:OpenLayers.i18n("resetSearchForm"),id:"resetBt",icon:"../images/default/cross.png",listeners:{click:function(){Ext.getCmp("searchForm").getForm().reset()
}}},{text:OpenLayers.i18n("search"),id:"searchBt",icon:"../js/GeoNetwork/resources/images/default/find.png",iconAlign:"right",listeners:{click:function(){if(Ext.getCmp("geometryMap")){metadataResultsView.addMap(Ext.getCmp("geometryMap").map,true)
}var any=Ext.get("E_any");
if(any){if(any.getValue()===OpenLayers.i18n("fullTextSearch")){any.setValue("")
}}catalogue.startRecord=1;
search()
}}}]})
}function search(){searching=true;
catalogue.search("searchForm",app.loadResults,null,catalogue.startRecord,true);
var infoPanel=Ext.getCmp("infoPanel"),resultsPanel=Ext.getCmp("resultsPanel"),tagCloudPanel=Ext.getCmp("tagCloudPanel");
if(infoPanel.isVisible()){infoPanel.hide()
}if(!resultsPanel.isVisible()){resultsPanel.show()
}if(!tagCloudPanel.isVisible()){tagCloudPanel.show()
}if(GeoNetwork.MapModule&&!visualizationModeInitialized){initMap()
}}function createBBar(){var previousAction=new Ext.Action({id:"previousBt",text:"&lt;&lt;",handler:function(){catalogue.startRecord-=parseInt(Ext.getCmp("E_hitsperpage").getValue(),10);
search()
},scope:this});
var nextAction=new Ext.Action({id:"nextBt",text:"&gt;&gt;",handler:function(){catalogue.startRecord+=parseInt(Ext.getCmp("E_hitsperpage").getValue(),10);
search()
},scope:this});
return new Ext.Toolbar({items:[previousAction,"|",nextAction,"|",{xtype:"tbtext",text:"",id:"info"}]})
}function createResultsPanel(){metadataResultsView=new GeoNetwork.MetadataResultsView({catalogue:catalogue,autoScroll:true,tpl:GeoNetwork.Templates.FULL});
catalogue.resultsView=metadataResultsView;
tBar=new GeoNetwork.MetadataResultsToolbar({catalogue:catalogue,searchBtCmp:Ext.getCmp("searchBt"),sortByCmp:Ext.getCmp("E_sortBy"),metadataResultsView:metadataResultsView});
bBar=createBBar();
resultPanel=new Ext.Panel({id:"resultsPanel",border:false,hidden:true,bodyCssClass:"md-view",autoWidth:true,layout:"fit",tbar:tBar,items:metadataResultsView,bbar:bBar});
return resultPanel
}function loadCallback(el,success,response,options){if(success){createMainTagCloud()
}else{Ext.get("infoPanel").getUpdater().update({url:"home_en.html"});
Ext.get("helpPanel").getUpdater().update({url:"help_en.html"})
}}function createInfoPanel(){return new Ext.Panel({border:true,id:"infoPanel",baseCls:"md-info",autoWidth:true,contentEl:"infoContent",autoLoad:{url:"home_"+catalogue.LANG+".html",callback:loadCallback,scope:this,loadScripts:false}})
}function createHelpPanel(){return new Ext.Panel({border:false,frame:false,baseCls:"none",id:"helpPanel",autoWidth:true,renderTo:"shortcut",autoLoad:{url:"help_"+catalogue.LANG+".html",callback:initShortcut,scope:this,loadScripts:false}})
}function createMainTagCloud(){var tagCloudView=new GeoNetwork.TagCloudView({catalogue:catalogue,query:"fast=true&summaryOnly=true",renderTo:"tag",onSuccess:"app.loadResults"});
return tagCloudView
}function createTagCloud(){var tagCloudView=new GeoNetwork.TagCloudView({catalogue:catalogue});
return new Ext.Panel({id:"tagCloudPanel",border:true,hidden:true,baseCls:"md-view",items:tagCloudView})
}function edit(metadataId,create,group,child){if(!this.editorWindow){this.editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:GeoNetwork.Settings.editor.defaultViewMode,catalogue:catalogue,xlinkOptions:{CONTACT:true}});
this.editorWindow=new Ext.Window({tools:[{id:"newwindow",qtip:OpenLayers.i18n("newWindow"),handler:function(e,toolEl,panel,tc){window.open(GeoNetwork.Util.getBaseUrl(location.href)+"#edit="+metadataId);
panel.hide()
},scope:this}],title:OpenLayers.i18n("mdEditor"),id:"editorWindow",layout:"fit",modal:false,items:this.editorPanel,closeAction:"hide",collapsible:true,collapsed:false,maximizable:true,maximized:true,resizable:true,width:980,height:800});
this.editorPanel.setContainer(this.editorWindow);
this.editorPanel.on("editorClosed",function(){Ext.getCmp("searchBt").fireEvent("click")
})
}if(metadataId){this.editorWindow.show();
this.editorPanel.init(metadataId,create,group,child)
}}function createHeader(){var info=catalogue.getInfo();
Ext.getDom("title").innerHTML='<img class="catLogo" src="../../images/logos/'+info.siteId+'.gif"/>&nbsp;'+info.name
}return{init:function(){geonetworkUrl=GeoNetwork.URL||window.location.href.match(/(http.*\/.*)\/apps\/search.*/,"")[1];
urlParameters=GeoNetwork.Util.getParameters(location.href);
var lang=GeoNetwork.Util.getCatalogueLang(urlParameters.hl||GeoNetwork.defaultLocale);
if(urlParameters.extent){urlParameters.bounds=new OpenLayers.Bounds(urlParameters.extent[0],urlParameters.extent[1],urlParameters.extent[2],urlParameters.extent[3])
}catalogue=new GeoNetwork.Catalogue({statusBarId:"info",lang:lang,hostUrl:geonetworkUrl,mdOverlayedCmpId:"resultsPanel",adminAppUrl:geonetworkUrl+"/srv/"+lang+"/admin",metadataStore:GeoNetwork.Settings.mdStore,metadataCSWStore:GeoNetwork.data.MetadataCSWResultsStore(),summaryStore:GeoNetwork.data.MetadataSummaryStore(),editMode:2,metadataEditFn:edit});
createHeader();
catalogue.setServiceUrl("xmlSearch",GeoNetwork.Settings.searchService);
searchForm=createSearchForm();
createModeSwitcher();
createLanguageSwitcher(lang);
createLoginForm();
edit();
resultsPanel=createResultsPanel();
infoPanel=createInfoPanel();
helpPanel=createHelpPanel();
tagCloudViewPanel=createTagCloud();
var margins="35 0 0 0";
var viewport=new Ext.Viewport({layout:"border",id:"vp",items:[{region:"west",id:"west",split:true,minWidth:300,width:300,maxWidth:400,autoScroll:true,collapsible:true,hideCollapseTool:true,collapseMode:"mini",margins:margins,forceLayout:true,layoutConfig:{animate:true},items:[searchForm,tagCloudViewPanel]},{region:"center",id:"center",split:true,margins:margins,items:[infoPanel,resultPanel]},{region:"east",id:"east",layout:"fit",split:true,collapsible:true,hideCollapseTool:true,collapseMode:"mini",collapsed:true,hidden:!GeoNetwork.MapModule,margins:margins,minWidth:300,width:500}]});
if(urlParameters.mode){app.switchMode(urlParameters.mode,false)
}GeoNetwork.util.SearchTools.populateFormFromParams(searchForm,urlParameters);
if(urlParameters.search!==undefined){Ext.getCmp("searchBt").fireEvent("click")
}if(urlParameters.edit!==undefined&&urlParameters.edit!==""){catalogue.metadataEdit(urlParameters.edit)
}if(urlParameters.create!==undefined){resultPanel.getTopToolbar().createMetadataAction.fireEvent("click")
}if(urlParameters.uuid!==undefined){catalogue.metadataShow(urlParameters.uuid,true)
}else{if(urlParameters.id!==undefined){catalogue.metadataShowById(urlParameters.id,true)
}}Ext.get("E_any").setWidth(285);
Ext.get("E_any").setHeight(28);
if(GeoNetwork.searchDefault.activeMapControlExtent){Ext.getCmp("geometryMap").setExtent()
}if(urlParameters.bounds){Ext.getCmp("geometryMap").map.zoomToExtent(urlParameters.bounds)
}resultPanel.setHeight(Ext.getCmp("center").getHeight());
var events=["afterDelete","afterRating","afterLogout","afterLogin"];
Ext.each(events,function(e){catalogue.on(e,function(){if(searching===true){Ext.getCmp("searchBt").fireEvent("click")
}})
})
},getIMap:function(){if(!iMap){initMap()
}return iMap
},getCatalogue:function(){return catalogue
},loadResults:function(response){Ext.getCmp("previousBt").setDisabled(catalogue.startRecord===1);
Ext.getCmp("nextBt").setDisabled(catalogue.startRecord+parseInt(Ext.getCmp("E_hitsperpage").getValue(),10)>catalogue.metadataStore.totalLength);
if(Ext.getCmp("E_sortBy").getValue()){Ext.getCmp("sortByToolBar").setValue(Ext.getCmp("E_sortBy").getValue()+"#"+Ext.getCmp("sortOrder").getValue())
}else{Ext.getCmp("sortByToolBar").setValue(Ext.getCmp("E_sortBy").getValue())
}resultsPanel.syncSize();
resultsPanel.setHeight(Ext.getCmp("center").getHeight());
Ext.getCmp("west").syncSize();
Ext.getCmp("center").syncSize();
Ext.ux.Lightbox.register("a[rel^=lightbox]")
},switchMode:function(mode,force){var ms=Ext.getCmp("ms"),e=Ext.getCmp("east"),c=Ext.getCmp("center"),w=Ext.getCmp("west"),currentMode;
if(mode===null){currentMode=ms.getValue().getGroupValue();
if(currentMode==="0"){ms.onSetValue(Ext.getCmp("visualizationMode"),true)
}else{ms.onSetValue(Ext.getCmp("discoveryMode"),true)
}mode=currentMode=ms.getValue().getGroupValue()
}if(force){if(mode==="1"){ms.onSetValue(Ext.getCmp("visualizationMode"),true)
}else{ms.onSetValue(Ext.getCmp("discoveryMode"),true)
}}if(mode==="1"&&!visualizationModeInitialized){initMap()
}if(mode==="1"&&iMap){e.add(iMap.getViewport());
e.doLayout();
if(e.collapsed){e.toggleCollapse()
}if(!w.collapsed){w.toggleCollapse()
}Ext.getCmp("vp").syncSize()
}else{if(!e.collapsed){e.toggleCollapse()
}if(w.collapsed){w.toggleCollapse()
}}}}
};
Ext.onReady(function(){var lang=/hl=([a-z]{2})/.exec(location.href);
GeoNetwork.Util.setLang(lang&&lang[1],"..");
Ext.QuickTips.init();
setTimeout(function(){Ext.get("loading").remove();
Ext.get("loading-mask").fadeOut({remove:true})
},250);
app=new GeoNetwork.app();
app.init();
catalogue=app.getCatalogue();
Ext.getDom("E_any").focus(true)
});